{"version":3,"sources":["../src/battle-dex.ts"],"names":["window","global","exports","nodewebkit","process","versions","toID","text","id","userid","toLowerCase","replace","toUserid","PSUtils","splitFirst","str","delimiter","limit","splitStr","length","delimiterIndex","indexOf","push","slice","compare","a","b","localeCompare","Array","isArray","i","comparison","reverse","Error","sortBy","array","callback","sort","toRoomid","roomid","toName","name","trim","substr","Dex","gen","modid","cache","statNames","statNamesExceptHP","pokeballs","resourcePrefix","prefix","document","location","protocol","fxPrefix","loadedSpriteData","xy","bw","moddedDexes","moves","get","nameOrMove","BattleAliases","BattleMovedex","data","exists","exec","hpWithType","hpPower","basePower","Number","move","Move","items","nameOrItem","BattleItems","item","Item","abilities","nameOrAbility","BattleAbilities","ability","Ability","species","nameOrSpecies","formid","BattlePokedexAltForms","BattlePokedex","BattleBaseSpeciesChart","baseSpeciesId","startsWith","tier","baseSpecies","Species","cosmeticFormes","forme","baseForme","otherFormes","types","allCache","type","toUpperCase","BattleTypeChart","damageTaken","effectType","all","isName","hasOwnProperty","mod","BattleTeambuilderTable","ModdedDex","forGen","resolveAvatar","avatar","BattleAvatarNumbers","charAt","includes","Config","server","registered","port","host","encodeURIComponent","sanitizeName","prefs","prop","Storage","getShortName","shortName","getEffect","PureEffect","getGen3Category","hasAbility","loadSpriteData","path","$","attr","qs","split","match","el","createElement","src","getElementsByTagName","appendChild","getSpriteData","pokemon","isFront","options","mechanicsGen","isDynamax","dynamax","Pokemon","volatiles","transform","shiny","gender","isGigantamax","getSpeciesForme","endsWith","spriteData","w","h","y","url","pixelated","isFrontSprite","cryurl","spriteid","dir","facing","graphicsGen","Math","max","min","baseDir","animationData","miscData","speciesid","isTotem","BattlePokemonSprites","BattlePokemonSpritesBW","num","baseSpeciesid","formeid","isMega","afd","noScale","allowAnim","getPokemonIconNum","isFemale","facingLeft","BattlePokemonIconIndexes","BattlePokemonIconIndexesLeft","getPokemonIcon","speciesForme","formechange","top","floor","left","fainted","getTeambuilderSpriteData","spriteDir","x","xydexExists","isNonstandard","getTeambuilderSprite","getItemIcon","spritenum","getTypeIcon","sanitizedType","getCategoryIcon","category","categoryID","sanitizedCategory","getPokeballs","Object","values","isPokeball","Moves","Items","Abilities","Types","table","overrideMoveData","assign","overrideItemDesc","shortDesc","overrideAbilityData","overrideSpeciesData","overrideTier","removeType","overrideTypeChart","parseInt","require"],"mappings":"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","sourcesContent":["/**\r\n * Pokemon Showdown Dex\r\n *\r\n * Roughly equivalent to sim/dex.js in a Pokemon Showdown server, but\r\n * designed for use in browsers rather than in Node.\r\n *\r\n * This is a generic utility library for Pokemon Showdown code: any\r\n * code shared between the replay viewer and the client usually ends up\r\n * here.\r\n *\r\n * Licensing note: PS's client has complicated licensing:\r\n * - The client as a whole is AGPLv3\r\n * - The battle replay/animation engine (battle-*.ts) by itself is MIT\r\n *\r\n * Compiled into battledata.js which includes all dependencies\r\n *\r\n * @author Guangcong Luo <guangcongluo@gmail.com>\r\n * @license MIT\r\n */\r\n\r\ndeclare var require: any;\r\ndeclare var global: any;\r\n\r\nif (typeof window === 'undefined') {\r\n\t// Node\r\n\t(global as any).window = global;\r\n} else {\r\n\t// browser (possibly NW.js!)\r\n\twindow.exports = window;\r\n}\r\n\r\n// @ts-ignore\r\nwindow.nodewebkit = !!(typeof process !== 'undefined' && process.versions && process.versions['node-webkit']);\r\n\r\nfunction toID(text: any) {\r\n\tif (text?.id) {\r\n\t\ttext = text.id;\r\n\t} else if (text?.userid) {\r\n\t\ttext = text.userid;\r\n\t}\r\n\tif (typeof text !== 'string' && typeof text !== 'number') return '' as ID;\r\n\treturn ('' + text).toLowerCase().replace(/[^a-z0-9]+/g, '') as ID;\r\n}\r\n\r\nfunction toUserid(text: any) {\r\n\treturn toID(text);\r\n}\r\n\r\ntype Comparable = number | string | boolean | Comparable[] | {reverse: Comparable};\r\nconst PSUtils = new class {\r\n\t/**\r\n\t * Like string.split(delimiter), but only recognizes the first `limit`\r\n\t * delimiters (default 1).\r\n\t *\r\n\t * `\"1 2 3 4\".split(\" \", 2) => [\"1\", \"2\"]`\r\n\t *\r\n\t * `splitFirst(\"1 2 3 4\", \" \", 1) => [\"1\", \"2 3 4\"]`\r\n\t *\r\n\t * Returns an array of length exactly limit + 1.\r\n\t */\r\n\tsplitFirst(str: string, delimiter: string, limit: number = 1) {\r\n\t\tlet splitStr: string[] = [];\r\n\t\twhile (splitStr.length < limit) {\r\n\t\t\tlet delimiterIndex = str.indexOf(delimiter);\r\n\t\t\tif (delimiterIndex >= 0) {\r\n\t\t\t\tsplitStr.push(str.slice(0, delimiterIndex));\r\n\t\t\t\tstr = str.slice(delimiterIndex + delimiter.length);\r\n\t\t\t} else {\r\n\t\t\t\tsplitStr.push(str);\r\n\t\t\t\tstr = '';\r\n\t\t\t}\r\n\t\t}\r\n\t\tsplitStr.push(str);\r\n\t\treturn splitStr;\r\n\t}\r\n\r\n\t/**\r\n\t * Compares two variables; intended to be used as a smarter comparator.\r\n\t * The two variables must be the same type (TypeScript will not check this).\r\n\t *\r\n\t * - Numbers are sorted low-to-high, use `-val` to reverse\r\n\t * - Strings are sorted A to Z case-semi-insensitively, use `{reverse: val}` to reverse\r\n\t * - Booleans are sorted true-first (REVERSE of casting to numbers), use `!val` to reverse\r\n\t * - Arrays are sorted lexically in the order of their elements\r\n\t *\r\n\t * In other words: `[num, str]` will be sorted A to Z, `[num, {reverse: str}]` will be sorted Z to A.\r\n\t */\r\n\tcompare(a: Comparable, b: Comparable): number {\r\n\t\tif (typeof a === 'number') {\r\n\t\t\treturn a - (b as number);\r\n\t\t}\r\n\t\tif (typeof a === 'string') {\r\n\t\t\treturn a.localeCompare(b as string);\r\n\t\t}\r\n\t\tif (typeof a === 'boolean') {\r\n\t\t\treturn (a ? 1 : 2) - (b ? 1 : 2);\r\n\t\t}\r\n\t\tif (Array.isArray(a)) {\r\n\t\t\tfor (let i = 0; i < a.length; i++) {\r\n\t\t\t\tconst comparison = PSUtils.compare(a[i], (b as Comparable[])[i]);\r\n\t\t\t\tif (comparison) return comparison;\r\n\t\t\t}\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t\tif (a.reverse) {\r\n\t\t\treturn PSUtils.compare((b as {reverse: string}).reverse, a.reverse);\r\n\t\t}\r\n\t\tthrow new Error(`Passed value ${a} is not comparable`);\r\n\t}\r\n\t/**\r\n\t * Sorts an array according to the callback's output on its elements.\r\n\t *\r\n\t * The callback's output is compared according to `PSUtils.compare` (in\r\n\t * particular, it supports arrays so you can sort by multiple things).\r\n\t */\r\n\tsortBy<T>(array: T[], callback: (a: T) => Comparable): T[];\r\n\t/**\r\n\t * Sorts an array according to `PSUtils.compare`. (Correctly sorts numbers,\r\n\t * unlike `array.sort`)\r\n\t */\r\n\tsortBy<T extends Comparable>(array: T[]): T[];\r\n\tsortBy<T>(array: T[], callback?: (a: T) => Comparable) {\r\n\t\tif (!callback) return (array as any[]).sort(PSUtils.compare);\r\n\t\treturn array.sort((a, b) => PSUtils.compare(callback(a), callback(b)));\r\n\t}\r\n};\r\n\r\n/**\r\n * Sanitize a room ID by removing anything that isn't alphanumeric or `-`.\r\n * Shouldn't actually do anything except against malicious input.\r\n */\r\nfunction toRoomid(roomid: string) {\r\n\treturn roomid.replace(/[^a-zA-Z0-9-]+/g, '').toLowerCase();\r\n}\r\n\r\nfunction toName(name: any) {\r\n\tif (typeof name !== 'string' && typeof name !== 'number') return '';\r\n\tname = ('' + name).replace(/[\\|\\s\\[\\]\\,\\u202e]+/g, ' ').trim();\r\n\tif (name.length > 18) name = name.substr(0, 18).trim();\r\n\r\n\t// remove zalgo\r\n\tname = name.replace(\r\n\t\t/[\\u0300-\\u036f\\u0483-\\u0489\\u0610-\\u0615\\u064B-\\u065F\\u0670\\u06D6-\\u06DC\\u06DF-\\u06ED\\u0E31\\u0E34-\\u0E3A\\u0E47-\\u0E4E]{3,}/g,\r\n\t\t''\r\n\t);\r\n\tname = name.replace(/[\\u239b-\\u23b9]/g, '');\r\n\r\n\treturn name;\r\n}\r\n\r\ninterface SpriteData {\r\n\tw: number;\r\n\th: number;\r\n\ty?: number;\r\n\tgen?: number;\r\n\turl?: string;\r\n\trawHTML?: string;\r\n\tpixelated?: boolean;\r\n\tisFrontSprite?: boolean;\r\n\tcryurl?: string;\r\n\tshiny?: boolean;\r\n}\r\n\r\ninterface TeambuilderSpriteData {\r\n\tx: number;\r\n\ty: number;\r\n\tspriteDir: string;\r\n\tspriteid: string;\r\n\tshiny?: boolean;\r\n}\r\n\r\nconst Dex = new class implements ModdedDex {\r\n\treadonly gen = 9;\r\n\treadonly modid = 'gen9' as ID;\r\n\treadonly cache = null!;\r\n\r\n\treadonly statNames: ReadonlyArray<StatName> = ['hp', 'atk', 'def', 'spa', 'spd', 'spe'];\r\n\treadonly statNamesExceptHP: ReadonlyArray<StatNameExceptHP> = ['atk', 'def', 'spa', 'spd', 'spe'];\r\n\r\n\tpokeballs: string[] | null = null;\r\n\r\n\tresourcePrefix = (() => {\r\n\t\tlet prefix = '';\r\n\t\tif (window.document?.location?.protocol !== 'http:') prefix = 'https:';\r\n\t\treturn `${prefix}//raw.githubusercontent.com/Poilerwags/Sprites/master/play.pokemonshowdown.com/`;\r\n\t})();\r\n\r\n\tfxPrefix = (() => {\r\n\t\tconst protocol = (window.document?.location?.protocol !== 'http:') ? 'https:' : '';\r\n\t\treturn `${protocol}//raw.githubusercontent.com/Poilerwags/Sprites/master/play.pokemonshowdown.com/fx/`;\r\n\t})();\r\n\r\n\tloadedSpriteData = {xy: 1, bw: 0};\r\n\tmoddedDexes: {[mod: string]: ModdedDex} = {};\r\n\r\n\tmod(modid: ID): ModdedDex {\r\n\t\tif (modid === 'gen9') return this;\r\n\t\tif (!window.BattleTeambuilderTable) return this;\r\n\t\tif (modid in this.moddedDexes) {\r\n\t\t\treturn this.moddedDexes[modid];\r\n\t\t}\r\n\t\tthis.moddedDexes[modid] = new ModdedDex(modid);\r\n\t\treturn this.moddedDexes[modid];\r\n\t}\r\n\tforGen(gen: number) {\r\n\t\tif (!gen) return this;\r\n\t\treturn this.mod(`gen${gen}` as ID);\r\n\t}\r\n\r\n\tresolveAvatar(avatar: string): string {\r\n\t\tif (window.BattleAvatarNumbers && avatar in BattleAvatarNumbers) {\r\n\t\t\tavatar = BattleAvatarNumbers[avatar];\r\n\t\t}\r\n\t\tif (avatar.charAt(0) === '#') {\r\n\t\t\treturn Dex.resourcePrefix + 'sprites/trainers-custom/' + toID(avatar.substr(1)) + '.png';\r\n\t\t}\r\n\t\tif (avatar.includes('.') && window.Config?.server?.registered) {\r\n\t\t\t// custom avatar served by the server\r\n\t\t\tlet protocol = (Config.server.port === 443) ? 'https' : 'http';\r\n\t\t\treturn protocol + '://' + Config.server.host + ':' + Config.server.port +\r\n\t\t\t\t'/avatars/' + encodeURIComponent(avatar).replace(/\\%3F/g, '?');\r\n\t\t}\r\n\t\treturn Dex.resourcePrefix + 'sprites/trainers/' + Dex.sanitizeName(avatar || 'unknown') + '.png';\r\n\t}\r\n\r\n\t/**\r\n\t * This is used to sanitize strings from data files like `moves.js` and\r\n\t * `teambuilder-tables.js`.\r\n\t *\r\n\t * This makes sure untrusted strings can't wreak havoc if someone forgets to\r\n\t * escape it before putting it in HTML.\r\n\t *\r\n\t * None of these characters belong in these files, anyway. (They can be used\r\n\t * in move descriptions, but those are served from `text.js`, which are\r\n\t * definitely always treated as unsanitized.)\r\n\t */\r\n\tsanitizeName(name: any) {\r\n\t\tif (!name) return '';\r\n\t\treturn ('' + name)\r\n\t\t\t.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;')\r\n\t\t\t.slice(0, 50);\r\n\t}\r\n\r\n\tprefs(prop: string) {\r\n\t\t// @ts-ignore\r\n\t\treturn window.Storage?.prefs?.(prop);\r\n\t}\r\n\r\n\tgetShortName(name: string) {\r\n\t\tlet shortName = name.replace(/[^A-Za-z0-9]+$/, '');\r\n\t\tif (shortName.indexOf('(') >= 0) {\r\n\t\t\tshortName += name.slice(shortName.length).replace(/[^\\(\\)]+/g, '').replace(/\\(\\)/g, '');\r\n\t\t}\r\n\t\treturn shortName;\r\n\t}\r\n\r\n\tgetEffect(name: string | null | undefined): PureEffect | Item | Ability | Move {\r\n\t\tname = (name || '').trim();\r\n\t\tif (name.substr(0, 5) === 'item:') {\r\n\t\t\treturn Dex.items.get(name.substr(5).trim());\r\n\t\t} else if (name.substr(0, 8) === 'ability:') {\r\n\t\t\treturn Dex.abilities.get(name.substr(8).trim());\r\n\t\t} else if (name.substr(0, 5) === 'move:') {\r\n\t\t\treturn Dex.moves.get(name.substr(5).trim());\r\n\t\t}\r\n\t\tlet id = toID(name);\r\n\t\treturn new PureEffect(id, name);\r\n\t}\r\n\r\n\tmoves = {\r\n\t\tget: (nameOrMove: string | Move | null | undefined): Move => {\r\n\t\t\tif (nameOrMove && typeof nameOrMove !== 'string') {\r\n\t\t\t\t// TODO: don't accept Moves here\r\n\t\t\t\treturn nameOrMove;\r\n\t\t\t}\r\n\t\t\tlet name = nameOrMove || '';\r\n\t\t\tlet id = toID(nameOrMove);\r\n\t\t\tif (window.BattleAliases && id in BattleAliases) {\r\n\t\t\t\tname = BattleAliases[id];\r\n\t\t\t\tid = toID(name);\r\n\t\t\t}\r\n\t\t\tif (!window.BattleMovedex) window.BattleMovedex = {};\r\n\t\t\tlet data = window.BattleMovedex[id];\r\n\t\t\tif (data && typeof data.exists === 'boolean') return data;\r\n\r\n\t\t\tif (!data && id.substr(0, 11) === 'hiddenpower' && id.length > 11) {\r\n\t\t\t\tlet [, hpWithType, hpPower] = /([a-z]*)([0-9]*)/.exec(id)!;\r\n\t\t\t\tdata = {\r\n\t\t\t\t\t...(window.BattleMovedex[hpWithType] || {}),\r\n\t\t\t\t\tbasePower: Number(hpPower) || 60,\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tif (!data && id.substr(0, 6) === 'return' && id.length > 6) {\r\n\t\t\t\tdata = {\r\n\t\t\t\t\t...(window.BattleMovedex['return'] || {}),\r\n\t\t\t\t\tbasePower: Number(id.slice(6)),\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tif (!data && id.substr(0, 11) === 'frustration' && id.length > 11) {\r\n\t\t\t\tdata = {\r\n\t\t\t\t\t...(window.BattleMovedex['frustration'] || {}),\r\n\t\t\t\t\tbasePower: Number(id.slice(11)),\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tif (!data) data = {exists: false};\r\n\t\t\tlet move = new Move(id, name, data);\r\n\t\t\twindow.BattleMovedex[id] = move;\r\n\t\t\treturn move;\r\n\t\t},\r\n\t};\r\n\r\n\tgetGen3Category(type: string) {\r\n\t\treturn [\r\n\t\t\t'Fire', 'Water', 'Grass', 'Electric', 'Ice', 'Psychic', 'Dark', 'Dragon',\r\n\t\t].includes(type) ? 'Special' : 'Physical';\r\n\t}\r\n\r\n\titems = {\r\n\t\tget: (nameOrItem: string | Item | null | undefined): Item => {\r\n\t\t\tif (nameOrItem && typeof nameOrItem !== 'string') {\r\n\t\t\t\t// TODO: don't accept Items here\r\n\t\t\t\treturn nameOrItem;\r\n\t\t\t}\r\n\t\t\tlet name = nameOrItem || '';\r\n\t\t\tlet id = toID(nameOrItem);\r\n\t\t\tif (window.BattleAliases && id in BattleAliases) {\r\n\t\t\t\tname = BattleAliases[id];\r\n\t\t\t\tid = toID(name);\r\n\t\t\t}\r\n\t\t\tif (!window.BattleItems) window.BattleItems = {};\r\n\t\t\tlet data = window.BattleItems[id];\r\n\t\t\tif (data && typeof data.exists === 'boolean') return data;\r\n\t\t\tif (!data) data = {exists: false};\r\n\t\t\tlet item = new Item(id, name, data);\r\n\t\t\twindow.BattleItems[id] = item;\r\n\t\t\treturn item;\r\n\t\t},\r\n\t};\r\n\r\n\tabilities = {\r\n\t\tget: (nameOrAbility: string | Ability | null | undefined): Ability => {\r\n\t\t\tif (nameOrAbility && typeof nameOrAbility !== 'string') {\r\n\t\t\t\t// TODO: don't accept Abilities here\r\n\t\t\t\treturn nameOrAbility;\r\n\t\t\t}\r\n\t\t\tlet name = nameOrAbility || '';\r\n\t\t\tlet id = toID(nameOrAbility);\r\n\t\t\tif (window.BattleAliases && id in BattleAliases) {\r\n\t\t\t\tname = BattleAliases[id];\r\n\t\t\t\tid = toID(name);\r\n\t\t\t}\r\n\t\t\tif (!window.BattleAbilities) window.BattleAbilities = {};\r\n\t\t\tlet data = window.BattleAbilities[id];\r\n\t\t\tif (data && typeof data.exists === 'boolean') return data;\r\n\t\t\tif (!data) data = {exists: false};\r\n\t\t\tlet ability = new Ability(id, name, data);\r\n\t\t\twindow.BattleAbilities[id] = ability;\r\n\t\t\treturn ability;\r\n\t\t},\r\n\t};\r\n\r\n\tspecies = {\r\n\t\tget: (nameOrSpecies: string | Species | null | undefined): Species => {\r\n\t\t\tif (nameOrSpecies && typeof nameOrSpecies !== 'string') {\r\n\t\t\t\t// TODO: don't accept Species' here\r\n\t\t\t\treturn nameOrSpecies;\r\n\t\t\t}\r\n\t\t\tlet name = nameOrSpecies || '';\r\n\t\t\tlet id = toID(nameOrSpecies);\r\n\t\t\tlet formid = id;\r\n\t\t\tif (!window.BattlePokedexAltForms) window.BattlePokedexAltForms = {};\r\n\t\t\tif (formid in window.BattlePokedexAltForms) return window.BattlePokedexAltForms[formid];\r\n\t\t\tif (window.BattleAliases && id in BattleAliases) {\r\n\t\t\t\tname = BattleAliases[id];\r\n\t\t\t\tid = toID(name);\r\n\t\t\t} else if (window.BattlePokedex && !(id in BattlePokedex) && window.BattleBaseSpeciesChart) {\r\n\t\t\t\tfor (const baseSpeciesId of BattleBaseSpeciesChart) {\r\n\t\t\t\t\tif (formid.startsWith(baseSpeciesId)) {\r\n\t\t\t\t\t\tid = baseSpeciesId;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!window.BattlePokedex) window.BattlePokedex = {};\r\n\t\t\tlet data = window.BattlePokedex[id];\r\n\r\n\t\t\tlet species: Species;\r\n\t\t\tif (data && typeof data.exists === 'boolean') {\r\n\t\t\t\tspecies = data;\r\n\t\t\t} else {\r\n\t\t\t\tif (!data) data = {exists: false};\r\n\t\t\t\tif (!data.tier && id.slice(-5) === 'totem') {\r\n\t\t\t\t\tdata.tier = this.species.get(id.slice(0, -5)).tier;\r\n\t\t\t\t}\r\n\t\t\t\tif (!data.tier && data.baseSpecies && toID(data.baseSpecies) !== id) {\r\n\t\t\t\t\tdata.tier = this.species.get(data.baseSpecies).tier;\r\n\t\t\t\t}\r\n\t\t\t\tspecies = new Species(id, name, data);\r\n\t\t\t\twindow.BattlePokedex[id] = species;\r\n\t\t\t}\r\n\r\n\t\t\tif (species.cosmeticFormes) {\r\n\t\t\t\tfor (const forme of species.cosmeticFormes) {\r\n\t\t\t\t\tif (toID(forme) === formid) {\r\n\t\t\t\t\t\tspecies = new Species(formid, name, {\r\n\t\t\t\t\t\t\t...species,\r\n\t\t\t\t\t\t\tname: forme,\r\n\t\t\t\t\t\t\tforme: forme.slice(species.name.length + 1),\r\n\t\t\t\t\t\t\tbaseForme: \"\",\r\n\t\t\t\t\t\t\tbaseSpecies: species.name,\r\n\t\t\t\t\t\t\totherFormes: null,\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\twindow.BattlePokedexAltForms[formid] = species;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn species;\r\n\t\t},\r\n\t};\r\n\r\n\ttypes = {\r\n\t\tallCache: null as Type[] | null,\r\n\t\tget: (type: any): Type => {\r\n\t\t\tif (!type || typeof type === 'string') {\r\n\t\t\t\tconst id = toID(type) as string;\r\n\t\t\t\tconst name = id.substr(0, 1).toUpperCase() + id.substr(1);\r\n\t\t\t\ttype = (window.BattleTypeChart && window.BattleTypeChart[id]) || {};\r\n\t\t\t\tif (type.damageTaken) type.exists = true;\r\n\t\t\t\tif (!type.id) type.id = id;\r\n\t\t\t\tif (!type.name) type.name = name;\r\n\t\t\t\tif (!type.effectType) {\r\n\t\t\t\t\ttype.effectType = 'Type';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn type;\r\n\t\t},\r\n\t\tall: (): readonly Type[] => {\r\n\t\t\tif (this.types.allCache) return this.types.allCache;\r\n\t\t\tconst types = [];\r\n\t\t\tfor (const id in (window.BattleTypeChart || {})) {\r\n\t\t\t\ttypes.push(Dex.types.get(id));\r\n\t\t\t}\r\n\t\t\tif (types.length) this.types.allCache = types;\r\n\t\t\treturn types;\r\n\t\t},\r\n\t\tisName: (name: string | null): boolean => {\r\n\t\t\tconst id = toID(name);\r\n\t\t\tif (name !== id.substr(0, 1).toUpperCase() + id.substr(1)) return false;\r\n\t\t\treturn (window.BattleTypeChart || {}).hasOwnProperty(id);\r\n\t\t},\r\n\t};\r\n\r\n\thasAbility(species: Species, ability: string) {\r\n\t\tfor (const i in species.abilities) {\r\n\t\t\t// @ts-ignore\r\n\t\t\tif (ability === species.abilities[i]) return true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tloadSpriteData(gen: 'xy' | 'bw') {\r\n\t\tif (this.loadedSpriteData[gen]) return;\r\n\t\tthis.loadedSpriteData[gen] = 1;\r\n\r\n\t\tlet path = $('script[src*=\"pokedex-mini.js\"]').attr('src') || '';\r\n\t\tlet qs = '?' + (path.split('?')[1] || '');\r\n\t\tpath = (path.match(/.+?(?=data\\/pokedex-mini\\.js)/) || [])[0] || '';\r\n\r\n\t\tlet el = document.createElement('script');\r\n\t\tel.src = path + 'data/pokedex-mini-bw.js' + qs;\r\n\t\tdocument.getElementsByTagName('body')[0].appendChild(el);\r\n\t}\r\n\tgetSpriteData(pokemon: Pokemon | Species | string, isFront: boolean, options: {\r\n\t\tgen?: number,\r\n\t\tshiny?: boolean,\r\n\t\tgender?: GenderName,\r\n\t\tafd?: boolean,\r\n\t\tnoScale?: boolean,\r\n\t\tmod?: string,\r\n\t\tdynamax?: boolean,\r\n\t} = {gen: 6}) {\r\n\t\tconst mechanicsGen = options.gen || 6;\r\n\t\tlet isDynamax = !!options.dynamax;\r\n\t\tif (pokemon instanceof Pokemon) {\r\n\t\t\tif (pokemon.volatiles.transform) {\r\n\t\t\t\toptions.shiny = pokemon.volatiles.transform[2];\r\n\t\t\t\toptions.gender = pokemon.volatiles.transform[3];\r\n\t\t\t} else {\r\n\t\t\t\toptions.shiny = pokemon.shiny;\r\n\t\t\t\toptions.gender = pokemon.gender;\r\n\t\t\t}\r\n\t\t\tlet isGigantamax = false;\r\n\t\t\tif (pokemon.volatiles.dynamax) {\r\n\t\t\t\tif (pokemon.volatiles.dynamax[1]) {\r\n\t\t\t\t\tisGigantamax = true;\r\n\t\t\t\t} else if (options.dynamax !== false) {\r\n\t\t\t\t\tisDynamax = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tpokemon = pokemon.getSpeciesForme() + (isGigantamax ? '-Gmax' : '');\r\n\t\t}\r\n\t\tconst species = Dex.species.get(pokemon);\r\n\t\t// Gmax sprites are already extremely large, so we don't need to double.\r\n\t\tif (species.name.endsWith('-Gmax')) isDynamax = false;\r\n\t\tlet spriteData = {\r\n\t\t\tgen: mechanicsGen,\r\n\t\t\tw: 96,\r\n\t\t\th: 96,\r\n\t\t\ty: 0,\r\n\t\t\turl: Dex.resourcePrefix + 'sprites/',\r\n\t\t\tpixelated: true,\r\n\t\t\tisFrontSprite: false,\r\n\t\t\tcryurl: '',\r\n\t\t\tshiny: options.shiny,\r\n\t\t};\r\n\t\tlet name = species.spriteid;\r\n\t\tlet dir;\r\n\t\tlet facing;\r\n\t\tif (isFront) {\r\n\t\t\tspriteData.isFrontSprite = true;\r\n\t\t\tdir = '';\r\n\t\t\tfacing = 'front';\r\n\t\t} else {\r\n\t\t\tdir = '-back';\r\n\t\t\tfacing = 'back';\r\n\t\t}\r\n\r\n\t\t// Decide which gen sprites to use.\r\n\t\t//\r\n\t\t// There are several different generations we care about here:\r\n\t\t//\r\n\t\t//   - mechanicsGen: the generation number of the mechanics and battle (options.gen)\r\n\t\t//   - graphicsGen: the generation number of sprite/field graphics the user has requested.\r\n\t\t//     This will default to mechanicsGen, but may be altered depending on user preferences.\r\n\t\t//   - spriteData.gen: the generation number of a the specific Pokemon sprite in question.\r\n\t\t//     This defaults to graphicsGen, but if the graphicsGen doesn't have a sprite for the Pokemon\r\n\t\t//     (eg. Darmanitan in graphicsGen 2) then we go up gens until it exists.\r\n\t\t//\r\n\t\tlet graphicsGen = mechanicsGen;\r\n\t\tif (Dex.prefs('nopastgens')) graphicsGen = 6;\r\n\t\tif (Dex.prefs('bwgfx') && graphicsGen >= 6) graphicsGen = 5;\r\n\t\tspriteData.gen = Math.max(graphicsGen, Math.min(species.gen, 5));\r\n\t\tconst baseDir = ['', 'gen1', 'gen2', 'gen3', 'gen4', 'gen5', '', '', '', ''][spriteData.gen];\r\n\r\n\t\tlet animationData = null;\r\n\t\tlet miscData = null;\r\n\t\tlet speciesid = species.id;\r\n\t\tif (species.isTotem) speciesid = toID(name);\r\n\t\tif (baseDir === '' && window.BattlePokemonSprites) {\r\n\t\t\tanimationData = BattlePokemonSprites[speciesid];\r\n\t\t}\r\n\t\tif (baseDir === 'gen5' && window.BattlePokemonSpritesBW) {\r\n\t\t\tanimationData = BattlePokemonSpritesBW[speciesid];\r\n\t\t}\r\n\t\tif (window.BattlePokemonSprites) miscData = BattlePokemonSprites[speciesid];\r\n\t\tif (!miscData && window.BattlePokemonSpritesBW) miscData = BattlePokemonSpritesBW[speciesid];\r\n\t\tif (!animationData) animationData = {};\r\n\t\tif (!miscData) miscData = {};\r\n\r\n\t\tif (miscData.num !== 0 && miscData.num > -5000) {\r\n\t\t\tlet baseSpeciesid = toID(species.baseSpecies);\r\n\t\t\tspriteData.cryurl = 'audio/cries/' + baseSpeciesid;\r\n\t\t\tlet formeid = species.formeid;\r\n\t\t\tif (species.isMega || formeid && (\r\n\t\t\t\tformeid === '-crowned' ||\r\n\t\t\t\tformeid === '-eternal' ||\r\n\t\t\t\tformeid === '-eternamax' ||\r\n\t\t\t\tformeid === '-four' ||\r\n\t\t\t\tformeid === '-hangry' ||\r\n\t\t\t\tformeid === '-hero' ||\r\n\t\t\t\tformeid === '-lowkey' ||\r\n\t\t\t\tformeid === '-noice' ||\r\n\t\t\t\tformeid === '-primal' ||\r\n\t\t\t\tformeid === '-rapidstrike' ||\r\n\t\t\t\tformeid === '-roaming' ||\r\n\t\t\t\tformeid === '-school' ||\r\n\t\t\t\tformeid === '-sky' ||\r\n\t\t\t\tformeid === '-starter' ||\r\n\t\t\t\tformeid === '-super' ||\r\n\t\t\t\tformeid === '-therian' ||\r\n\t\t\t\tformeid === '-unbound' ||\r\n\t\t\t\tbaseSpeciesid === 'calyrex' ||\r\n\t\t\t\tbaseSpeciesid === 'kyurem' ||\r\n\t\t\t\tbaseSpeciesid === 'cramorant' ||\r\n\t\t\t\tbaseSpeciesid === 'indeedee' ||\r\n\t\t\t\tbaseSpeciesid === 'lycanroc' ||\r\n\t\t\t\tbaseSpeciesid === 'necrozma' ||\r\n\t\t\t\tbaseSpeciesid === 'oinkologne' ||\r\n\t\t\t\tbaseSpeciesid === 'oricorio' ||\r\n\t\t\t\tbaseSpeciesid === 'slowpoke' ||\r\n\t\t\t\tbaseSpeciesid === 'tatsugiri' ||\r\n\t\t\t\tbaseSpeciesid === 'zygarde'\r\n\t\t\t)) {\r\n\t\t\t\tspriteData.cryurl += formeid;\r\n\t\t\t}\r\n\t\t\tspriteData.cryurl += '.mp3';\r\n\t\t}\r\n\r\n\t\tif (options.shiny && mechanicsGen > 1) dir += '-shiny';\r\n\r\n\t\t// April Fool's 2014\r\n\t\tif (window.Config && Config.server && Config.server.afd || options.afd) {\r\n\t\t\tdir = 'afd' + dir;\r\n\t\t\tspriteData.url += dir + '/' + name + '.png';\r\n\t\t\t// Duplicate code but needed to make AFD tinymax work\r\n\t\t\t// April Fool's 2020\r\n\t\t\tif (isDynamax && !options.noScale) {\r\n\t\t\t\tspriteData.w *= 0.25;\r\n\t\t\t\tspriteData.h *= 0.25;\r\n\t\t\t\tspriteData.y += -22;\r\n\t\t\t} else if (species.isTotem && !options.noScale) {\r\n\t\t\t\tspriteData.w *= 0.5;\r\n\t\t\t\tspriteData.h *= 0.5;\r\n\t\t\t\tspriteData.y += -11;\r\n\t\t\t}\r\n\t\t\treturn spriteData;\r\n\t\t}\r\n\r\n\t\t// Mod Cries\r\n\t\tif (options.mod) {\r\n\t\t\tspriteData.cryurl = `sprites/${options.mod}/audio/${toID(species.baseSpecies)}`;\r\n\t\t\tspriteData.cryurl += '.mp3';\r\n\t\t}\r\n\r\n\t\tif (animationData[facing + 'f'] && options.gender === 'F') facing += 'f';\r\n\t\tlet allowAnim = !Dex.prefs('noanim') && !Dex.prefs('nogif');\r\n\t\tif (allowAnim && spriteData.gen >= 6) spriteData.pixelated = false;\r\n\t\tif (allowAnim && animationData[facing] && spriteData.gen >= 5) {\r\n\t\t\tif (facing.slice(-1) === 'f') name += '-f';\r\n\t\t\tdir = baseDir + 'ani' + dir;\r\n\r\n\t\t\tspriteData.w = animationData[facing].w;\r\n\t\t\tspriteData.h = animationData[facing].h;\r\n\t\t\tspriteData.url += dir + '/' + name + '.gif';\r\n\t\t} else {\r\n\t\t\t// There is no entry or enough data in pokedex-mini.js\r\n\t\t\t// Handle these in case-by-case basis; either using BW sprites or matching the played gen.\r\n\t\t\tdir = (baseDir || 'gen5') + dir;\r\n\r\n\t\t\t// Gender differences don't exist prior to Gen 4,\r\n\t\t\t// so there are no sprites for it\r\n\t\t\tif (spriteData.gen >= 4 && options.gender === 'F') {\r\n\t\t\t\tif(miscData['frontf'] || [\r\n\t\t\t\t\t'bulbasaurdelta', 'ivysaurdelta', 'venusaurdelta', 'venusaurdeltamega', 'deinodelta', 'zweilousdelta', 'hydreigondelta', 'gardevoirdeltamega', 'meganiummega'\r\n\t\t\t\t].includes(speciesid)) {\r\n\t\t\t\t\tname += '-f';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\r\n\t\t\tspriteData.url += dir + '/' + name + '.png';\r\n\t\t}\r\n\r\n\t\tif (!options.noScale) {\r\n\t\t\tif (graphicsGen > 4) {\r\n\t\t\t\t// no scaling\r\n\t\t\t} else if (spriteData.isFrontSprite) {\r\n\t\t\t\tspriteData.w *= 2;\r\n\t\t\t\tspriteData.h *= 2;\r\n\t\t\t\tspriteData.y += -16;\r\n\t\t\t} else {\r\n\t\t\t\t// old gen backsprites are multiplied by 1.5x by the 3D engine\r\n\t\t\t\tspriteData.w *= 2 / 1.5;\r\n\t\t\t\tspriteData.h *= 2 / 1.5;\r\n\t\t\t\tspriteData.y += -11;\r\n\t\t\t}\r\n\t\t\tif (spriteData.gen <= 2) spriteData.y += 2;\r\n\t\t}\r\n\t\tif (isDynamax && !options.noScale) {\r\n\t\t\tspriteData.w *= 2;\r\n\t\t\tspriteData.h *= 2;\r\n\t\t\tspriteData.y += -22;\r\n\t\t} else if (species.isTotem && !options.noScale) {\r\n\t\t\tspriteData.w *= 1.5;\r\n\t\t\tspriteData.h *= 1.5;\r\n\t\t\tspriteData.y += -11;\r\n\t\t}\r\n\r\n\t\treturn spriteData;\r\n\t}\r\n\r\n\tgetPokemonIconNum(id: ID, isFemale?: boolean, facingLeft?: boolean) {\r\n\t\tlet num = 0;\r\n\t\tif (window.BattlePokemonSprites?.[id]?.num) {\r\n\t\t\tnum = BattlePokemonSprites[id].num;\r\n\t\t} else if (window.BattlePokedex?.[id]?.num) {\r\n\t\t\tnum = BattlePokedex[id].num;\r\n\t\t}\r\n\t\tif (num < 0) num = 0;\r\n\t\tif (num > 1010) num = 0;\r\n\r\n\t\tif (window.BattlePokemonIconIndexes?.[id]) {\r\n\t\t\tnum = BattlePokemonIconIndexes[id];\r\n\t\t}\r\n\r\n\t\tif (isFemale) {\r\n\t\t\tif ([\r\n\t\t\t\t'unfezant', 'frillish', 'jellicent', 'meowstic', 'pyroar',\r\n\t\t\t\t'bulbasaurdelta', 'ivysaurdelta', 'venusaurdelta', 'venusaurdeltamega', 'deinodelta', 'zweilousdelta', 'hydreigondelta'\r\n\t\t\t].includes(id)) {\r\n\t\t\t\tnum = BattlePokemonIconIndexes[id + 'f'];\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (facingLeft) {\r\n\t\t\tif (BattlePokemonIconIndexesLeft[id]) {\r\n\t\t\t\tnum = BattlePokemonIconIndexesLeft[id];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn num;\r\n\t}\r\n\r\n\tgetPokemonIcon(pokemon: string | Pokemon | ServerPokemon | PokemonSet | null, facingLeft?: boolean) {\r\n\t\tif (pokemon === 'pokeball') {\r\n\t\t\treturn `background:transparent url(${Dex.resourcePrefix}sprites/pokemonicons-pokeball-sheet.png) no-repeat scroll -0px 4px`;\r\n\t\t} else if (pokemon === 'pokeball-statused') {\r\n\t\t\treturn `background:transparent url(${Dex.resourcePrefix}sprites/pokemonicons-pokeball-sheet.png) no-repeat scroll -40px 4px`;\r\n\t\t} else if (pokemon === 'pokeball-fainted') {\r\n\t\t\treturn `background:transparent url(${Dex.resourcePrefix}sprites/pokemonicons-pokeball-sheet.png) no-repeat scroll -80px 4px;opacity:.4;filter:contrast(0)`;\r\n\t\t} else if (pokemon === 'pokeball-none') {\r\n\t\t\treturn `background:transparent url(${Dex.resourcePrefix}sprites/pokemonicons-pokeball-sheet.png) no-repeat scroll -80px 4px`;\r\n\t\t}\r\n\r\n\t\tlet id = toID(pokemon);\r\n\t\tif (!pokemon || typeof pokemon === 'string') pokemon = null;\r\n\t\t// @ts-ignore\r\n\t\tif (pokemon?.speciesForme) id = toID(pokemon.speciesForme);\r\n\t\t// @ts-ignore\r\n\t\tif (pokemon?.species) id = toID(pokemon.species);\r\n\t\t// @ts-ignore\r\n\t\tif (pokemon?.volatiles?.formechange && !pokemon.volatiles.transform) {\r\n\t\t\t// @ts-ignore\r\n\t\t\tid = toID(pokemon.volatiles.formechange[1]);\r\n\t\t}\r\n\t\tlet num = this.getPokemonIconNum(id, pokemon?.gender === 'F', facingLeft);\r\n\r\n\t\tlet top = Math.floor(num / 12) * 30;\r\n\t\tlet left = (num % 12) * 40;\r\n\t\tlet fainted = ((pokemon as Pokemon | ServerPokemon)?.fainted ? `;opacity:.3;filter:grayscale(100%) brightness(.5)` : ``);\r\n\t\treturn `background:transparent url(${Dex.resourcePrefix}sprites/pokemonicons-sheet.png?v12) no-repeat scroll -${left}px -${top}px${fainted}`;\r\n\t}\r\n\r\n\tgetTeambuilderSpriteData(pokemon: any, gen: number = 0): TeambuilderSpriteData {\r\n\t\tlet id = toID(pokemon.species);\r\n\t\tlet spriteid = pokemon.spriteid;\r\n\t\tlet species = Dex.species.get(pokemon.species);\r\n\t\tif (pokemon.species && !spriteid) {\r\n\t\t\tspriteid = species.spriteid || toID(pokemon.species);\r\n\t\t}\r\n\t\tif (species.exists === false) return { spriteDir: 'sprites/gen5', spriteid: '0', x: 10, y: 5 };\r\n\t\tconst spriteData: TeambuilderSpriteData = {\r\n\t\t\tspriteid,\r\n\t\t\tspriteDir: 'sprites/dex',\r\n\t\t\tx: -2,\r\n\t\t\ty: -3,\r\n\t\t};\r\n\t\tif (pokemon.shiny) spriteData.shiny = true;\r\n\t\tif (Dex.prefs('nopastgens')) gen = 6;\r\n\t\tif (Dex.prefs('bwgfx') && gen > 5) gen = 5;\r\n\t\tlet xydexExists = (!species.isNonstandard || species.isNonstandard === 'Past' || species.isNonstandard === 'CAP') || [\r\n\t\t\t\"pikachustarter\", \"eeveestarter\", \"meltan\", \"melmetal\", \"pokestarufo\", \"pokestarufo2\", \"pokestarbrycenman\", \"pokestarmt\", \"pokestarmt2\", \"pokestargiant\", \"pokestarhumanoid\", \"pokestarmonster\", \"pokestarf00\", \"pokestarf002\", \"pokestarspirit\",\r\n\t\t].includes(species.id);\r\n\t\tif (species.gen === 8 && species.isNonstandard !== 'CAP') xydexExists = false;\r\n\t\tif ((!gen || gen >= 6) && xydexExists) {\r\n\t\t\tif (species.gen >= 7) {\r\n\t\t\t\tspriteData.x = -6;\r\n\t\t\t\tspriteData.y = -7;\r\n\t\t\t} else if (id.substr(0, 6) === 'arceus') {\r\n\t\t\t\tspriteData.x = -2;\r\n\t\t\t\tspriteData.y = 7;\r\n\t\t\t} else if (id === 'garchomp') {\r\n\t\t\t\tspriteData.x = -2;\r\n\t\t\t\tspriteData.y = 2;\r\n\t\t\t} else if (id === 'garchompmega') {\r\n\t\t\t\tspriteData.x = -2;\r\n\t\t\t\tspriteData.y = 0;\r\n\t\t\t}\r\n\t\t\treturn spriteData;\r\n\t\t}\r\n\t\tspriteData.spriteDir = 'sprites/gen5';\r\n\t\tif (gen <= 1 && species.gen <= 1) spriteData.spriteDir = 'sprites/gen1';\r\n\t\telse if (gen <= 2 && species.gen <= 2) spriteData.spriteDir = 'sprites/gen2';\r\n\t\telse if (gen <= 3 && species.gen <= 3) spriteData.spriteDir = 'sprites/gen3';\r\n\t\telse if (gen <= 4 && species.gen <= 4) spriteData.spriteDir = 'sprites/gen4';\r\n\t\tspriteData.x = 10;\r\n\t\tspriteData.y = 5;\r\n\t\treturn spriteData;\r\n\t}\r\n\r\n\tgetTeambuilderSprite(pokemon: any, gen: number = 0) {\r\n\t\tif (!pokemon) return '';\r\n\t\tconst data = this.getTeambuilderSpriteData(pokemon, gen);\r\n\t\tconst shiny = (data.shiny ? '-shiny' : '');\r\n\t\treturn 'background-image:url(' + Dex.resourcePrefix + data.spriteDir + shiny + '/' + data.spriteid + '.png);background-position:' + data.x + 'px ' + data.y + 'px;background-repeat:no-repeat';\r\n\t}\r\n\r\n\tgetItemIcon(item: any) {\r\n\t\tlet num = 0;\r\n\t\tif (typeof item === 'string' && exports.BattleItems) item = exports.BattleItems[toID(item)];\r\n\t\tif (item?.spritenum) num = item.spritenum;\r\n\r\n\t\tlet top = Math.floor(num / 16) * 24;\r\n\t\tlet left = (num % 16) * 24;\r\n\t\treturn 'background:transparent url(' + Dex.resourcePrefix + 'sprites/itemicons-sheet.png?g9) no-repeat scroll -' + left + 'px -' + top + 'px';\r\n\t}\r\n\r\n\tgetTypeIcon(type: string | null, b?: boolean) { // b is just for utilichart.js\r\n\t\ttype = this.types.get(type).name;\r\n\t\tif (!type) type = '???';\r\n\t\tlet sanitizedType = type.replace(/\\?/g, '%3f');\r\n\t\treturn `<img src=\"${Dex.resourcePrefix}sprites/types/${sanitizedType}.png\" alt=\"${type}\" height=\"14\" width=\"32\" class=\"pixelated${b ? ' b' : ''}\" />`;\r\n\t}\r\n\r\n\tgetCategoryIcon(category: string | null) {\r\n\t\tconst categoryID = toID(category);\r\n\t\tlet sanitizedCategory = '';\r\n\t\tswitch (categoryID) {\r\n\t\tcase 'physical':\r\n\t\tcase 'special':\r\n\t\tcase 'status':\r\n\t\t\tsanitizedCategory = categoryID.charAt(0).toUpperCase() + categoryID.slice(1);\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tsanitizedCategory = 'undefined';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\treturn `<img src=\"${Dex.resourcePrefix}sprites/categories/${sanitizedCategory}.png\" alt=\"${sanitizedCategory}\" height=\"14\" width=\"32\" class=\"pixelated\" />`;\r\n\t}\r\n\r\n\tgetPokeballs() {\r\n\t\tif (this.pokeballs) return this.pokeballs;\r\n\t\tthis.pokeballs = [];\r\n\t\tif (!window.BattleItems) window.BattleItems = {};\r\n\t\tfor (const data of Object.values(window.BattleItems) as AnyObject[]) {\r\n\t\t\tif (!data.isPokeball) continue;\r\n\t\t\tthis.pokeballs.push(data.name);\r\n\t\t}\r\n\t\treturn this.pokeballs;\r\n\t}\r\n};\r\n\r\nclass ModdedDex {\r\n\treadonly gen: number;\r\n\treadonly modid: ID;\r\n\treadonly cache = {\r\n\t\tMoves: {} as any as {[k: string]: Move},\r\n\t\tItems: {} as any as {[k: string]: Item},\r\n\t\tAbilities: {} as any as {[k: string]: Ability},\r\n\t\tSpecies: {} as any as {[k: string]: Species},\r\n\t\tTypes: {} as any as {[k: string]: Effect},\r\n\t};\r\n\tpokeballs: string[] | null = null;\r\n\tconstructor(modid: ID) {\r\n\t\tthis.modid = modid;\r\n\t\tconst gen = parseInt(modid.substr(3, 1), 10);\r\n\t\tif (!modid.startsWith('gen') || !gen) throw new Error(\"Unsupported modid\");\r\n\t\tthis.gen = gen;\r\n\t}\r\n\tmoves = {\r\n\t\tget: (name: string): Move => {\r\n\t\t\tlet id = toID(name);\r\n\t\t\tif (window.BattleAliases && id in BattleAliases) {\r\n\t\t\t\tname = BattleAliases[id];\r\n\t\t\t\tid = toID(name);\r\n\t\t\t}\r\n\t\t\tif (this.cache.Moves.hasOwnProperty(id)) return this.cache.Moves[id];\r\n\r\n\t\t\tlet data = {...Dex.moves.get(name)};\r\n\r\n\t\t\tfor (let i = Dex.gen - 1; i >= this.gen; i--) {\r\n\t\t\t\tconst table = window.BattleTeambuilderTable[`gen${i}`];\r\n\t\t\t\tif (id in table.overrideMoveData) {\r\n\t\t\t\t\tObject.assign(data, table.overrideMoveData[id]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this.modid !== `gen${this.gen}`) {\r\n\t\t\t\tconst table = window.BattleTeambuilderTable[this.modid];\r\n\t\t\t\tif (id in table.overrideMoveData) {\r\n\t\t\t\t\tObject.assign(data, table.overrideMoveData[id]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this.gen <= 3 && data.category !== 'Status') {\r\n\t\t\t\tdata.category = Dex.getGen3Category(data.type);\r\n\t\t\t}\r\n\r\n\t\t\tconst move = new Move(id, name, data);\r\n\t\t\tthis.cache.Moves[id] = move;\r\n\t\t\treturn move;\r\n\t\t},\r\n\t};\r\n\r\n\titems = {\r\n\t\tget: (name: string): Item => {\r\n\t\t\tlet id = toID(name);\r\n\t\t\tif (window.BattleAliases && id in BattleAliases) {\r\n\t\t\t\tname = BattleAliases[id];\r\n\t\t\t\tid = toID(name);\r\n\t\t\t}\r\n\t\t\tif (this.cache.Items.hasOwnProperty(id)) return this.cache.Items[id];\r\n\r\n\t\t\tlet data = {...Dex.items.get(name)};\r\n\r\n\t\t\tfor (let i = this.gen; i < 9; i++) {\r\n\t\t\t\tconst table = window.BattleTeambuilderTable['gen' + i];\r\n\t\t\t\tif (id in table.overrideItemDesc) {\r\n\t\t\t\t\tdata.shortDesc = table.overrideItemDesc[id];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst item = new Item(id, name, data);\r\n\t\t\tthis.cache.Items[id] = item;\r\n\t\t\treturn item;\r\n\t\t},\r\n\t};\r\n\r\n\tabilities = {\r\n\t\tget: (name: string): Ability => {\r\n\t\t\tlet id = toID(name);\r\n\t\t\tif (window.BattleAliases && id in BattleAliases) {\r\n\t\t\t\tname = BattleAliases[id];\r\n\t\t\t\tid = toID(name);\r\n\t\t\t}\r\n\t\t\tif (this.cache.Abilities.hasOwnProperty(id)) return this.cache.Abilities[id];\r\n\r\n\t\t\tlet data = {...Dex.abilities.get(name)};\r\n\r\n\t\t\tfor (let i = Dex.gen - 1; i >= this.gen; i--) {\r\n\t\t\t\tconst table = window.BattleTeambuilderTable[`gen${i}`];\r\n\t\t\t\tif (id in table.overrideAbilityData) {\r\n\t\t\t\t\tObject.assign(data, table.overrideAbilityData[id]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this.modid !== `gen${this.gen}`) {\r\n\t\t\t\tconst table = window.BattleTeambuilderTable[this.modid];\r\n\t\t\t\tif (id in table.overrideAbilityData) {\r\n\t\t\t\t\tObject.assign(data, table.overrideAbilityData[id]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst ability = new Ability(id, name, data);\r\n\t\t\tthis.cache.Abilities[id] = ability;\r\n\t\t\treturn ability;\r\n\t\t},\r\n\t};\r\n\r\n\tspecies = {\r\n\t\tget: (name: string): Species => {\r\n\t\t\tlet id = toID(name);\r\n\t\t\tif (window.BattleAliases && id in BattleAliases) {\r\n\t\t\t\tname = BattleAliases[id];\r\n\t\t\t\tid = toID(name);\r\n\t\t\t}\r\n\t\t\tif (this.cache.Species.hasOwnProperty(id)) return this.cache.Species[id];\r\n\r\n\t\t\tlet data = {...Dex.species.get(name)};\r\n\r\n\t\t\tfor (let i = Dex.gen - 1; i >= this.gen; i--) {\r\n\t\t\t\tconst table = window.BattleTeambuilderTable[`gen${i}`];\r\n\t\t\t\tif (id in table.overrideSpeciesData) {\r\n\t\t\t\t\tObject.assign(data, table.overrideSpeciesData[id]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this.modid !== `gen${this.gen}`) {\r\n\t\t\t\tconst table = window.BattleTeambuilderTable[this.modid];\r\n\t\t\t\tif (id in table.overrideSpeciesData) {\r\n\t\t\t\t\tObject.assign(data, table.overrideSpeciesData[id]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this.gen < 3 || this.modid === 'gen7letsgo') {\r\n\t\t\t\tdata.abilities = {0: \"No Ability\"};\r\n\t\t\t}\r\n\r\n\t\t\tconst table = window.BattleTeambuilderTable[this.modid];\r\n\t\t\tif (id in table.overrideTier) data.tier = table.overrideTier[id];\r\n\t\t\tif (!data.tier && id.slice(-5) === 'totem') {\r\n\t\t\t\tdata.tier = this.species.get(id.slice(0, -5)).tier;\r\n\t\t\t}\r\n\t\t\tif (!data.tier && data.baseSpecies && toID(data.baseSpecies) !== id) {\r\n\t\t\t\tdata.tier = this.species.get(data.baseSpecies).tier;\r\n\t\t\t}\r\n\t\t\tif (data.gen > this.gen) data.tier = 'Illegal';\r\n\r\n\t\t\tconst species = new Species(id, name, data);\r\n\t\t\tthis.cache.Species[id] = species;\r\n\t\t\treturn species;\r\n\t\t},\r\n\t};\r\n\r\n\ttypes = {\r\n\t\tget: (name: string): Effect => {\r\n\t\t\tconst id = toID(name) as ID;\r\n\t\t\tname = id.substr(0, 1).toUpperCase() + id.substr(1);\r\n\r\n\t\t\tif (this.cache.Types.hasOwnProperty(id)) return this.cache.Types[id];\r\n\r\n\t\t\tlet data = {...Dex.types.get(name)};\r\n\r\n\t\t\tfor (let i = 7; i >= this.gen; i--) {\r\n\t\t\t\tconst table = window.BattleTeambuilderTable['gen' + i];\r\n\t\t\t\tif (id in table.removeType) {\r\n\t\t\t\t\tdata.exists = false;\r\n\t\t\t\t\t// don't bother correcting its attributes given it doesn't exist\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif (id in table.overrideTypeChart) {\r\n\t\t\t\t\tdata = {...data, ...table.overrideTypeChart[id]};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.cache.Types[id] = data;\r\n\t\t\treturn data;\r\n\t\t},\r\n\t};\r\n\r\n\tgetPokeballs() {\r\n\t\tif (this.pokeballs) return this.pokeballs;\r\n\t\tthis.pokeballs = [];\r\n\t\tif (!window.BattleItems) window.BattleItems = {};\r\n\t\tfor (const data of Object.values(window.BattleItems) as AnyObject[]) {\r\n\t\t\tif (data.gen && data.gen > this.gen) continue;\r\n\t\t\tif (!data.isPokeball) continue;\r\n\t\t\tthis.pokeballs.push(data.name);\r\n\t\t}\r\n\t\treturn this.pokeballs;\r\n\t}\r\n}\r\n\r\nif (typeof require === 'function') {\r\n\t// in Node\r\n\t(global as any).Dex = Dex;\r\n\t(global as any).toID = toID;\r\n}\r\n"],"file":"battle-dex.js"}