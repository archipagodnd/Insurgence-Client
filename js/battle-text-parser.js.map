{"version":3,"sources":["../src/battle-text-parser.ts"],"names":["BattleTextParser","perspective","p1","p2","p3","p4","gen","turn","curLineSection","lowercaseRegExp","undefined","pokemonName","pokemon","startsWith","charAt","slice","trim","parseLine","line","noDefault","index","indexOf","cmd","index2a","index2b","index3b","split","parseBattleLine","args","kwArgs","length","lastArg","bracketPos","pop","upgradeArgs","parseNameParts","text","group","test","name","atIndex","status","away","item","move","number","ability","effect","arg3","arg4","target","of","id","effectId","block","from","includes","ability2","extractMessage","buf","out","parseArgs","fixLowercase","input","prefixes","map","templateId","template","BattleText","toUpperCase","bracketIndex","filter","prefix","escapeRegExp","join","RegExp","replace","match","side","isNear","allyID","pokemonFull","details","nickname","species","trainer","sideid","team","isFar","opposingTeam","own","party","opposingParty","toID","type","namespaces","namespace","maybeAbility","holder","abilityActivation","stat","entry","statName","lineSection","sectionBreak","prevSection","curSection","noSectionBreak","parseArgsInner","num","parseInt","Number","fullname","arg2","newSpecies","newSpeciesId","templateName","msg","line1","isNaN","zeffect","message","already","fatigue","damage","upkeep","oldAbility","fail","hasTarget","eat","weaken","thaw","weather","percentage","partiallytrapped","wisher","amount","multiple","source","spread","attacker","blocker","heavy","weak","forme","ohko","template2","require","global"],"mappings":"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","sourcesContent":["/**\n * Text parser\n *\n * No dependencies\n * Optional dependency: BattleText\n *\n * @author Guangcong Luo <guangcongluo@gmail.com>\n * @license MIT\n */\n\ndeclare const BattleText: {[id: string]: {[templateName: string]: string}};\n\ntype Args = [string, ...string[]];\ntype KWArgs = {[kw: string]: string};\ntype SideID = 'p1' | 'p2' | 'p3' | 'p4';\n\nclass BattleTextParser {\n\tp1 = \"Player 1\";\n\tp2 = \"Player 2\";\n\tp3 = \"Player 3\";\n\tp4 = \"Player 4\";\n\tperspective: SideID;\n\tgen = 7;\n\tturn = 0;\n\tcurLineSection: 'break' | 'preMajor' | 'major' | 'postMajor' = 'break';\n\tlowercaseRegExp: RegExp | null | undefined = undefined;\n\n\tconstructor(perspective: SideID = 'p1') {\n\t\tthis.perspective = perspective;\n\t}\n\n\tstatic parseLine(line: string, noDefault: true): Args | null;\n\tstatic parseLine(line: string): Args;\n\tstatic parseLine(line: string, noDefault?: boolean): Args | null {\n\t\tif (!line.startsWith('|')) {\n\t\t\treturn ['', line];\n\t\t}\n\t\tif (line === '|') {\n\t\t\treturn ['done'];\n\t\t}\n\t\tconst index = line.indexOf('|', 1);\n\t\tconst cmd = line.slice(1, index);\n\t\tswitch (cmd) {\n\t\tcase 'chatmsg': case 'chatmsg-raw': case 'raw': case 'error': case 'html':\n\t\tcase 'inactive': case 'inactiveoff': case 'warning':\n\t\tcase 'fieldhtml': case 'controlshtml': case 'bigerror':\n\t\tcase 'debug': case 'tier': case 'challstr': case 'popup': case '':\n\t\t\treturn [cmd, line.slice(index + 1)];\n\t\tcase 'c': case 'chat': case 'uhtml': case 'uhtmlchange': case 'queryresponse':\n\t\t\t// three parts\n\t\t\tconst index2a = line.indexOf('|', index + 1);\n\t\t\treturn [cmd, line.slice(index + 1, index2a), line.slice(index2a + 1)];\n\t\tcase 'c:': case 'pm':\n\t\t\t// four parts\n\t\t\tconst index2b = line.indexOf('|', index + 1);\n\t\t\tconst index3b = line.indexOf('|', index2b + 1);\n\t\t\treturn [cmd, line.slice(index + 1, index2b), line.slice(index2b + 1, index3b), line.slice(index3b + 1)];\n\t\t}\n\t\tif (noDefault) return null;\n\t\treturn line.slice(1).split('|') as [string, ...string[]];\n\t}\n\n\tstatic parseBattleLine(line: string): {args: Args, kwArgs: KWArgs} {\n\t\tlet args = this.parseLine(line, true);\n\t\tif (args) return {args, kwArgs: {}};\n\n\t\targs = line.slice(1).split('|') as [string, ...string[]];\n\t\tconst kwArgs: KWArgs = {};\n\t\twhile (args.length > 1) {\n\t\t\tconst lastArg = args[args.length - 1];\n\t\t\tif (lastArg.charAt(0) !== '[') break;\n\t\t\tconst bracketPos = lastArg.indexOf(']');\n\t\t\tif (bracketPos <= 0) break;\n\t\t\t// default to '.' so it evaluates to boolean true\n\t\t\tkwArgs[lastArg.slice(1, bracketPos)] = lastArg.slice(bracketPos + 1).trim() || '.';\n\t\t\targs.pop();\n\t\t}\n\t\treturn BattleTextParser.upgradeArgs({args, kwArgs});\n\t}\n\n\tstatic parseNameParts(text: string) {\n\t\tlet group = '';\n\t\t// names can't start with a symbol\n\t\tif (!/[A-Za-z0-9]/.test(text.charAt(0))) {\n\t\t\tgroup = text.charAt(0);\n\t\t\ttext = text.slice(1);\n\t\t}\n\n\t\tlet name = text;\n\t\tconst atIndex = text.indexOf('@');\n\t\tlet status = '';\n\t\tlet away = false;\n\t\tif (atIndex > 0) {\n\t\t\tname = text.slice(0, atIndex);\n\t\t\tstatus = text.slice(atIndex + 1);\n\t\t\tif (status.startsWith('!')) {\n\t\t\t\taway = true;\n\t\t\t\tstatus = status.slice(1);\n\t\t\t}\n\t\t}\n\t\treturn {group, name, away, status};\n\t}\n\n\tstatic upgradeArgs({args, kwArgs}: {args: Args, kwArgs: KWArgs}): {args: Args, kwArgs: KWArgs} {\n\t\tswitch (args[0]) {\n\t\tcase '-activate': {\n\t\t\tif (kwArgs.item || kwArgs.move || kwArgs.number || kwArgs.ability) return {args, kwArgs};\n\t\t\tlet [, pokemon, effect, arg3, arg4] = args;\n\t\t\tlet target = kwArgs.of;\n\t\t\tconst id = BattleTextParser.effectId(effect);\n\n\t\t\tif (kwArgs.block) return {args: ['-fail', pokemon], kwArgs};\n\n\t\t\tif (id === 'wonderguard') return {args: ['-immune', pokemon], kwArgs: {from: 'ability:Wonder Guard'}};\n\n\t\t\tif (id === 'beatup' && kwArgs.of) return {args, kwArgs: {name: kwArgs.of}};\n\n\t\t\tif ([\n\t\t\t\t'ingrain', 'quickguard', 'wideguard', 'craftyshield', 'matblock', 'protect', 'mist', 'safeguard',\n\t\t\t\t'electricterrain', 'mistyterrain', 'psychicterrain', 'telepathy', 'stickyhold', 'suctioncups', 'aromaveil',\n\t\t\t\t'flowerveil', 'sweetveil', 'disguise', 'safetygoggles', 'protectivepads',\n\t\t\t].includes(id)) {\n\t\t\t\tif (target) {\n\t\t\t\t\tkwArgs.of = pokemon;\n\t\t\t\t\treturn {args: ['-block', target, effect, arg3], kwArgs};\n\t\t\t\t}\n\t\t\t\treturn {args: ['-block', pokemon, effect, arg3], kwArgs};\n\t\t\t}\n\n\t\t\tif (id === 'charge') {\n\t\t\t\treturn {args: ['-singlemove', pokemon, effect], kwArgs: {of: target}};\n\t\t\t}\n\t\t\tif ([\n\t\t\t\t'bind', 'wrap', 'clamp', 'whirlpool', 'firespin', 'magmastorm', 'sandtomb', 'infestation', 'snaptrap', 'thundercage', 'trapped',\n\t\t\t].includes(id)) {\n\t\t\t\treturn {args: ['-start', pokemon, effect], kwArgs: {of: target}};\n\t\t\t}\n\n\t\t\tif (id === 'fairylock') {\n\t\t\t\treturn {args: ['-fieldactivate', effect], kwArgs: {}};\n\t\t\t}\n\n\t\t\tif (id === 'symbiosis' || id === 'poltergeist') {\n\t\t\t\tkwArgs.item = arg3;\n\t\t\t} else if (id === 'magnitude') {\n\t\t\t\tkwArgs.number = arg3;\n\t\t\t} else if (id === 'skillswap' || id === 'mummy' || id === 'wanderingspirit') {\n\t\t\t\tkwArgs.ability = arg3;\n\t\t\t\tkwArgs.ability2 = arg4;\n\t\t\t} else if ([\n\t\t\t\t'eeriespell', 'gmaxdepletion', 'spite', 'grudge', 'forewarn', 'sketch', 'leppaberry', 'mysteryberry',\n\t\t\t].includes(id)) {\n\t\t\t\tkwArgs.move = arg3;\n\t\t\t\tkwArgs.number = arg4;\n\t\t\t}\n\t\t\targs = ['-activate', pokemon, effect, target || ''];\n\t\t\tbreak;\n\t\t}\n\n\t\tcase '-fail': {\n\t\t\tif (kwArgs.from === 'ability: Flower Veil') {\n\t\t\t\treturn {args: ['-block', kwArgs.of, 'ability: Flower Veil'], kwArgs: {of: args[1]}};\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\n\t\tcase '-start': {\n\t\t\tif (kwArgs.from === 'Protean' || kwArgs.from === 'Color Change') kwArgs.from = 'ability:' + kwArgs.from;\n\t\t\tbreak;\n\t\t}\n\n\t\tcase 'move': {\n\t\t\tif (kwArgs.from === 'Magic Bounce') kwArgs.from = 'ability:Magic Bounce';\n\t\t\tbreak;\n\t\t}\n\n\t\tcase 'cant': {\n\t\t\tlet [, pokemon, effect, move] = args;\n\t\t\tif (['ability: Queenly Majesty', 'ability: Damp', 'ability: Dazzling'].includes(effect)) {\n\t\t\t\targs[0] = '-block';\n\t\t\t\treturn {args: ['-block', pokemon, effect, move, kwArgs.of], kwArgs: {}};\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\n\t\tcase '-nothing':\n\t\t\t// OLD: |-nothing\n\t\t\t// NEW: |-activate||move:Splash\n\t\t\treturn {args: ['-activate', '', 'move:Splash'], kwArgs};\n\t\t}\n\t\treturn {args, kwArgs};\n\t}\n\n\textractMessage(buf: string) {\n\t\tlet out = '';\n\t\tfor (const line of buf.split('\\n')) {\n\t\t\tconst {args, kwArgs} = BattleTextParser.parseBattleLine(line);\n\t\t\tout += this.parseArgs(args, kwArgs) || '';\n\t\t}\n\t\treturn out;\n\t}\n\n\tfixLowercase(input: string) {\n\t\tif (this.lowercaseRegExp === undefined) {\n\t\t\tconst prefixes = ['pokemon', 'opposingPokemon', 'team', 'opposingTeam', 'party', 'opposingParty'].map(templateId => {\n\t\t\t\tconst template = BattleText.default[templateId];\n\t\t\t\tif (template.charAt(0) === template.charAt(0).toUpperCase()) return '';\n\t\t\t\tconst bracketIndex = template.indexOf('[');\n\t\t\t\tif (bracketIndex >= 0) return template.slice(0, bracketIndex);\n\t\t\t\treturn template;\n\t\t\t}).filter(prefix => prefix);\n\t\t\tif (prefixes.length) {\n\t\t\t\tlet buf = `((?:^|\\n)(?:  |  \\\\\\(|\\\\\\[)?)(` +\n\t\t\t\t\tprefixes.map(BattleTextParser.escapeRegExp).join('|') +\n\t\t\t\t\t`)`;\n\t\t\t\tthis.lowercaseRegExp = new RegExp(buf, 'g');\n\t\t\t} else {\n\t\t\t\tthis.lowercaseRegExp = null;\n\t\t\t}\n\t\t}\n\t\tif (!this.lowercaseRegExp) return input;\n\t\treturn input.replace(this.lowercaseRegExp, (match, p1, p2) => (\n\t\t\tp1 + p2.charAt(0).toUpperCase() + p2.slice(1)\n\t\t));\n\t}\n\n\tstatic escapeRegExp(input: string) {\n\t\treturn input.replace(/[\\\\^$.*+?()[\\]{}|]/g, '\\\\$&');\n\t}\n\n\tpokemonName = (pokemon: string) => {\n\t\tif (!pokemon) return '';\n\t\tif (!pokemon.startsWith('p')) return `???pokemon:${pokemon}???`;\n\t\tif (pokemon.charAt(3) === ':') return pokemon.slice(4).trim();\n\t\telse if (pokemon.charAt(2) === ':') return pokemon.slice(3).trim();\n\t\treturn `???pokemon:${pokemon}???`;\n\t};\n\n\tpokemon(pokemon: string) {\n\t\tif (!pokemon) return '';\n\t\tlet side = pokemon.slice(0, 2);\n\t\tif (!['p1', 'p2', 'p3', 'p4'].includes(side)) return `???pokemon:${pokemon}???`;\n\t\tconst name = this.pokemonName(pokemon);\n\t\tconst isNear = side === this.perspective || side === BattleTextParser.allyID(side as SideID);\n\t\tconst template = BattleText.default[isNear ? 'pokemon' : 'opposingPokemon'];\n\t\treturn template.replace('[NICKNAME]', name);\n\t}\n\n\tpokemonFull(pokemon: string, details: string): [string, string] {\n\t\tconst nickname = this.pokemonName(pokemon);\n\n\t\tconst species = details.split(',')[0];\n\t\tif (nickname === species) return [pokemon.slice(0, 2), `**${species}**`];\n\t\treturn [pokemon.slice(0, 2), `${nickname} (**${species}**)`];\n\t}\n\n\ttrainer(side: string) {\n\t\tside = side.slice(0, 2);\n\t\tif (side === 'p1') return this.p1;\n\t\tif (side === 'p2') return this.p2;\n\t\tif (side === 'p3') return this.p3;\n\t\tif (side === 'p4') return this.p4;\n\t\treturn `???side:${side}???`;\n\t}\n\n\tstatic allyID(sideid: SideID): SideID | '' {\n\t\tif (sideid === 'p1') return 'p3';\n\t\tif (sideid === 'p2') return 'p4';\n\t\tif (sideid === 'p3') return 'p1';\n\t\tif (sideid === 'p4') return 'p2';\n\t\treturn '';\n\t}\n\n\tteam(side: string, isFar: boolean = false) {\n\t\tside = side.slice(0, 2);\n\t\tif (side === this.perspective || side === BattleTextParser.allyID(side as SideID)) {\n\t\t\treturn !isFar ? BattleText.default.team : BattleText.default.opposingTeam;\n\t\t}\n\t\treturn isFar ? BattleText.default.team : BattleText.default.opposingTeam;\n\t}\n\n\town(side: string) {\n\t\tside = side.slice(0, 2);\n\t\tif (side === this.perspective) {\n\t\t\treturn 'OWN';\n\t\t}\n\t\treturn '';\n\t}\n\n\tparty(side: string) {\n\t\tside = side.slice(0, 2);\n\t\tif (side === this.perspective || side === BattleTextParser.allyID(side as SideID)) {\n\t\t\treturn BattleText.default.party;\n\t\t}\n\t\treturn BattleText.default.opposingParty;\n\t}\n\n\tstatic effectId(effect?: string) {\n\t\tif (!effect) return '';\n\t\tif (effect.startsWith('item:') || effect.startsWith('move:')) {\n\t\t\teffect = effect.slice(5);\n\t\t} else if (effect.startsWith('ability:')) {\n\t\t\teffect = effect.slice(8);\n\t\t}\n\t\treturn toID(effect);\n\t}\n\n\teffect(effect?: string) {\n\t\tif (!effect) return '';\n\t\tif (effect.startsWith('item:') || effect.startsWith('move:')) {\n\t\t\teffect = effect.slice(5);\n\t\t} else if (effect.startsWith('ability:')) {\n\t\t\teffect = effect.slice(8);\n\t\t}\n\t\treturn effect.trim();\n\t}\n\n\ttemplate(type: string, ...namespaces: (string | undefined)[]) {\n\t\tfor (const namespace of namespaces) {\n\t\t\tif (!namespace) continue;\n\t\t\tif (namespace === 'OWN') {\n\t\t\t\treturn BattleText.default[type + 'Own'] + '\\n';\n\t\t\t}\n\t\t\tif (namespace === 'NODEFAULT') {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t\tlet id = BattleTextParser.effectId(namespace);\n\t\t\tif (BattleText[id] && type in BattleText[id]) {\n\t\t\t\tif (BattleText[id][type].charAt(1) === '.') type = BattleText[id][type].slice(2) as ID;\n\t\t\t\tif (BattleText[id][type].charAt(0) === '#') id = BattleText[id][type].slice(1) as ID;\n\t\t\t\tif (!BattleText[id][type]) return '';\n\t\t\t\treturn BattleText[id][type] + '\\n';\n\t\t\t}\n\t\t}\n\t\tif (!BattleText.default[type]) return '';\n\t\treturn BattleText.default[type] + '\\n';\n\t}\n\n\tmaybeAbility(effect: string | undefined, holder: string) {\n\t\tif (!effect) return '';\n\t\tif (!effect.startsWith('ability:')) return '';\n\t\treturn this.ability(effect.slice(8).trim(), holder);\n\t}\n\n\tability(name: string | undefined, holder: string) {\n\t\tif (!name) return '';\n\t\treturn BattleText.default.abilityActivation.replace('[POKEMON]', this.pokemon(holder)).replace('[ABILITY]', this.effect(name)) + '\\n';\n\t}\n\n\tstatic stat(stat: string) {\n\t\tconst entry = BattleText[stat || \"stats\"];\n\t\tif (!entry || !entry.statName) return `???stat:${stat}???`;\n\t\treturn entry.statName;\n\t}\n\n\tlineSection(args: Args, kwArgs: KWArgs) {\n\t\tconst cmd = args[0];\n\t\tswitch (cmd) {\n\t\tcase 'done' : case 'turn':\n\t\t\treturn 'break';\n\t\tcase 'move' : case 'cant': case 'switch': case 'drag': case 'upkeep': case 'start': case '-mega': case '-candynamax':\n\t\t\treturn 'major';\n\t\tcase 'switchout': case 'faint':\n\t\t\treturn 'preMajor';\n\t\tcase '-zpower':\n\t\t\treturn 'postMajor';\n\t\tcase '-damage': {\n\t\t\tconst id = BattleTextParser.effectId(kwArgs.from);\n\t\t\tif (id === 'confusion') return 'major';\n\t\t\treturn 'postMajor';\n\t\t}\n\t\tcase '-curestatus': {\n\t\t\tconst id = BattleTextParser.effectId(kwArgs.from);\n\t\t\tif (id === 'naturalcure') return 'preMajor';\n\t\t\treturn 'postMajor';\n\t\t}\n\t\tcase '-start': {\n\t\t\tconst id = BattleTextParser.effectId(kwArgs.from);\n\t\t\tif (id === 'protean') return 'preMajor';\n\t\t\treturn 'postMajor';\n\t\t}\n\t\tcase '-activate': {\n\t\t\tconst id = BattleTextParser.effectId(args[2]);\n\t\t\tif (id === 'confusion' || id === 'attract') return 'preMajor';\n\t\t\treturn 'postMajor';\n\t\t}\n\t\t}\n\t\treturn (cmd.charAt(0) === '-' ? 'postMajor' : '');\n\t}\n\n\tsectionBreak(args: Args, kwArgs: KWArgs) {\n\t\tconst prevSection = this.curLineSection;\n\t\tconst curSection = this.lineSection(args, kwArgs);\n\t\tif (!curSection) return false;\n\t\tthis.curLineSection = curSection;\n\t\tswitch (curSection) {\n\t\tcase 'break':\n\t\t\tif (prevSection !== 'break') return true;\n\t\t\treturn false;\n\t\tcase 'preMajor':\n\t\tcase 'major':\n\t\t\tif (prevSection === 'postMajor' || prevSection === 'major') return true;\n\t\t\treturn false;\n\t\tcase 'postMajor':\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tparseArgs(args: Args, kwArgs: KWArgs, noSectionBreak?: boolean) {\n\t\tlet buf = !noSectionBreak && this.sectionBreak(args, kwArgs) ? '\\n' : '';\n\t\treturn buf + this.fixLowercase(this.parseArgsInner(args, kwArgs) || '');\n\t}\n\n\tparseArgsInner(args: Args, kwArgs: KWArgs) {\n\t\tlet cmd = args[0];\n\t\tswitch (cmd) {\n\t\tcase 'player': {\n\t\t\tconst [, side, name] = args;\n\t\t\tif (side === 'p1' && name) {\n\t\t\t\tthis.p1 = name;\n\t\t\t} else if (side === 'p2' && name) {\n\t\t\t\tthis.p2 = name;\n\t\t\t} else if (side === 'p3' && name) {\n\t\t\t\tthis.p3 = name;\n\t\t\t} else if (side === 'p4' && name) {\n\t\t\t\tthis.p4 = name;\n\t\t\t}\n\t\t\treturn '';\n\t\t}\n\n\t\tcase 'gen': {\n\t\t\tconst [, num] = args;\n\t\t\tthis.gen = parseInt(num, 10);\n\t\t\treturn '';\n\t\t}\n\n\t\tcase 'turn': {\n\t\t\tconst [, num] = args;\n\t\t\tthis.turn = Number.parseInt(num, 10);\n\t\t\treturn this.template('turn').replace('[NUMBER]', num) + '\\n';\n\t\t}\n\n\t\tcase 'start': {\n\t\t\treturn this.template('startBattle').replace('[TRAINER]', this.p1).replace('[TRAINER]', this.p2);\n\t\t}\n\n\t\tcase 'win': case 'tie': {\n\t\t\tconst [, name] = args;\n\t\t\tif (cmd === 'tie' || !name) {\n\t\t\t\treturn this.template('tieBattle').replace('[TRAINER]', this.p1).replace('[TRAINER]', this.p2);\n\t\t\t}\n\t\t\treturn this.template('winBattle').replace('[TRAINER]', name);\n\t\t}\n\n\t\tcase 'switch': {\n\t\t\tconst [, pokemon, details] = args;\n\t\t\tconst [side, fullname] = this.pokemonFull(pokemon, details);\n\t\t\tconst template = this.template('switchIn', this.own(side));\n\t\t\treturn template.replace('[TRAINER]', this.trainer(side)).replace('[FULLNAME]', fullname);\n\t\t}\n\n\t\tcase 'drag': {\n\t\t\tconst [, pokemon, details] = args;\n\t\t\tconst [side, fullname] = this.pokemonFull(pokemon, details);\n\t\t\tconst template = this.template('drag');\n\t\t\treturn template.replace('[TRAINER]', this.trainer(side)).replace('[FULLNAME]', fullname);\n\t\t}\n\n\t\tcase 'detailschange': case '-transform': case '-formechange': {\n\t\t\tconst [, pokemon, arg2, arg3] = args;\n\t\t\tlet newSpecies = '';\n\t\t\tswitch (cmd) {\n\t\t\tcase 'detailschange': newSpecies = arg2.split(',')[0].trim(); break;\n\t\t\tcase '-transform': newSpecies = arg3; break;\n\t\t\tcase '-formechange': newSpecies = arg2; break;\n\t\t\t}\n\t\t\tlet newSpeciesId = toID(newSpecies);\n\t\t\tlet id = '';\n\t\t\tlet templateName = 'transform';\n\t\t\tif (cmd !== '-transform') {\n\t\t\t\tswitch (newSpeciesId) {\n\t\t\t\tcase 'greninjaash': id = 'battlebond'; break;\n\t\t\t\tcase 'mimikyubusted': id = 'disguise'; break;\n\t\t\t\tcase 'zygardecomplete': id = 'powerconstruct'; break;\n\t\t\t\tcase 'necrozmaultra': id = 'ultranecroziumz'; break;\n\t\t\t\tcase 'darmanitanzen': id = 'zenmode'; break;\n\t\t\t\tcase 'darmanitan': id = 'zenmode'; templateName = 'transformEnd'; break;\n\t\t\t\tcase 'darmanitangalarzen': id = 'zenmode'; break;\n\t\t\t\tcase 'darmanitangalar': id = 'zenmode'; templateName = 'transformEnd'; break;\n\t\t\t\tcase 'aegislashblade': id = 'stancechange'; break;\n\t\t\t\tcase 'aegislash': id = 'stancechange'; templateName = 'transformEnd'; break;\n\t\t\t\tcase 'wishiwashischool': id = 'schooling'; break;\n\t\t\t\tcase 'wishiwashi': id = 'schooling'; templateName = 'transformEnd'; break;\n\t\t\t\tcase 'miniormeteor': id = 'shieldsdown'; break;\n\t\t\t\tcase 'minior': id = 'shieldsdown'; templateName = 'transformEnd'; break;\n\t\t\t\tcase 'eiscuenoice': id = 'iceface'; break;\n\t\t\t\tcase 'eiscue': id = 'iceface'; templateName = 'transformEnd'; break;\n\t\t\t\t}\n\t\t\t} else if (newSpecies) {\n\t\t\t\tid = 'transform';\n\t\t\t}\n\t\t\tconst template = this.template(templateName, id, kwArgs.msg ? '' : 'NODEFAULT');\n\t\t\tconst line1 = this.maybeAbility(kwArgs.from, kwArgs.of || pokemon);\n\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon)).replace('[SPECIES]', newSpecies);\n\t\t}\n\n\t\tcase 'switchout': {\n\t\t\tconst [, pokemon] = args;\n\t\t\tconst side = pokemon.slice(0, 2);\n\t\t\tconst template = this.template('switchOut', kwArgs.from, this.own(side));\n\t\t\treturn template.replace('[TRAINER]', this.trainer(side)).replace('[NICKNAME]', this.pokemonName(pokemon)).replace('[POKEMON]', this.pokemon(pokemon));\n\t\t}\n\n\t\tcase 'faint': {\n\t\t\tconst [, pokemon] = args;\n\t\t\tconst template = this.template('faint');\n\t\t\treturn template.replace('[POKEMON]', this.pokemon(pokemon));\n\t\t}\n\n\t\tcase 'swap': {\n\t\t\tconst [, pokemon, target] = args;\n\t\t\tif (!target || !isNaN(Number(target))) {\n\t\t\t\tconst template = this.template('swapCenter');\n\t\t\t\treturn template.replace('[POKEMON]', this.pokemon(pokemon));\n\t\t\t}\n\t\t\tconst template = this.template('swap');\n\t\t\treturn template.replace('[POKEMON]', this.pokemon(pokemon)).replace('[TARGET]', this.pokemon(target));\n\t\t}\n\n\t\tcase 'move': {\n\t\t\tconst [, pokemon, move] = args;\n\t\t\tlet line1 = this.maybeAbility(kwArgs.from, kwArgs.of || pokemon);\n\t\t\tif (kwArgs.zeffect) {\n\t\t\t\tline1 = this.template('zEffect').replace('[POKEMON]', this.pokemon(pokemon));\n\t\t\t}\n\t\t\tconst template = this.template('move', kwArgs.from);\n\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon)).replace('[MOVE]', move);\n\t\t}\n\n\t\tcase 'cant': {\n\t\t\tlet [, pokemon, effect, move] = args;\n\t\t\tconst template = this.template('cant', effect, 'NODEFAULT') ||\n\t\t\t\tthis.template(move ? 'cant' : 'cantNoMove');\n\t\t\tconst line1 = this.maybeAbility(effect, kwArgs.of || pokemon);\n\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon)).replace('[MOVE]', move);\n\t\t}\n\n\t\tcase '-candynamax': {\n\t\t\tlet [, side] = args;\n\t\t\tconst own = this.own(side);\n\t\t\tlet template = '';\n\t\t\tif (this.turn === 1) {\n\t\t\t\tif (own) template = this.template('canDynamax', own);\n\t\t\t} else {\n\t\t\t\ttemplate = this.template('canDynamax', own);\n\t\t\t}\n\t\t\treturn template.replace('[TRAINER]', this.trainer(side));\n\t\t}\n\n\t\tcase 'message': {\n\t\t\tlet [, message] = args;\n\t\t\treturn '' + message + '\\n';\n\t\t}\n\n\t\tcase '-start': {\n\t\t\tlet [, pokemon, effect, arg3] = args;\n\t\t\tconst line1 = this.maybeAbility(effect, pokemon) || this.maybeAbility(kwArgs.from, kwArgs.of || pokemon);\n\t\t\tlet id = BattleTextParser.effectId(effect);\n\t\t\tif (id === 'typechange') {\n\t\t\t\tconst template = this.template('typeChange', kwArgs.from);\n\t\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon)).replace('[TYPE]', arg3).replace('[SOURCE]', this.pokemon(kwArgs.of));\n\t\t\t}\n\t\t\tif (id === 'typeadd') {\n\t\t\t\tconst template = this.template('typeAdd', kwArgs.from);\n\t\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon)).replace('[TYPE]', arg3);\n\t\t\t}\n\t\t\tif (id.startsWith('stockpile')) {\n\t\t\t\tconst num = id.slice(9);\n\t\t\t\tconst template = this.template('start', 'stockpile');\n\t\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon)).replace('[NUMBER]', num);\n\t\t\t}\n\t\t\tif (id.startsWith('perish')) {\n\t\t\t\tconst num = id.slice(6);\n\t\t\t\tconst template = this.template('activate', 'perishsong');\n\t\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon)).replace('[NUMBER]', num);\n\t\t\t}\n\t\t\tlet templateId = 'start';\n\t\t\tif (kwArgs.already) templateId = 'alreadyStarted';\n\t\t\tif (kwArgs.fatigue) templateId = 'startFromFatigue';\n\t\t\tif (kwArgs.zeffect) templateId = 'startFromZEffect';\n\t\t\tif (kwArgs.damage) templateId = 'activate';\n\t\t\tif (kwArgs.block) templateId = 'block';\n\t\t\tif (kwArgs.upkeep) templateId = 'upkeep';\n\t\t\tif (id === 'mist' && this.gen <= 2) templateId = 'startGen' + this.gen;\n\t\t\tif (id === 'reflect' || id === 'lightscreen') templateId = 'startGen1';\n\t\t\tif (templateId === 'start' && kwArgs.from?.startsWith('item:')) {\n\t\t\t\ttemplateId += 'FromItem';\n\t\t\t}\n\t\t\tconst template = this.template(templateId, effect);\n\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon)).replace('[EFFECT]', this.effect(effect)).replace('[MOVE]', arg3).replace('[SOURCE]', this.pokemon(kwArgs.of)).replace('[ITEM]', this.effect(kwArgs.from));\n\t\t}\n\n\t\tcase '-end': {\n\t\t\tlet [, pokemon, effect] = args;\n\t\t\tconst line1 = this.maybeAbility(effect, pokemon) || this.maybeAbility(kwArgs.from, kwArgs.of || pokemon);\n\t\t\tlet id = BattleTextParser.effectId(effect);\n\t\t\tif (id === 'doomdesire' || id === 'futuresight') {\n\t\t\t\tconst template = this.template('activate', effect);\n\t\t\t\treturn line1 + template.replace('[TARGET]', this.pokemon(pokemon));\n\t\t\t}\n\t\t\tlet templateId = 'end';\n\t\t\tlet template = '';\n\t\t\tif (kwArgs.from?.startsWith('item:')) {\n\t\t\t\ttemplate = this.template('endFromItem', effect);\n\t\t\t}\n\t\t\tif (!template) template = this.template(templateId, effect);\n\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon)).replace('[EFFECT]', this.effect(effect)).replace('[SOURCE]', this.pokemon(kwArgs.of)).replace('[ITEM]', this.effect(kwArgs.from));\n\t\t}\n\n\t\tcase '-ability': {\n\t\t\tlet [, pokemon, ability, oldAbility, arg4] = args;\n\t\t\tlet line1 = '';\n\t\t\tif (oldAbility && (oldAbility.startsWith('p1') || oldAbility.startsWith('p2') || oldAbility === 'boost')) {\n\t\t\t\targ4 = oldAbility;\n\t\t\t\toldAbility = '';\n\t\t\t}\n\t\t\tif (oldAbility) line1 += this.ability(oldAbility, pokemon);\n\t\t\tline1 += this.ability(ability, pokemon);\n\t\t\tif (kwArgs.fail) {\n\t\t\t\tconst template = this.template('block', kwArgs.from);\n\t\t\t\treturn line1 + template;\n\t\t\t}\n\t\t\tif (kwArgs.from) {\n\t\t\t\tline1 = this.maybeAbility(kwArgs.from, pokemon) + line1;\n\t\t\t\tconst template = this.template('changeAbility', kwArgs.from);\n\t\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon)).replace('[ABILITY]', this.effect(ability)).replace('[SOURCE]', this.pokemon(kwArgs.of));\n\t\t\t}\n\t\t\tconst id = BattleTextParser.effectId(ability);\n\t\t\tif (id === 'unnerve') {\n\t\t\t\tconst template = this.template('start', ability);\n\t\t\t\treturn line1 + template.replace('[TEAM]', this.team(pokemon.slice(0, 2), true));\n\t\t\t}\n\t\t\tlet templateId = 'start';\n\t\t\tif (id === 'anticipation' || id === 'sturdy') templateId = 'activate';\n\t\t\tconst template = this.template(templateId, ability, 'NODEFAULT');\n\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon));\n\t\t}\n\n\t\tcase '-endability': {\n\t\t\tlet [, pokemon, ability] = args;\n\t\t\tif (ability) return this.ability(ability, pokemon);\n\t\t\tconst line1 = this.maybeAbility(kwArgs.from, kwArgs.of || pokemon);\n\t\t\tconst template = this.template('start', 'Gastro Acid');\n\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon));\n\t\t}\n\n\t\tcase '-item': {\n\t\t\tconst [, pokemon, item] = args;\n\t\t\tconst id = BattleTextParser.effectId(kwArgs.from);\n\t\t\tlet target = '';\n\t\t\tif (['magician', 'pickpocket'].includes(id)) {\n\t\t\t\t[target, kwArgs.of] = [kwArgs.of, ''];\n\t\t\t}\n\t\t\tconst line1 = this.maybeAbility(kwArgs.from, kwArgs.of || pokemon);\n\t\t\tif (['thief', 'covet', 'bestow', 'magician', 'pickpocket'].includes(id)) {\n\t\t\t\tconst template = this.template('takeItem', kwArgs.from);\n\t\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon)).replace('[ITEM]', this.effect(item)).replace('[SOURCE]', this.pokemon(target || kwArgs.of));\n\t\t\t}\n\t\t\tif (id === 'frisk') {\n\t\t\t\tconst hasTarget = kwArgs.of && pokemon && kwArgs.of !== pokemon;\n\t\t\t\tconst template = this.template(hasTarget ? 'activate' : 'activateNoTarget', \"Frisk\");\n\t\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(kwArgs.of)).replace('[ITEM]', this.effect(item)).replace('[TARGET]', this.pokemon(pokemon));\n\t\t\t}\n\t\t\tif (kwArgs.from) {\n\t\t\t\tconst template = this.template('addItem', kwArgs.from);\n\t\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon)).replace('[ITEM]', this.effect(item));\n\t\t\t}\n\t\t\tconst template = this.template('start', item, 'NODEFAULT');\n\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon));\n\t\t}\n\n\t\tcase '-enditem': {\n\t\t\tlet [, pokemon, item] = args;\n\t\t\tconst line1 = this.maybeAbility(kwArgs.from, kwArgs.of || pokemon);\n\t\t\tif (kwArgs.eat) {\n\t\t\t\tconst template = this.template('eatItem', kwArgs.from);\n\t\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon)).replace('[ITEM]', this.effect(item));\n\t\t\t}\n\t\t\tconst id = BattleTextParser.effectId(kwArgs.from);\n\t\t\tif (id === 'gem') {\n\t\t\t\tconst template = this.template('useGem', item);\n\t\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon)).replace('[ITEM]', this.effect(item)).replace('[MOVE]', kwArgs.move);\n\t\t\t}\n\t\t\tif (id === 'stealeat') {\n\t\t\t\tconst template = this.template('removeItem', \"Bug Bite\");\n\t\t\t\treturn line1 + template.replace('[SOURCE]', this.pokemon(kwArgs.of)).replace('[ITEM]', this.effect(item));\n\t\t\t}\n\t\t\tif (kwArgs.from) {\n\t\t\t\tconst template = this.template('removeItem', kwArgs.from);\n\t\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon)).replace('[ITEM]', this.effect(item)).replace('[SOURCE]', this.pokemon(kwArgs.of));\n\t\t\t}\n\t\t\tif (kwArgs.weaken) {\n\t\t\t\tconst template = this.template('activateWeaken');\n\t\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon)).replace('[ITEM]', this.effect(item));\n\t\t\t}\n\t\t\tlet template = this.template('end', item, 'NODEFAULT');\n\t\t\tif (!template) template = this.template('activateItem').replace('[ITEM]', this.effect(item));\n\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon)).replace('[TARGET]', this.pokemon(kwArgs.of));\n\t\t}\n\n\t\tcase '-status': {\n\t\t\tconst [, pokemon, status] = args;\n\t\t\tconst line1 = this.maybeAbility(kwArgs.from, kwArgs.of || pokemon);\n\t\t\tif (BattleTextParser.effectId(kwArgs.from) === 'rest') {\n\t\t\t\tconst template = this.template('startFromRest', status);\n\t\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon));\n\t\t\t}\n\t\t\tconst template = this.template('start', status);\n\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon));\n\t\t}\n\n\t\tcase '-curestatus': {\n\t\t\tconst [, pokemon, status] = args;\n\t\t\tif (BattleTextParser.effectId(kwArgs.from) === 'naturalcure') {\n\t\t\t\tconst template = this.template('activate', kwArgs.from);\n\t\t\t\treturn template.replace('[POKEMON]', this.pokemon(pokemon));\n\t\t\t}\n\t\t\tconst line1 = this.maybeAbility(kwArgs.from, kwArgs.of || pokemon);\n\t\t\tif (kwArgs.from?.startsWith('item:')) {\n\t\t\t\tconst template = this.template('endFromItem', status);\n\t\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon)).replace('[ITEM]', this.effect(kwArgs.from));\n\t\t\t}\n\t\t\tif (kwArgs.thaw) {\n\t\t\t\tconst template = this.template('endFromMove', status);\n\t\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon)).replace('[MOVE]', this.effect(kwArgs.from));\n\t\t\t}\n\t\t\tlet template = this.template('end', status, 'NODEFAULT');\n\t\t\tif (!template) template = this.template('end').replace('[EFFECT]', status);\n\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon));\n\t\t}\n\n\t\tcase '-cureteam': {\n\t\t\treturn this.template('activate', kwArgs.from);\n\t\t}\n\n\t\tcase '-singleturn': case '-singlemove': {\n\t\t\tconst [, pokemon, effect] = args;\n\t\t\tconst line1 = this.maybeAbility(effect, kwArgs.of || pokemon) ||\n\t\t\t\tthis.maybeAbility(kwArgs.from, kwArgs.of || pokemon);\n\t\t\tlet id = BattleTextParser.effectId(effect);\n\t\t\tif (id === 'instruct') {\n\t\t\t\tconst template = this.template('activate', effect);\n\t\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(kwArgs.of)).replace('[TARGET]', this.pokemon(pokemon));\n\t\t\t}\n\t\t\tlet template = this.template('start', effect, 'NODEFAULT');\n\t\t\tif (!template) template = this.template('start').replace('[EFFECT]', this.effect(effect));\n\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon)).replace('[SOURCE]', this.pokemon(kwArgs.of)).replace('[TEAM]', this.team(pokemon.slice(0, 2)));\n\t\t}\n\n\t\tcase '-sidestart': {\n\t\t\tlet [, side, effect] = args;\n\t\t\tlet template = this.template('start', effect, 'NODEFAULT');\n\t\t\tif (!template) template = this.template('startTeamEffect').replace('[EFFECT]', this.effect(effect));\n\t\t\treturn template.replace('[TEAM]', this.team(side)).replace('[PARTY]', this.party(side));\n\t\t}\n\n\t\tcase '-sideend': {\n\t\t\tlet [, side, effect] = args;\n\t\t\tlet template = this.template('end', effect, 'NODEFAULT');\n\t\t\tif (!template) template = this.template('endTeamEffect').replace('[EFFECT]', this.effect(effect));\n\t\t\treturn template.replace('[TEAM]', this.team(side)).replace('[PARTY]', this.party(side));\n\t\t}\n\n\t\tcase '-weather': {\n\t\t\tconst [, weather] = args;\n\t\t\tif (!weather || weather === 'none') {\n\t\t\t\tconst template = this.template('end', kwArgs.from, 'NODEFAULT');\n\t\t\t\tif (!template) return this.template('endFieldEffect').replace('[EFFECT]', this.effect(weather));\n\t\t\t\treturn template;\n\t\t\t}\n\t\t\tif (kwArgs.upkeep) {\n\t\t\t\treturn this.template('upkeep', weather, 'NODEFAULT');\n\t\t\t}\n\t\t\tconst line1 = this.maybeAbility(kwArgs.from, kwArgs.of);\n\t\t\tlet template = this.template('start', weather, 'NODEFAULT');\n\t\t\tif (!template) template = this.template('startFieldEffect').replace('[EFFECT]', this.effect(weather));\n\t\t\treturn line1 + template;\n\t\t}\n\n\t\tcase '-fieldstart': case '-fieldactivate': {\n\t\t\tconst [, effect] = args;\n\t\t\tconst line1 = this.maybeAbility(kwArgs.from, kwArgs.of);\n\t\t\tlet templateId = cmd.slice(6);\n\t\t\tif (BattleTextParser.effectId(effect) === 'perishsong') templateId = 'start';\n\t\t\tlet template = this.template(templateId, effect, 'NODEFAULT');\n\t\t\tif (!template) template = this.template('startFieldEffect').replace('[EFFECT]', this.effect(effect));\n\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(kwArgs.of));\n\t\t}\n\n\t\tcase '-fieldend': {\n\t\t\tlet [, effect] = args;\n\t\t\tlet template = this.template('end', effect, 'NODEFAULT');\n\t\t\tif (!template) template = this.template('endFieldEffect').replace('[EFFECT]', this.effect(effect));\n\t\t\treturn template;\n\t\t}\n\n\t\tcase '-sethp': {\n\t\t\tlet effect = kwArgs.from;\n\t\t\treturn this.template('activate', effect);\n\t\t}\n\n\t\tcase '-message': {\n\t\t\tlet [, message] = args;\n\t\t\treturn '  ' + message + '\\n';\n\t\t}\n\n\t\tcase '-hint': {\n\t\t\tlet [, message] = args;\n\t\t\treturn '  (' + message + ')\\n';\n\t\t}\n\n\t\tcase '-activate': {\n\t\t\tlet [, pokemon, effect, target] = args;\n\t\t\tlet id = BattleTextParser.effectId(effect);\n\t\t\tif (id === 'celebrate') {\n\t\t\t\treturn this.template('activate', 'celebrate').replace('[TRAINER]', this.trainer(pokemon.slice(0, 2)));\n\t\t\t}\n\t\t\tif (!target && ['hyperspacefury', 'hyperspacehole', 'phantomforce', 'shadowforce', 'feint'].includes(id)) {\n\t\t\t\t[pokemon, target] = [kwArgs.of, pokemon];\n\t\t\t\tif (!pokemon) pokemon = target;\n\t\t\t}\n\t\t\tif (!target) target = kwArgs.of || pokemon;\n\n\t\t\tlet line1 = this.maybeAbility(effect, pokemon);\n\n\t\t\tif (id === 'lockon' || id === 'mindreader') {\n\t\t\t\tconst template = this.template('start', effect);\n\t\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(kwArgs.of)).replace('[SOURCE]', this.pokemon(pokemon));\n\t\t\t}\n\n\t\t\tif (id === 'mummy' && kwArgs.ability) {\n\t\t\t\tline1 += this.ability(kwArgs.ability, target);\n\t\t\t\tline1 += this.ability('Mummy', target);\n\t\t\t\tconst template = this.template('changeAbility', 'mummy');\n\t\t\t\treturn line1 + template.replace('[TARGET]', this.pokemon(target));\n\t\t\t}\n\n\t\t\tlet templateId = 'activate';\n\t\t\tif (id === 'forewarn' && pokemon === target) {\n\t\t\t\ttemplateId = 'activateNoTarget';\n\t\t\t}\n\t\t\tlet template = this.template(templateId, effect, 'NODEFAULT');\n\t\t\tif (!template) {\n\t\t\t\tif (line1) return line1; // Abilities don't have a default template\n\t\t\t\ttemplate = this.template('activate');\n\t\t\t\treturn line1 + template.replace('[EFFECT]', this.effect(effect));\n\t\t\t}\n\n\t\t\tif (id === 'brickbreak') {\n\t\t\t\ttemplate = template.replace('[TEAM]', this.team(target.slice(0, 2)));\n\t\t\t}\n\t\t\tif (kwArgs.ability) {\n\t\t\t\tline1 += this.ability(kwArgs.ability, pokemon);\n\t\t\t}\n\t\t\tif (kwArgs.ability2) {\n\t\t\t\tline1 += this.ability(kwArgs.ability2, target);\n\t\t\t}\n\t\t\tif (kwArgs.move || kwArgs.number || kwArgs.item || kwArgs.name) {\n\t\t\t\ttemplate = template.replace('[MOVE]', kwArgs.move).replace('[NUMBER]', kwArgs.number).replace('[ITEM]', kwArgs.item).replace('[NAME]', kwArgs.name);\n\t\t\t}\n\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon)).replace('[TARGET]', this.pokemon(target)).replace('[SOURCE]', this.pokemon(kwArgs.of));\n\t\t}\n\n\t\tcase '-prepare': {\n\t\t\tconst [, pokemon, effect, target] = args;\n\t\t\tconst template = this.template('prepare', effect);\n\t\t\treturn template.replace('[POKEMON]', this.pokemon(pokemon)).replace('[TARGET]', this.pokemon(target));\n\t\t}\n\n\t\tcase '-damage': {\n\t\t\tlet [, pokemon, , percentage] = args;\n\t\t\tlet template = this.template('damage', kwArgs.from, 'NODEFAULT');\n\t\t\tconst line1 = this.maybeAbility(kwArgs.from, kwArgs.of || pokemon);\n\t\t\tconst id = BattleTextParser.effectId(kwArgs.from);\n\t\t\tif (template) {\n\t\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon));\n\t\t\t}\n\n\t\t\tif (!kwArgs.from) {\n\t\t\t\ttemplate = this.template(percentage ? 'damagePercentage' : 'damage');\n\t\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon)).replace('[PERCENTAGE]', percentage);\n\t\t\t}\n\t\t\tif (kwArgs.from.startsWith('item:')) {\n\t\t\t\ttemplate = this.template(kwArgs.of ? 'damageFromPokemon' : 'damageFromItem');\n\t\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon)).replace('[ITEM]', this.effect(kwArgs.from)).replace('[SOURCE]', this.pokemon(kwArgs.of));\n\t\t\t}\n\t\t\tif (kwArgs.partiallytrapped || id === 'bind' || id === 'wrap') {\n\t\t\t\ttemplate = this.template('damageFromPartialTrapping');\n\t\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon)).replace('[MOVE]', this.effect(kwArgs.from));\n\t\t\t}\n\n\t\t\ttemplate = this.template('damage');\n\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon));\n\t\t}\n\n\t\tcase '-heal': {\n\t\t\tlet [, pokemon] = args;\n\t\t\tlet template = this.template('heal', kwArgs.from, 'NODEFAULT');\n\t\t\tconst line1 = this.maybeAbility(kwArgs.from, pokemon);\n\t\t\tif (template) {\n\t\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon)).replace('[SOURCE]', this.pokemon(kwArgs.of)).replace('[NICKNAME]', kwArgs.wisher);\n\t\t\t}\n\n\t\t\tif (kwArgs.from && !kwArgs.from.startsWith('ability:')) {\n\t\t\t\ttemplate = this.template('healFromEffect');\n\t\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon)).replace('[EFFECT]', this.effect(kwArgs.from));\n\t\t\t}\n\n\t\t\ttemplate = this.template('heal');\n\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon));\n\t\t}\n\n\t\tcase '-boost': case '-unboost': {\n\t\t\tlet [, pokemon, stat, num] = args;\n\t\t\tif (stat === 'spa' && this.gen === 1) stat = 'spc';\n\t\t\tconst amount = parseInt(num, 10);\n\t\t\tconst line1 = this.maybeAbility(kwArgs.from, kwArgs.of || pokemon);\n\t\t\tlet templateId = cmd.slice(1);\n\t\t\tif (amount >= 3) templateId += '3';\n\t\t\telse if (amount >= 2) templateId += '2';\n\t\t\telse if (amount === 0) templateId += '0';\n\t\t\tif (amount && kwArgs.zeffect) {\n\t\t\t\ttemplateId += (kwArgs.multiple ? 'MultipleFromZEffect' : 'FromZEffect');\n\t\t\t} else if (amount && kwArgs.from?.startsWith('item:')) {\n\t\t\t\tconst template = this.template(templateId + 'FromItem', kwArgs.from);\n\t\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon)).replace('[STAT]', BattleTextParser.stat(stat)).replace('[ITEM]', this.effect(kwArgs.from));\n\t\t\t}\n\t\t\tconst template = this.template(templateId, kwArgs.from);\n\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon)).replace('[STAT]', BattleTextParser.stat(stat));\n\t\t}\n\n\t\tcase '-setboost': {\n\t\t\tconst [, pokemon] = args;\n\t\t\tconst effect = kwArgs.from;\n\t\t\tconst line1 = this.maybeAbility(effect, kwArgs.of || pokemon);\n\t\t\tconst template = this.template('boost', effect);\n\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon));\n\t\t}\n\n\t\tcase '-swapboost': {\n\t\t\tconst [, pokemon, target] = args;\n\t\t\tconst line1 = this.maybeAbility(kwArgs.from, kwArgs.of || pokemon);\n\t\t\tconst id = BattleTextParser.effectId(kwArgs.from);\n\t\t\tlet templateId = 'swapBoost';\n\t\t\tif (id === 'guardswap') templateId = 'swapDefensiveBoost';\n\t\t\tif (id === 'powerswap') templateId = 'swapOffensiveBoost';\n\t\t\tconst template = this.template(templateId, kwArgs.from);\n\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon)).replace('[TARGET]', this.pokemon(target));\n\t\t}\n\n\t\tcase '-copyboost': {\n\t\t\tconst [, pokemon, target] = args;\n\t\t\tconst line1 = this.maybeAbility(kwArgs.from, kwArgs.of || pokemon);\n\t\t\tconst template = this.template('copyBoost', kwArgs.from);\n\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon)).replace('[TARGET]', this.pokemon(target));\n\t\t}\n\n\t\tcase '-clearboost': case '-clearpositiveboost': case '-clearnegativeboost': {\n\t\t\tconst [, pokemon, source] = args;\n\t\t\tconst line1 = this.maybeAbility(kwArgs.from, kwArgs.of || pokemon);\n\t\t\tlet templateId = 'clearBoost';\n\t\t\tif (kwArgs.zeffect) templateId = 'clearBoostFromZEffect';\n\t\t\tconst template = this.template(templateId, kwArgs.from);\n\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon)).replace('[SOURCE]', this.pokemon(source));\n\t\t}\n\n\t\tcase '-invertboost': {\n\t\t\tconst [, pokemon] = args;\n\t\t\tconst line1 = this.maybeAbility(kwArgs.from, kwArgs.of || pokemon);\n\t\t\tconst template = this.template('invertBoost', kwArgs.from);\n\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon));\n\t\t}\n\n\t\tcase '-clearallboost': {\n\t\t\treturn this.template('clearAllBoost', kwArgs.from);\n\t\t}\n\n\t\tcase '-crit': case '-supereffective': case '-resisted': {\n\t\t\tconst [, pokemon] = args;\n\t\t\tlet templateId = cmd.slice(1);\n\t\t\tif (templateId === 'supereffective') templateId = 'superEffective';\n\t\t\tif (kwArgs.spread) templateId += 'Spread';\n\t\t\tconst template = this.template(templateId);\n\t\t\treturn template.replace('[POKEMON]', this.pokemon(pokemon));\n\t\t}\n\n\t\tcase '-block': {\n\t\t\tlet [, pokemon, effect, move, attacker] = args;\n\t\t\tconst line1 = this.maybeAbility(effect, kwArgs.of || pokemon);\n\t\t\tlet id = BattleTextParser.effectId(effect);\n\t\t\tlet templateId = 'block';\n\t\t\tif (id === 'mist' && this.gen <= 2) templateId = 'blockGen' + this.gen;\n\t\t\tconst template = this.template(templateId, effect);\n\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon)).replace('[SOURCE]', this.pokemon(attacker || kwArgs.of)).replace('[MOVE]', move);\n\t\t}\n\n\t\tcase '-fail': {\n\t\t\tlet [, pokemon, effect, stat] = args;\n\t\t\tlet id = BattleTextParser.effectId(effect);\n\t\t\tlet blocker = BattleTextParser.effectId(kwArgs.from);\n\t\t\tconst line1 = this.maybeAbility(kwArgs.from, kwArgs.of || pokemon);\n\t\t\tlet templateId = 'block';\n\t\t\tif (['desolateland', 'primordialsea'].includes(blocker) &&\n\t\t\t\t!['sunnyday', 'raindance', 'sandstorm', 'hail', 'newmoon'].includes(id)) {\n\t\t\t\ttemplateId = 'blockMove';\n\t\t\t} else if (blocker === 'uproar' && kwArgs.msg) {\n\t\t\t\ttemplateId = 'blockSelf';\n\t\t\t}\n\t\t\tlet template = this.template(templateId, kwArgs.from);\n\t\t\tif (template) {\n\t\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon));\n\t\t\t}\n\n\t\t\tif (id === 'unboost') {\n\t\t\t\ttemplate = this.template(stat ? 'failSingular' : 'fail', 'unboost');\n\t\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon)).replace('[STAT]', stat);\n\t\t\t}\n\n\t\t\ttemplateId = 'fail';\n\t\t\tif (['brn', 'frz', 'par', 'psn', 'slp', 'substitute'].includes(id)) {\n\t\t\t\ttemplateId = 'alreadyStarted';\n\t\t\t}\n\t\t\tif (kwArgs.heavy) templateId = 'failTooHeavy';\n\t\t\tif (kwArgs.weak) templateId = 'fail';\n\t\t\tif (kwArgs.forme) templateId = 'failWrongForme';\n\t\t\ttemplate = this.template(templateId, id);\n\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon));\n\t\t}\n\n\t\tcase '-immune': {\n\t\t\tconst [, pokemon] = args;\n\t\t\tconst line1 = this.maybeAbility(kwArgs.from, kwArgs.of || pokemon);\n\t\t\tlet template = this.template('block', kwArgs.from);\n\t\t\tif (!template) {\n\t\t\t\tconst templateId = kwArgs.ohko ? 'immuneOHKO' : 'immune';\n\t\t\t\ttemplate = this.template(pokemon ? templateId : 'immuneNoPokemon', kwArgs.from);\n\t\t\t}\n\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon));\n\t\t}\n\n\t\tcase '-miss': {\n\t\t\tconst [, source, pokemon] = args;\n\t\t\tconst line1 = this.maybeAbility(kwArgs.from, kwArgs.of || pokemon);\n\t\t\tif (!pokemon) {\n\t\t\t\tconst template = this.template('missNoPokemon');\n\t\t\t\treturn line1 + template.replace('[SOURCE]', this.pokemon(source));\n\t\t\t}\n\t\t\tconst template = this.template('miss');\n\t\t\treturn line1 + template.replace('[POKEMON]', this.pokemon(pokemon));\n\t\t}\n\n\t\tcase '-center': case '-ohko': case '-combine': {\n\t\t\treturn this.template(cmd.slice(1));\n\t\t}\n\n\t\tcase '-notarget': {\n\t\t\treturn this.template('noTarget');\n\t\t}\n\n\t\tcase '-mega': case '-primal': {\n\t\t\tconst [, pokemon, species, item] = args;\n\t\t\tlet id = '';\n\t\t\tlet templateId = cmd.slice(1);\n\t\t\tif (species === 'Rayquaza') {\n\t\t\t\tid = 'dragonascent';\n\t\t\t\ttemplateId = 'megaNoItem';\n\t\t\t}\n\t\t\tif (!id && cmd === '-mega' && this.gen < 7) templateId = 'megaGen6';\n\t\t\tif (!item && cmd === '-mega') templateId = 'megaNoItem';\n\t\t\tlet template = this.template(templateId, id);\n\t\t\tconst side = pokemon.slice(0, 2);\n\t\t\tconst pokemonName = this.pokemon(pokemon);\n\t\t\tif (cmd === '-mega') {\n\t\t\t\tconst template2 = this.template('transformMega');\n\t\t\t\ttemplate += template2.replace('[POKEMON]', pokemonName).replace('[SPECIES]', species);\n\t\t\t}\n\t\t\treturn template.replace('[POKEMON]', pokemonName).replace('[ITEM]', item).replace('[TRAINER]', this.trainer(side));\n\t\t}\n\n\t\tcase '-zpower': {\n\t\t\tconst [, pokemon] = args;\n\t\t\tconst template = this.template('zPower');\n\t\t\treturn template.replace('[POKEMON]', this.pokemon(pokemon));\n\t\t}\n\n\t\tcase '-burst': {\n\t\t\tconst [, pokemon] = args;\n\t\t\tconst template = this.template('activate', \"Ultranecrozium Z\");\n\t\t\treturn template.replace('[POKEMON]', this.pokemon(pokemon));\n\t\t}\n\n\t\tcase '-zbroken': {\n\t\t\tconst [, pokemon] = args;\n\t\t\tconst template = this.template('zBroken');\n\t\t\treturn template.replace('[POKEMON]', this.pokemon(pokemon));\n\t\t}\n\n\t\tcase '-hitcount': {\n\t\t\tconst [, , num] = args;\n\t\t\tif (num === '1') {\n\t\t\t\treturn this.template('hitCountSingular');\n\t\t\t}\n\t\t\treturn this.template('hitCount').replace('[NUMBER]', num);\n\t\t}\n\n\t\tcase '-waiting': {\n\t\t\tconst [, pokemon, target] = args;\n\t\t\tconst template = this.template('activate', \"Water Pledge\");\n\t\t\treturn template.replace('[POKEMON]', this.pokemon(pokemon)).replace('[TARGET]', this.pokemon(target));\n\t\t}\n\n\t\tcase '-anim': {\n\t\t\treturn '';\n\t\t}\n\n\t\tdefault: {\n\t\t\treturn null;\n\t\t}\n\t\t}\n\t}\n}\n\nif (typeof require === 'function') {\n\t// in Node\n\t(global as any).BattleTextParser = BattleTextParser;\n}\n"],"file":"battle-text-parser.js"}