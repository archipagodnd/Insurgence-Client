{"version":3,"sources":["../src/battle.ts"],"names":["Pokemon","data","side","name","speciesForme","ident","details","searchid","slot","fainted","hp","maxhp","level","gender","shiny","hpcolor","moves","ability","baseAbility","item","itemEffect","prevItem","prevItemEffect","boosts","status","statusStage","volatiles","turnstatuses","movestatuses","lastMove","moveTrack","statusData","sleepTurns","toxicTurns","sprite","battle","scene","addPokemonSprite","isActive","active","includes","getHPColor","ratio","getHPColorClass","getPixelRange","pixels","color","epsilon","getFormattedRange","range","precision","separator","percentage","Math","abs","floor","toFixed","lower","upper","ceil","getDamageRange","damage","length","undefined","oldrange","newrange","r","healthParse","hpstring","parsedamage","heal","parenIndex","lastIndexOf","parseFloat","isNaN","ret","percent","round","substr","oldhp","oldmaxhp","oldwidth","hpWidth","oldcolor","parseHealth","oldnum","delta","deltawidth","checkDetails","indexOf","replace","getIdent","slots","removeVolatile","volatile","removeEffect","hasVolatile","addVolatile","args","addEffect","removeTurnstatus","hasTurnstatus","addTurnstatus","toID","clearTurnstatuses","id","updateStatbar","removeMovestatus","hasMovestatus","addMovestatus","clearMovestatuses","clearVolatiles","clearEffects","rememberMove","moveName","pp","recursionSource","Dex","getMove","charAt","transform","entry","push","rememberAbility","isNotBase","getAbility","getBoost","boostStat","boostStatTable","atk","def","spa","spd","spe","accuracy","evasion","spc","isRBY","gen","tier","goodBoostTable","badBoostTable","getWeightKg","serverPokemon","autotomizeFactor","autotomize","max","getSpecies","weightkg","getBoostType","clearVolatile","i","splice","copyVolatileFrom","pokemon","copyAll","removeTransform","copyTypesFrom","getTypes","types","addedType","join","typechange","split","filter","typeName","typeadd","isGrounded","hasPseudoWeather","getTypeList","concat","getSpeciesForme","formechange","dex","getBaseSpecies","reset","maxWidth","getHPText","destroy","Side","n","isOpp","foe","avatar","rating","totalPokemon","x","y","z","missedPokemon","wisher","lastPokemon","sideConditions","isFar","updateSprites","rollTrainerSprites","sprites","random","behindx","offset","behindy","leftof","behind","clearPokemon","updateSpritesForSide","setAvatar","setName","stagnateCallback","addSideCondition","effect","condition","removeSideCondition","addPokemon","replaceSlot","oldItem","parseDetails","poke","speciesClause","existingTable","toRemove","poke1i","poke1","poke2i","poke2","illusionFound","curPoke","updateSidebar","switchIn","animSummon","switchCallback","dragIn","oldpokemon","animDragOut","animDragIn","dragCallback","animUnsummon","switchOut","log","from","swapTo","kwArgs","target","oslot","swapWith","nslot","faint","animFaint","faintCallback","Playback","Battle","$frame","$logFrame","sidesSwitched","activityQueue","preemptActivityQueue","waitForAnimations","activityStep","fastForward","fastForwardWillScroll","resultWaiting","activeMoveIsSpread","turnCallback","startCallback","endCallback","customCallback","errorCallback","mute","messageFadeTime","messageShownTime","turnsSinceMoved","turn","started","ended","usesUpkeep","weather","pseudoWeather","weatherTimeLeft","weatherMinTimeLeft","mySide","nearSide","farSide","p1","p2","myPokemon","sides","teamPreviewCount","gameType","rated","isBlitz","endLastTurnPending","totalTimeLeft","graceTimeLeft","kickingInactive","roomid","hardcoreMode","ignoreNicks","prefs","ignoreOpponent","ignoreSpects","debug","joinButtons","paused","playbackState","Uninitialized","resumeButton","BattleSceneStub","BattleScene","init","removePseudoWeather","updateWeather","addPseudoWeather","minTimeLeft","timeLeft","pseudoWeatherName","dontResetSound","fastForwardOff","Seeking","resetBgm","resetTurnsSinceMoved","nextActivity","preempt","add","resetToCurrentTurn","fastForwardTo","play","pause","switchSides","setSidesSwitched","start","winner","prematureEnd","endLastTurn","updateStatbars","setHardcoreMode","mode","updateSidebars","setTurn","turnNum","parseInt","updateTurnCounters","incrementTurn","updateAcceleration","changeWeather","weatherName","isUpkeep","upkeepWeather","isExtremeWeather","activateAbility","pWeather","cond","useMove","move","fromeffect","getEffect","isZ","getItem","zMoveFrom","slice","window","BattleItems","zMoveType","type","animateMove","spread","still","miss","notarget","prepare","anim","runPrepareAnim","usedMove","runMoveAnim","targets","hitTarget","curTarget","getPokemon","cantUseMove","BattleStatusAnims","runStatusAnim","resultAnim","runOtherAnim","animReset","effectOrName","effectType","abilityActivateAnim","runMinor","nextArgs","nextKwargs","then","silent","closeMessagebar","simult","CONSUMED","ofpoke","of","itemPoke","damageinfo","hover","damageAnim","trackedMove","runResidualAnim","healAnim","k","cpoke","formattedRange","diff","stat","amount","stats","tmp","frompoke","volatilesToCopy","timeOffset","Config","server","afd","moveid","thaw","updateStatbarIfExists","eat","weaken","fail","wait","newSpeciesForme","commaIndex","trim","species","abilities","animTransform","tpoke","Error","isCustomAnim","sanitizeName","typeAnim","already","block","interrupt","time","Infinity","Number","number","pokeability","targetability","ability2","foeActive","maybeTarget","broken","getSide","upkeep","maxTimeLeft","endsWith","pwID","checkActive","beforeMove","afterMove","pokemonid","output","isTeamPreview","splitDetails","pop","curhp","colorchar","parsePokemonId","siden","slotChart","a","b","c","d","e","f","getSwitchedPokemon","parsedPokemonid","rememberTeamPreviewPokemon","sideid","findCorrespondingPokemon","isInactive","sidename","command","Finished","Paused","Playing","updateBgm","instantAdd","run","runMajor","teamPreviewEnd","updateGen","ruleName","totalTime","graceTime","hasIndex","userid","app","user","get","room","rooms","BattleTextParser","parseNameParts","toUserid","users","userCount","userList","updateUserCount","updateNoUsersOnline","remove","oldid","set","away","hideJoinButtons","teamPreview","targetIndex","forGen","setFrameHTML","BattleLog","sanitizeHTML","setControlsHTML","str","shift","preemptCatchup","parseBattleLine","maybeCloseMessagebar","nextLine","err","stack","line","test","startsWith","Ready","resume","skipTurn","animationOff","animationOn","startAnimations","animations","finishAnimations","interruptionCount","done","setQueue","queue","setMute","BattleSound","require","global"],"mappings":"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","sourcesContent":["/**\n * Pokemon Showdown Battle\n *\n * This is the main file for handling battle animations\n *\n * Licensing note: PS's client has complicated licensing:\n * - The client as a whole is AGPLv3\n * - The battle replay/animation engine (battle-*.ts) by itself is MIT\n *\n * Layout:\n *\n * - Battle\n *   - Side\n *     - Pokemon\n *   - BattleScene\n *     - BattleLog\n *       - BattleTextParser\n *\n * When a Battle receives a message, it splits the message into tokens\n * and parses what happens, updating its own state, and then telling\n * BattleScene to do any relevant animations. The tokens then get\n * passed directly into BattleLog. If the message is an in-battle\n * message, it'll be extracted by BattleTextParser, which adds it to\n * both the battle log itself, as well as the messagebar.\n *\n * @author Guangcong Luo <guangcongluo@gmail.com>\n * @license MIT\n */\n\n/** [id, element?, ...misc] */\ntype EffectState = any[] & {0: ID};\n/** [name, minTimeLeft, maxTimeLeft] */\ntype WeatherState = [string, number, number];\ntype EffectTable = {[effectid: string]: EffectState};\ntype HPColor = 'r' | 'y' | 'g';\n\nclass Pokemon implements PokemonDetails, PokemonHealth {\n\tname = '';\n\tspeciesForme = '';\n\n\t/**\n\t * A string representing information extractable from textual\n\t * messages: side, nickname.\n\t *\n\t * Will be the empty string between Team Preview and the first\n\t * switch-in.\n\t *\n\t * Examples: `p1: Unown` or `p2: Sparky`\n\t */\n\tident = '';\n\t/**\n\t * A string representing visible information not included in\n\t * ident: species, level, gender, shininess. Level is left off\n\t * if it's 100; gender is left off if it's genderless.\n\t *\n\t * Note: Can be partially filled out in Team Preview, because certain\n\t * forme information and shininess isn't visible there. In those\n\t * cases, details can change during the first switch-in, but will\n\t * otherwise not change over the course of a game.\n\t *\n\t * Examples: `Mimikyu, L50, F`, `Steelix, M, shiny`\n\t */\n\tdetails = '';\n\t/**\n\t * `` `${ident}|${details}` ``. Tracked for ease of searching.\n\t *\n\t * As with ident, blank before the first switch-in, and will only\n\t * change during the first switch-in.\n\t */\n\tsearchid = '';\n\n\tside: Side;\n\tslot = 0;\n\n\tfainted = false;\n\thp = 0;\n\tmaxhp = 1000;\n\tlevel = 100;\n\tgender: GenderName = 'N';\n\tshiny = false;\n\n\thpcolor: HPColor = 'g';\n\tmoves: string[] = [];\n\tability = '';\n\tbaseAbility = '';\n\titem = '';\n\titemEffect = '';\n\tprevItem = '';\n\tprevItemEffect = '';\n\n\tboosts: {[stat: string]: number} = {};\n\tstatus: StatusName | 'tox' | '' | '???' = '';\n\tstatusStage = 0;\n\tvolatiles: EffectTable = {};\n\tturnstatuses: EffectTable = {};\n\tmovestatuses: EffectTable = {};\n\tlastMove = '';\n\n\t/** [[moveName, ppUsed]] */\n\tmoveTrack: [string, number][] = [];\n\tstatusData = {sleepTurns: 0, toxicTurns: 0};\n\n\tsprite: PokemonSprite;\n\n\tconstructor(data: PokemonDetails, side: Side) {\n\t\tthis.side = side;\n\t\tthis.speciesForme = data.speciesForme;\n\n\t\tthis.details = data.details;\n\t\tthis.name = data.name;\n\t\tthis.level = data.level;\n\t\tthis.shiny = data.shiny;\n\t\tthis.gender = data.gender || 'N';\n\t\tthis.ident = data.ident;\n\t\tthis.searchid = data.searchid;\n\n\t\tthis.sprite = side.battle.scene.addPokemonSprite(this);\n\t}\n\n\tisActive() {\n\t\treturn this.side.active.includes(this);\n\t}\n\n\t/** @deprecated */\n\tprivate getHPColor(): HPColor {\n\t\tif (this.hpcolor) return this.hpcolor;\n\t\tlet ratio = this.hp / this.maxhp;\n\t\tif (ratio > 0.5) return 'g';\n\t\tif (ratio > 0.2) return 'y';\n\t\treturn 'r';\n\t}\n\t/** @deprecated */\n\tprivate getHPColorClass() {\n\t\tswitch (this.getHPColor()) {\n\t\tcase 'y': return 'hpbar hpbar-yellow';\n\t\tcase 'r': return 'hpbar hpbar-red';\n\t\t}\n\t\treturn 'hpbar';\n\t}\n\tstatic getPixelRange(pixels: number, color: HPColor | ''): [number, number] {\n\t\tlet epsilon = 0.5 / 714;\n\n\t\tif (pixels === 0) return [0, 0];\n\t\tif (pixels === 1) return [0 + epsilon, 2 / 48 - epsilon];\n\t\tif (pixels === 9) {\n\t\t\tif (color === 'y') { // ratio is > 0.2\n\t\t\t\treturn [0.2 + epsilon, 10 / 48 - epsilon];\n\t\t\t} else { // ratio is <= 0.2\n\t\t\t\treturn [9 / 48, 0.2];\n\t\t\t}\n\t\t}\n\t\tif (pixels === 24) {\n\t\t\tif (color === 'g') { // ratio is > 0.5\n\t\t\t\treturn [0.5 + epsilon, 25 / 48 - epsilon];\n\t\t\t} else { // ratio is exactly 0.5\n\t\t\t\treturn [0.5, 0.5];\n\t\t\t}\n\t\t}\n\t\tif (pixels === 48) return [1, 1];\n\n\t\treturn [pixels / 48, (pixels + 1) / 48 - epsilon];\n\t}\n\tstatic getFormattedRange(range: [number, number], precision: number, separator: string) {\n\t\tif (range[0] === range[1]) {\n\t\t\tlet percentage = Math.abs(range[0] * 100);\n\t\t\tif (Math.floor(percentage) === percentage) {\n\t\t\t\treturn percentage + '%';\n\t\t\t}\n\t\t\treturn percentage.toFixed(precision) + '%';\n\t\t}\n\t\tlet lower;\n\t\tlet upper;\n\t\tif (precision === 0) {\n\t\t\tlower = Math.floor(range[0] * 100);\n\t\t\tupper = Math.ceil(range[1] * 100);\n\t\t} else {\n\t\t\tlower = (range[0] * 100).toFixed(precision);\n\t\t\tupper = (range[1] * 100).toFixed(precision);\n\t\t}\n\t\treturn '' + lower + separator + upper + '%';\n\t}\n\t// Returns [min, max] damage dealt as a proportion of total HP from 0 to 1\n\tgetDamageRange(damage: any): [number, number] {\n\t\tif (damage[1] !== 48) {\n\t\t\tlet ratio = damage[0] / damage[1];\n\t\t\treturn [ratio, ratio];\n\t\t} else if (damage.length === undefined) {\n\t\t\t// wrong pixel damage.\n\t\t\t// this case exists for backward compatibility only.\n\t\t\treturn [damage[2] / 100, damage[2] / 100];\n\t\t}\n\t\t// pixel damage\n\t\tlet oldrange = Pokemon.getPixelRange(damage[3], damage[4]);\n\t\tlet newrange = Pokemon.getPixelRange(damage[3] + damage[0], this.hpcolor);\n\t\tif (damage[0] === 0) {\n\t\t\t// no change in displayed pixel width\n\t\t\treturn [0, newrange[1] - newrange[0]];\n\t\t}\n\t\tif (oldrange[0] < newrange[0]) { // swap order\n\t\t\tlet r = oldrange;\n\t\t\toldrange = newrange;\n\t\t\tnewrange = r;\n\t\t}\n\t\treturn [oldrange[0] - newrange[1], oldrange[1] - newrange[0]];\n\t}\n\thealthParse(hpstring: string, parsedamage?: boolean, heal?: boolean):\n\t\t[number, number, number] | [number, number, number, number, HPColor] | null {\n\t\t// returns [delta, denominator, percent(, oldnum, oldcolor)] or null\n\t\tif (!hpstring || !hpstring.length) return null;\n\t\tlet parenIndex = hpstring.lastIndexOf('(');\n\t\tif (parenIndex >= 0) {\n\t\t\t// old style damage and health reporting\n\t\t\tif (parsedamage) {\n\t\t\t\tlet damage = parseFloat(hpstring);\n\t\t\t\t// unusual check preseved for backward compatbility\n\t\t\t\tif (isNaN(damage)) damage = 50;\n\t\t\t\tif (heal) {\n\t\t\t\t\tthis.hp += this.maxhp * damage / 100;\n\t\t\t\t\tif (this.hp > this.maxhp) this.hp = this.maxhp;\n\t\t\t\t} else {\n\t\t\t\t\tthis.hp -= this.maxhp * damage / 100;\n\t\t\t\t}\n\t\t\t\t// parse the absolute health information\n\t\t\t\tlet ret = this.healthParse(hpstring);\n\t\t\t\tif (ret && (ret[1] === 100)) {\n\t\t\t\t\t// support for old replays with nearest-100th damage and health\n\t\t\t\t\treturn [damage, 100, damage];\n\t\t\t\t}\n\t\t\t\t// complicated expressions preserved for backward compatibility\n\t\t\t\tlet percent = Math.round(Math.ceil(damage * 48 / 100) / 48 * 100);\n\t\t\t\tlet pixels = Math.ceil(damage * 48 / 100);\n\t\t\t\treturn [pixels, 48, percent];\n\t\t\t}\n\t\t\tif (hpstring.substr(hpstring.length - 1) !== ')') {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\thpstring = hpstring.substr(parenIndex + 1, hpstring.length - parenIndex - 2);\n\t\t}\n\n\t\tlet oldhp = this.fainted ? 0 : (this.hp || 1);\n\t\tlet oldmaxhp = this.maxhp;\n\t\tlet oldwidth = this.hpWidth(100);\n\t\tlet oldcolor = this.hpcolor;\n\n\t\tthis.side.battle.parseHealth(hpstring, this);\n\t\tif (oldmaxhp === 0) { // max hp not known before parsing this message\n\t\t\toldmaxhp = oldhp = this.maxhp;\n\t\t}\n\n\t\tlet oldnum = oldhp ? (Math.floor(this.maxhp * oldhp / oldmaxhp) || 1) : 0;\n\t\tlet delta = this.hp - oldnum;\n\t\tlet deltawidth = this.hpWidth(100) - oldwidth;\n\t\treturn [delta, this.maxhp, deltawidth, oldnum, oldcolor];\n\t}\n\tcheckDetails(details?: string) {\n\t\tif (!details) return false;\n\t\tif (details === this.details) return true;\n\t\tif (this.searchid) return false;\n\t\tif (details.indexOf(', shiny') >= 0) {\n\t\t\tif (this.checkDetails(details.replace(', shiny', ''))) return true;\n\t\t}\n\t\t// the actual forme was hidden on Team Preview\n\t\tdetails = details.replace(/(-[A-Za-z0-9-]+)?(, |$)/, '-*$2');\n\t\treturn (details === this.details);\n\t}\n\tgetIdent() {\n\t\tlet slots = ['a', 'b', 'c', 'd', 'e', 'f'];\n\t\treturn this.ident.substr(0, 2) + slots[this.slot] + this.ident.substr(2);\n\t}\n\tremoveVolatile(volatile: ID) {\n\t\tthis.side.battle.scene.removeEffect(this, volatile);\n\t\tif (!this.hasVolatile(volatile)) return;\n\t\tdelete this.volatiles[volatile];\n\t}\n\taddVolatile(volatile: ID, ...args: any[]) {\n\t\tif (this.hasVolatile(volatile) && !args.length) return;\n\t\tthis.volatiles[volatile] = [volatile, ...args] as EffectState;\n\t\tthis.side.battle.scene.addEffect(this, volatile);\n\t}\n\thasVolatile(volatile: ID) {\n\t\treturn !!this.volatiles[volatile];\n\t}\n\tremoveTurnstatus(volatile: ID) {\n\t\tthis.side.battle.scene.removeEffect(this, volatile);\n\t\tif (!this.hasTurnstatus(volatile)) return;\n\t\tdelete this.turnstatuses[volatile];\n\t}\n\taddTurnstatus(volatile: ID) {\n\t\tvolatile = toID(volatile);\n\t\tthis.side.battle.scene.addEffect(this, volatile);\n\t\tif (this.hasTurnstatus(volatile)) return;\n\t\tthis.turnstatuses[volatile] = [volatile];\n\t}\n\thasTurnstatus(volatile: ID) {\n\t\treturn !!this.turnstatuses[volatile];\n\t}\n\tclearTurnstatuses() {\n\t\tfor (let id in this.turnstatuses) {\n\t\t\tthis.removeTurnstatus(id as ID);\n\t\t}\n\t\tthis.turnstatuses = {};\n\t\tthis.side.battle.scene.updateStatbar(this);\n\t}\n\tremoveMovestatus(volatile: ID) {\n\t\tthis.side.battle.scene.removeEffect(this, volatile);\n\t\tif (!this.hasMovestatus(volatile)) return;\n\t\tdelete this.movestatuses[volatile];\n\t}\n\taddMovestatus(volatile: ID) {\n\t\tvolatile = toID(volatile);\n\t\tif (this.hasMovestatus(volatile)) return;\n\t\tthis.movestatuses[volatile] = [volatile];\n\t\tthis.side.battle.scene.addEffect(this, volatile);\n\t}\n\thasMovestatus(volatile: ID) {\n\t\treturn !!this.movestatuses[volatile];\n\t}\n\tclearMovestatuses() {\n\t\tfor (let id in this.movestatuses) {\n\t\t\tthis.removeMovestatus(id as ID);\n\t\t}\n\t\tthis.movestatuses = {};\n\t}\n\tclearVolatiles() {\n\t\tthis.volatiles = {};\n\t\tthis.clearTurnstatuses();\n\t\tthis.clearMovestatuses();\n\t\tthis.side.battle.scene.clearEffects(this);\n\t}\n\trememberMove(moveName: string, pp = 1, recursionSource?: string) {\n\t\tif (recursionSource === this.ident) return;\n\t\tmoveName = Dex.getMove(moveName).name;\n\t\tif (moveName.charAt(0) === '*') return;\n\t\tif (moveName === 'Struggle') return;\n\t\tif (this.volatiles.transform) {\n\t\t\t// make sure there is no infinite recursion if both Pokemon are transformed into each other\n\t\t\tif (!recursionSource) recursionSource = this.ident;\n\t\t\tthis.volatiles.transform[1].rememberMove(moveName, 0, recursionSource);\n\t\t\tmoveName = '*' + moveName;\n\t\t}\n\t\tfor (const entry of this.moveTrack) {\n\t\t\tif (moveName === entry[0]) {\n\t\t\t\tentry[1] += pp;\n\t\t\t\tif (entry[1] < 0) entry[1] = 0;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tthis.moveTrack.push([moveName, pp]);\n\t}\n\trememberAbility(ability: string, isNotBase?: boolean) {\n\t\tability = Dex.getAbility(ability).name;\n\t\tthis.ability = ability;\n\t\tif (!this.baseAbility && !isNotBase) {\n\t\t\tthis.baseAbility = ability;\n\t\t}\n\t}\n\tgetBoost(boostStat: BoostStatName) {\n\t\tlet boostStatTable = {\n\t\t\tatk: 'Atk',\n\t\t\tdef: 'Def',\n\t\t\tspa: 'SpA',\n\t\t\tspd: 'SpD',\n\t\t\tspe: 'Spe',\n\t\t\taccuracy: 'Accuracy',\n\t\t\tevasion: 'Evasion',\n\t\t\tspc: 'Spc',\n\t\t};\n\t\tif (!this.boosts[boostStat]) {\n\t\t\treturn '1&times;&nbsp;' + boostStatTable[boostStat];\n\t\t}\n\t\tif (this.boosts[boostStat] > 6) this.boosts[boostStat] = 6;\n\t\tif (this.boosts[boostStat] < -6) this.boosts[boostStat] = -6;\n\t\tconst isRBY = this.side.battle.gen <= 1 && !this.side.battle.tier.includes('Stadium');\n\t\tif (!isRBY && (boostStat === 'accuracy' || boostStat === 'evasion')) {\n\t\t\tif (this.boosts[boostStat] > 0) {\n\t\t\t\tlet goodBoostTable = [\n\t\t\t\t\t'1&times;', '1.33&times;', '1.67&times;', '2&times;', '2.33&times;', '2.67&times;', '3&times;',\n\t\t\t\t];\n\t\t\t\t// let goodBoostTable = ['Normal', '+1', '+2', '+3', '+4', '+5', '+6'];\n\t\t\t\treturn '' + goodBoostTable[this.boosts[boostStat]] + '&nbsp;' + boostStatTable[boostStat];\n\t\t\t}\n\t\t\tlet badBoostTable = [\n\t\t\t\t'1&times;', '0.75&times;', '0.6&times;', '0.5&times;', '0.43&times;', '0.38&times;', '0.33&times;',\n\t\t\t];\n\t\t\t// let badBoostTable = ['Normal', '&minus;1', '&minus;2', '&minus;3', '&minus;4', '&minus;5', '&minus;6'];\n\t\t\treturn '' + badBoostTable[-this.boosts[boostStat]] + '&nbsp;' + boostStatTable[boostStat];\n\t\t}\n\t\tif (this.boosts[boostStat] > 0) {\n\t\t\tlet goodBoostTable = [\n\t\t\t\t'1&times;', '1.5&times;', '2&times;', '2.5&times;', '3&times;', '3.5&times;', '4&times;',\n\t\t\t];\n\t\t\t// let goodBoostTable = ['Normal', '+1', '+2', '+3', '+4', '+5', '+6'];\n\t\t\treturn '' + goodBoostTable[this.boosts[boostStat]] + '&nbsp;' + boostStatTable[boostStat];\n\t\t}\n\t\tlet badBoostTable = [\n\t\t\t'1&times;', '0.67&times;', '0.5&times;', '0.4&times;', '0.33&times;', '0.29&times;', '0.25&times;',\n\t\t];\n\t\t// let badBoostTable = ['Normal', '&minus;1', '&minus;2', '&minus;3', '&minus;4', '&minus;5', '&minus;6'];\n\t\treturn '' + badBoostTable[-this.boosts[boostStat]] + '&nbsp;' + boostStatTable[boostStat];\n\t}\n\tgetWeightKg(serverPokemon?: ServerPokemon) {\n\t\tlet autotomizeFactor = this.volatiles.autotomize?.[1] * 100 || 0;\n\t\treturn Math.max(this.getSpecies(serverPokemon).weightkg - autotomizeFactor, 0.1);\n\t}\n\tgetBoostType(boostStat: BoostStatName) {\n\t\tif (!this.boosts[boostStat]) return 'neutral';\n\t\tif (this.boosts[boostStat] > 0) return 'good';\n\t\treturn 'bad';\n\t}\n\tclearVolatile() {\n\t\tthis.ability = this.baseAbility;\n\t\tthis.boosts = {};\n\t\tthis.clearVolatiles();\n\t\tfor (let i = 0; i < this.moveTrack.length; i++) {\n\t\t\tif (this.moveTrack[i][0].charAt(0) === '*') {\n\t\t\t\tthis.moveTrack.splice(i, 1);\n\t\t\t\ti--;\n\t\t\t}\n\t\t}\n\t\t// this.lastMove = '';\n\t\tthis.statusStage = 0;\n\t\tthis.statusData.toxicTurns = 0;\n\t\tif (this.side.battle.gen === 5) this.statusData.sleepTurns = 0;\n\t}\n\t/**\n\t * copyAll = false means Baton Pass,\n\t * copyAll = true means Illusion breaking\n\t */\n\tcopyVolatileFrom(pokemon: Pokemon, copyAll?: boolean) {\n\t\tthis.boosts = pokemon.boosts;\n\t\tthis.volatiles = pokemon.volatiles;\n\t\t// this.lastMove = pokemon.lastMove; // I think\n\t\tif (!copyAll) {\n\t\t\tdelete this.volatiles['airballoon'];\n\t\t\tdelete this.volatiles['attract'];\n\t\t\tdelete this.volatiles['autotomize'];\n\t\t\tdelete this.volatiles['disable'];\n\t\t\tdelete this.volatiles['encore'];\n\t\t\tdelete this.volatiles['foresight'];\n\t\t\tdelete this.volatiles['imprison'];\n\t\t\tdelete this.volatiles['laserfocus'];\n\t\t\tdelete this.volatiles['mimic'];\n\t\t\tdelete this.volatiles['miracleeye'];\n\t\t\tdelete this.volatiles['nightmare'];\n\t\t\tdelete this.volatiles['smackdown'];\n\t\t\tdelete this.volatiles['stockpile1'];\n\t\t\tdelete this.volatiles['stockpile2'];\n\t\t\tdelete this.volatiles['stockpile3'];\n\t\t\tdelete this.volatiles['torment'];\n\t\t\tdelete this.volatiles['typeadd'];\n\t\t\tdelete this.volatiles['typechange'];\n\t\t\tdelete this.volatiles['yawn'];\n\t\t}\n\t\tdelete this.volatiles['transform'];\n\t\tdelete this.volatiles['formechange'];\n\n\t\tpokemon.boosts = {};\n\t\tpokemon.volatiles = {};\n\t\tpokemon.side.battle.scene.removeTransform(pokemon);\n\t\tpokemon.statusStage = 0;\n\t}\n\tcopyTypesFrom(pokemon: Pokemon) {\n\t\tconst [types, addedType] = pokemon.getTypes();\n\t\tthis.addVolatile('typechange' as ID, types.join('/'));\n\t\tif (addedType) {\n\t\t\tthis.addVolatile('typeadd' as ID, addedType);\n\t\t} else {\n\t\t\tthis.removeVolatile('typeadd' as ID);\n\t\t}\n\t}\n\tgetTypes(serverPokemon?: ServerPokemon): [ReadonlyArray<TypeName>, TypeName | ''] {\n\t\tlet types: ReadonlyArray<TypeName>;\n\t\tif (this.volatiles.typechange) {\n\t\t\ttypes = this.volatiles.typechange[1].split('/');\n\t\t} else {\n\t\t\ttypes = this.getSpecies(serverPokemon).types;\n\t\t}\n\t\tif (this.hasTurnstatus('roost' as ID) && types.includes('Flying')) {\n\t\t\ttypes = types.filter(typeName => typeName !== 'Flying');\n\t\t\tif (!types.length) types = ['Normal'];\n\t\t}\n\t\tconst addedType = (this.volatiles.typeadd ? this.volatiles.typeadd[1] : '');\n\t\treturn [types, addedType];\n\t}\n\tisGrounded(serverPokemon?: ServerPokemon) {\n\t\tconst battle = this.side.battle;\n\t\tif (battle.hasPseudoWeather('Gravity')) {\n\t\t\treturn true;\n\t\t} else if (this.volatiles['ingrain'] && battle.gen >= 4) {\n\t\t\treturn true;\n\t\t} else if (this.volatiles['smackdown']) {\n\t\t\treturn true;\n\t\t}\n\n\t\tlet item = toID(serverPokemon ? serverPokemon.item : this.item);\n\t\tlet ability = toID(this.ability || serverPokemon?.ability);\n\t\tif (battle.hasPseudoWeather('Magic Room') || this.volatiles['embargo'] || ability === 'klutz') {\n\t\t\titem = '' as ID;\n\t\t}\n\n\t\tif (item === 'ironball') {\n\t\t\treturn true;\n\t\t}\n\t\tif (ability === 'levitate') {\n\t\t\treturn false;\n\t\t}\n\t\tif (this.volatiles['magnetrise'] || this.volatiles['telekinesis']) {\n\t\t\treturn false;\n\t\t}\n\t\tif (item === 'airballoon') {\n\t\t\treturn false;\n\t\t}\n\t\treturn !this.getTypeList(serverPokemon).includes('Flying');\n\t}\n\tgetTypeList(serverPokemon?: ServerPokemon) {\n\t\tconst [types, addedType] = this.getTypes(serverPokemon);\n\t\treturn addedType ? types.concat(addedType) : types;\n\t}\n\tgetSpeciesForme(serverPokemon?: ServerPokemon): string {\n\t\treturn this.volatiles.formechange ? this.volatiles.formechange[1] :\n\t\t\t(serverPokemon ? serverPokemon.speciesForme : this.speciesForme);\n\t}\n\tgetSpecies(serverPokemon?: ServerPokemon) {\n\t\treturn this.side.battle.dex.getSpecies(this.getSpeciesForme(serverPokemon));\n\t}\n\tgetBaseSpecies() {\n\t\treturn this.side.battle.dex.getSpecies(this.speciesForme);\n\t}\n\treset() {\n\t\tthis.clearVolatile();\n\t\tthis.hp = this.maxhp;\n\t\tthis.fainted = false;\n\t\tthis.status = '';\n\t\tthis.moveTrack = [];\n\t\tthis.name = this.name || this.speciesForme;\n\t}\n\t// This function is used for two things:\n\t//   1) The percentage to display beside the HP bar.\n\t//   2) The width to draw an HP bar.\n\t//\n\t// This function is NOT used in the calculation of any other displayed\n\t// percentages or ranges, which have their own, more complex, formulae.\n\thpWidth(maxWidth: number) {\n\t\tif (this.fainted || !this.hp) return 0;\n\n\t\t// special case for low health...\n\t\tif (this.hp === 1 && this.maxhp > 45) return 1;\n\n\t\tif (this.maxhp === 48) {\n\t\t\t// Draw the health bar to the middle of the range.\n\t\t\t// This affects the width of the visual health bar *only*; it\n\t\t\t// does not affect the ranges displayed in any way.\n\t\t\tlet range = Pokemon.getPixelRange(this.hp, this.hpcolor);\n\t\t\tlet ratio = (range[0] + range[1]) / 2;\n\t\t\treturn Math.round(maxWidth * ratio) || 1;\n\t\t}\n\t\tlet percentage = Math.ceil(100 * this.hp / this.maxhp);\n\t\tif ((percentage === 100) && (this.hp < this.maxhp)) {\n\t\t\tpercentage = 99;\n\t\t}\n\t\treturn percentage * maxWidth / 100;\n\t}\n\tstatic getHPText(pokemon: PokemonHealth, precision = 1) {\n\t\tif (pokemon.maxhp === 100) return pokemon.hp + '%';\n\t\tif (pokemon.maxhp !== 48) return (100 * pokemon.hp / pokemon.maxhp).toFixed(precision) + '%';\n\t\tlet range = Pokemon.getPixelRange(pokemon.hp, pokemon.hpcolor);\n\t\treturn Pokemon.getFormattedRange(range, precision, '');\n\t}\n\tdestroy() {\n\t\tif (this.sprite) this.sprite.destroy();\n\t\tthis.sprite = null!;\n\t\tthis.side = null!;\n\t}\n}\n\nclass Side {\n\tbattle: Battle;\n\tname = '';\n\tid = '';\n\tn: number;\n\tisFar: boolean;\n\tfoe: Side = null!;\n\tavatar: string = 'unknown';\n\trating: string = '';\n\ttotalPokemon = 6;\n\tx = 0;\n\ty = 0;\n\tz = 0;\n\tmissedPokemon: Pokemon = null!;\n\n\twisher: Pokemon | null = null;\n\n\tactive = [null] as (Pokemon | null)[];\n\tlastPokemon = null as Pokemon | null;\n\tpokemon = [] as Pokemon[];\n\n\t/** [effectName, levels, minDuration, maxDuration] */\n\tsideConditions: {[id: string]: [string, number, number, number]} = {};\n\n\tconstructor(battle: Battle, n: number, isOpp?: boolean) {\n\t\tthis.battle = battle;\n\t\tthis.n = n;\n\t\tthis.isFar = isOpp || !!n;\n\t\tthis.updateSprites();\n\t}\n\n\trollTrainerSprites() {\n\t\tlet sprites = ['lucas', 'dawn', 'ethan', 'lyra', 'hilbert', 'hilda'];\n\t\tthis.avatar = sprites[Math.floor(Math.random() * sprites.length)];\n\t}\n\n\tbehindx(offset: number) {\n\t\treturn this.x + (!this.isFar ? -1 : 1) * offset;\n\t}\n\tbehindy(offset: number) {\n\t\treturn this.y + (!this.isFar ? 1 : -1) * offset;\n\t}\n\tleftof(offset: number) {\n\t\treturn (!this.isFar ? -1 : 1) * offset;\n\t}\n\tbehind(offset: number) {\n\t\treturn this.z + (!this.isFar ? -1 : 1) * offset;\n\t}\n\n\tclearPokemon() {\n\t\tfor (const pokemon of this.pokemon) pokemon.destroy();\n\t\tthis.pokemon = [];\n\t\tfor (let i = 0; i < this.active.length; i++) this.active[i] = null;\n\t\tthis.lastPokemon = null;\n\t}\n\treset() {\n\t\tthis.clearPokemon();\n\t\tthis.updateSprites();\n\t\tthis.sideConditions = {};\n\t}\n\tupdateSprites() {\n\t\tthis.z = (this.isFar ? 200 : 0);\n\t\tthis.battle.scene.updateSpritesForSide(this);\n\t}\n\tsetAvatar(avatar: string) {\n\t\tthis.avatar = avatar;\n\t}\n\tsetName(name: string, avatar?: string) {\n\t\tif (name) this.name = name;\n\t\tthis.id = toID(this.name);\n\t\tif (avatar) {\n\t\t\tthis.setAvatar(avatar);\n\t\t} else {\n\t\t\tthis.rollTrainerSprites();\n\t\t\tif (this.foe && this.avatar === this.foe.avatar) this.rollTrainerSprites();\n\t\t}\n\t\tif (this.battle.stagnateCallback) this.battle.stagnateCallback(this.battle);\n\t}\n\taddSideCondition(effect: Effect) {\n\t\tlet condition = effect.id;\n\t\tif (this.sideConditions[condition]) {\n\t\t\tif (condition === 'spikes' || condition === 'toxicspikes') {\n\t\t\t\tthis.sideConditions[condition][1]++;\n\t\t\t}\n\t\t\tthis.battle.scene.addSideCondition(this.n, condition);\n\t\t\treturn;\n\t\t}\n\t\t// Side conditions work as: [effectName, levels, minDuration, maxDuration]\n\t\tswitch (condition) {\n\t\tcase 'auroraveil':\n\t\t\tthis.sideConditions[condition] = [effect.name, 1, 5, 8];\n\t\t\tbreak;\n\t\tcase 'reflect':\n\t\t\tthis.sideConditions[condition] = [effect.name, 1, 5, this.battle.gen >= 4 ? 8 : 0];\n\t\t\tbreak;\n\t\tcase 'safeguard':\n\t\t\tthis.sideConditions[condition] = [effect.name, 1, 5, 0];\n\t\t\tbreak;\n\t\tcase 'lightscreen':\n\t\t\tthis.sideConditions[condition] = [effect.name, 1, 5, this.battle.gen >= 4 ? 8 : 0];\n\t\t\tbreak;\n\t\tcase 'mist':\n\t\t\tthis.sideConditions[condition] = [effect.name, 1, 5, 0];\n\t\t\tbreak;\n\t\tcase 'tailwind':\n\t\t\tthis.sideConditions[condition] = [effect.name, 1, this.battle.gen >= 5 ? 4 : 3, 0];\n\t\t\tbreak;\n\t\tcase 'luckychant':\n\t\t\tthis.sideConditions[condition] = [effect.name, 1, 5, 0];\n\t\t\tbreak;\n\t\tcase 'stealthrock':\n\t\tcase 'spikes':\n\t\tcase 'toxicspikes':\n\t\tcase 'stickyweb':\n\t\t\tthis.sideConditions[condition] = [effect.name, 1, 0, 0];\n\t\t\tbreak;\n\t\tcase 'gmaxwildfire':\n\t\tcase 'gmaxvolcalith':\n\t\tcase 'gmaxvinelash':\n\t\tcase 'gmaxcannonade':\n\t\t\tthis.sideConditions[condition] = [effect.name, 1, 4, 0];\n\t\t\tbreak;\n\t\tcase 'grasspledge':\n\t\t\tthis.sideConditions[condition] = ['Swamp', 1, 4, 0];\n\t\t\tbreak;\n\t\tcase 'waterpledge':\n\t\t\tthis.sideConditions[condition] = ['Rainbow', 1, 4, 0];\n\t\t\tbreak;\n\t\tcase 'firepledge':\n\t\t\tthis.sideConditions[condition] = ['Sea of Fire', 1, 4, 0];\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tthis.sideConditions[condition] = [effect.name, 1, 0, 0];\n\t\t\tbreak;\n\t\t}\n\t\tthis.battle.scene.addSideCondition(this.n, condition);\n\t}\n\tremoveSideCondition(condition: string) {\n\t\tconst id = toID(condition);\n\t\tif (!this.sideConditions[id]) return;\n\t\tdelete this.sideConditions[id];\n\t\tthis.battle.scene.removeSideCondition(this.n, id);\n\t}\n\taddPokemon(name: string, ident: string, details: string, replaceSlot = -1) {\n\t\tconst oldItem = replaceSlot >= 0 ? this.pokemon[replaceSlot].item : undefined;\n\n\t\tconst data = this.battle.parseDetails(name, ident, details);\n\t\tconst poke = new Pokemon(data, this);\n\t\tif (oldItem) poke.item = oldItem;\n\n\t\tif (!poke.ability && poke.baseAbility) poke.ability = poke.baseAbility;\n\t\tpoke.reset();\n\n\t\tif (replaceSlot >= 0) {\n\t\t\tthis.pokemon[replaceSlot] = poke;\n\t\t} else {\n\t\t\tthis.pokemon.push(poke);\n\t\t}\n\t\tif (this.pokemon.length > this.totalPokemon || this.battle.speciesClause) {\n\t\t\t// check for Illusion\n\t\t\tlet existingTable: {[searchid: string]: number} = {};\n\t\t\tlet toRemove = -1;\n\t\t\tfor (let poke1i = 0; poke1i < this.pokemon.length; poke1i++) {\n\t\t\t\tlet poke1 = this.pokemon[poke1i];\n\t\t\t\tif (!poke1.searchid) continue;\n\t\t\t\tif (poke1.searchid in existingTable) {\n\t\t\t\t\tlet poke2i = existingTable[poke1.searchid];\n\t\t\t\t\tlet poke2 = this.pokemon[poke2i];\n\t\t\t\t\tif (poke === poke1) {\n\t\t\t\t\t\ttoRemove = poke2i;\n\t\t\t\t\t} else if (poke === poke2) {\n\t\t\t\t\t\ttoRemove = poke1i;\n\t\t\t\t\t} else if (this.active.indexOf(poke1) >= 0) {\n\t\t\t\t\t\ttoRemove = poke2i;\n\t\t\t\t\t} else if (this.active.indexOf(poke2) >= 0) {\n\t\t\t\t\t\ttoRemove = poke1i;\n\t\t\t\t\t} else if (poke1.fainted && !poke2.fainted) {\n\t\t\t\t\t\ttoRemove = poke2i;\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttoRemove = poke1i;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\texistingTable[poke1.searchid] = poke1i;\n\t\t\t}\n\t\t\tif (toRemove >= 0) {\n\t\t\t\tif (this.pokemon[toRemove].fainted) {\n\t\t\t\t\t// A fainted Pokemon was actually a Zoroark\n\t\t\t\t\tlet illusionFound = null;\n\t\t\t\t\tfor (const curPoke of this.pokemon) {\n\t\t\t\t\t\tif (curPoke === poke) continue;\n\t\t\t\t\t\tif (curPoke.fainted) continue;\n\t\t\t\t\t\tif (this.active.indexOf(curPoke) >= 0) continue;\n\t\t\t\t\t\tif (curPoke.speciesForme === 'Zoroark' || curPoke.speciesForme === 'Zorua' || curPoke.ability === 'Illusion') {\n\t\t\t\t\t\t\tillusionFound = curPoke;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (!illusionFound) {\n\t\t\t\t\t\t// This is Hackmons; we'll just guess a random unfainted Pokemon.\n\t\t\t\t\t\t// This will keep the fainted Pokemon count correct, and will\n\t\t\t\t\t\t// eventually become correct as incorrect guesses are switched in\n\t\t\t\t\t\t// and reguessed.\n\t\t\t\t\t\tfor (const curPoke of this.pokemon) {\n\t\t\t\t\t\t\tif (curPoke === poke) continue;\n\t\t\t\t\t\t\tif (curPoke.fainted) continue;\n\t\t\t\t\t\t\tif (this.active.indexOf(curPoke) >= 0) continue;\n\t\t\t\t\t\t\tillusionFound = curPoke;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (illusionFound) {\n\t\t\t\t\t\tillusionFound.fainted = true;\n\t\t\t\t\t\tillusionFound.hp = 0;\n\t\t\t\t\t\tillusionFound.status = '';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.pokemon.splice(toRemove, 1);\n\t\t\t}\n\t\t}\n\t\tthis.battle.scene.updateSidebar(this);\n\n\t\treturn poke;\n\t}\n\n\tswitchIn(pokemon: Pokemon, slot?: number) {\n\t\tif (slot === undefined) slot = pokemon.slot;\n\t\tthis.active[slot] = pokemon;\n\t\tpokemon.slot = slot;\n\t\tpokemon.clearVolatile();\n\t\tpokemon.lastMove = '';\n\t\tthis.battle.lastMove = 'switch-in';\n\t\tif (['batonpass', 'zbatonpass'].includes(this.lastPokemon?.lastMove!)) {\n\t\t\tpokemon.copyVolatileFrom(this.lastPokemon!);\n\t\t}\n\n\t\tthis.battle.scene.animSummon(pokemon, slot);\n\n\t\tif (this.battle.switchCallback) this.battle.switchCallback(this.battle, this);\n\t}\n\tdragIn(pokemon: Pokemon, slot = pokemon.slot) {\n\t\tlet oldpokemon = this.active[slot];\n\t\tif (oldpokemon === pokemon) return;\n\t\tthis.lastPokemon = oldpokemon;\n\t\tif (oldpokemon) {\n\t\t\tthis.battle.scene.animDragOut(oldpokemon);\n\t\t\toldpokemon.clearVolatile();\n\t\t}\n\t\tpokemon.clearVolatile();\n\t\tpokemon.lastMove = '';\n\t\tthis.battle.lastMove = 'switch-in';\n\t\tthis.active[slot] = pokemon;\n\t\tpokemon.slot = slot;\n\n\t\tthis.battle.scene.animDragIn(pokemon, slot);\n\n\t\tif (this.battle.dragCallback) this.battle.dragCallback(this.battle, this);\n\t}\n\treplace(pokemon: Pokemon, slot = pokemon.slot) {\n\t\tlet oldpokemon = this.active[slot];\n\t\tif (pokemon === oldpokemon) return;\n\t\tthis.lastPokemon = oldpokemon;\n\t\tpokemon.clearVolatile();\n\t\tif (oldpokemon) {\n\t\t\tpokemon.lastMove = oldpokemon.lastMove;\n\t\t\tpokemon.hp = oldpokemon.hp;\n\t\t\tpokemon.maxhp = oldpokemon.maxhp;\n\t\t\tpokemon.hpcolor = oldpokemon.hpcolor;\n\t\t\tpokemon.status = oldpokemon.status;\n\t\t\tpokemon.copyVolatileFrom(oldpokemon, true);\n\t\t\tpokemon.statusData = {...oldpokemon.statusData};\n\t\t\t// we don't know anything about the illusioned pokemon except that it's not fainted\n\t\t\t// technically we also know its status but only at the end of the turn, not here\n\t\t\toldpokemon.fainted = false;\n\t\t\toldpokemon.hp = oldpokemon.maxhp;\n\t\t\toldpokemon.status = '???';\n\t\t}\n\t\tthis.active[slot] = pokemon;\n\t\tpokemon.slot = slot;\n\n\t\tif (oldpokemon) {\n\t\t\tthis.battle.scene.animUnsummon(oldpokemon, true);\n\t\t}\n\t\tthis.battle.scene.animSummon(pokemon, slot, true);\n\t\t// not sure if we want a different callback\n\t\tif (this.battle.dragCallback) this.battle.dragCallback(this.battle, this);\n\t}\n\tswitchOut(pokemon: Pokemon, slot = pokemon.slot) {\n\t\tif (pokemon.lastMove !== 'batonpass' && pokemon.lastMove !== 'zbatonpass') {\n\t\t\tpokemon.clearVolatile();\n\t\t} else {\n\t\t\tpokemon.removeVolatile('transform' as ID);\n\t\t\tpokemon.removeVolatile('formechange' as ID);\n\t\t}\n\t\tif (pokemon.lastMove === 'uturn' || pokemon.lastMove === 'voltswitch') {\n\t\t\tthis.battle.log(['switchout', pokemon.ident], {from: pokemon.lastMove});\n\t\t} else if (pokemon.lastMove !== 'batonpass' && pokemon.lastMove !== 'zbatonpass') {\n\t\t\tthis.battle.log(['switchout', pokemon.ident]);\n\t\t}\n\t\tpokemon.statusData.toxicTurns = 0;\n\t\tif (this.battle.gen === 5) pokemon.statusData.sleepTurns = 0;\n\t\tthis.lastPokemon = pokemon;\n\t\tthis.active[slot] = null;\n\n\t\tthis.battle.scene.animUnsummon(pokemon);\n\t}\n\tswapTo(pokemon: Pokemon, slot: number, kwArgs: KWArgs) {\n\t\tif (pokemon.slot === slot) return;\n\t\tlet target = this.active[slot];\n\n\t\tlet oslot = pokemon.slot;\n\n\t\tpokemon.slot = slot;\n\t\tif (target) target.slot = oslot;\n\n\t\tthis.active[slot] = pokemon;\n\t\tthis.active[oslot] = target;\n\n\t\tthis.battle.scene.animUnsummon(pokemon, true);\n\t\tif (target) this.battle.scene.animUnsummon(target, true);\n\n\t\tthis.battle.scene.animSummon(pokemon, slot, true);\n\t\tif (target) this.battle.scene.animSummon(target, oslot, true);\n\t}\n\tswapWith(pokemon: Pokemon, target: Pokemon, kwArgs: KWArgs) {\n\t\t// method provided for backwards compatibility only\n\t\tif (pokemon === target) return;\n\n\t\tlet oslot = pokemon.slot;\n\t\tlet nslot = target.slot;\n\n\t\tpokemon.slot = nslot;\n\t\ttarget.slot = oslot;\n\t\tthis.active[nslot] = pokemon;\n\t\tthis.active[oslot] = target;\n\n\t\tthis.battle.scene.animUnsummon(pokemon, true);\n\t\tthis.battle.scene.animUnsummon(target, true);\n\n\t\tthis.battle.scene.animSummon(pokemon, nslot, true);\n\t\tthis.battle.scene.animSummon(target, oslot, true);\n\t}\n\tfaint(pokemon: Pokemon, slot = pokemon.slot) {\n\t\tpokemon.clearVolatile();\n\t\tthis.lastPokemon = pokemon;\n\t\tthis.active[slot] = null;\n\n\t\tpokemon.fainted = true;\n\t\tpokemon.hp = 0;\n\n\t\tthis.battle.scene.animFaint(pokemon);\n\t\tif (this.battle.faintCallback) this.battle.faintCallback(this.battle, this);\n\t}\n\tdestroy() {\n\t\tthis.clearPokemon();\n\t\tthis.battle = null!;\n\t\tthis.foe = null!;\n\t}\n}\n\nenum Playback {\n\t/**\n\t * Battle is at the end of the queue. `|start` is not in the queue.\n\t * Battle is waiting for `.add()` or `.setQueue()` to add `|start` to\n\t * the queue. Adding other queue entries will happen immediately,\n\t * bringing the state back to Uninitialized.\n\t */\n\tUninitialized = 0,\n\t/**\n\t * Battle is at `|start` and hasn't been started yet.\n\t * Battle is paused, waiting for `.play()`.\n\t */\n\tReady = 1,\n\t/**\n\t * `.play()` has been called. Battle should be animating\n\t * normally.\n\t */\n\tPlaying = 2,\n\t/**\n\t * `.pause()` has been called. Battle is waiting for `.play()`.\n\t */\n\tPaused = 3,\n\t/**\n\t * Battle is at the end of the queue. Battle is waiting for\n\t * `.add()` for further battle progress.\n\t */\n\tFinished = 4,\n\t/**\n\t * Battle is fast forwarding through the queue, with animations off.\n\t */\n\tSeeking = 5,\n}\n\ninterface PokemonDetails {\n\tdetails: string;\n\tname: string;\n\tspeciesForme: string;\n\tlevel: number;\n\tshiny: boolean;\n\tgender: GenderName | '';\n\tident: string;\n\tsearchid: string;\n}\ninterface PokemonHealth {\n\thp: number;\n\tmaxhp: number;\n\thpcolor: HPColor | '';\n\tstatus: StatusName | 'tox' | '' | '???';\n\tfainted?: boolean;\n}\ninterface ServerPokemon extends PokemonDetails, PokemonHealth {\n\tident: string;\n\tdetails: string;\n\tcondition: string;\n\tactive: boolean;\n\t/** unboosted stats */\n\tstats: {\n\t\tatk: number,\n\t\tdef: number,\n\t\tspa: number,\n\t\tspd: number,\n\t\tspe: number,\n\t};\n\t/** currently an ID, will revise to name */\n\tmoves: string[];\n\t/** currently an ID, will revise to name */\n\tbaseAbility: string;\n\t/** currently an ID, will revise to name */\n\tability?: string;\n\t/** currently an ID, will revise to name */\n\titem: string;\n\t/** currently an ID, will revise to name */\n\tpokeball: string;\n\t/** false if the pokemon cannot gigantamax, otherwise a string containing the full name of its G-max move */\n\tgigantamax: string | false;\n}\n\nclass Battle {\n\tscene: BattleScene | BattleSceneStub;\n\n\tsidesSwitched = false;\n\n\t// activity queue\n\tactivityQueue = [] as string[];\n\t/** See battle.instantAdd */\n\tpreemptActivityQueue = [] as string[];\n\twaitForAnimations: true | false | 'simult' = true;\n\tactivityStep = 0;\n\tfastForward = 0;\n\tfastForwardWillScroll = false;\n\n\tresultWaiting = false;\n\tactiveMoveIsSpread: string | null = null;\n\n\t// callback\n\tfaintCallback: ((battle: Battle, side: Side) => void) | null = null;\n\tswitchCallback: ((battle: Battle, side: Side) => void) | null = null;\n\tdragCallback: ((battle: Battle, side: Side) => void) | null = null;\n\tturnCallback: ((battle: Battle) => void) | null = null;\n\tstartCallback: ((battle: Battle) => void) | null = null;\n\tstagnateCallback: ((battle: Battle) => void) | null = null;\n\tendCallback: ((battle: Battle) => void) | null = null;\n\tcustomCallback: ((battle: Battle, cmd: string, args: string[], kwArgs: KWArgs) => void) | null = null;\n\terrorCallback: ((battle: Battle) => void) | null = null;\n\n\tmute = false;\n\tmessageFadeTime = 300;\n\tmessageShownTime = 1;\n\tturnsSinceMoved = 0;\n\n\tturn = 0;\n\t/**\n\t * Has playback gotten to Team Preview or `|start` yet?\n\t * (Affects whether BGM is playing)\n\t */\n\tstarted = false;\n\t/**\n\t * Has playback gotten to the point where a player has won or tied?\n\t * (Affects whether BGM is playing)\n\t */\n\tended = false;\n\tusesUpkeep = false;\n\tweather = '' as ID;\n\tpseudoWeather = [] as WeatherState[];\n\tweatherTimeLeft = 0;\n\tweatherMinTimeLeft = 0;\n\tmySide: Side = null!;\n\tnearSide: Side = null!;\n\tfarSide: Side = null!;\n\tp1: Side = null!;\n\tp2: Side = null!;\n\tmyPokemon: ServerPokemon[] | null = null;\n\tsides: [Side, Side] = [null!, null!];\n\tlastMove = '';\n\n\tgen = 7;\n\tdex: ModdedDex = Dex;\n\tteamPreviewCount = 0;\n\tspeciesClause = false;\n\ttier = '';\n\tgameType: 'singles' | 'doubles' | 'triples' = 'singles';\n\trated: string | boolean = false;\n\tisBlitz = false;\n\tendLastTurnPending = false;\n\ttotalTimeLeft = 0;\n\tgraceTimeLeft = 0;\n\t/**\n\t * true: timer on, state unknown\n\t * false: timer off\n\t * number: seconds left this turn\n\t */\n\tkickingInactive: number | boolean = false;\n\n\t// options\n\tid = '';\n\troomid = '';\n\thardcoreMode = false;\n\tignoreNicks = !!Dex.prefs('ignorenicks');\n\tignoreOpponent = !!Dex.prefs('ignoreopp');\n\tignoreSpects = !!Dex.prefs('ignorespects');\n\tdebug = false;\n\tjoinButtons = false;\n\n\t/**\n\t * The actual pause state. Will only be true if playback is actually\n\t * paused, not just waiting for the opponent to make a move.\n\t */\n\tpaused = true;\n\tplaybackState = Playback.Uninitialized;\n\n\t// external\n\tresumeButton: JQuery.EventHandler<HTMLElement, null> | null = null;\n\n\tconstructor($frame: JQuery<HTMLElement>, $logFrame: JQuery<HTMLElement>, id = '') {\n\t\tthis.id = id;\n\n\t\tif (!$frame && !$logFrame) {\n\t\t\tthis.scene = new BattleSceneStub();\n\t\t} else {\n\t\t\tthis.scene = new BattleScene(this, $frame, $logFrame);\n\t\t}\n\n\t\tthis.init();\n\t}\n\n\tremovePseudoWeather(weather: string) {\n\t\tfor (let i = 0; i < this.pseudoWeather.length; i++) {\n\t\t\tif (this.pseudoWeather[i][0] === weather) {\n\t\t\t\tthis.pseudoWeather.splice(i, 1);\n\t\t\t\tthis.scene.updateWeather();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\taddPseudoWeather(weather: string, minTimeLeft: number, timeLeft: number) {\n\t\tthis.pseudoWeather.push([weather, minTimeLeft, timeLeft]);\n\t\tthis.scene.updateWeather();\n\t}\n\thasPseudoWeather(weather: string) {\n\t\tfor (const [pseudoWeatherName] of this.pseudoWeather) {\n\t\t\tif (weather === pseudoWeatherName) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\tinit() {\n\t\tthis.p1 = new Side(this, 0);\n\t\tthis.p2 = new Side(this, 1);\n\t\tthis.sides = [this.p1, this.p2];\n\t\tthis.p2.foe = this.p1;\n\t\tthis.p1.foe = this.p2;\n\t\tthis.nearSide = this.mySide = this.p1;\n\t\tthis.farSide = this.p2;\n\t\tthis.gen = 7;\n\t\tthis.reset();\n\t}\n\treset(dontResetSound?: boolean) {\n\t\t// battle state\n\t\tthis.turn = 0;\n\t\tthis.started = false;\n\t\tthis.ended = false;\n\t\tthis.weather = '' as ID;\n\t\tthis.weatherTimeLeft = 0;\n\t\tthis.weatherMinTimeLeft = 0;\n\t\tthis.pseudoWeather = [];\n\t\tthis.lastMove = '';\n\n\t\tfor (const side of this.sides) {\n\t\t\tif (side) side.reset();\n\t\t}\n\t\tthis.myPokemon = null;\n\n\t\t// DOM state\n\t\tthis.scene.reset();\n\n\t\t// activity queue state\n\t\tthis.activeMoveIsSpread = null;\n\t\tthis.activityStep = 0;\n\t\tthis.fastForwardOff();\n\t\tthis.resultWaiting = false;\n\t\tthis.paused = true;\n\t\tif (this.playbackState !== Playback.Seeking) {\n\t\t\tthis.playbackState = Playback.Uninitialized;\n\t\t\tif (!dontResetSound) this.scene.resetBgm();\n\t\t}\n\t\tthis.resetTurnsSinceMoved();\n\t\tthis.nextActivity();\n\t}\n\tdestroy() {\n\t\tthis.scene.destroy();\n\n\t\tfor (let i = 0; i < this.sides.length; i++) {\n\t\t\tif (this.sides[i]) this.sides[i].destroy();\n\t\t\tthis.sides[i] = null!;\n\t\t}\n\t\tthis.mySide = null!;\n\t\tthis.nearSide = null!;\n\t\tthis.farSide = null!;\n\t\tthis.p1 = null!;\n\t\tthis.p2 = null!;\n\t}\n\n\tlog(args: Args, kwArgs?: KWArgs, preempt?: boolean) {\n\t\tthis.scene.log.add(args, kwArgs, preempt);\n\t}\n\n\tresetToCurrentTurn() {\n\t\tif (this.ended) {\n\t\t\tthis.reset(true);\n\t\t\tthis.fastForwardTo(-1);\n\t\t} else {\n\t\t\tlet turn = this.turn;\n\t\t\tlet paused = this.paused;\n\t\t\tthis.reset(true);\n\t\t\tthis.paused = paused;\n\t\t\tif (turn) this.fastForwardTo(turn);\n\t\t\tif (!paused) {\n\t\t\t\tthis.play();\n\t\t\t} else {\n\t\t\t\tthis.pause();\n\t\t\t}\n\t\t}\n\t}\n\tswitchSides() {\n\t\tthis.setSidesSwitched(!this.sidesSwitched);\n\t\tthis.resetToCurrentTurn();\n\t}\n\tsetSidesSwitched(sidesSwitched: boolean) {\n\t\tthis.sidesSwitched = sidesSwitched;\n\t\tif (this.sidesSwitched) {\n\t\t\tthis.nearSide = this.mySide = this.p2;\n\t\t\tthis.farSide = this.p1;\n\t\t} else {\n\t\t\tthis.nearSide = this.mySide = this.p1;\n\t\t\tthis.farSide = this.p2;\n\t\t}\n\t\tthis.nearSide.isFar = false;\n\t\tthis.farSide.isFar = true;\n\n\t\t// nothing else should need updating - don't call this function after sending out pokemon\n\t}\n\n\t//\n\t// activities\n\t//\n\tstart() {\n\t\tthis.log(['start']);\n\t\tthis.resetTurnsSinceMoved();\n\t\tif (this.startCallback) this.startCallback(this);\n\t}\n\twinner(winner?: string) {\n\t\tthis.log(['win', winner || '']);\n\t\tthis.ended = true;\n\t}\n\tprematureEnd() {\n\t\tthis.log(['message', 'This replay ends here.']);\n\t\tthis.ended = true;\n\t}\n\tendLastTurn() {\n\t\tif (this.endLastTurnPending) {\n\t\t\tthis.endLastTurnPending = false;\n\t\t\tthis.scene.updateStatbars();\n\t\t}\n\t}\n\tsetHardcoreMode(mode: boolean) {\n\t\tthis.hardcoreMode = mode;\n\t\tthis.scene.updateSidebars();\n\t\tthis.scene.updateWeather(true);\n\t}\n\tsetTurn(turnNum: string | number) {\n\t\tturnNum = parseInt(turnNum as string, 10);\n\t\tif (turnNum === this.turn + 1) {\n\t\t\tthis.endLastTurnPending = true;\n\t\t}\n\t\tif (this.turn && !this.usesUpkeep) this.updateTurnCounters(); // for compatibility with old replays\n\t\tthis.turn = turnNum;\n\n\t\tif (!this.fastForward) this.turnsSinceMoved++;\n\n\t\tthis.scene.incrementTurn();\n\n\t\tif (this.fastForward) {\n\t\t\tif (this.turnCallback) this.turnCallback(this);\n\t\t\tif (this.fastForward > -1 && turnNum >= this.fastForward) {\n\t\t\t\tthis.fastForwardOff();\n\t\t\t\tif (this.endCallback) this.endCallback(this);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.turnCallback) this.turnCallback(this);\n\t}\n\tresetTurnsSinceMoved() {\n\t\tthis.turnsSinceMoved = 0;\n\t\tthis.scene.updateAcceleration();\n\t}\n\tchangeWeather(weatherName: string, poke?: Pokemon, isUpkeep?: boolean, ability?: Effect) {\n\t\tlet weather = toID(weatherName);\n\t\tif (!weather || weather === 'none') {\n\t\t\tweather = '' as ID;\n\t\t}\n\t\tif (isUpkeep) {\n\t\t\tif (this.weather && this.weatherTimeLeft) {\n\t\t\t\tthis.weatherTimeLeft--;\n\t\t\t\tif (this.weatherMinTimeLeft !== 0) this.weatherMinTimeLeft--;\n\t\t\t}\n\t\t\tif (!this.fastForward) {\n\t\t\t\tthis.scene.upkeepWeather();\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tif (weather) {\n\t\t\tlet isExtremeWeather = (weather === 'deltastream' || weather === 'desolateland' || weather === 'primordialsea');\n\t\t\tif (poke) {\n\t\t\t\tif (ability) {\n\t\t\t\t\tthis.activateAbility(poke, ability.name);\n\t\t\t\t}\n\t\t\t\tthis.weatherTimeLeft = (this.gen <= 5 || isExtremeWeather) ? 0 : 8;\n\t\t\t\tthis.weatherMinTimeLeft = (this.gen <= 5 || isExtremeWeather) ? 0 : 5;\n\t\t\t} else if (isExtremeWeather) {\n\t\t\t\tthis.weatherTimeLeft = 0;\n\t\t\t\tthis.weatherMinTimeLeft = 0;\n\t\t\t} else {\n\t\t\t\tthis.weatherTimeLeft = (this.gen <= 3 ? 5 : 8);\n\t\t\t\tthis.weatherMinTimeLeft = (this.gen <= 3 ? 0 : 5);\n\t\t\t}\n\t\t}\n\t\tthis.weather = weather;\n\t\tthis.scene.updateWeather();\n\t}\n\tupdateTurnCounters() {\n\t\tfor (const pWeather of this.pseudoWeather) {\n\t\t\tif (pWeather[1]) pWeather[1]--;\n\t\t\tif (pWeather[2]) pWeather[2]--;\n\t\t}\n\t\tfor (const side of this.sides) {\n\t\t\tfor (const id in side.sideConditions) {\n\t\t\t\tlet cond = side.sideConditions[id];\n\t\t\t\tif (cond[2]) cond[2]--;\n\t\t\t\tif (cond[3]) cond[3]--;\n\t\t\t}\n\t\t\tfor (const poke of side.active) {\n\t\t\t\tif (poke) {\n\t\t\t\t\tif (poke.status === 'tox') poke.statusData.toxicTurns++;\n\t\t\t\t\tpoke.clearTurnstatuses();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.scene.updateWeather();\n\t}\n\tuseMove(pokemon: Pokemon, move: Move, target: Pokemon | null, kwArgs: KWArgs) {\n\t\tlet fromeffect = Dex.getEffect(kwArgs.from);\n\t\tthis.activateAbility(pokemon, fromeffect);\n\t\tpokemon.clearMovestatuses();\n\t\tif (move.id === 'focuspunch') {\n\t\t\tpokemon.removeTurnstatus('focuspunch' as ID);\n\t\t}\n\t\tthis.scene.updateStatbar(pokemon);\n\t\tif (fromeffect.id === 'sleeptalk') {\n\t\t\tpokemon.rememberMove(move.name, 0);\n\t\t} else if (!fromeffect.id || fromeffect.id === 'pursuit') {\n\t\t\tlet moveName = move.name;\n\t\t\tif (move.isZ) {\n\t\t\t\tpokemon.item = move.isZ;\n\t\t\t\tlet item = Dex.getItem(move.isZ);\n\t\t\t\tif (item.zMoveFrom) moveName = item.zMoveFrom;\n\t\t\t} else if (move.name.slice(0, 2) === 'Z-') {\n\t\t\t\tmoveName = moveName.slice(2);\n\t\t\t\tmove = Dex.getMove(moveName);\n\t\t\t\tif (window.BattleItems) {\n\t\t\t\t\tfor (let item in BattleItems) {\n\t\t\t\t\t\tif (BattleItems[item].zMoveType === move.type) pokemon.item = item;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet pp = 1;\n\t\t\tif (move.target === \"all\") {\n\t\t\t\tfor (const active of pokemon.side.foe.active) {\n\t\t\t\t\tif (active && toID(active.ability) === 'pressure') {\n\t\t\t\t\t\tpp += 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (target && target.side !== pokemon.side && toID(target.ability) === 'pressure') {\n\t\t\t\tpp += 1;\n\t\t\t}\n\t\t\tpokemon.rememberMove(moveName, pp);\n\t\t}\n\t\tpokemon.lastMove = move.id;\n\t\tthis.lastMove = move.id;\n\t\tif (move.id === 'wish' || move.id === 'healingwish') {\n\t\t\tpokemon.side.wisher = pokemon;\n\t\t}\n\t}\n\tanimateMove(pokemon: Pokemon, move: Move, target: Pokemon | null, kwArgs: KWArgs) {\n\t\tthis.activeMoveIsSpread = kwArgs.spread;\n\t\tif (this.fastForward || kwArgs.still) return;\n\n\t\tif (!target) target = pokemon.side.foe.active[0];\n\t\tif (!target) target = pokemon.side.foe.missedPokemon;\n\t\tif (kwArgs.miss && target.side) {\n\t\t\ttarget = target.side.missedPokemon;\n\t\t}\n\t\tif (kwArgs.notarget) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (kwArgs.prepare || kwArgs.anim === 'prepare') {\n\t\t\tthis.scene.runPrepareAnim(move.id, pokemon, target);\n\t\t\treturn;\n\t\t}\n\n\t\tlet usedMove = kwArgs.anim ? Dex.getMove(kwArgs.anim) : move;\n\t\tif (!kwArgs.spread) {\n\t\t\tthis.scene.runMoveAnim(usedMove.id, [pokemon, target]);\n\t\t\treturn;\n\t\t}\n\n\t\tlet targets = [pokemon];\n\t\tif (kwArgs.spread === '.') {\n\t\t\t//  no target was hit by the attack\n\t\t\ttargets.push(target.side.missedPokemon);\n\t\t} else {\n\t\t\tfor (const hitTarget of kwArgs.spread.split(',')) {\n\t\t\t\tconst curTarget = this.getPokemon(hitTarget + ': ?');\n\t\t\t\tif (!curTarget) {\n\t\t\t\t\tthis.log(['error', `Invalid spread move target: \"${hitTarget}\"`]);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\ttargets.push(curTarget);\n\t\t\t}\n\t\t}\n\n\t\tthis.scene.runMoveAnim(usedMove.id, targets);\n\t}\n\tcantUseMove(pokemon: Pokemon, effect: Effect, move: Move, kwArgs: KWArgs) {\n\t\tpokemon.clearMovestatuses();\n\t\tthis.scene.updateStatbar(pokemon);\n\t\tif (effect.id in BattleStatusAnims) {\n\t\t\tthis.scene.runStatusAnim(effect.id, [pokemon]);\n\t\t}\n\t\tthis.activateAbility(pokemon, effect);\n\t\tif (move.id) pokemon.rememberMove(move.name, 0);\n\t\tswitch (effect.id) {\n\t\tcase 'par':\n\t\t\tthis.scene.resultAnim(pokemon, 'Paralyzed', 'par');\n\t\t\tbreak;\n\t\tcase 'frz':\n\t\t\tthis.scene.resultAnim(pokemon, 'Frozen', 'frz');\n\t\t\tbreak;\n\t\tcase 'slp':\n\t\t\tthis.scene.resultAnim(pokemon, 'Asleep', 'slp');\n\t\t\tpokemon.statusData.sleepTurns++;\n\t\t\tbreak;\n\t\tcase 'truant':\n\t\t\tthis.scene.resultAnim(pokemon, 'Loafing around', 'neutral');\n\t\t\tbreak;\n\t\tcase 'recharge':\n\t\t\tthis.scene.runOtherAnim('selfstatus' as ID, [pokemon]);\n\t\t\tthis.scene.resultAnim(pokemon, 'Must recharge', 'neutral');\n\t\t\tbreak;\n\t\tcase 'focuspunch':\n\t\t\tthis.scene.resultAnim(pokemon, 'Lost focus', 'neutral');\n\t\t\tpokemon.removeTurnstatus('focuspunch' as ID);\n\t\t\tbreak;\n\t\tcase 'shelltrap':\n\t\t\tthis.scene.resultAnim(pokemon, 'Trap failed', 'neutral');\n\t\t\tpokemon.removeTurnstatus('shelltrap' as ID);\n\t\t\tbreak;\n\t\tcase 'flinch':\n\t\t\tthis.scene.resultAnim(pokemon, 'Flinched', 'neutral');\n\t\t\tpokemon.removeTurnstatus('focuspunch' as ID);\n\t\t\tbreak;\n\t\tcase 'attract':\n\t\t\tthis.scene.resultAnim(pokemon, 'Immobilized', 'neutral');\n\t\t\tbreak;\n\t\t}\n\t\tthis.scene.animReset(pokemon);\n\t}\n\n\tactivateAbility(pokemon: Pokemon | null, effectOrName: Effect | string, isNotBase?: boolean) {\n\t\tif (!pokemon || !effectOrName) return;\n\t\tif (typeof effectOrName !== 'string') {\n\t\t\tif (effectOrName.effectType !== 'Ability') return;\n\t\t\teffectOrName = effectOrName.name;\n\t\t}\n\t\tthis.scene.abilityActivateAnim(pokemon, effectOrName);\n\t\tpokemon.rememberAbility(effectOrName, isNotBase);\n\t}\n\n\trunMinor(args: Args, kwArgs: KWArgs, nextArgs?: Args, nextKwargs?: KWArgs) {\n\t\tif (nextArgs && nextKwargs) {\n\t\t\tif (args[2] === 'Sturdy' && args[0] === '-activate') {\n\t\t\t\targs[2] = 'ability: Sturdy';\n\t\t\t}\n\t\t\tif (['-crit', '-supereffective', '-resisted'].includes(args[0]) || args[2] === 'ability: Sturdy') {\n\t\t\t\tkwArgs.then = '.';\n\t\t\t}\n\t\t\tif (args[0] === '-damage' && !kwArgs.from && args[1] !== nextArgs[1] && (\n\t\t\t\t['-crit', '-supereffective', '-resisted'].includes(nextArgs[0]) ||\n\t\t\t\t(nextArgs[0] === '-damage' && !nextKwargs.from)\n\t\t\t)) {\n\t\t\t\tkwArgs.then = '.';\n\t\t\t}\n\t\t\tif (args[0] === '-damage' && nextArgs[0] === '-damage' && kwArgs.from && kwArgs.from === nextKwargs.from) {\n\t\t\t\tkwArgs.then = '.';\n\t\t\t}\n\t\t\tif (args[0] === '-ability' && (args[2] === 'Intimidate' || args[3] === 'boost')) {\n\t\t\t\tkwArgs.then = '.';\n\t\t\t}\n\t\t\tif (args[0] === '-unboost' && nextArgs[0] === '-unboost') {\n\t\t\t\tkwArgs.then = '.';\n\t\t\t}\n\t\t\tif (args[0] === '-boost' && nextArgs[0] === '-boost') {\n\t\t\t\tkwArgs.then = '.';\n\t\t\t}\n\t\t\tif (args[0] === '-damage' && kwArgs.from === 'Leech Seed' && nextArgs[0] === '-heal' && nextKwargs.silent) {\n\t\t\t\tkwArgs.then = '.';\n\t\t\t}\n\t\t\tif (args[0] === 'detailschange' && nextArgs[0] === '-mega') {\n\t\t\t\tif (this.scene.closeMessagebar()) {\n\t\t\t\t\tthis.activityStep--;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tkwArgs.simult = '.';\n\t\t\t}\n\t\t}\n\t\tif (kwArgs.then) this.waitForAnimations = false;\n\t\tif (kwArgs.simult) this.waitForAnimations = 'simult';\n\n\t\tconst CONSUMED = ['eaten', 'popped', 'consumed', 'held up'];\n\t\tswitch (args[0]) {\n\t\tcase '-damage': {\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tlet damage = poke.healthParse(args[2], true);\n\t\t\tif (damage === null) break;\n\t\t\tlet range = poke.getDamageRange(damage);\n\n\t\t\tif (kwArgs.from) {\n\t\t\t\tlet effect = Dex.getEffect(kwArgs.from);\n\t\t\t\tlet ofpoke = this.getPokemon(kwArgs.of);\n\t\t\t\tthis.activateAbility(ofpoke, effect);\n\t\t\t\tif (effect.effectType === 'Item') {\n\t\t\t\t\tconst itemPoke = ofpoke || poke;\n\t\t\t\t\tif (itemPoke.prevItem !== effect.name && !CONSUMED.includes(itemPoke.prevItemEffect)) {\n\t\t\t\t\t\titemPoke.item = effect.name;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tswitch (effect.id) {\n\t\t\t\tcase 'brn':\n\t\t\t\t\tthis.scene.runStatusAnim('brn' as ID, [poke]);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'psn':\n\t\t\t\t\tthis.scene.runStatusAnim('psn' as ID, [poke]);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'baddreams':\n\t\t\t\t\tthis.scene.runStatusAnim('cursed' as ID, [poke]);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'curse':\n\t\t\t\t\tthis.scene.runStatusAnim('cursed' as ID, [poke]);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'confusion':\n\t\t\t\t\tthis.scene.runStatusAnim('confusedselfhit' as ID, [poke]);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'leechseed':\n\t\t\t\t\tthis.scene.runOtherAnim('leech' as ID, [ofpoke!, poke]);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'bind':\n\t\t\t\tcase 'wrap':\n\t\t\t\t\tthis.scene.runOtherAnim('bound' as ID, [poke]);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlet damageinfo = '' + Pokemon.getFormattedRange(range, damage[1] === 100 ? 0 : 1, '\\u2013');\n\t\t\t\tif (damage[1] !== 100) {\n\t\t\t\t\tlet hover = '' + ((damage[0] < 0) ? '\\u2212' : '') +\n\t\t\t\t\t\tMath.abs(damage[0]) + '/' + damage[1];\n\t\t\t\t\tif (damage[1] === 48) { // this is a hack\n\t\t\t\t\t\thover += ' pixels';\n\t\t\t\t\t}\n\t\t\t\t\t// battle-log will convert this into <abbr>\n\t\t\t\t\tdamageinfo = '||' + hover + '||' + damageinfo + '||';\n\t\t\t\t}\n\t\t\t\targs[3] = damageinfo;\n\t\t\t}\n\t\t\tthis.scene.damageAnim(poke, Pokemon.getFormattedRange(range, 0, ' to '));\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-heal': {\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tlet damage = poke.healthParse(args[2], true, true);\n\t\t\tif (damage === null) break;\n\t\t\tlet range = poke.getDamageRange(damage);\n\n\t\t\tif (kwArgs.from) {\n\t\t\t\tlet effect = Dex.getEffect(kwArgs.from);\n\t\t\t\tthis.activateAbility(poke, effect);\n\t\t\t\tif (effect.effectType === 'Item' && !CONSUMED.includes(poke.prevItemEffect)) {\n\t\t\t\t\tif (poke.prevItem !== effect.name) {\n\t\t\t\t\t\tpoke.item = effect.name;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tswitch (effect.id) {\n\t\t\t\tcase 'lunardance':\n\t\t\t\t\tfor (let trackedMove of poke.moveTrack) {\n\t\t\t\t\t\ttrackedMove[1] = 0;\n\t\t\t\t\t}\n\t\t\t\t\t// falls through\n\t\t\t\tcase 'healingwish':\n\t\t\t\t\tthis.lastMove = 'healing-wish';\n\t\t\t\t\tthis.scene.runResidualAnim('healingwish' as ID, poke);\n\t\t\t\t\tpoke.side.wisher = null;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'wish':\n\t\t\t\t\tthis.scene.runResidualAnim('wish' as ID, poke);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.scene.runOtherAnim('heal' as ID, [poke]);\n\t\t\tthis.scene.healAnim(poke, Pokemon.getFormattedRange(range, 0, ' to '));\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-sethp': {\n\t\t\tfor (let k = 0; k < 2; k++) {\n\t\t\t\tlet cpoke = this.getPokemon(args[1 + 2 * k]);\n\t\t\t\tif (cpoke) {\n\t\t\t\t\tlet damage = cpoke.healthParse(args[2 + 2 * k])!;\n\t\t\t\t\tlet range = cpoke.getDamageRange(damage);\n\t\t\t\t\tlet formattedRange = Pokemon.getFormattedRange(range, 0, ' to ');\n\t\t\t\t\tlet diff = damage[0];\n\t\t\t\t\tif (diff > 0) {\n\t\t\t\t\t\tthis.scene.healAnim(cpoke, formattedRange);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.scene.damageAnim(cpoke, formattedRange);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-boost': {\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tlet stat = args[2] as BoostStatName;\n\t\t\tif (this.gen === 1 && stat === 'spd') break;\n\t\t\tif (this.gen === 1 && stat === 'spa') stat = 'spc';\n\t\t\tlet amount = parseInt(args[3], 10);\n\t\t\tif (amount === 0) {\n\t\t\t\tthis.scene.resultAnim(poke, 'already ' + poke.getBoost(stat), 'neutral');\n\t\t\t\tthis.log(args, kwArgs);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (!poke.boosts[stat]) {\n\t\t\t\tpoke.boosts[stat] = 0;\n\t\t\t}\n\t\t\tpoke.boosts[stat] += amount;\n\n\t\t\tif (!kwArgs.silent && kwArgs.from) {\n\t\t\t\tlet effect = Dex.getEffect(kwArgs.from);\n\t\t\t\tlet ofpoke = this.getPokemon(kwArgs.of);\n\t\t\t\tif (!(effect.id === 'weakarmor' && stat === 'spe')) {\n\t\t\t\t\tthis.activateAbility(ofpoke || poke, effect);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.scene.resultAnim(poke, poke.getBoost(stat), 'good');\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-unboost': {\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tlet stat = args[2] as BoostStatName;\n\t\t\tif (this.gen === 1 && stat === 'spd') break;\n\t\t\tif (this.gen === 1 && stat === 'spa') stat = 'spc';\n\t\t\tlet amount = parseInt(args[3], 10);\n\t\t\tif (amount === 0) {\n\t\t\t\tthis.scene.resultAnim(poke, 'already ' + poke.getBoost(stat), 'neutral');\n\t\t\t\tthis.log(args, kwArgs);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (!poke.boosts[stat]) {\n\t\t\t\tpoke.boosts[stat] = 0;\n\t\t\t}\n\t\t\tpoke.boosts[stat] -= amount;\n\n\t\t\tif (!kwArgs.silent && kwArgs.from) {\n\t\t\t\tlet effect = Dex.getEffect(kwArgs.from);\n\t\t\t\tlet ofpoke = this.getPokemon(kwArgs.of);\n\t\t\t\tthis.activateAbility(ofpoke || poke, effect);\n\t\t\t}\n\t\t\tthis.scene.resultAnim(poke, poke.getBoost(stat), 'bad');\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-setboost': {\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tlet stat = args[2] as BoostStatName;\n\t\t\tlet amount = parseInt(args[3], 10);\n\t\t\tpoke.boosts[stat] = amount;\n\t\t\tthis.scene.resultAnim(poke, poke.getBoost(stat), (amount > 0 ? 'good' : 'bad'));\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-swapboost': {\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tlet poke2 = this.getPokemon(args[2])!;\n\t\t\tlet stats = args[3] ? args[3].split(', ') : ['atk', 'def', 'spa', 'spd', 'spe', 'accuracy', 'evasion'];\n\t\t\tfor (const stat of stats) {\n\t\t\t\tlet tmp = poke.boosts[stat];\n\t\t\t\tpoke.boosts[stat] = poke2.boosts[stat];\n\t\t\t\tif (!poke.boosts[stat]) delete poke.boosts[stat];\n\t\t\t\tpoke2.boosts[stat] = tmp;\n\t\t\t\tif (!poke2.boosts[stat]) delete poke2.boosts[stat];\n\t\t\t}\n\t\t\tthis.scene.resultAnim(poke, 'Stats swapped', 'neutral');\n\t\t\tthis.scene.resultAnim(poke2, 'Stats swapped', 'neutral');\n\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-clearpositiveboost': {\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tlet ofpoke = this.getPokemon(args[2]);\n\t\t\tlet effect = Dex.getEffect(args[3]);\n\t\t\tfor (const stat in poke.boosts) {\n\t\t\t\tif (poke.boosts[stat] > 0) delete poke.boosts[stat];\n\t\t\t}\n\t\t\tthis.scene.resultAnim(poke, 'Boosts lost', 'bad');\n\n\t\t\tif (effect.id) {\n\t\t\t\tswitch (effect.id) {\n\t\t\t\tcase 'spectralthief':\n\t\t\t\t\t// todo: update StealBoosts so it animates 1st on Spectral Thief\n\t\t\t\t\tthis.scene.runOtherAnim('spectralthiefboost' as ID, [ofpoke!, poke]);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-clearnegativeboost': {\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tfor (const stat in poke.boosts) {\n\t\t\t\tif (poke.boosts[stat] < 0) delete poke.boosts[stat];\n\t\t\t}\n\t\t\tthis.scene.resultAnim(poke, 'Restored', 'good');\n\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-copyboost': {\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tlet frompoke = this.getPokemon(args[2])!;\n\t\t\tlet stats = args[3] ? args[3].split(', ') : ['atk', 'def', 'spa', 'spd', 'spe', 'accuracy', 'evasion'];\n\t\t\tfor (const stat of stats) {\n\t\t\t\tpoke.boosts[stat] = frompoke.boosts[stat];\n\t\t\t\tif (!poke.boosts[stat]) delete poke.boosts[stat];\n\t\t\t}\n\t\t\tif (this.gen >= 6) {\n\t\t\t\tconst volatilesToCopy = ['focusenergy', 'laserfocus'];\n\t\t\t\tfor (const volatile of volatilesToCopy) {\n\t\t\t\t\tif (frompoke.volatiles[volatile]) {\n\t\t\t\t\t\tpoke.addVolatile(volatile as ID);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpoke.removeVolatile(volatile as ID);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.scene.resultAnim(poke, 'Stats copied', 'neutral');\n\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-clearboost': {\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tpoke.boosts = {};\n\t\t\tif (!kwArgs.silent && kwArgs.from) {\n\t\t\t\tlet effect = Dex.getEffect(kwArgs.from);\n\t\t\t\tlet ofpoke = this.getPokemon(kwArgs.of);\n\t\t\t\tthis.activateAbility(ofpoke || poke, effect);\n\t\t\t}\n\t\t\tthis.scene.resultAnim(poke, 'Stats reset', 'neutral');\n\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-invertboost': {\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tfor (const stat in poke.boosts) {\n\t\t\t\tpoke.boosts[stat] = -poke.boosts[stat];\n\t\t\t}\n\t\t\tthis.scene.resultAnim(poke, 'Stats inverted', 'neutral');\n\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-clearallboost': {\n\t\t\tlet timeOffset = this.scene.timeOffset;\n\t\t\tfor (const side of this.sides) {\n\t\t\t\tfor (const active of side.active) {\n\t\t\t\t\tif (active) {\n\t\t\t\t\t\tactive.boosts = {};\n\t\t\t\t\t\tthis.scene.timeOffset = timeOffset;\n\t\t\t\t\t\tthis.scene.resultAnim(active, 'Stats reset', 'neutral');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-crit': {\n\t\t\tlet poke = this.getPokemon(args[1]);\n\t\t\tif (poke) this.scene.resultAnim(poke, 'Critical hit', 'bad');\n\t\t\tif (this.activeMoveIsSpread) kwArgs.spread = '.';\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-supereffective': {\n\t\t\tlet poke = this.getPokemon(args[1]);\n\t\t\tif (poke) {\n\t\t\t\tthis.scene.resultAnim(poke, 'Super-effective', 'bad');\n\t\t\t\tif (window.Config?.server?.afd) {\n\t\t\t\t\tthis.scene.runOtherAnim('hitmark' as ID, [poke]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this.activeMoveIsSpread) kwArgs.spread = '.';\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-resisted': {\n\t\t\tlet poke = this.getPokemon(args[1]);\n\t\t\tif (poke) this.scene.resultAnim(poke, 'Resisted', 'neutral');\n\t\t\tif (this.activeMoveIsSpread) kwArgs.spread = '.';\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-immune': {\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tlet fromeffect = Dex.getEffect(kwArgs.from);\n\t\t\tthis.activateAbility(this.getPokemon(kwArgs.of) || poke, fromeffect);\n\t\t\tthis.log(args, kwArgs);\n\t\t\tthis.scene.resultAnim(poke, 'Immune', 'neutral');\n\t\t\tbreak;\n\t\t}\n\t\tcase '-miss': {\n\t\t\tlet target = this.getPokemon(args[2]);\n\t\t\tif (target) {\n\t\t\t\tthis.scene.resultAnim(target, 'Missed', 'neutral');\n\t\t\t}\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-fail': {\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tlet effect = Dex.getEffect(args[2]);\n\t\t\tlet fromeffect = Dex.getEffect(kwArgs.from);\n\t\t\tlet ofpoke = this.getPokemon(kwArgs.of);\n\t\t\tthis.activateAbility(ofpoke || poke, fromeffect);\n\t\t\tswitch (effect.id) {\n\t\t\tcase 'brn':\n\t\t\t\tthis.scene.resultAnim(poke, 'Already burned', 'neutral');\n\t\t\t\tbreak;\n\t\t\tcase 'tox':\n\t\t\tcase 'psn':\n\t\t\t\tthis.scene.resultAnim(poke, 'Already poisoned', 'neutral');\n\t\t\t\tbreak;\n\t\t\tcase 'slp':\n\t\t\t\tif (fromeffect.id === 'uproar') {\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Failed', 'neutral');\n\t\t\t\t} else {\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Already asleep', 'neutral');\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'par':\n\t\t\t\tthis.scene.resultAnim(poke, 'Already paralyzed', 'neutral');\n\t\t\t\tbreak;\n\t\t\tcase 'frz':\n\t\t\t\tthis.scene.resultAnim(poke, 'Already frozen', 'neutral');\n\t\t\t\tbreak;\n\t\t\tcase 'unboost':\n\t\t\t\tthis.scene.resultAnim(poke, 'Stat drop blocked', 'neutral');\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tif (poke) {\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Failed', 'neutral');\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tthis.scene.animReset(poke);\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-block': {\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tlet ofpoke = this.getPokemon(kwArgs.of);\n\t\t\tlet effect = Dex.getEffect(args[2]);\n\t\t\tthis.activateAbility(ofpoke || poke, effect);\n\t\t\tswitch (effect.id) {\n\t\t\tcase 'quickguard':\n\t\t\t\tpoke.addTurnstatus('quickguard' as ID);\n\t\t\t\tthis.scene.resultAnim(poke, 'Quick Guard', 'good');\n\t\t\t\tbreak;\n\t\t\tcase 'wideguard':\n\t\t\t\tpoke.addTurnstatus('wideguard' as ID);\n\t\t\t\tthis.scene.resultAnim(poke, 'Wide Guard', 'good');\n\t\t\t\tbreak;\n\t\t\tcase 'craftyshield':\n\t\t\t\tpoke.addTurnstatus('craftyshield' as ID);\n\t\t\t\tthis.scene.resultAnim(poke, 'Crafty Shield', 'good');\n\t\t\t\tbreak;\n\t\t\tcase 'protect':\n\t\t\t\tpoke.addTurnstatus('protect' as ID);\n\t\t\t\tthis.scene.resultAnim(poke, 'Protected', 'good');\n\t\t\t\tbreak;\n\n\t\t\tcase 'safetygoggles':\n\t\t\t\tpoke.item = 'Safety Goggles';\n\t\t\t\tbreak;\n\t\t\tcase 'protectivepads':\n\t\t\t\tpoke.item = 'Protective Pads';\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-center': case '-notarget': case '-ohko':\n\t\tcase '-combine': case '-hitcount': case '-waiting': case '-zbroken': {\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-zpower': {\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tthis.scene.runOtherAnim('zpower' as ID, [poke]);\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-prepare': {\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tlet moveid = toID(args[2]);\n\t\t\tlet target = this.getPokemon(args[3]) || poke.side.foe.active[0] || poke;\n\t\t\tthis.scene.runPrepareAnim(moveid, poke, target);\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-mustrecharge': {\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tpoke.addMovestatus('mustrecharge' as ID);\n\t\t\tthis.scene.updateStatbar(poke);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-status': {\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tlet effect = Dex.getEffect(kwArgs.from);\n\t\t\tlet ofpoke = this.getPokemon(kwArgs.of) || poke;\n\t\t\tpoke.status = args[2] as StatusName;\n\t\t\tpoke.removeVolatile('yawn' as ID);\n\t\t\tthis.activateAbility(ofpoke || poke, effect);\n\t\t\tif (effect.effectType === 'Item') {\n\t\t\t\tofpoke.item = effect.name;\n\t\t\t}\n\n\t\t\tswitch (args[2]) {\n\t\t\tcase 'brn':\n\t\t\t\tthis.scene.resultAnim(poke, 'Burned', 'brn');\n\t\t\t\tthis.scene.runStatusAnim('brn' as ID, [poke]);\n\t\t\t\tbreak;\n\t\t\tcase 'tox':\n\t\t\t\tthis.scene.resultAnim(poke, 'Toxic poison', 'psn');\n\t\t\t\tthis.scene.runStatusAnim('psn' as ID, [poke]);\n\t\t\t\tpoke.statusData.toxicTurns = (effect.name === \"Toxic Orb\" ? -1 : 0);\n\t\t\t\tbreak;\n\t\t\tcase 'psn':\n\t\t\t\tthis.scene.resultAnim(poke, 'Poisoned', 'psn');\n\t\t\t\tthis.scene.runStatusAnim('psn' as ID, [poke]);\n\t\t\t\tbreak;\n\t\t\tcase 'slp':\n\t\t\t\tthis.scene.resultAnim(poke, 'Asleep', 'slp');\n\t\t\t\tif (effect.id === 'rest') {\n\t\t\t\t\tpoke.statusData.sleepTurns = 0; // for Gen 2 use through Sleep Talk\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'par':\n\t\t\t\tthis.scene.resultAnim(poke, 'Paralyzed', 'par');\n\t\t\t\tthis.scene.runStatusAnim('par' as ID, [poke]);\n\t\t\t\tbreak;\n\t\t\tcase 'frz':\n\t\t\t\tthis.scene.resultAnim(poke, 'Frozen', 'frz');\n\t\t\t\tthis.scene.runStatusAnim('frz' as ID, [poke]);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthis.scene.updateStatbar(poke);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-curestatus': {\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tlet effect = Dex.getEffect(kwArgs.from);\n\n\t\t\tif (effect.id) {\n\t\t\t\tswitch (effect.id) {\n\t\t\t\tcase 'flamewheel':\n\t\t\t\tcase 'flareblitz':\n\t\t\t\tcase 'fusionflare':\n\t\t\t\tcase 'sacredfire':\n\t\t\t\tcase 'scald':\n\t\t\t\tcase 'steameruption':\n\t\t\t\t\tkwArgs.thaw = '.';\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (poke) {\n\t\t\t\tpoke.status = '';\n\t\t\t\tswitch (args[2]) {\n\t\t\t\tcase 'brn':\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Burn cured', 'good');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'tox':\n\t\t\t\tcase 'psn':\n\t\t\t\t\tpoke.statusData.toxicTurns = 0;\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Poison cured', 'good');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'slp':\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Woke up', 'good');\n\t\t\t\t\tpoke.statusData.sleepTurns = 0;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'par':\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Paralysis cured', 'good');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'frz':\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Thawed', 'good');\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tpoke.removeVolatile('confusion' as ID);\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Cured', 'good');\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\n\t\t}\n\t\tcase '-cureteam': { // For old gens when the whole team was always cured\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tfor (const target of poke.side.pokemon) {\n\t\t\t\ttarget.status = '';\n\t\t\t\tthis.scene.updateStatbarIfExists(target);\n\t\t\t}\n\n\t\t\tthis.scene.resultAnim(poke, 'Team Cured', 'good');\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-item': {\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tlet item = Dex.getItem(args[2]);\n\t\t\tlet effect = Dex.getEffect(kwArgs.from);\n\t\t\tlet ofpoke = this.getPokemon(kwArgs.of);\n\t\t\tpoke.item = item.name;\n\t\t\tpoke.itemEffect = '';\n\t\t\tpoke.removeVolatile('airballoon' as ID);\n\t\t\tif (item.id === 'airballoon') poke.addVolatile('airballoon' as ID);\n\n\t\t\tif (effect.id) {\n\t\t\t\tswitch (effect.id) {\n\t\t\t\tcase 'pickup':\n\t\t\t\t\tthis.activateAbility(poke, \"Pickup\");\n\t\t\t\t\t// falls through\n\t\t\t\tcase 'recycle':\n\t\t\t\t\tpoke.itemEffect = 'found';\n\t\t\t\t\tthis.scene.resultAnim(poke, item.name, 'neutral');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'frisk':\n\t\t\t\t\tthis.activateAbility(ofpoke!, \"Frisk\");\n\t\t\t\t\tif (poke && poke !== ofpoke) { // used for gen 6\n\t\t\t\t\t\tpoke.itemEffect = 'frisked';\n\t\t\t\t\t\tthis.scene.resultAnim(poke, item.name, 'neutral');\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'magician':\n\t\t\t\tcase 'pickpocket':\n\t\t\t\t\tthis.activateAbility(poke, effect.name);\n\t\t\t\t\t// falls through\n\t\t\t\tcase 'thief':\n\t\t\t\tcase 'covet':\n\t\t\t\t\t// simulate the removal of the item from the ofpoke\n\t\t\t\t\tofpoke!.item = '';\n\t\t\t\t\tofpoke!.itemEffect = '';\n\t\t\t\t\tofpoke!.prevItem = item.name;\n\t\t\t\t\tofpoke!.prevItemEffect = 'stolen';\n\t\t\t\t\tofpoke!.addVolatile('itemremoved' as ID);\n\t\t\t\t\tpoke.itemEffect = 'stolen';\n\t\t\t\t\tthis.scene.resultAnim(poke, item.name, 'neutral');\n\t\t\t\t\tthis.scene.resultAnim(ofpoke!, 'Item Stolen', 'bad');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'harvest':\n\t\t\t\t\tpoke.itemEffect = 'harvested';\n\t\t\t\t\tthis.activateAbility(poke, \"Harvest\");\n\t\t\t\t\tthis.scene.resultAnim(poke, item.name, 'neutral');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'bestow':\n\t\t\t\t\tpoke.itemEffect = 'bestowed';\n\t\t\t\t\tthis.scene.resultAnim(poke, item.name, 'neutral');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'switcheroo':\n\t\t\t\tcase 'trick':\n\t\t\t\t\tpoke.itemEffect = 'tricked';\n\t\t\t\t\t// falls through\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tswitch (item.id) {\n\t\t\t\tcase 'airballoon':\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Balloon', 'good');\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-enditem': {\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tlet item = Dex.getItem(args[2]);\n\t\t\tlet effect = Dex.getEffect(kwArgs.from);\n\t\t\tpoke.item = '';\n\t\t\tpoke.itemEffect = '';\n\t\t\tpoke.prevItem = item.name;\n\t\t\tpoke.prevItemEffect = '';\n\t\t\tpoke.removeVolatile('airballoon' as ID);\n\t\t\tpoke.addVolatile('itemremoved' as ID);\n\t\t\tif (kwArgs.eat) {\n\t\t\t\tpoke.prevItemEffect = 'eaten';\n\t\t\t\tthis.scene.runOtherAnim('consume' as ID, [poke]);\n\t\t\t\tthis.lastMove = item.id;\n\t\t\t} else if (kwArgs.weaken) {\n\t\t\t\tpoke.prevItemEffect = 'eaten';\n\t\t\t\tthis.lastMove = item.id;\n\t\t\t} else if (effect.id) {\n\t\t\t\tswitch (effect.id) {\n\t\t\t\tcase 'fling':\n\t\t\t\t\tpoke.prevItemEffect = 'flung';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'knockoff':\n\t\t\t\t\tpoke.prevItemEffect = 'knocked off';\n\t\t\t\t\tthis.scene.runOtherAnim('itemoff' as ID, [poke]);\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Item knocked off', 'neutral');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'stealeat':\n\t\t\t\t\tpoke.prevItemEffect = 'stolen';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'gem':\n\t\t\t\t\tpoke.prevItemEffect = 'consumed';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'incinerate':\n\t\t\t\t\tpoke.prevItemEffect = 'incinerated';\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tswitch (item.id) {\n\t\t\t\tcase 'airballoon':\n\t\t\t\t\tpoke.prevItemEffect = 'popped';\n\t\t\t\t\tpoke.removeVolatile('airballoon' as ID);\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Balloon popped', 'neutral');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'focussash':\n\t\t\t\t\tpoke.prevItemEffect = 'consumed';\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Sash', 'neutral');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'focusband':\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Focus Band', 'neutral');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'redcard':\n\t\t\t\t\tpoke.prevItemEffect = 'held up';\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tpoke.prevItemEffect = 'consumed';\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-ability': {\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tlet ability = Dex.getAbility(args[2]);\n\t\t\tlet effect = Dex.getEffect(kwArgs.from);\n\t\t\tlet ofpoke = this.getPokemon(kwArgs.of);\n\t\t\tpoke.rememberAbility(ability.name, effect.id && !kwArgs.fail);\n\n\t\t\tif (kwArgs.silent) {\n\t\t\t\t// do nothing\n\t\t\t} else if (effect.id) {\n\t\t\t\tswitch (effect.id) {\n\t\t\t\tcase 'trace':\n\t\t\t\t\tthis.activateAbility(poke, \"Trace\");\n\t\t\t\t\tthis.scene.wait(500);\n\t\t\t\t\tthis.activateAbility(poke, ability.name, true);\n\t\t\t\t\tofpoke!.rememberAbility(ability.name);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'powerofalchemy':\n\t\t\t\tcase 'receiver':\n\t\t\t\t\tthis.activateAbility(poke, effect.name);\n\t\t\t\t\tthis.scene.wait(500);\n\t\t\t\t\tthis.activateAbility(poke, ability.name, true);\n\t\t\t\t\tofpoke!.rememberAbility(ability.name);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'roleplay':\n\t\t\t\t\tthis.activateAbility(poke, ability.name, true);\n\t\t\t\t\tofpoke!.rememberAbility(ability.name);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'desolateland':\n\t\t\t\tcase 'primordialsea':\n\t\t\t\tcase 'deltastream':\n\t\t\t\t\tif (kwArgs.fail) {\n\t\t\t\t\t\tthis.activateAbility(poke, ability.name);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tthis.activateAbility(poke, ability.name);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.activateAbility(poke, ability.name);\n\t\t\t}\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-endability': {\n\t\t\t// deprecated; use |-start| for Gastro Acid\n\t\t\t// and the third arg of |-ability| for Entrainment et al\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tlet ability = Dex.getAbility(args[2]);\n\t\t\tpoke.ability = '(suppressed)';\n\n\t\t\tif (ability.id) {\n\t\t\t\tif (!poke.baseAbility) poke.baseAbility = ability.name;\n\t\t\t}\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase 'detailschange': {\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tpoke.removeVolatile('formechange' as ID);\n\t\t\tpoke.removeVolatile('typeadd' as ID);\n\t\t\tpoke.removeVolatile('typechange' as ID);\n\n\t\t\tlet newSpeciesForme = args[2];\n\t\t\tlet commaIndex = newSpeciesForme.indexOf(',');\n\t\t\tif (commaIndex !== -1) {\n\t\t\t\tlet level = newSpeciesForme.substr(commaIndex + 1).trim();\n\t\t\t\tif (level.charAt(0) === 'L') {\n\t\t\t\t\tpoke.level = parseInt(level.substr(1), 10);\n\t\t\t\t}\n\t\t\t\tnewSpeciesForme = args[2].substr(0, commaIndex);\n\t\t\t}\n\t\t\tlet species = this.dex.getSpecies(newSpeciesForme);\n\n\t\t\tpoke.speciesForme = newSpeciesForme;\n\t\t\tpoke.ability = poke.baseAbility = (species.abilities ? species.abilities['0'] : '');\n\n\t\t\tpoke.details = args[2];\n\t\t\tpoke.searchid = args[1].substr(0, 2) + args[1].substr(3) + '|' + args[2];\n\n\t\t\tthis.scene.animTransform(poke, true, true);\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-transform': {\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tlet tpoke = this.getPokemon(args[2])!;\n\t\t\tlet effect = Dex.getEffect(kwArgs.from);\n\t\t\tif (poke === tpoke) throw new Error(\"Transforming into self\");\n\n\t\t\tif (!kwArgs.silent) {\n\t\t\t\tthis.activateAbility(poke, effect);\n\t\t\t}\n\n\t\t\tpoke.boosts = {...tpoke.boosts};\n\t\t\tpoke.copyTypesFrom(tpoke);\n\t\t\tpoke.ability = tpoke.ability;\n\t\t\tconst speciesForme = (tpoke.volatiles.formechange ? tpoke.volatiles.formechange[1] : tpoke.speciesForme);\n\t\t\tconst pokemon = tpoke;\n\t\t\tconst shiny = tpoke.shiny;\n\t\t\tconst gender = tpoke.gender;\n\t\t\tpoke.addVolatile('transform' as ID, pokemon, shiny, gender);\n\t\t\tpoke.addVolatile('formechange' as ID, speciesForme);\n\t\t\tfor (const trackedMove of tpoke.moveTrack) {\n\t\t\t\tpoke.rememberMove(trackedMove[0], 0);\n\t\t\t}\n\t\t\tthis.scene.animTransform(poke);\n\t\t\tthis.scene.resultAnim(poke, 'Transformed', 'good');\n\t\t\tthis.log(['-transform', args[1], args[2], tpoke.speciesForme], kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-formechange': {\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tlet species = Dex.getSpecies(args[2]);\n\t\t\tlet fromeffect = Dex.getEffect(kwArgs.from);\n\t\t\tlet isCustomAnim = false;\n\t\t\tpoke.removeVolatile('typeadd' as ID);\n\t\t\tpoke.removeVolatile('typechange' as ID);\n\t\t\tif (this.gen >= 7) poke.removeVolatile('autotomize' as ID);\n\n\t\t\tif (!kwArgs.silent) {\n\t\t\t\tthis.activateAbility(poke, fromeffect);\n\t\t\t}\n\t\t\tpoke.addVolatile('formechange' as ID, species.name); // the formechange volatile reminds us to revert the sprite change on switch-out\n\t\t\tthis.scene.animTransform(poke, isCustomAnim);\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-mega': {\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tlet item = Dex.getItem(args[3]);\n\t\t\tif (args[3]) {\n\t\t\t\tpoke.item = item.name;\n\t\t\t}\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-primal': case '-burst': {\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-start': {\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tlet effect = Dex.getEffect(args[2]);\n\t\t\tlet ofpoke = this.getPokemon(kwArgs.of);\n\t\t\tlet fromeffect = Dex.getEffect(kwArgs.from);\n\n\t\t\tthis.activateAbility(poke, effect);\n\t\t\tthis.activateAbility(ofpoke || poke, fromeffect);\n\t\t\tswitch (effect.id) {\n\t\t\tcase 'typechange':\n\t\t\t\tif (ofpoke && fromeffect.id === 'reflecttype') {\n\t\t\t\t\tpoke.copyTypesFrom(ofpoke);\n\t\t\t\t} else {\n\t\t\t\t\tconst types = Dex.sanitizeName(args[3] || '???');\n\t\t\t\t\tpoke.removeVolatile('typeadd' as ID);\n\t\t\t\t\tpoke.addVolatile('typechange' as ID, types);\n\t\t\t\t\tif (!kwArgs.silent) {\n\t\t\t\t\t\tthis.scene.typeAnim(poke, types);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.scene.updateStatbar(poke);\n\t\t\t\tbreak;\n\t\t\tcase 'typeadd':\n\t\t\t\tconst type = Dex.sanitizeName(args[3]);\n\t\t\t\tpoke.addVolatile('typeadd' as ID, type);\n\t\t\t\tif (kwArgs.silent) break;\n\t\t\t\tthis.scene.typeAnim(poke, type);\n\t\t\t\tbreak;\n\t\t\tcase 'dynamax':\n\t\t\t\tpoke.addVolatile('dynamax' as ID);\n\t\t\t\tthis.scene.animTransform(poke, true);\n\t\t\t\tbreak;\n\t\t\tcase 'powertrick':\n\t\t\t\tthis.scene.resultAnim(poke, 'Power Trick', 'neutral');\n\t\t\t\tbreak;\n\t\t\tcase 'foresight':\n\t\t\tcase 'miracleeye':\n\t\t\t\tthis.scene.resultAnim(poke, 'Identified', 'bad');\n\t\t\t\tbreak;\n\t\t\tcase 'telekinesis':\n\t\t\t\tthis.scene.resultAnim(poke, 'Telekinesis', 'neutral');\n\t\t\t\tbreak;\n\t\t\tcase 'confusion':\n\t\t\t\tif (!kwArgs.already) {\n\t\t\t\t\tthis.scene.runStatusAnim('confused' as ID, [poke]);\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Confused', 'bad');\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'leechseed':\n\t\t\t\tthis.scene.updateStatbar(poke);\n\t\t\t\tbreak;\n\t\t\tcase 'healblock':\n\t\t\t\tthis.scene.resultAnim(poke, 'Heal Block', 'bad');\n\t\t\t\tbreak;\n\t\t\tcase 'yawn':\n\t\t\t\tthis.scene.resultAnim(poke, 'Drowsy', 'slp');\n\t\t\t\tbreak;\n\t\t\tcase 'taunt':\n\t\t\t\tthis.scene.resultAnim(poke, 'Taunted', 'bad');\n\t\t\t\tbreak;\n\t\t\tcase 'imprison':\n\t\t\t\tthis.scene.resultAnim(poke, 'Imprisoning', 'good');\n\t\t\t\tbreak;\n\t\t\tcase 'disable':\n\t\t\t\tthis.scene.resultAnim(poke, 'Disabled', 'bad');\n\t\t\t\tbreak;\n\t\t\tcase 'embargo':\n\t\t\t\tthis.scene.resultAnim(poke, 'Embargo', 'bad');\n\t\t\t\tbreak;\n\t\t\tcase 'torment':\n\t\t\t\tthis.scene.resultAnim(poke, 'Tormented', 'bad');\n\t\t\t\tbreak;\n\t\t\tcase 'ingrain':\n\t\t\t\tthis.scene.resultAnim(poke, 'Ingrained', 'good');\n\t\t\t\tbreak;\n\t\t\tcase 'aquaring':\n\t\t\t\tthis.scene.resultAnim(poke, 'Aqua Ring', 'good');\n\t\t\t\tbreak;\n\t\t\tcase 'stockpile1':\n\t\t\t\tthis.scene.resultAnim(poke, 'Stockpile', 'good');\n\t\t\t\tbreak;\n\t\t\tcase 'stockpile2':\n\t\t\t\tpoke.removeVolatile('stockpile1' as ID);\n\t\t\t\tthis.scene.resultAnim(poke, 'Stockpile&times;2', 'good');\n\t\t\t\tbreak;\n\t\t\tcase 'stockpile3':\n\t\t\t\tpoke.removeVolatile('stockpile2' as ID);\n\t\t\t\tthis.scene.resultAnim(poke, 'Stockpile&times;3', 'good');\n\t\t\t\tbreak;\n\t\t\tcase 'perish0':\n\t\t\t\tpoke.removeVolatile('perish1' as ID);\n\t\t\t\tbreak;\n\t\t\tcase 'perish1':\n\t\t\t\tpoke.removeVolatile('perish2' as ID);\n\t\t\t\tthis.scene.resultAnim(poke, 'Perish next turn', 'bad');\n\t\t\t\tbreak;\n\t\t\tcase 'perish2':\n\t\t\t\tpoke.removeVolatile('perish3' as ID);\n\t\t\t\tthis.scene.resultAnim(poke, 'Perish in 2', 'bad');\n\t\t\t\tbreak;\n\t\t\tcase 'perish3':\n\t\t\t\tif (!kwArgs.silent) this.scene.resultAnim(poke, 'Perish in 3', 'bad');\n\t\t\t\tbreak;\n\t\t\tcase 'encore':\n\t\t\t\tthis.scene.resultAnim(poke, 'Encored', 'bad');\n\t\t\t\tbreak;\n\t\t\tcase 'bide':\n\t\t\t\tthis.scene.resultAnim(poke, 'Bide', 'good');\n\t\t\t\tbreak;\n\t\t\tcase 'attract':\n\t\t\t\tthis.scene.resultAnim(poke, 'Attracted', 'bad');\n\t\t\t\tbreak;\n\t\t\tcase 'autotomize':\n\t\t\t\tthis.scene.resultAnim(poke, 'Lightened', 'good');\n\t\t\t\tif (poke.volatiles.autotomize) {\n\t\t\t\t\tpoke.volatiles.autotomize[1]++;\n\t\t\t\t} else {\n\t\t\t\t\tpoke.addVolatile('autotomize' as ID, 1);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'focusenergy':\n\t\t\t\tthis.scene.resultAnim(poke, '+Crit rate', 'good');\n\t\t\t\tbreak;\n\t\t\tcase 'curse':\n\t\t\t\tthis.scene.resultAnim(poke, 'Cursed', 'bad');\n\t\t\t\tbreak;\n\t\t\tcase 'nightmare':\n\t\t\t\tthis.scene.resultAnim(poke, 'Nightmare', 'bad');\n\t\t\t\tbreak;\n\t\t\tcase 'magnetrise':\n\t\t\t\tthis.scene.resultAnim(poke, 'Magnet Rise', 'good');\n\t\t\t\tbreak;\n\t\t\tcase 'smackdown':\n\t\t\t\tthis.scene.resultAnim(poke, 'Smacked Down', 'bad');\n\t\t\t\tpoke.removeVolatile('magnetrise' as ID);\n\t\t\t\tpoke.removeVolatile('telekinesis' as ID);\n\t\t\t\tif (poke.lastMove === 'fly' || poke.lastMove === 'bounce') this.scene.animReset(poke);\n\t\t\t\tbreak;\n\t\t\tcase 'substitute':\n\t\t\t\tif (kwArgs.damage) {\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Damage', 'bad');\n\t\t\t\t} else if (kwArgs.block) {\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Blocked', 'neutral');\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\t// Gen 1\n\t\t\tcase 'lightscreen':\n\t\t\t\tthis.scene.resultAnim(poke, 'Light Screen', 'good');\n\t\t\t\tbreak;\n\t\t\tcase 'reflect':\n\t\t\t\tthis.scene.resultAnim(poke, 'Reflect', 'good');\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tpoke.addVolatile(effect.id);\n\t\t\tthis.scene.updateStatbar(poke);\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-end': {\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tlet effect = Dex.getEffect(args[2]);\n\t\t\tlet fromeffect = Dex.getEffect(kwArgs.from);\n\t\t\tpoke.removeVolatile(effect.id);\n\n\t\t\tif (kwArgs.silent) {\n\t\t\t\t// do nothing\n\t\t\t} else {\n\t\t\t\tswitch (effect.id) {\n\t\t\t\tcase 'dynamax':\n\t\t\t\t\tthis.scene.animTransform(poke);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'powertrick':\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Power Trick', 'neutral');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'telekinesis':\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Telekinesis&nbsp;ended', 'neutral');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'skydrop':\n\t\t\t\t\tif (kwArgs.interrupt) {\n\t\t\t\t\t\tthis.scene.anim(poke, {time: 100});\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'confusion':\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Confusion&nbsp;ended', 'good');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'leechseed':\n\t\t\t\t\tif (fromeffect.id === 'rapidspin') {\n\t\t\t\t\t\tthis.scene.resultAnim(poke, 'De-seeded', 'good');\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'healblock':\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Heal Block ended', 'good');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'attract':\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Attract&nbsp;ended', 'good');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'taunt':\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Taunt&nbsp;ended', 'good');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'disable':\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Disable&nbsp;ended', 'good');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'embargo':\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Embargo ended', 'good');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'torment':\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Torment&nbsp;ended', 'good');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'encore':\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Encore&nbsp;ended', 'good');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'bide':\n\t\t\t\t\tthis.scene.runOtherAnim('bideunleash' as ID, [poke]);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'illusion':\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Illusion ended', 'bad');\n\t\t\t\t\tpoke.rememberAbility('Illusion');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'slowstart':\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Slow Start ended', 'good');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'perishsong': // for backwards compatibility\n\t\t\t\t\tpoke.removeVolatile('perish3' as ID);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'substitute':\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Faded', 'bad');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'stockpile':\n\t\t\t\t\tpoke.removeVolatile('stockpile1' as ID);\n\t\t\t\t\tpoke.removeVolatile('stockpile2' as ID);\n\t\t\t\t\tpoke.removeVolatile('stockpile3' as ID);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tif (effect.effectType === 'Move') {\n\t\t\t\t\t\tif (effect.name === 'Doom Desire') {\n\t\t\t\t\t\t\tthis.scene.runOtherAnim('doomdesirehit' as ID, [poke]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (effect.name === 'Future Sight') {\n\t\t\t\t\t\t\tthis.scene.runOtherAnim('futuresighthit' as ID, [poke]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.scene.updateStatbar(poke);\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-singleturn': {\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tlet effect = Dex.getEffect(args[2]);\n\t\t\tif (effect.id === 'roost' && !poke.getTypeList().includes('Flying')) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tpoke.addTurnstatus(effect.id);\n\t\t\tswitch (effect.id) {\n\t\t\tcase 'roost':\n\t\t\t\tthis.scene.resultAnim(poke, 'Landed', 'neutral');\n\t\t\t\tbreak;\n\t\t\tcase 'quickguard':\n\t\t\t\tthis.scene.resultAnim(poke, 'Quick Guard', 'good');\n\t\t\t\tbreak;\n\t\t\tcase 'wideguard':\n\t\t\t\tthis.scene.resultAnim(poke, 'Wide Guard', 'good');\n\t\t\t\tbreak;\n\t\t\tcase 'craftyshield':\n\t\t\t\tthis.scene.resultAnim(poke, 'Crafty Shield', 'good');\n\t\t\t\tbreak;\n\t\t\tcase 'matblock':\n\t\t\t\tthis.scene.resultAnim(poke, 'Mat Block', 'good');\n\t\t\t\tbreak;\n\t\t\tcase 'protect':\n\t\t\t\tthis.scene.resultAnim(poke, 'Protected', 'good');\n\t\t\t\tbreak;\n\t\t\tcase 'endure':\n\t\t\t\tthis.scene.resultAnim(poke, 'Enduring', 'good');\n\t\t\t\tbreak;\n\t\t\tcase 'helpinghand':\n\t\t\t\tthis.scene.resultAnim(poke, 'Helping Hand', 'good');\n\t\t\t\tbreak;\n\t\t\tcase 'focuspunch':\n\t\t\t\tthis.scene.resultAnim(poke, 'Focusing', 'neutral');\n\t\t\t\tpoke.rememberMove(effect.name, 0);\n\t\t\t\tbreak;\n\t\t\tcase 'shelltrap':\n\t\t\t\tthis.scene.resultAnim(poke, 'Trap set', 'neutral');\n\t\t\t\tpoke.rememberMove(effect.name, 0);\n\t\t\t\tbreak;\n\t\t\tcase 'beakblast':\n\t\t\t\tthis.scene.runOtherAnim('bidecharge' as ID, [poke]);\n\t\t\t\tthis.scene.resultAnim(poke, 'Beak Blast', 'neutral');\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tthis.scene.updateStatbar(poke);\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-singlemove': {\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tlet effect = Dex.getEffect(args[2]);\n\t\t\tpoke.addMovestatus(effect.id);\n\n\t\t\tswitch (effect.id) {\n\t\t\tcase 'grudge':\n\t\t\t\tthis.scene.resultAnim(poke, 'Grudge', 'neutral');\n\t\t\t\tbreak;\n\t\t\tcase 'destinybond':\n\t\t\t\tthis.scene.resultAnim(poke, 'Destiny Bond', 'neutral');\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-activate': {\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tlet effect = Dex.getEffect(args[2]);\n\t\t\tlet target = this.getPokemon(args[3]);\n\t\t\tthis.activateAbility(poke, effect);\n\t\t\tswitch (effect.id) {\n\t\t\tcase 'poltergeist':\n\t\t\t\tpoke.item = kwArgs.item;\n\t\t\t\tpoke.itemEffect = 'disturbed';\n\t\t\t\tbreak;\n\t\t\tcase 'grudge':\n\t\t\t\tpoke.rememberMove(kwArgs.move, Infinity);\n\t\t\t\tbreak;\n\t\t\tcase 'substitute':\n\t\t\t\tif (kwArgs.damage) {\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Damage', 'bad');\n\t\t\t\t} else if (kwArgs.block) {\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Blocked', 'neutral');\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'attract':\n\t\t\t\tthis.scene.runStatusAnim('attracted' as ID, [poke]);\n\t\t\t\tbreak;\n\t\t\tcase 'bide':\n\t\t\t\tthis.scene.runOtherAnim('bidecharge' as ID, [poke]);\n\t\t\t\tbreak;\n\n\t\t\t// move activations\n\t\t\tcase 'aromatherapy':\n\t\t\t\tthis.scene.resultAnim(poke, 'Team Cured', 'good');\n\t\t\t\tbreak;\n\t\t\tcase 'healbell':\n\t\t\t\tthis.scene.resultAnim(poke, 'Team Cured', 'good');\n\t\t\t\tbreak;\n\t\t\tcase 'brickbreak':\n\t\t\t\ttarget!.side.removeSideCondition('Reflect');\n\t\t\t\ttarget!.side.removeSideCondition('LightScreen');\n\t\t\t\tbreak;\n\t\t\tcase 'hyperspacefury':\n\t\t\tcase 'hyperspacehole':\n\t\t\tcase 'phantomforce':\n\t\t\tcase 'shadowforce':\n\t\t\tcase 'feint':\n\t\t\t\tthis.scene.resultAnim(poke, 'Protection broken', 'bad');\n\t\t\t\tpoke.removeTurnstatus('protect' as ID);\n\t\t\t\tfor (const curTarget of poke.side.pokemon) {\n\t\t\t\t\tcurTarget.removeTurnstatus('wideguard' as ID);\n\t\t\t\t\tcurTarget.removeTurnstatus('quickguard' as ID);\n\t\t\t\t\tcurTarget.removeTurnstatus('craftyshield' as ID);\n\t\t\t\t\tcurTarget.removeTurnstatus('matblock' as ID);\n\t\t\t\t\tthis.scene.updateStatbar(curTarget);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'eeriespell':\n\t\t\tcase 'gmaxdepletion':\n\t\t\tcase 'spite':\n\t\t\t\tlet move = Dex.getMove(kwArgs.move).name;\n\t\t\t\tlet pp = Number(kwArgs.number);\n\t\t\t\tif (isNaN(pp)) pp = 4;\n\t\t\t\tpoke.rememberMove(move, pp);\n\t\t\t\tbreak;\n\t\t\tcase 'gravity':\n\t\t\t\tpoke.removeVolatile('magnetrise' as ID);\n\t\t\t\tpoke.removeVolatile('telekinesis' as ID);\n\t\t\t\tthis.scene.anim(poke, {time: 100});\n\t\t\t\tbreak;\n\t\t\tcase 'skillswap': case 'wanderingspirit':\n\t\t\t\tif (this.gen <= 4) break;\n\t\t\t\tlet pokeability = Dex.sanitizeName(kwArgs.ability) || target!.ability;\n\t\t\t\tlet targetability = Dex.sanitizeName(kwArgs.ability2) || poke.ability;\n\t\t\t\tif (pokeability) {\n\t\t\t\t\tpoke.ability = pokeability;\n\t\t\t\t\tif (!target!.baseAbility) target!.baseAbility = pokeability;\n\t\t\t\t}\n\t\t\t\tif (targetability) {\n\t\t\t\t\ttarget!.ability = targetability;\n\t\t\t\t\tif (!poke.baseAbility) poke.baseAbility = targetability;\n\t\t\t\t}\n\t\t\t\tif (poke.side !== target!.side) {\n\t\t\t\t\tthis.activateAbility(poke, pokeability, true);\n\t\t\t\t\tthis.activateAbility(target, targetability, true);\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\t// ability activations\n\t\t\tcase 'forewarn':\n\t\t\t\tif (target) {\n\t\t\t\t\ttarget.rememberMove(kwArgs.move, 0);\n\t\t\t\t} else {\n\t\t\t\t\tlet foeActive = [] as Pokemon[];\n\t\t\t\t\tfor (const maybeTarget of poke.side.foe.active) {\n\t\t\t\t\t\tif (maybeTarget && !maybeTarget.fainted) foeActive.push(maybeTarget);\n\t\t\t\t\t}\n\t\t\t\t\tif (foeActive.length === 1) {\n\t\t\t\t\t\tfoeActive[0].rememberMove(kwArgs.move, 0);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'mummy':\n\t\t\t\tif (!kwArgs.ability) break; // if Mummy activated but failed, no ability will have been sent\n\t\t\t\tlet ability = Dex.getAbility(kwArgs.ability);\n\t\t\t\tthis.activateAbility(target, ability.name);\n\t\t\t\tthis.activateAbility(poke, \"Mummy\");\n\t\t\t\tthis.scene.wait(700);\n\t\t\t\tthis.activateAbility(target, \"Mummy\", true);\n\t\t\t\tbreak;\n\n\t\t\t// item activations\n\t\t\tcase 'leppaberry':\n\t\t\tcase 'mysteryberry':\n\t\t\t\tpoke.rememberMove(kwArgs.move, effect.id === 'leppaberry' ? -10 : -5);\n\t\t\t\tbreak;\n\t\t\tcase 'focusband':\n\t\t\t\tpoke.item = 'Focus Band';\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tif (kwArgs.broken) { // for custom moves that break protection\n\t\t\t\t\tthis.scene.resultAnim(poke, 'Protection broken', 'bad');\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-sidestart': {\n\t\t\tlet side = this.getSide(args[1]);\n\t\t\tlet effect = Dex.getEffect(args[2]);\n\t\t\tside.addSideCondition(effect);\n\n\t\t\tswitch (effect.id) {\n\t\t\tcase 'tailwind':\n\t\t\tcase 'auroraveil':\n\t\t\tcase 'reflect':\n\t\t\tcase 'lightscreen':\n\t\t\tcase 'safeguard':\n\t\t\tcase 'mist':\n\t\t\tcase 'gmaxwildfire':\n\t\t\tcase 'gmaxvolcalith':\n\t\t\tcase 'gmaxvinelash':\n\t\t\tcase 'gmaxcannonade':\n\t\t\tcase 'grasspledge':\n\t\t\tcase 'firepledge':\n\t\t\tcase 'waterpledge':\n\t\t\t\tthis.scene.updateWeather();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-sideend': {\n\t\t\tlet side = this.getSide(args[1]);\n\t\t\tlet effect = Dex.getEffect(args[2]);\n\t\t\t// let from = Dex.getEffect(kwArgs.from);\n\t\t\t// let ofpoke = this.getPokemon(kwArgs.of);\n\t\t\tside.removeSideCondition(effect.name);\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-weather': {\n\t\t\tlet effect = Dex.getEffect(args[1]);\n\t\t\tlet poke = this.getPokemon(kwArgs.of) || undefined;\n\t\t\tlet ability = Dex.getEffect(kwArgs.from);\n\t\t\tif (!effect.id || effect.id === 'none') {\n\t\t\t\tkwArgs.from = this.weather;\n\t\t\t}\n\t\t\tthis.changeWeather(effect.name, poke, !!kwArgs.upkeep, ability);\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-fieldstart': {\n\t\t\tlet effect = Dex.getEffect(args[1]);\n\t\t\tlet poke = this.getPokemon(kwArgs.of);\n\t\t\tlet fromeffect = Dex.getEffect(kwArgs.from);\n\t\t\tthis.activateAbility(poke, fromeffect);\n\t\t\tlet maxTimeLeft = 0;\n\t\t\tif (effect.id.endsWith('terrain')) {\n\t\t\t\tfor (let i = this.pseudoWeather.length - 1; i >= 0; i--) {\n\t\t\t\t\tlet pwID = toID(this.pseudoWeather[i][0]);\n\t\t\t\t\tif (pwID.endsWith('terrain')) {\n\t\t\t\t\t\tthis.pseudoWeather.splice(i, 1);\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (this.gen > 6) maxTimeLeft = 8;\n\t\t\t}\n\t\t\tthis.addPseudoWeather(effect.name, 5, maxTimeLeft);\n\n\t\t\tswitch (effect.id) {\n\t\t\tcase 'gravity':\n\t\t\t\tif (!this.fastForward) {\n\t\t\t\t\tfor (const side of this.sides) {\n\t\t\t\t\t\tfor (const active of side.active) {\n\t\t\t\t\t\t\tif (active) this.scene.runOtherAnim('gravity' as ID, [active]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-fieldend': {\n\t\t\tlet effect = Dex.getEffect(args[1]);\n\t\t\t// let poke = this.getPokemon(kwArgs.of);\n\t\t\tthis.removePseudoWeather(effect.name);\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-fieldactivate': {\n\t\t\tlet effect = Dex.getEffect(args[1]);\n\t\t\tswitch (effect.id) {\n\t\t\tcase 'perishsong':\n\t\t\t\tthis.scene.updateStatbars();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-anim': {\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tlet move = Dex.getMove(args[2]);\n\t\t\tif (this.checkActive(poke)) return;\n\t\t\tlet poke2 = this.getPokemon(args[3]);\n\t\t\tthis.scene.beforeMove(poke);\n\t\t\tthis.animateMove(poke, move, poke2, kwArgs);\n\t\t\tthis.scene.afterMove(poke);\n\t\t\tbreak;\n\t\t}\n\t\tcase '-hint': case '-message': {\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tdefault: {\n\t\t\tthrow new Error(`Unrecognized minor action: ${args[0]}`);\n\t\t\tbreak;\n\t\t}}\n\t}\n\t/*\n\tparseSpriteData(name) {\n\t\tlet siden = 0,\n\t\t\tfoe = false;\n\t\twhile (true) {\n\t\t\tif (name.substr(0, 6) === 'foeof-') {\n\t\t\t\tfoe = true;\n\t\t\t\tname = name.substr(6);\n\t\t\t} else if (name.substr(0, 9) === 'switched-') name = name.substr(9);\n\t\t\telse if (name.substr(0, 9) === 'existing-') name = name.substr(9);\n\t\t\telse if (name.substr(0, 4) === 'foe-') {\n\t\t\t\tsiden = this.p2.n;\n\t\t\t\tname = name.substr(4);\n\t\t\t} else if (name.substr(0, 5) === 'ally-') {\n\t\t\t\tsiden = this.p1.n;\n\t\t\t\tname = name.substr(5);\n\t\t\t} else break;\n\t\t}\n\t\tif (name.substr(name.length - 1) === ')') {\n\t\t\tlet parenIndex = name.lastIndexOf('(');\n\t\t\tif (parenIndex > 0) {\n\t\t\t\tlet species = name.substr(parenIndex + 1);\n\t\t\t\tname = species.substr(0, species.length - 1);\n\t\t\t}\n\t\t}\n\t\tif (foe) siden = (siden ? 0 : 1);\n\n\t\tlet data = Dex.getSpecies(name);\n\t\treturn data.spriteData[siden];\n\t}\n\t*/\n\t/**\n\t * @param name Leave blank for Team Preview\n\t * @param pokemonid Leave blank for Team Preview\n\t * @param details\n\t * @param output\n\t */\n\tparseDetails(name: string, pokemonid: string, details: string, output: PokemonDetails = {} as any) {\n\t\tconst isTeamPreview = !name;\n\t\toutput.details = details;\n\t\toutput.name = name;\n\t\toutput.speciesForme = name;\n\t\toutput.level = 100;\n\t\toutput.shiny = false;\n\t\toutput.gender = '';\n\t\toutput.ident = (!isTeamPreview ? pokemonid : '');\n\t\toutput.searchid = (!isTeamPreview ? `${pokemonid}|${details}` : '');\n\t\tlet splitDetails = details.split(', ');\n\t\tif (splitDetails[splitDetails.length - 1] === 'shiny') {\n\t\t\toutput.shiny = true;\n\t\t\tsplitDetails.pop();\n\t\t}\n\t\tif (splitDetails[splitDetails.length - 1] === 'M' || splitDetails[splitDetails.length - 1] === 'F') {\n\t\t\toutput.gender = splitDetails[splitDetails.length - 1] as GenderName;\n\t\t\tsplitDetails.pop();\n\t\t}\n\t\tif (splitDetails[1]) {\n\t\t\toutput.level = parseInt(splitDetails[1].substr(1), 10) || 100;\n\t\t}\n\t\tif (splitDetails[0]) {\n\t\t\toutput.speciesForme = splitDetails[0];\n\t\t}\n\t\treturn output;\n\t}\n\tparseHealth(hpstring: string, output: PokemonHealth = {} as any) {\n\t\tlet [hp, status] = hpstring.split(' ');\n\n\t\t// hp parse\n\t\toutput.hpcolor = '';\n\t\tif (hp === '0' || hp === '0.0') {\n\t\t\tif (!output.maxhp) output.maxhp = 100;\n\t\t\toutput.hp = 0;\n\t\t} else if (hp.indexOf('/') > 0) {\n\t\t\tlet [curhp, maxhp] = hp.split('/');\n\t\t\tif (isNaN(parseFloat(curhp)) || isNaN(parseFloat(maxhp))) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\toutput.hp = parseFloat(curhp);\n\t\t\toutput.maxhp = parseFloat(maxhp);\n\t\t\tif (output.hp > output.maxhp) output.hp = output.maxhp;\n\t\t\tconst colorchar = maxhp.slice(-1);\n\t\t\tif (colorchar === 'y' || colorchar === 'g') {\n\t\t\t\toutput.hpcolor = colorchar;\n\t\t\t}\n\t\t} else if (!isNaN(parseFloat(hp))) {\n\t\t\tif (!output.maxhp) output.maxhp = 100;\n\t\t\toutput.hp = output.maxhp * parseFloat(hp) / 100;\n\t\t}\n\n\t\t// status parse\n\t\tif (!status) {\n\t\t\toutput.status = '';\n\t\t} else if (status === 'par' || status === 'brn' || status === 'slp' || status === 'frz' || status === 'tox') {\n\t\t\toutput.status = status;\n\t\t} else if (status === 'psn' && output.status !== 'tox') {\n\t\t\toutput.status = status;\n\t\t} else if (status === 'fnt') {\n\t\t\toutput.hp = 0;\n\t\t\toutput.fainted = true;\n\t\t}\n\t\treturn output;\n\t}\n\tparsePokemonId(pokemonid: string) {\n\t\tlet name = pokemonid;\n\n\t\tlet siden = -1;\n\t\tlet slot = -1; // if there is an explicit slot for this pokemon\n\t\tlet slotChart: {[k: string]: number} = {a: 0, b: 1, c: 2, d: 3, e: 4, f: 5};\n\t\tif (name.substr(0, 4) === 'p2: ' || name === 'p2') {\n\t\t\tsiden = this.p2.n;\n\t\t\tname = name.substr(4);\n\t\t} else if (name.substr(0, 4) === 'p1: ' || name === 'p1') {\n\t\t\tsiden = this.p1.n;\n\t\t\tname = name.substr(4);\n\t\t} else if (name.substr(0, 2) === 'p2' && name.substr(3, 2) === ': ') {\n\t\t\tslot = slotChart[name.substr(2, 1)];\n\t\t\tsiden = this.p2.n;\n\t\t\tname = name.substr(5);\n\t\t\tpokemonid = 'p2: ' + name;\n\t\t} else if (name.substr(0, 2) === 'p1' && name.substr(3, 2) === ': ') {\n\t\t\tslot = slotChart[name.substr(2, 1)];\n\t\t\tsiden = this.p1.n;\n\t\t\tname = name.substr(5);\n\t\t\tpokemonid = 'p1: ' + name;\n\t\t}\n\t\treturn {name, siden, slot, pokemonid};\n\t}\n\tgetSwitchedPokemon(pokemonid: string, details: string) {\n\t\tif (pokemonid === '??') throw new Error(`pokemonid not passed`);\n\t\tconst {name, siden, slot, pokemonid: parsedPokemonid} = this.parsePokemonId(pokemonid);\n\t\tpokemonid = parsedPokemonid;\n\n\t\tconst searchid = `${pokemonid}|${details}`;\n\t\tconst side = this.sides[siden];\n\n\t\t// search inactive revealed pokemon\n\t\tfor (let i = 0; i < side.pokemon.length; i++) {\n\t\t\tlet pokemon = side.pokemon[i];\n\t\t\tif (pokemon.fainted) continue;\n\t\t\t// already active, can't be switching in\n\t\t\tif (side.active.includes(pokemon)) continue;\n\t\t\t// just switched out, can't be switching in\n\t\t\tif (pokemon === side.lastPokemon && !side.active[slot]) continue;\n\n\t\t\tif (pokemon.searchid === searchid) {\n\t\t\t\t// exact match\n\t\t\t\tif (slot >= 0) pokemon.slot = slot;\n\t\t\t\treturn pokemon;\n\t\t\t}\n\t\t\tif (!pokemon.searchid && pokemon.checkDetails(details)) {\n\t\t\t\t// switch-in matches Team Preview entry\n\t\t\t\tpokemon = side.addPokemon(name, pokemonid, details, i);\n\t\t\t\tif (slot >= 0) pokemon.slot = slot;\n\t\t\t\treturn pokemon;\n\t\t\t}\n\t\t}\n\n\t\t// pokemon not found, create a new pokemon object for it\n\t\tconst pokemon = side.addPokemon(name, pokemonid, details);\n\t\tif (slot >= 0) pokemon.slot = slot;\n\t\treturn pokemon;\n\t}\n\trememberTeamPreviewPokemon(sideid: string, details: string) {\n\t\tconst {siden} = this.parsePokemonId(sideid);\n\n\t\treturn this.sides[siden].addPokemon('', '', details);\n\t}\n\tfindCorrespondingPokemon(serverPokemon: {ident: string, details: string}) {\n\t\tconst {siden} = this.parsePokemonId(serverPokemon.ident);\n\t\tconst searchid = `${serverPokemon.ident}|${serverPokemon.details}`;\n\t\tfor (const pokemon of this.sides[siden].pokemon) {\n\t\t\tif (pokemon.searchid === searchid) {\n\t\t\t\treturn pokemon;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\tgetPokemon(pokemonid: string | undefined) {\n\t\tif (!pokemonid || pokemonid === '??' || pokemonid === 'null' || pokemonid === 'false') {\n\t\t\treturn null;\n\t\t}\n\t\tconst {siden, slot, pokemonid: parsedPokemonid} = this.parsePokemonId(pokemonid);\n\t\tpokemonid = parsedPokemonid;\n\n\t\t/** if true, don't match an active pokemon */\n\t\tconst isInactive = (slot < 0);\n\t\tconst side = this.sides[siden];\n\n\t\t// search player's pokemon\n\t\tif (!isInactive && side.active[slot]) return side.active[slot];\n\n\t\tfor (const pokemon of side.pokemon) {\n\t\t\tif (isInactive && side.active.includes(pokemon)) continue;\n\t\t\tif (pokemon.ident === pokemonid) { // name matched, good enough\n\t\t\t\tif (slot >= 0) pokemon.slot = slot;\n\t\t\t\treturn pokemon;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\tgetSide(sidename: string): Side {\n\t\tif (sidename === 'p1' || sidename.substr(0, 3) === 'p1:') return this.p1;\n\t\tif (sidename === 'p2' || sidename.substr(0, 3) === 'p2:') return this.p2;\n\t\tif (this.nearSide.id === sidename) return this.nearSide;\n\t\tif (this.farSide.id === sidename) return this.farSide;\n\t\tif (this.nearSide.name === sidename) return this.nearSide;\n\t\tif (this.farSide.name === sidename) return this.farSide;\n\t\treturn {\n\t\t\tname: sidename,\n\t\t\tid: sidename.replace(/ /g, ''),\n\t\t} as any;\n\t}\n\n\tadd(command: string, fastForward?: boolean) {\n\t\tif (command) this.activityQueue.push(command);\n\n\t\tif (this.playbackState === Playback.Uninitialized) {\n\t\t\tthis.nextActivity();\n\t\t} else if (this.playbackState === Playback.Finished) {\n\t\t\tthis.playbackState = this.paused ? Playback.Paused : Playback.Playing;\n\t\t\tif (this.paused) return;\n\t\t\tthis.scene.updateBgm();\n\t\t\tif (fastForward) {\n\t\t\t\tthis.fastForwardTo(-1);\n\t\t\t} else {\n\t\t\t\tthis.nextActivity();\n\t\t\t}\n\t\t}\n\t}\n\t/**\n\t * PS's preempt system is intended to show chat messages immediately,\n\t * instead of waiting for the battle to get to the point where the\n\t * message was said.\n\t *\n\t * In addition to being a nice quality-of-life feature, it's also\n\t * important to make sure timer updates happen in real-time.\n\t */\n\tinstantAdd(command: string) {\n\t\tthis.run(command, true);\n\t\tthis.preemptActivityQueue.push(command);\n\t\tthis.add(command);\n\t}\n\trunMajor(args: Args, kwArgs: KWArgs, preempt?: boolean) {\n\t\tswitch (args[0]) {\n\t\tcase 'start': {\n\t\t\tthis.scene.teamPreviewEnd();\n\t\t\tthis.nearSide.active[0] = null;\n\t\t\tthis.farSide.active[0] = null;\n\t\t\tthis.start();\n\t\t\tbreak;\n\t\t}\n\t\tcase 'upkeep': {\n\t\t\tthis.usesUpkeep = true;\n\t\t\tthis.updateTurnCounters();\n\t\t\tbreak;\n\t\t}\n\t\tcase 'turn': {\n\t\t\tthis.setTurn(args[1]);\n\t\t\tthis.log(args);\n\t\t\tbreak;\n\t\t}\n\t\tcase 'tier': {\n\t\t\tthis.tier = args[1];\n\t\t\tif (this.tier.slice(-13) === 'Random Battle') {\n\t\t\t\tthis.speciesClause = true;\n\t\t\t}\n\t\t\tif (this.tier.slice(-8) === ' (Blitz)') {\n\t\t\t\tthis.messageFadeTime = 40;\n\t\t\t\tthis.isBlitz = true;\n\t\t\t}\n\t\t\tthis.log(args);\n\t\t\tbreak;\n\t\t}\n\t\tcase 'gametype': {\n\t\t\tthis.gameType = args[1] as any;\n\t\t\tswitch (args[1]) {\n\t\t\tdefault:\n\t\t\t\tthis.nearSide.active = [null];\n\t\t\t\tthis.farSide.active = [null];\n\t\t\t\tbreak;\n\t\t\tcase 'doubles':\n\t\t\t\tthis.nearSide.active = [null, null];\n\t\t\t\tthis.farSide.active = [null, null];\n\t\t\t\tbreak;\n\t\t\tcase 'triples':\n\t\t\tcase 'rotation':\n\t\t\t\tthis.nearSide.active = [null, null, null];\n\t\t\t\tthis.farSide.active = [null, null, null];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tthis.scene.updateGen();\n\t\t\tbreak;\n\t\t}\n\t\tcase 'rule': {\n\t\t\tlet ruleName = args[1].split(': ')[0];\n\t\t\tif (ruleName === 'Species Clause') this.speciesClause = true;\n\t\t\tif (ruleName === 'Blitz') {\n\t\t\t\tthis.messageFadeTime = 40;\n\t\t\t\tthis.isBlitz = true;\n\t\t\t}\n\t\t\tthis.log(args);\n\t\t\tbreak;\n\t\t}\n\t\tcase 'rated': {\n\t\t\tthis.rated = args[1] || true;\n\t\t\tthis.scene.updateGen();\n\t\t\tthis.log(args);\n\t\t\tbreak;\n\t\t}\n\t\tcase 'inactive': {\n\t\t\tif (!this.kickingInactive) this.kickingInactive = true;\n\t\t\tif (args[1].slice(0, 11) === \"Time left: \") {\n\t\t\t\tlet [time, totalTime, graceTime] = args[1].split(' | ');\n\t\t\t\tthis.kickingInactive = parseInt(time.slice(11), 10) || true;\n\t\t\t\tthis.totalTimeLeft = parseInt(totalTime, 10);\n\t\t\t\tthis.graceTimeLeft = parseInt(graceTime || '', 10) || 0;\n\t\t\t\tif (this.totalTimeLeft === this.kickingInactive) this.totalTimeLeft = 0;\n\t\t\t\treturn;\n\t\t\t} else if (args[1].slice(0, 9) === \"You have \") {\n\t\t\t\t// this is ugly but parseInt is documented to work this way\n\t\t\t\t// so I'm going to be lazy and not chop off the rest of the\n\t\t\t\t// sentence\n\t\t\t\tthis.kickingInactive = parseInt(args[1].slice(9), 10) || true;\n\t\t\t\treturn;\n\t\t\t} else if (args[1].slice(-14) === ' seconds left.') {\n\t\t\t\tlet hasIndex = args[1].indexOf(' has ');\n\t\t\t\tlet userid = window.app?.user?.get('userid');\n\t\t\t\tif (toID(args[1].slice(0, hasIndex)) === userid) {\n\t\t\t\t\tthis.kickingInactive = parseInt(args[1].slice(hasIndex + 5), 10) || true;\n\t\t\t\t}\n\t\t\t} else if (args[1].slice(-27) === ' 15 seconds left this turn.') {\n\t\t\t\tif (this.isBlitz) return;\n\t\t\t}\n\t\t\tthis.log(args, undefined, preempt);\n\t\t\tbreak;\n\t\t}\n\t\tcase 'inactiveoff': {\n\t\t\tthis.kickingInactive = false;\n\t\t\tthis.log(args, undefined, preempt);\n\t\t\tbreak;\n\t\t}\n\t\tcase 'join': case 'j': case 'J': {\n\t\t\tif (this.roomid) {\n\t\t\t\tlet room = app!.rooms[this.roomid];\n\t\t\t\tlet user = BattleTextParser.parseNameParts(args[1]);\n\t\t\t\tlet userid = toUserid(user.name);\n\t\t\t\tif (!room.users[userid]) room.userCount.users++;\n\t\t\t\troom.users[userid] = user;\n\t\t\t\troom.userList.add(userid);\n\t\t\t\troom.userList.updateUserCount();\n\t\t\t\troom.userList.updateNoUsersOnline();\n\t\t\t}\n\t\t\tthis.log(args, undefined, preempt);\n\t\t\tbreak;\n\t\t}\n\t\tcase 'leave': case 'l': case 'L': {\n\t\t\tif (this.roomid) {\n\t\t\t\tlet room = app!.rooms[this.roomid];\n\t\t\t\tlet user = args[1];\n\t\t\t\tlet userid = toUserid(user);\n\t\t\t\tif (room.users[userid]) room.userCount.users--;\n\t\t\t\tdelete room.users[userid];\n\t\t\t\troom.userList.remove(userid);\n\t\t\t\troom.userList.updateUserCount();\n\t\t\t\troom.userList.updateNoUsersOnline();\n\t\t\t}\n\t\t\tthis.log(args, undefined, preempt);\n\t\t\tbreak;\n\t\t}\n\t\tcase 'name': case 'n': case 'N': {\n\t\t\tif (this.roomid) {\n\t\t\t\tlet room = app!.rooms[this.roomid];\n\t\t\t\tlet user = BattleTextParser.parseNameParts(args[1]);\n\t\t\t\tlet oldid = args[2];\n\t\t\t\tif (toUserid(oldid) === app!.user.get('userid')) {\n\t\t\t\t\tapp!.user.set({\n\t\t\t\t\t\taway: user.away,\n\t\t\t\t\t\tstatus: user.status,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tlet userid = toUserid(user.name);\n\t\t\t\troom.users[userid] = user;\n\t\t\t\troom.userList.remove(oldid);\n\t\t\t\troom.userList.add(userid);\n\t\t\t}\n\t\t\tif (!this.ignoreSpects) {\n\t\t\t\tthis.log(args, undefined, preempt);\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\tcase 'player': {\n\t\t\tlet side = this.getSide(args[1]);\n\t\t\tside.setName(args[2]);\n\t\t\tif (args[3]) side.setAvatar(args[3]);\n\t\t\tif (args[4]) side.rating = args[4];\n\t\t\tthis.scene.updateSidebar(side);\n\t\t\tif (this.joinButtons) this.scene.hideJoinButtons();\n\t\t\tthis.log(args);\n\t\t\tbreak;\n\t\t}\n\t\tcase 'teamsize': {\n\t\t\tlet side = this.getSide(args[1]);\n\t\t\tside.totalPokemon = parseInt(args[2], 10);\n\t\t\tthis.scene.updateSidebar(side);\n\t\t\tbreak;\n\t\t}\n\t\tcase 'win': case 'tie': {\n\t\t\tthis.winner(args[0] === 'tie' ? undefined : args[1]);\n\t\t\tbreak;\n\t\t}\n\t\tcase 'prematureend': {\n\t\t\tthis.prematureEnd();\n\t\t\tbreak;\n\t\t}\n\t\tcase 'clearpoke': {\n\t\t\tthis.p1.clearPokemon();\n\t\t\tthis.p2.clearPokemon();\n\t\t\tbreak;\n\t\t}\n\t\tcase 'poke': {\n\t\t\tlet pokemon = this.rememberTeamPreviewPokemon(args[1], args[2])!;\n\t\t\tif (args[3] === 'item') {\n\t\t\t\tpokemon.item = '(exists)';\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\tcase 'teampreview': {\n\t\t\tthis.teamPreviewCount = parseInt(args[1], 10);\n\t\t\tthis.scene.teamPreview();\n\t\t\tbreak;\n\t\t}\n\t\tcase 'switch': case 'drag': case 'replace': {\n\t\t\tthis.endLastTurn();\n\t\t\tlet poke = this.getSwitchedPokemon(args[1], args[2])!;\n\t\t\tlet slot = poke.slot;\n\t\t\tpoke.healthParse(args[3]);\n\t\t\tpoke.removeVolatile('itemremoved' as ID);\n\t\t\tif (args[0] === 'switch') {\n\t\t\t\tif (poke.side.active[slot]) {\n\t\t\t\t\tpoke.side.switchOut(poke.side.active[slot]!);\n\t\t\t\t}\n\t\t\t\tpoke.side.switchIn(poke);\n\t\t\t} else if (args[0] === 'replace') {\n\t\t\t\tpoke.side.replace(poke);\n\t\t\t} else {\n\t\t\t\tpoke.side.dragIn(poke);\n\t\t\t}\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase 'faint': {\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tpoke.side.faint(poke);\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase 'swap': {\n\t\t\tif (isNaN(Number(args[2]))) {\n\t\t\t\tconst poke = this.getPokemon(args[1])!;\n\t\t\t\tpoke.side.swapWith(poke, this.getPokemon(args[2])!, kwArgs);\n\t\t\t} else {\n\t\t\t\tconst poke = this.getPokemon(args[1])!;\n\t\t\t\tconst targetIndex = parseInt(args[2], 10);\n\t\t\t\tif (kwArgs.from) {\n\t\t\t\t\tconst target = poke.side.active[targetIndex];\n\t\t\t\t\tif (target) args[2] = target.ident;\n\t\t\t\t}\n\t\t\t\tpoke.side.swapTo(poke, targetIndex, kwArgs);\n\t\t\t}\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase 'move': {\n\t\t\tthis.endLastTurn();\n\t\t\tthis.resetTurnsSinceMoved();\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tlet move = Dex.getMove(args[2]);\n\t\t\tif (this.checkActive(poke)) return;\n\t\t\tlet poke2 = this.getPokemon(args[3]);\n\t\t\tthis.scene.beforeMove(poke);\n\t\t\tthis.useMove(poke, move, poke2, kwArgs);\n\t\t\tthis.animateMove(poke, move, poke2, kwArgs);\n\t\t\tthis.log(args, kwArgs);\n\t\t\tthis.scene.afterMove(poke);\n\t\t\tbreak;\n\t\t}\n\t\tcase 'cant': {\n\t\t\tthis.endLastTurn();\n\t\t\tthis.resetTurnsSinceMoved();\n\t\t\tlet poke = this.getPokemon(args[1])!;\n\t\t\tlet effect = Dex.getEffect(args[2]);\n\t\t\tlet move = Dex.getMove(args[3]);\n\t\t\tthis.cantUseMove(poke, effect, move, kwArgs);\n\t\t\tthis.log(args, kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase 'gen': {\n\t\t\tthis.gen = parseInt(args[1], 10);\n\t\t\tthis.dex = Dex.forGen(this.gen);\n\t\t\tthis.scene.updateGen();\n\t\t\tthis.log(args);\n\t\t\tbreak;\n\t\t}\n\t\tcase 'callback': {\n\t\t\tif (this.customCallback) this.customCallback(this, args[1], args.slice(1), kwArgs);\n\t\t\tbreak;\n\t\t}\n\t\tcase 'fieldhtml': {\n\t\t\tthis.playbackState = Playback.Seeking; // force seeking to prevent controls etc\n\t\t\tthis.scene.setFrameHTML(BattleLog.sanitizeHTML(args[1]));\n\t\t\tbreak;\n\t\t}\n\t\tcase 'controlshtml': {\n\t\t\tthis.scene.setControlsHTML(BattleLog.sanitizeHTML(args[1]));\n\t\t\tbreak;\n\t\t}\n\t\tdefault: {\n\t\t\tthis.log(args, kwArgs, preempt);\n\t\t\tbreak;\n\t\t}}\n\t}\n\n\trun(str: string, preempt?: boolean) {\n\t\tif (!preempt && this.preemptActivityQueue.length && str === this.preemptActivityQueue[0]) {\n\t\t\tthis.preemptActivityQueue.shift();\n\t\t\tthis.scene.preemptCatchup();\n\t\t\treturn;\n\t\t}\n\t\tif (!str) return;\n\t\tconst {args, kwArgs} = BattleTextParser.parseBattleLine(str);\n\n\t\tif (this.scene.maybeCloseMessagebar(args, kwArgs)) {\n\t\t\tthis.activityStep--;\n\t\t\tthis.activeMoveIsSpread = null;\n\t\t\treturn;\n\t\t}\n\n\t\t// parse the next line if it's a minor: runMinor needs it parsed to determine when to merge minors\n\t\tlet nextArgs: Args = [''];\n\t\tlet nextKwargs: KWArgs = {};\n\t\tconst nextLine = this.activityQueue[this.activityStep + 1] || '';\n\t\tif (nextLine.slice(0, 2) === '|-') {\n\t\t\t({args: nextArgs, kwArgs: nextKwargs} = BattleTextParser.parseBattleLine(nextLine));\n\t\t}\n\n\t\tif (this.debug) {\n\t\t\tif (args[0].charAt(0) === '-' || args[0] === 'detailschange') {\n\t\t\t\tthis.runMinor(args, kwArgs, nextArgs, nextKwargs);\n\t\t\t} else {\n\t\t\t\tthis.runMajor(args, kwArgs, preempt);\n\t\t\t}\n\t\t} else {\n\t\t\ttry {\n\t\t\t\tif (args[0].charAt(0) === '-' || args[0] === 'detailschange') {\n\t\t\t\t\tthis.runMinor(args, kwArgs, nextArgs, nextKwargs);\n\t\t\t\t} else {\n\t\t\t\t\tthis.runMajor(args, kwArgs, preempt);\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tthis.log(['majorerror', 'Error parsing: ' + str + ' (' + err + ')']);\n\t\t\t\tif (err.stack) {\n\t\t\t\t\tlet stack = ('' + err.stack).split('\\n');\n\t\t\t\t\tfor (const line of stack) {\n\t\t\t\t\t\tif (/\\brun\\b/.test(line)) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.log(['error', line]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (this.errorCallback) this.errorCallback(this);\n\t\t\t}\n\t\t}\n\n\t\tif (nextLine.startsWith('|start') || args[0] === 'teampreview') {\n\t\t\tthis.started = true;\n\t\t\tif (this.playbackState === Playback.Uninitialized) {\n\t\t\t\tthis.playbackState = Playback.Ready;\n\t\t\t}\n\t\t\tthis.scene.updateBgm();\n\t\t}\n\t}\n\tcheckActive(poke: Pokemon) {\n\t\tif (!poke.side.active[poke.slot]) {\n\t\t\t// SOMEONE jumped in in the middle of a replay. <_<\n\t\t\tpoke.side.replace(poke);\n\t\t}\n\t\treturn false;\n\t}\n\n\tpause() {\n\t\tthis.paused = true;\n\t\tthis.playbackState = Playback.Paused;\n\t\tthis.scene.pause();\n\t}\n\tplay() {\n\t\tthis.paused = false;\n\t\tthis.playbackState = Playback.Playing;\n\t\tthis.scene.resume();\n\t\tthis.nextActivity();\n\t}\n\tskipTurn() {\n\t\tthis.fastForwardTo(this.turn + 1);\n\t}\n\tfastForwardTo(time: string | number) {\n\t\tif (this.fastForward) return;\n\t\ttime = Math.floor(Number(time));\n\t\tif (isNaN(time)) return;\n\t\tif (this.ended && time >= this.turn + 1) return;\n\n\t\tif (time <= this.turn && time !== -1) {\n\t\t\tlet paused = this.paused;\n\t\t\tthis.reset(true);\n\t\t\tif (paused) this.pause();\n\t\t\telse this.paused = false;\n\t\t\tthis.fastForwardWillScroll = true;\n\t\t}\n\t\tif (!time) {\n\t\t\tthis.fastForwardOff();\n\t\t\tthis.nextActivity();\n\t\t\treturn;\n\t\t}\n\t\tthis.scene.animationOff();\n\t\tthis.playbackState = Playback.Seeking;\n\t\tthis.fastForward = time;\n\t\tthis.nextActivity();\n\t}\n\tfastForwardOff() {\n\t\tthis.fastForward = 0;\n\t\tthis.scene.animationOn();\n\t\tthis.playbackState = this.paused ? Playback.Paused : Playback.Playing;\n\t}\n\tnextActivity() {\n\t\tif (this.playbackState === Playback.Ready || this.playbackState === Playback.Paused) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.scene.startAnimations();\n\t\tlet animations = undefined;\n\t\twhile (!animations) {\n\t\t\tthis.waitForAnimations = true;\n\t\t\tif (this.activityStep >= this.activityQueue.length) {\n\t\t\t\tthis.fastForwardOff();\n\t\t\t\tthis.playbackState = Playback.Finished;\n\t\t\t\tif (this.ended) {\n\t\t\t\t\tthis.scene.updateBgm();\n\t\t\t\t}\n\t\t\t\tif (this.endCallback) this.endCallback(this);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// @ts-ignore property modified in method\n\t\t\tif (this.playbackState === Playback.Ready || this.playbackState === Playback.Paused) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.run(this.activityQueue[this.activityStep]);\n\t\t\tthis.activityStep++;\n\t\t\tif (this.waitForAnimations === true) {\n\t\t\t\tanimations = this.scene.finishAnimations();\n\t\t\t} else if (this.waitForAnimations === 'simult') {\n\t\t\t\tthis.scene.timeOffset = 0;\n\t\t\t}\n\t\t}\n\n\t\t// @ts-ignore property modified in method\n\t\tif (this.playbackState === Playback.Ready || this.playbackState === Playback.Paused) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst interruptionCount = this.scene.interruptionCount;\n\t\tanimations.done(() => {\n\t\t\tif (interruptionCount === this.scene.interruptionCount) {\n\t\t\t\tthis.nextActivity();\n\t\t\t}\n\t\t});\n\t}\n\n\tsetQueue(queue: string[]) {\n\t\tthis.activityQueue = queue;\n\t\tthis.reset();\n\t}\n\n\tsetMute(mute: boolean) {\n\t\tBattleSound.setMute(mute);\n\t}\n}\n\nif (typeof require === 'function') {\n\t// in Node\n\t(global as any).Battle = Battle;\n\t(global as any).Pokemon = Pokemon;\n}\n"],"file":"battle.js"}