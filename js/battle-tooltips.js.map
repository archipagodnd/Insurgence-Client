{"version":3,"sources":["../src/battle-tooltips.ts"],"names":["ModifiableValue","battle","pokemon","serverPokemon","value","maxValue","comment","itemName","abilityName","weatherName","isAccuracy","Dex","items","get","item","name","ability","baseAbility","abilities","weather","moves","exists","reset","tryItem","hasPseudoWeather","push","volatiles","ignoreKlutz","tryAbility","includes","effectiveAbility","tryWeather","sides","side","active","itemModify","factor","modify","abilityModify","weatherModify","round","set","reason","setRange","Number","toFixed","toString","valueString","join","BattleTooltips","clickTooltipEvent","e","isLocked","preventDefault","stopImmediatePropagation","holdLockTooltipEvent","hideTooltip","target","currentTarget","showTooltip","type","tagName","longTapTimeout","setTimeout","lockTooltip","LONG_TAP_DELAY","showTooltipEvent","elem","cancelLongTap","parentNode","removeChild","parentElem","$","removeClass","clearTimeout","isPressed","addClass","handleTouchEnd","listen","$elem","on","unshowTooltip","click","args","dataset","tooltip","split","ownHeight","ownheight","buf","move","dex","teamIndex","parseInt","nearSide","pokemonControlled","Math","floor","mySide","n","gmaxMove","undefined","myPokemon","showMoveTooltip","sideIndex","species","getBaseSpecies","baseSpecies","index","otherPokemon","showPokemonTooltip","sidesSwitched","activeIndex","pokemonIndex","length","ally","myAllyPokemon","showFieldTooltip","Promise","resolve","Error","stack","placeTooltip","innerHTML","hoveredElem","notRelativeToParent","scene","$turn","hoveredX1","offset","left","parent","hoveredY1","top","hoveredY2","outerHeight","x","max","y","$wrapper","document","body","append","selection","window","getSelection","err","css","html","appendTo","find","height","documentElement","clientHeight","width","outerWidth","clientWidth","getStatusZMoveEffect","zMove","effect","zMoveEffects","boostText","boost","boosts","Object","keys","map","stat","BattleTextParser","getMaxMoveFromType","maxMoveTable","isZOrMax","text","zEffect","foeActive","foe","gameType","filter","toID","getMoveType","moveType","category","zMoveFrom","Move","id","moveName","zMoveTable","zMoveType","movePower","basePower","startsWith","maxMove","getTypeIcon","getCategoryIcon","showingMultipleBasePowers","prevBasePower","difference","basePowers","getMoveBasePower","activeTarget","accuracy","getMoveAccuracy","calls","gen","calledMove","hardcoreMode","shortDesc","priority","desc","flags","defrost","protect","bypasssub","reflectable","contact","sound","powder","punch","pulse","bite","recoil","hasCrashDamage","bullet","slicing","wind","clientPokemon","isActive","illusionIndex","genderBuf","gender","fxPrefix","toLowerCase","BattleLog","escapeHTML","speciesForme","levelBuf","level","formechange","transform","types","terastallized","teraType","getPokemonTypes","typechange","typeadd","rules","fainted","hp","maxhp","status","toUpperCase","exacthp","Pokemon","getHPText","min","statusData","toxicTurns","sleepTurns","supportsAbilities","tier","abilityText","getPokemonAbilityText","itemText","itemEffect","prevItem","prevItemEffect","renderStats","battlePokemon","findCorrespondingPokemon","moveid","moveTrack","row","getPPUseText","charAt","isZ","isMax","pokemonHasClones","atLeastOne","sideConditions","sideConditionsLeft","weatherbuf","weatherLeft","slice","speciesClause","searchid","calculateModifiedStats","stats","isPowerTrick","statNamesExceptHP","statName","sourceStatName","clientStatName","spc","boostLevel","boostTable","atk","spe","speedHalvingEVItems","isTransform","speciesName","speedModifiers","spa","def","spd","abilityActive","pokemonHasType","allyActive","allyAbility","getAllyAbility","getSpecies","isNFE","evos","some","evo","evoSpecies","isNonstandard","chainedSpeedModifier","modifier","ceil","short","isTransformed","getSpeedRange","modifiedStats","hasModifiedStat","statLabel","BattleText","statShortName","moveTrackRow","showKnown","ppUsed","maxpp","substr","pp","noPPBoosts","Infinity","tr","trunc","baseSpe","baseStats","bstWithoutHp","bst","scale","isCGT","isRandomBattle","minNature","maxNature","maxIv","maxIvEvOffset","forMaxMove","pokemonTypes","getTypeList","onMemory","onPlate","onDrive","naturalGift","isGrounded","getSpeciesForme","noTypeOverride","allowTypeOverride","getTypes","i","isSound","getGen3Category","ohko","accuracyModifiers","chain","mod","accuracyAfterChain","multiplier","ratios","ratio","faintCounter","boostCount","values","ppLeft","minSpe","maxSpe","minRatio","maxRatio","fling","isGKLK","targetWeight","getWeightKg","pokemonWeight","timesAttacked","secondaries","auraBoosted","auraBroken","getItemBoost","incenseTypes","itemTypes","orbUsers","orbTypes","noGemMoves","preterastallized","curType","slot","getPokemonAbilityData","abilityData","possibilities","hidePossible","baseAbilityName","Poison","Fighting","Dark","Grass","Normal","Rock","Steel","Dragon","Electric","Water","Fire","Ghost","Bug","Psychic","Ice","Flying","Ground","Fairy","BattleStatGuesser","formatid","moveCount","hasMove","ignoreEVLimits","supportsEVs","supportsAVs","endsWith","guess","role","guessRole","comboEVs","guessEVs","evs","plusStat","minusStat","itemid","abilityid","megaEvolves","megaStone","needsFourMoves","moveids","len","heal","isFast","physicalBulk","specialBulk","bulk","ultrafast","offenseBias","ensureMinEVs","evTotal","diff","change","evPriority","prioStat","ensureMaxEVs","statChart","primaryStat","getStat","ev","secondaryStat","SRweaknesses","SRresistances","SRweak","indexOf","hpDivisibility","hpShouldBeDivisible","remaining","evOverride","natureOverride","baseStat","iv","ivs","val","BattleNatures","nature","plus","minus","friendshipValue","require","global"],"mappings":"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","sourcesContent":["/**\r\n * Pokemon Showdown Tooltips\r\n *\r\n * A file for generating tooltips for battles. This should be IE7+ and\r\n * use the DOM directly.\r\n *\r\n * @author Guangcong Luo <guangcongluo@gmail.com>\r\n * @license MIT\r\n */\r\n\r\nclass ModifiableValue {\r\n\tvalue = 0;\r\n\tmaxValue = 0;\r\n\tcomment: string[];\r\n\tbattle: Battle;\r\n\tpokemon: Pokemon;\r\n\tserverPokemon: ServerPokemon;\r\n\titemName: string;\r\n\tabilityName: string;\r\n\tweatherName: string;\r\n\tisAccuracy = false;\r\n\tconstructor(battle: Battle, pokemon: Pokemon, serverPokemon: ServerPokemon) {\r\n\t\tthis.comment = [];\r\n\t\tthis.battle = battle;\r\n\t\tthis.pokemon = pokemon;\r\n\t\tthis.serverPokemon = serverPokemon;\r\n\r\n\t\tthis.itemName = Dex.items.get(serverPokemon.item).name;\r\n\t\tconst ability = serverPokemon.ability || pokemon?.ability || serverPokemon.baseAbility;\r\n\t\tthis.abilityName = Dex.abilities.get(ability).name;\r\n\t\tthis.weatherName = battle.weather === 'snow' ? 'Snow' : Dex.moves.get(battle.weather).exists ?\r\n\t\t\tDex.moves.get(battle.weather).name : Dex.abilities.get(battle.weather).name;\r\n\t}\r\n\treset(value = 0, isAccuracy?: boolean) {\r\n\t\tthis.value = value;\r\n\t\tthis.maxValue = 0;\r\n\t\tthis.isAccuracy = !!isAccuracy;\r\n\t\tthis.comment = [];\r\n\t}\r\n\ttryItem(itemName: string) {\r\n\t\tif (itemName !== this.itemName) return false;\r\n\t\tif (this.battle.hasPseudoWeather('Magic Room')) {\r\n\t\t\tthis.comment.push(` (${itemName} suppressed by Magic Room)`);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif (this.pokemon?.volatiles['embargo']) {\r\n\t\t\tthis.comment.push(` (${itemName} suppressed by Embargo)`);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tconst ignoreKlutz = [\r\n\t\t\t\"Macho Brace\", \"Power Anklet\", \"Power Band\", \"Power Belt\", \"Power Bracer\", \"Power Lens\", \"Power Weight\",\r\n\t\t];\r\n\t\tif (this.tryAbility('Klutz') && !ignoreKlutz.includes(itemName)) {\r\n\t\t\tthis.comment.push(` (${itemName} suppressed by Klutz)`);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\ttryAbility(abilityName: string) {\r\n\t\tif (abilityName !== this.abilityName) return false;\r\n\t\tif (this.pokemon?.volatiles['gastroacid']) {\r\n\t\t\tthis.comment.push(` (${abilityName} suppressed by Gastro Acid)`);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t// Check for Neutralizing Gas\r\n\t\tif (!this.pokemon?.effectiveAbility(this.serverPokemon)) return false;\r\n\t\treturn true;\r\n\t}\r\n\ttryWeather(weatherName?: string) {\r\n\t\tif (!this.weatherName) return false;\r\n\t\tif (!weatherName) weatherName = this.weatherName;\r\n\t\telse if (weatherName !== this.weatherName) return false;\r\n\t\tfor (const side of this.battle.sides) {\r\n\t\t\tfor (const active of side.active) {\r\n\t\t\t\tif (active && ['Air Lock', 'Cloud Nine'].includes(active.ability)) {\r\n\t\t\t\t\tthis.comment.push(` (${weatherName} suppressed by ${active.ability})`);\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\titemModify(factor: number, itemName?: string) {\r\n\t\tif (!itemName) itemName = this.itemName;\r\n\t\tif (!itemName) return false;\r\n\t\tif (!this.tryItem(itemName)) return false;\r\n\t\treturn this.modify(factor, itemName);\r\n\t}\r\n\tabilityModify(factor: number, abilityName: string) {\r\n\t\tif (!this.tryAbility(abilityName)) return false;\r\n\t\treturn this.modify(factor, abilityName);\r\n\t}\r\n\tweatherModify(factor: number, weatherName?: string, name?: string) {\r\n\t\tif (!weatherName) weatherName = this.weatherName;\r\n\t\tif (!weatherName) return false;\r\n\t\tif (!this.tryWeather(weatherName)) return false;\r\n\t\treturn this.modify(factor, name || weatherName);\r\n\t}\r\n\tmodify(factor: number, name?: string) {\r\n\t\tif (factor === 0) {\r\n\t\t\tif (name) this.comment.push(` (${name})`);\r\n\t\t\tthis.value = 0;\r\n\t\t\tthis.maxValue = 0;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tif (name) this.comment.push(` (${this.round(factor)}&times; from ${name})`);\r\n\t\tthis.value *= factor;\r\n\t\tif (!(name === 'Technician' && this.maxValue > 60)) this.maxValue *= factor;\r\n\t\treturn true;\r\n\t}\r\n\tset(value: number, reason?: string) {\r\n\t\tif (reason) this.comment.push(` (${reason})`);\r\n\t\tthis.value = value;\r\n\t\tthis.maxValue = 0;\r\n\t\treturn true;\r\n\t}\r\n\tsetRange(value: number, maxValue: number, reason?: string) {\r\n\t\tif (reason) this.comment.push(` (${reason})`);\r\n\t\tthis.value = value;\r\n\t\tthis.maxValue = maxValue;\r\n\t\treturn true;\r\n\t}\r\n\tround(value: number) {\r\n\t\treturn value ? Number(value.toFixed(2)) : 0;\r\n\t}\r\n\ttoString() {\r\n\t\tlet valueString;\r\n\t\tif (this.isAccuracy) {\r\n\t\t\tvalueString = this.value ? `${this.round(this.value)}%` : `can't miss`;\r\n\t\t} else {\r\n\t\t\tvalueString = this.value ? `${this.round(this.value)}` : ``;\r\n\t\t}\r\n\t\tif (this.maxValue) {\r\n\t\t\tvalueString += ` to ${this.round(this.maxValue)}` + (this.isAccuracy ? '%' : '');\r\n\t\t}\r\n\t\treturn valueString + this.comment.join('');\r\n\t}\r\n}\r\n\r\nclass BattleTooltips {\r\n\tbattle: Battle;\r\n\r\n\tconstructor(battle: Battle) {\r\n\t\tthis.battle = battle;\r\n\t}\r\n\r\n\t// tooltips\r\n\t// Touch delay, pressing finger more than that time will cause the tooltip to open.\r\n\t// Shorter time will cause the button to click\r\n\tstatic LONG_TAP_DELAY = 350; // ms\r\n\tstatic longTapTimeout = 0;\r\n\tstatic elem: HTMLDivElement | null = null;\r\n\tstatic parentElem: HTMLElement | null = null;\r\n\tstatic isLocked = false;\r\n\tstatic isPressed = false;\r\n\r\n\tstatic hideTooltip() {\r\n\t\tif (!BattleTooltips.elem) return;\r\n\t\tBattleTooltips.cancelLongTap();\r\n\t\tBattleTooltips.elem.parentNode!.removeChild(BattleTooltips.elem);\r\n\t\tBattleTooltips.elem = null;\r\n\t\tBattleTooltips.parentElem = null;\r\n\t\tBattleTooltips.isLocked = false;\r\n\t\t$('#tooltipwrapper').removeClass('tooltip-locked');\r\n\t}\r\n\r\n\tstatic cancelLongTap() {\r\n\t\tif (BattleTooltips.longTapTimeout) {\r\n\t\t\tclearTimeout(BattleTooltips.longTapTimeout);\r\n\t\t\tBattleTooltips.longTapTimeout = 0;\r\n\t\t}\r\n\t}\r\n\r\n\tlockTooltip() {\r\n\t\tif (BattleTooltips.elem && !BattleTooltips.isLocked) {\r\n\t\t\tBattleTooltips.isLocked = true;\r\n\t\t\tif (BattleTooltips.isPressed) {\r\n\t\t\t\t$(BattleTooltips.parentElem!).removeClass('pressed');\r\n\t\t\t\tBattleTooltips.isPressed = false;\r\n\t\t\t}\r\n\t\t\t$('#tooltipwrapper').addClass('tooltip-locked');\r\n\t\t}\r\n\t}\r\n\r\n\thandleTouchEnd(e: TouchEvent) {\r\n\t\tBattleTooltips.cancelLongTap();\r\n\r\n\t\tif (!BattleTooltips.isLocked) BattleTooltips.hideTooltip();\r\n\t}\r\n\r\n\tlisten(elem: HTMLElement | JQuery<HTMLElement>) {\r\n\t\tconst $elem = $(elem);\r\n\t\t$elem.on('mouseover', '.has-tooltip', this.showTooltipEvent);\r\n\t\t$elem.on('click', '.has-tooltip', this.clickTooltipEvent);\r\n\t\t$elem.on('focus', '.has-tooltip', this.showTooltipEvent);\r\n\t\t$elem.on('mouseout', '.has-tooltip', BattleTooltips.unshowTooltip);\r\n\t\t$elem.on('mousedown', '.has-tooltip', this.holdLockTooltipEvent);\r\n\t\t$elem.on('blur', '.has-tooltip', BattleTooltips.unshowTooltip);\r\n\t\t$elem.on('mouseup', '.has-tooltip', BattleTooltips.unshowTooltip);\r\n\r\n\t\t$elem.on('touchstart', '.has-tooltip', e => {\r\n\t\t\te.preventDefault();\r\n\t\t\tthis.holdLockTooltipEvent(e);\r\n\t\t\tif (!BattleTooltips.parentElem) {\r\n\t\t\t\t// should never happen, but in case there's a bug in the tooltip handler\r\n\t\t\t\tBattleTooltips.parentElem = e.currentTarget;\r\n\t\t\t}\r\n\t\t\t$(BattleTooltips.parentElem!).addClass('pressed');\r\n\t\t\tBattleTooltips.isPressed = true;\r\n\t\t});\r\n\t\t$elem.on('touchend', '.has-tooltip', e => {\r\n\t\t\te.preventDefault();\r\n\t\t\tif (e.currentTarget === BattleTooltips.parentElem && BattleTooltips.isPressed) {\r\n\t\t\t\tBattleTooltips.parentElem!.click();\r\n\t\t\t}\r\n\t\t\tBattleTooltips.unshowTooltip();\r\n\t\t});\r\n\t\t$elem.on('touchleave', '.has-tooltip', BattleTooltips.unshowTooltip);\r\n\t\t$elem.on('touchcancel', '.has-tooltip', BattleTooltips.unshowTooltip);\r\n\t}\r\n\r\n\tclickTooltipEvent = (e: Event) => {\r\n\t\tif (BattleTooltips.isLocked) {\r\n\t\t\te.preventDefault();\r\n\t\t\te.stopImmediatePropagation();\r\n\t\t}\r\n\t};\r\n\t/**\r\n\t * An event that will lock a tooltip if held down\r\n\t *\r\n\t * (Namely, a long-tap or long-click)\r\n\t */\r\n\tholdLockTooltipEvent = (e: JQuery.TriggeredEvent) => {\r\n\t\tif (BattleTooltips.isLocked) BattleTooltips.hideTooltip();\r\n\t\tconst target = e.currentTarget as HTMLElement;\r\n\t\tthis.showTooltip(target);\r\n\t\tlet factor = (e.type === 'mousedown' && target.tagName === 'BUTTON' ? 2 : 1);\r\n\r\n\t\tBattleTooltips.longTapTimeout = setTimeout(() => {\r\n\t\t\tBattleTooltips.longTapTimeout = 0;\r\n\t\t\tthis.lockTooltip();\r\n\t\t}, BattleTooltips.LONG_TAP_DELAY * factor);\r\n\t};\r\n\r\n\tshowTooltipEvent = (e: Event) => {\r\n\t\tif (BattleTooltips.isLocked) return;\r\n\t\tthis.showTooltip(e.currentTarget as HTMLElement);\r\n\t};\r\n\r\n\t/**\r\n\t * Only hides tooltips if they're not locked\r\n\t */\r\n\tstatic unshowTooltip() {\r\n\t\tif (BattleTooltips.isLocked) return;\r\n\t\tif (BattleTooltips.isPressed) {\r\n\t\t\t$(BattleTooltips.parentElem!).removeClass('pressed');\r\n\t\t\tBattleTooltips.isPressed = false;\r\n\t\t}\r\n\t\tBattleTooltips.hideTooltip();\r\n\t}\r\n\r\n\tshowTooltip(elem: HTMLElement) {\r\n\t\tconst args = (elem.dataset.tooltip || '').split('|');\r\n\t\tconst [type] = args;\r\n\t\t/**\r\n\t\t * If false, we instead attach the tooltip above the parent element.\r\n\t\t * This is important for the move/switch menus so the tooltip doesn't\r\n\t\t * cover up buttons above the hovered button.\r\n\t\t */\r\n\t\tlet ownHeight = !!elem.dataset.ownheight;\r\n\r\n\t\tlet buf: string;\r\n\t\tswitch (type) {\r\n\t\tcase 'move':\r\n\t\tcase 'zmove':\r\n\t\tcase 'maxmove': { // move|MOVE|ACTIVEPOKEMON|[GMAXMOVE]\r\n\t\t\tlet move = this.battle.dex.moves.get(args[1]);\r\n\t\t\tlet teamIndex = parseInt(args[2], 10);\r\n\t\t\tlet pokemon = this.battle.nearSide.active[\r\n\t\t\t\tteamIndex + this.battle.pokemonControlled * Math.floor(this.battle.mySide.n / 2)\r\n\t\t\t];\r\n\t\t\tlet gmaxMove = args[3] ? this.battle.dex.moves.get(args[3]) : undefined;\r\n\t\t\tif (!pokemon) return false;\r\n\t\t\tlet serverPokemon = this.battle.myPokemon![teamIndex];\r\n\t\t\tbuf = this.showMoveTooltip(move, type, pokemon, serverPokemon, gmaxMove);\r\n\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tcase 'pokemon': { // pokemon|SIDE|POKEMON\r\n\t\t\t// mouse over sidebar pokemon\r\n\t\t\t// pokemon definitely exists, serverPokemon always ignored\r\n\t\t\tlet sideIndex = parseInt(args[1], 10);\r\n\t\t\tlet side = this.battle.sides[sideIndex];\r\n\t\t\tlet pokemon = side.pokemon[parseInt(args[2], 10)];\r\n\t\t\tif (args[3] === 'illusion') {\r\n\t\t\t\tbuf = '';\r\n\t\t\t\tconst species = pokemon.getBaseSpecies().baseSpecies;\r\n\t\t\t\tlet index = 1;\r\n\t\t\t\tfor (const otherPokemon of side.pokemon) {\r\n\t\t\t\t\tif (otherPokemon.getBaseSpecies().baseSpecies === species) {\r\n\t\t\t\t\t\tbuf += this.showPokemonTooltip(otherPokemon, null, false, index);\r\n\t\t\t\t\t\tindex++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tbuf = this.showPokemonTooltip(pokemon);\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'activepokemon': { // activepokemon|SIDE|ACTIVE\r\n\t\t\t// mouse over active pokemon\r\n\t\t\t// pokemon definitely exists, serverPokemon maybe\r\n\t\t\tlet sideIndex = parseInt(args[1], 10);\r\n\t\t\tlet side = this.battle.sides[+this.battle.sidesSwitched ^ sideIndex];\r\n\t\t\tlet activeIndex = parseInt(args[2], 10);\r\n\t\t\tlet pokemonIndex = activeIndex;\r\n\t\t\tif (activeIndex >= 1 && this.battle.sides.length > 2) {\r\n\t\t\t\tpokemonIndex -= 1;\r\n\t\t\t\tside = this.battle.sides[side.n + 2];\r\n\t\t\t}\r\n\t\t\tlet pokemon = side.active[activeIndex];\r\n\t\t\tlet serverPokemon = null;\r\n\t\t\tif (side === this.battle.mySide && this.battle.myPokemon) {\r\n\t\t\t\tserverPokemon = this.battle.myPokemon[pokemonIndex];\r\n\t\t\t}\r\n\t\t\tif (side === this.battle.mySide.ally && this.battle.myAllyPokemon) {\r\n\t\t\t\tserverPokemon = this.battle.myAllyPokemon[pokemonIndex];\r\n\t\t\t}\r\n\t\t\tif (!pokemon) return false;\r\n\t\t\tbuf = this.showPokemonTooltip(pokemon, serverPokemon, true);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'switchpokemon': { // switchpokemon|POKEMON\r\n\t\t\t// mouse over switchable pokemon\r\n\t\t\t// serverPokemon definitely exists, sidePokemon maybe\r\n\t\t\t// let side = this.battle.mySide;\r\n\t\t\tlet activeIndex = parseInt(args[1], 10);\r\n\t\t\tlet pokemon = null;\r\n\t\t\t/* if (activeIndex < side.active.length && activeIndex < this.battle.pokemonControlled) {\r\n\t\t\t\tpokemon = side.active[activeIndex];\r\n\t\t\t\tif (pokemon && pokemon.side === side.ally) pokemon = null;\r\n\t\t\t} */\r\n\t\t\tlet serverPokemon = this.battle.myPokemon![activeIndex];\r\n\t\t\tbuf = this.showPokemonTooltip(pokemon, serverPokemon);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'allypokemon': { // allypokemon|POKEMON\r\n\t\t\t// mouse over ally's pokemon in multi battles\r\n\t\t\t// serverPokemon definitely exists, sidePokemon maybe\r\n\t\t\t// let side = this.battle.mySide.ally;\r\n\t\t\tlet activeIndex = parseInt(args[1], 10);\r\n\t\t\tlet pokemon = null;\r\n\t\t\t/*if (activeIndex < side.pokemon.length) {\r\n\t\t\t\tpokemon = side.pokemon[activeIndex] || side.ally ? side.ally.pokemon[activeIndex] : null;\r\n\t\t\t}*/\r\n\t\t\tlet serverPokemon = this.battle.myAllyPokemon ? this.battle.myAllyPokemon[activeIndex] : null;\r\n\t\t\tbuf = this.showPokemonTooltip(pokemon, serverPokemon);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'field': {\r\n\t\t\tbuf = this.showFieldTooltip();\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tdefault:\r\n\t\t\t// \"throws\" an error without crashing\r\n\t\t\tPromise.resolve(new Error(`unrecognized type`));\r\n\t\t\tbuf = `<p class=\"message-error\" style=\"white-space: pre-wrap\">${new Error(`unrecognized type`).stack}</p>`;\r\n\t\t}\r\n\r\n\t\tthis.placeTooltip(buf, elem, ownHeight, type);\r\n\t\treturn true;\r\n\t}\r\n\r\n\tplaceTooltip(innerHTML: string, hoveredElem?: HTMLElement, notRelativeToParent?: boolean, type?: string) {\r\n\t\tlet $elem;\r\n\t\tif (hoveredElem) {\r\n\t\t\t$elem = $(hoveredElem);\r\n\t\t} else {\r\n\t\t\t$elem = (this.battle.scene as BattleScene).$turn;\r\n\t\t\tnotRelativeToParent = true;\r\n\t\t}\r\n\r\n\t\tlet hoveredX1 = $elem.offset()!.left;\r\n\r\n\t\tif (!notRelativeToParent) {\r\n\t\t\t$elem = $elem.parent();\r\n\t\t}\r\n\r\n\t\tlet hoveredY1 = $elem.offset()!.top;\r\n\t\tlet hoveredY2 = hoveredY1 + $elem.outerHeight()!;\r\n\r\n\t\t// (x, y) are the left and top offsets of #tooltipwrapper, which mark the\r\n\t\t// BOTTOM LEFT CORNER of the tooltip\r\n\r\n\t\tlet x = Math.max(hoveredX1 - 2, 0);\r\n\t\tlet y = Math.max(hoveredY1 - 5, 0);\r\n\r\n\t\tlet $wrapper = $('#tooltipwrapper');\r\n\t\tif (!$wrapper.length) {\r\n\t\t\t$wrapper = $(`<div id=\"tooltipwrapper\" role=\"tooltip\"></div>`);\r\n\t\t\t$(document.body).append($wrapper);\r\n\t\t\t$wrapper.on('click', e => {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst selection = window.getSelection()!;\r\n\t\t\t\t\tif (selection.type === 'Range') return;\r\n\t\t\t\t} catch (err) {}\r\n\t\t\t\tBattleTooltips.hideTooltip();\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\t$wrapper.removeClass('tooltip-locked');\r\n\t\t}\r\n\t\t$wrapper.css({\r\n\t\t\tleft: x,\r\n\t\t\ttop: y,\r\n\t\t});\r\n\t\tinnerHTML = `<div class=\"tooltipinner\"><div class=\"tooltip tooltip-${type}\">${innerHTML}</div></div>`;\r\n\t\t$wrapper.html(innerHTML).appendTo(document.body);\r\n\t\tBattleTooltips.elem = $wrapper.find('.tooltip')[0] as HTMLDivElement;\r\n\t\tBattleTooltips.isLocked = false;\r\n\r\n\t\tlet height = $(BattleTooltips.elem).outerHeight()!;\r\n\t\tif (y - height < 1) {\r\n\t\t\t// tooltip is too tall to fit above the element:\r\n\t\t\t// try to fit it below it instead\r\n\t\t\ty = hoveredY2 + height + 5;\r\n\t\t\tif (y > document.documentElement.clientHeight) {\r\n\t\t\t\t// tooltip is also too tall to fit below the element:\r\n\t\t\t\t// just place it at the top of the screen\r\n\t\t\t\ty = height + 1;\r\n\t\t\t}\r\n\t\t\t$wrapper.css('top', y);\r\n\t\t} else if (y < 75) {\r\n\t\t\t// tooltip is pretty high up, put it below the element if it fits\r\n\t\t\ty = hoveredY2 + height + 5;\r\n\t\t\tif (y < document.documentElement.clientHeight) {\r\n\t\t\t\t// it fits\r\n\t\t\t\t$wrapper.css('top', y);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet width = $(BattleTooltips.elem).outerWidth()!;\r\n\t\tif (x > document.documentElement.clientWidth - width - 2) {\r\n\t\t\tx = document.documentElement.clientWidth - width - 2;\r\n\t\t\t$wrapper.css('left', x);\r\n\t\t}\r\n\r\n\t\tBattleTooltips.parentElem = hoveredElem || null;\r\n\t\treturn true;\r\n\t}\r\n\r\n\thideTooltip() {\r\n\t\tBattleTooltips.hideTooltip();\r\n\t}\r\n\r\n\tstatic zMoveEffects: {[zEffect: string]: string} = {\r\n\t\t'clearnegativeboost': \"Restores negative stat stages to 0\",\r\n\t\t'crit2': \"Crit ratio +2\",\r\n\t\t'heal': \"Restores HP 100%\",\r\n\t\t'curse': \"Restores HP 100% if user is Ghost type, otherwise Attack +1\",\r\n\t\t'redirect': \"Redirects opposing attacks to user\",\r\n\t\t'healreplacement': \"Restores replacement's HP 100%\",\r\n\t};\r\n\r\n\tgetStatusZMoveEffect(move: Move) {\r\n\t\tif (move.zMove!.effect! in BattleTooltips.zMoveEffects) {\r\n\t\t\treturn BattleTooltips.zMoveEffects[move.zMove!.effect!];\r\n\t\t}\r\n\t\tlet boostText = '';\r\n\t\tif (move.zMove!.boost) {\r\n\t\t\tlet boosts = Object.keys(move.zMove!.boost) as StatName[];\r\n\t\t\tboostText = boosts.map(stat =>\r\n\t\t\t\tBattleTextParser.stat(stat) + ' +' + move.zMove!.boost![stat]\r\n\t\t\t).join(', ');\r\n\t\t}\r\n\t\treturn boostText;\r\n\t}\r\n\r\n\tstatic zMoveTable: {[type in TypeName]: string} = {\r\n\t\tPoison: \"Acid Downpour\",\r\n\t\tFighting: \"All-Out Pummeling\",\r\n\t\tDark: \"Black Hole Eclipse\",\r\n\t\tGrass: \"Bloom Doom\",\r\n\t\tNormal: \"Breakneck Blitz\",\r\n\t\tRock: \"Continental Crush\",\r\n\t\tSteel: \"Corkscrew Crash\",\r\n\t\tDragon: \"Devastating Drake\",\r\n\t\tElectric: \"Gigavolt Havoc\",\r\n\t\tWater: \"Hydro Vortex\",\r\n\t\tFire: \"Inferno Overdrive\",\r\n\t\tGhost: \"Never-Ending Nightmare\",\r\n\t\tBug: \"Savage Spin-Out\",\r\n\t\tPsychic: \"Shattered Psyche\",\r\n\t\tIce: \"Subzero Slammer\",\r\n\t\tFlying: \"Supersonic Skystrike\",\r\n\t\tGround: \"Tectonic Rage\",\r\n\t\tFairy: \"Twinkle Tackle\",\r\n\t\t\"???\": \"\",\r\n\t};\r\n\r\n\tstatic maxMoveTable: {[type in TypeName]: string} = {\r\n\t\tPoison: \"Max Ooze\",\r\n\t\tFighting: \"Max Knuckle\",\r\n\t\tDark: \"Max Darkness\",\r\n\t\tGrass: \"Max Overgrowth\",\r\n\t\tNormal: \"Max Strike\",\r\n\t\tRock: \"Max Rockfall\",\r\n\t\tSteel: \"Max Steelspike\",\r\n\t\tDragon: \"Max Wyrmwind\",\r\n\t\tElectric: \"Max Lightning\",\r\n\t\tWater: \"Max Geyser\",\r\n\t\tFire: \"Max Flare\",\r\n\t\tGhost: \"Max Phantasm\",\r\n\t\tBug: \"Max Flutterby\",\r\n\t\tPsychic: \"Max Mindstorm\",\r\n\t\tIce: \"Max Hailstorm\",\r\n\t\tFlying: \"Max Airstream\",\r\n\t\tGround: \"Max Quake\",\r\n\t\tFairy: \"Max Starfall\",\r\n\t\t\"???\": \"\",\r\n\t};\r\n\r\n\tgetMaxMoveFromType(type: TypeName, gmaxMove?: string | Move) {\r\n\t\tif (gmaxMove) {\r\n\t\t\tgmaxMove = Dex.moves.get(gmaxMove);\r\n\t\t\tif (type === gmaxMove.type) return gmaxMove;\r\n\t\t}\r\n\t\treturn Dex.moves.get(BattleTooltips.maxMoveTable[type]);\r\n\t}\r\n\r\n\tshowMoveTooltip(move: Move, isZOrMax: string, pokemon: Pokemon, serverPokemon: ServerPokemon, gmaxMove?: Move) {\r\n\t\tlet text = '';\r\n\r\n\t\tlet zEffect = '';\r\n\t\tlet foeActive = pokemon.side.foe.active;\r\n\t\tif (this.battle.gameType === 'freeforall') {\r\n\t\t\tfoeActive = [...foeActive, ...pokemon.side.active].filter(active => active !== pokemon);\r\n\t\t}\r\n\t\t// TODO: move this somewhere it makes more sense\r\n\t\tif (pokemon.ability === '(suppressed)') serverPokemon.ability = '(suppressed)';\r\n\t\tlet ability = toID(serverPokemon.ability || pokemon.ability || serverPokemon.baseAbility);\r\n\t\tlet item = this.battle.dex.items.get(serverPokemon.item);\r\n\r\n\t\tlet value = new ModifiableValue(this.battle, pokemon, serverPokemon);\r\n\t\tlet [moveType, category] = this.getMoveType(move, value, gmaxMove || isZOrMax === 'maxmove');\r\n\r\n\t\tif (isZOrMax === 'zmove') {\r\n\t\t\tif (item.zMoveFrom === move.name) {\r\n\t\t\t\tmove = this.battle.dex.moves.get(item.zMove as string);\r\n\t\t\t} else if (move.category === 'Status') {\r\n\t\t\t\tmove = new Move(move.id, \"\", {\r\n\t\t\t\t\t...move,\r\n\t\t\t\t\tname: 'Z-' + move.name,\r\n\t\t\t\t});\r\n\t\t\t\tzEffect = this.getStatusZMoveEffect(move);\r\n\t\t\t} else {\r\n\t\t\t\tlet moveName = BattleTooltips.zMoveTable[item.zMoveType as TypeName];\r\n\t\t\t\tlet zMove = this.battle.dex.moves.get(moveName);\r\n\t\t\t\tlet movePower = move.zMove!.basePower;\r\n\t\t\t\t// the different Hidden Power types don't have a Z power set, fall back on base move\r\n\t\t\t\tif (!movePower && move.id.startsWith('hiddenpower')) {\r\n\t\t\t\t\tmovePower = this.battle.dex.moves.get('hiddenpower').zMove!.basePower;\r\n\t\t\t\t}\r\n\t\t\t\tif (move.id === 'weatherball') {\r\n\t\t\t\t\tswitch (this.battle.weather) {\r\n\t\t\t\t\tcase 'sunnyday':\r\n\t\t\t\t\tcase 'desolateland':\r\n\t\t\t\t\t\tzMove = this.battle.dex.moves.get(BattleTooltips.zMoveTable['Fire']);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'raindance':\r\n\t\t\t\t\tcase 'primordialsea':\r\n\t\t\t\t\t\tzMove = this.battle.dex.moves.get(BattleTooltips.zMoveTable['Water']);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'sandstorm':\r\n\t\t\t\t\t\tzMove = this.battle.dex.moves.get(BattleTooltips.zMoveTable['Rock']);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'hail':\r\n\t\t\t\t\tcase 'snow':\r\n\t\t\t\t\t\tzMove = this.battle.dex.moves.get(BattleTooltips.zMoveTable['Ice']);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'newmoon':\r\n\t\t\t\t\t\tzMove = this.battle.dex.moves.get(BattleTooltips.zMoveTable['Dark']);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tmove = new Move(zMove.id, zMove.name, {\r\n\t\t\t\t\t...zMove,\r\n\t\t\t\t\tcategory: move.category,\r\n\t\t\t\t\tbasePower: movePower,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t} else if (isZOrMax === 'maxmove') {\r\n\t\t\tif (move.category === 'Status') {\r\n\t\t\t\tmove = this.battle.dex.moves.get('Max Guard');\r\n\t\t\t} else {\r\n\t\t\t\tlet maxMove = this.getMaxMoveFromType(moveType, gmaxMove);\r\n\t\t\t\tconst basePower = ['gmaxdrumsolo', 'gmaxfireball', 'gmaxhydrosnipe'].includes(maxMove.id) ?\r\n\t\t\t\t\tmaxMove.basePower : move.maxMove.basePower;\r\n\t\t\t\tmove = new Move(maxMove.id, maxMove.name, {\r\n\t\t\t\t\t...maxMove,\r\n\t\t\t\t\tcategory: move.category,\r\n\t\t\t\t\tbasePower,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\ttext += '<h2>' + move.name + '<br />';\r\n\r\n\t\ttext += Dex.getTypeIcon(moveType);\r\n\t\ttext += ` ${Dex.getCategoryIcon(category)}</h2>`;\r\n\r\n\t\t// Check if there are more than one active Pokmon to check for multiple possible BPs.\r\n\t\tlet showingMultipleBasePowers = false;\r\n\t\tif (category !== 'Status' && foeActive.length > 1) {\r\n\t\t\t// We check if there is a difference in base powers to note it.\r\n\t\t\t// Otherwise, it is just shown as in singles.\r\n\t\t\t// The trick is that we need to calculate it first for each Pokmon to see if it changes.\r\n\t\t\tlet prevBasePower: string | null = null;\r\n\t\t\tlet basePower: string = '';\r\n\t\t\tlet difference = false;\r\n\t\t\tlet basePowers = [];\r\n\t\t\tfor (const active of foeActive) {\r\n\t\t\t\tif (!active) continue;\r\n\t\t\t\tvalue = this.getMoveBasePower(move, moveType, value, active);\r\n\t\t\t\tbasePower = '' + value;\r\n\t\t\t\tif (prevBasePower === null) prevBasePower = basePower;\r\n\t\t\t\tif (prevBasePower !== basePower) difference = true;\r\n\t\t\t\tbasePowers.push('Base power vs ' + active.name + ': ' + basePower);\r\n\t\t\t}\r\n\t\t\tif (difference) {\r\n\t\t\t\ttext += '<p>' + basePowers.join('<br />') + '</p>';\r\n\t\t\t\tshowingMultipleBasePowers = true;\r\n\t\t\t}\r\n\t\t\t// Falls through to not to repeat code on showing the base power.\r\n\t\t}\r\n\t\tif (!showingMultipleBasePowers && category !== 'Status') {\r\n\t\t\tlet activeTarget = foeActive[0] || foeActive[1] || foeActive[2];\r\n\t\t\tvalue = this.getMoveBasePower(move, moveType, value, activeTarget);\r\n\t\t\ttext += '<p>Base power: ' + value + '</p>';\r\n\t\t}\r\n\r\n\t\tlet accuracy = this.getMoveAccuracy(move, value);\r\n\r\n\t\t// Deal with Nature Power special case, indicating which move it calls.\r\n\t\tif (move.id === 'naturepower') {\r\n\t\t\tlet calls;\r\n\t\t\tif (this.battle.gen > 5) {\r\n\t\t\t\tif (this.battle.hasPseudoWeather('Electric Terrain')) {\r\n\t\t\t\t\tcalls = 'Thunderbolt';\r\n\t\t\t\t} else if (this.battle.hasPseudoWeather('Grassy Terrain')) {\r\n\t\t\t\t\tcalls = 'Energy Ball';\r\n\t\t\t\t} else if (this.battle.hasPseudoWeather('Misty Terrain')) {\r\n\t\t\t\t\tcalls = 'Moonblast';\r\n\t\t\t\t} else if (this.battle.hasPseudoWeather('Psychic Terrain')) {\r\n\t\t\t\t\tcalls = 'Psychic';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcalls = 'Tri Attack';\r\n\t\t\t\t}\r\n\t\t\t} else if (this.battle.gen > 3) {\r\n\t\t\t\t// In gens 4 and 5 it calls Earthquake.\r\n\t\t\t\tcalls = 'Earthquake';\r\n\t\t\t} else {\r\n\t\t\t\t// In gen 3 it calls Swift, so it retains its normal typing.\r\n\t\t\t\tcalls = 'Swift';\r\n\t\t\t}\r\n\t\t\tlet calledMove = this.battle.dex.moves.get(calls);\r\n\t\t\ttext += 'Calls ' + Dex.getTypeIcon(this.getMoveType(calledMove, value)[0]) + ' ' + calledMove.name;\r\n\t\t}\r\n\r\n\t\ttext += '<p>Accuracy: ' + accuracy + '</p>';\r\n\t\tif (zEffect) text += '<p>Z-Effect: ' + zEffect + '</p>';\r\n\r\n\t\tif (this.battle.hardcoreMode) {\r\n\t\t\ttext += '<p class=\"section\">' + move.shortDesc + '</p>';\r\n\t\t} else {\r\n\t\t\ttext += '<p class=\"section\">';\r\n\t\t\tif (move.priority > 1) {\r\n\t\t\t\ttext += 'Nearly always moves first <em>(priority +' + move.priority + ')</em>.</p><p>';\r\n\t\t\t} else if (move.priority <= -1) {\r\n\t\t\t\ttext += 'Nearly always moves last <em>(priority &minus;' + (-move.priority) + ')</em>.</p><p>';\r\n\t\t\t} else if (move.priority === 1) {\r\n\t\t\t\ttext += 'Usually moves first <em>(priority +' + move.priority + ')</em>.</p><p>';\r\n\t\t\t} else {\r\n\t\t\t\tif (move.id === 'grassyglide' && this.battle.hasPseudoWeather('Grassy Terrain')) {\r\n\t\t\t\t\ttext += 'Usually moves first <em>(priority +1)</em>.</p><p>';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\ttext += '' + (move.desc || move.shortDesc || '') + '</p>';\r\n\r\n\t\t\tif (this.battle.gameType === 'doubles' || this.battle.gameType === 'multi') {\r\n\t\t\t\tif (move.target === 'allAdjacent') {\r\n\t\t\t\t\ttext += '<p>&#x25ce; Hits both foes and ally.</p>';\r\n\t\t\t\t} else if (move.target === 'allAdjacentFoes') {\r\n\t\t\t\t\ttext += '<p>&#x25ce; Hits both foes.</p>';\r\n\t\t\t\t}\r\n\t\t\t} else if (this.battle.gameType === 'triples') {\r\n\t\t\t\tif (move.target === 'allAdjacent') {\r\n\t\t\t\t\ttext += '<p>&#x25ce; Hits adjacent foes and allies.</p>';\r\n\t\t\t\t} else if (move.target === 'allAdjacentFoes') {\r\n\t\t\t\t\ttext += '<p>&#x25ce; Hits adjacent foes.</p>';\r\n\t\t\t\t} else if (move.target === 'any') {\r\n\t\t\t\t\ttext += '<p>&#x25ce; Can target distant Pok&eacute;mon in Triples.</p>';\r\n\t\t\t\t}\r\n\t\t\t} else if (this.battle.gameType === 'freeforall') {\r\n\t\t\t\tif (move.target === 'allAdjacent' || move.target === 'allAdjacentFoes') {\r\n\t\t\t\t\ttext += '<p>&#x25ce; Hits all foes.</p>';\r\n\t\t\t\t} else if (move.target === 'adjacentAlly') {\r\n\t\t\t\t\ttext += '<p>&#x25ce; Can target any foe in Free-For-All.</p>';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (move.flags.defrost) {\r\n\t\t\t\ttext += `<p class=\"movetag\">The user thaws out if it is frozen.</p>`;\r\n\t\t\t}\r\n\t\t\tif (!move.flags.protect && !['self', 'allySide'].includes(move.target)) {\r\n\t\t\t\ttext += `<p class=\"movetag\">Not blocked by Protect <small>(and Detect, King's Shield, Spiky Shield)</small></p>`;\r\n\t\t\t}\r\n\t\t\tif (move.flags.bypasssub) {\r\n\t\t\t\ttext += `<p class=\"movetag\">Bypasses Substitute <small>(but does not break it)</small></p>`;\r\n\t\t\t}\r\n\t\t\tif (!move.flags.reflectable && !['self', 'allySide'].includes(move.target) && move.category === 'Status') {\r\n\t\t\t\ttext += `<p class=\"movetag\">&#x2713; Not bounceable <small>(can't be bounced by Magic Coat/Bounce)</small></p>`;\r\n\t\t\t}\r\n\r\n\t\t\tif (move.flags.contact) {\r\n\t\t\t\ttext += `<p class=\"movetag\">&#x2713; Contact <small>(triggers Iron Barbs, Spiky Shield, etc)</small></p>`;\r\n\t\t\t}\r\n\t\t\tif (move.flags.sound) {\r\n\t\t\t\ttext += `<p class=\"movetag\">&#x2713; Sound <small>(doesn't affect Soundproof pokemon)</small></p>`;\r\n\t\t\t}\r\n\t\t\tif (move.flags.powder && this.battle.gen > 5) {\r\n\t\t\t\ttext += `<p class=\"movetag\">&#x2713; Powder <small>(doesn't affect Grass, Overcoat, Safety Goggles)</small></p>`;\r\n\t\t\t}\r\n\t\t\tif (move.flags.punch && ability === 'ironfist') {\r\n\t\t\t\ttext += `<p class=\"movetag\">&#x2713; Fist <small>(boosted by Iron Fist)</small></p>`;\r\n\t\t\t}\r\n\t\t\tif (move.flags.pulse && ability === 'megalauncher') {\r\n\t\t\t\ttext += `<p class=\"movetag\">&#x2713; Pulse <small>(boosted by Mega Launcher)</small></p>`;\r\n\t\t\t}\r\n\t\t\tif (move.flags.bite && ability === 'strongjaw') {\r\n\t\t\t\ttext += `<p class=\"movetag\">&#x2713; Bite <small>(boosted by Strong Jaw)</small></p>`;\r\n\t\t\t}\r\n\t\t\tif (move.flags.bite && ability === 'spectraljaws') {\r\n\t\t\t\ttext += `<p class=\"movetag\">&#x2713; Bite <small>(boosted by Spectral Jaws)</small></p>`;\r\n\t\t\t}\r\n\t\t\tif (move.flags.sound && ability === 'amplifier') {\r\n\t\t\t\ttext += `<p class=\"movetag\">&#x2713; Sound <small>(boosted by Amplifier)</small></p>`;\r\n\t\t\t}\r\n\t\t\tif ((move.recoil || move.hasCrashDamage) && ability === 'reckless') {\r\n\t\t\t\ttext += `<p class=\"movetag\">&#x2713; Recoil <small>(boosted by Reckless)</small></p>`;\r\n\t\t\t}\r\n\t\t\tif (move.flags.bullet) {\r\n\t\t\t\ttext += `<p class=\"movetag\">&#x2713; Bullet-like <small>(doesn't affect Bulletproof pokemon)</small></p>`;\r\n\t\t\t}\r\n\t\t\tif (move.flags.slicing) {\r\n\t\t\t\ttext += `<p class=\"movetag\">&#x2713; Slicing <small>(boosted by Sharpness)</small></p>`;\r\n\t\t\t}\r\n\t\t\tif (move.flags.wind) {\r\n\t\t\t\ttext += `<p class=\"movetag\">&#x2713; Wind <small>(activates Wind Power and Wind Rider)</small></p>`;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn text;\r\n\t}\r\n\r\n\t/**\r\n\t * Needs either a Pokemon or a ServerPokemon, but note that neither\r\n\t * are guaranteed: If you hover over a possible switch-in that's\r\n\t * never been switched in before, you'll only have a ServerPokemon,\r\n\t * and if you hover over an opponent's pokemon, you'll only have a\r\n\t * Pokemon.\r\n\t *\r\n\t * isActive is true if hovering over a pokemon in the battlefield,\r\n\t * and false if hovering over a pokemon in the Switch menu.\r\n\t *\r\n\t * @param clientPokemon\r\n\t * @param serverPokemon\r\n\t * @param isActive\r\n\t */\r\n\tshowPokemonTooltip(\r\n\t\tclientPokemon: Pokemon | null, serverPokemon?: ServerPokemon | null, isActive?: boolean, illusionIndex?: number\r\n\t) {\r\n\t\tconst pokemon = clientPokemon || serverPokemon!;\r\n\t\tlet text = '';\r\n\t\tlet genderBuf = '';\r\n\t\tconst gender = pokemon.gender;\r\n\t\tif (gender === 'M' || gender === 'F') {\r\n\t\t\tgenderBuf = ` <img src=\"${Dex.fxPrefix}gender-${gender.toLowerCase()}.png\" alt=\"${gender}\" width=\"7\" height=\"10\" class=\"pixelated\" /> `;\r\n\t\t}\r\n\r\n\t\tlet name = BattleLog.escapeHTML(pokemon.name);\r\n\t\tif (pokemon.speciesForme !== pokemon.name) {\r\n\t\t\tname += ' <small>(' + BattleLog.escapeHTML(pokemon.speciesForme) + ')</small>';\r\n\t\t}\r\n\r\n\t\tlet levelBuf = (pokemon.level !== 120 ? ` <small>L${pokemon.level}</small>` : ``);\r\n\t\tif (!illusionIndex || illusionIndex === 1) {\r\n\t\t\ttext += `<h2>${name}${genderBuf}${illusionIndex ? '' : levelBuf}<br />`;\r\n\r\n\t\t\tif (clientPokemon?.volatiles.formechange) {\r\n\t\t\t\tif (clientPokemon.volatiles.transform) {\r\n\t\t\t\t\ttext += `<small>(Transformed into ${clientPokemon.volatiles.formechange[1]})</small><br />`;\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttext += `<small>(Changed forme: ${clientPokemon.volatiles.formechange[1]})</small><br />`;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tlet types = serverPokemon?.terastallized ? [serverPokemon.teraType] : this.getPokemonTypes(pokemon);\r\n\r\n\t\t\tif (pokemon.terastallized) {\r\n\t\t\t\ttext += `<small>(Terastallized)</small><br />`;\r\n\t\t\t} else if (clientPokemon?.volatiles.typechange || clientPokemon?.volatiles.typeadd) {\r\n\t\t\t\ttext += `<small>(Type changed)</small><br />`;\r\n\t\t\t}\r\n\t\t\ttext += `<span class=\"textaligned-typeicons\">${types.map(type => Dex.getTypeIcon(type)).join(' ')}</span>`;\r\n\t\t\tif (pokemon.terastallized) {\r\n\t\t\t\ttext += `&nbsp; &nbsp; <small>(base: <span class=\"textaligned-typeicons\">${this.getPokemonTypes(pokemon, true).map(type => Dex.getTypeIcon(type)).join(' ')}</span>)</small>`;\r\n\t\t\t} else if (serverPokemon?.teraType && !this.battle.rules['Terastal Clause']) {\r\n\t\t\t\ttext += `&nbsp; &nbsp; <small>(Tera Type: <span class=\"textaligned-typeicons\">${Dex.getTypeIcon(serverPokemon.teraType)}</span>)</small>`;\r\n\t\t\t}\r\n\t\t\ttext += `</h2>`;\r\n\t\t}\r\n\r\n\t\tif (illusionIndex) {\r\n\t\t\ttext += `<p class=\"section\"><strong>Possible Illusion #${illusionIndex}</strong>${levelBuf}</p>`;\r\n\t\t}\r\n\r\n\t\tif (pokemon.fainted) {\r\n\t\t\ttext += '<p><small>HP:</small> (fainted)</p>';\r\n\t\t} else if (this.battle.hardcoreMode) {\r\n\t\t\tif (serverPokemon) {\r\n\t\t\t\ttext += '<p><small>HP:</small> ' + serverPokemon.hp + '/' + serverPokemon.maxhp + (pokemon.status ? ' <span class=\"status ' + pokemon.status + '\">' + pokemon.status.toUpperCase() + '</span>' : '') + '</p>';\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tlet exacthp = '';\r\n\t\t\tif (serverPokemon) {\r\n\t\t\t\texacthp = ' (' + serverPokemon.hp + '/' + serverPokemon.maxhp + ')';\r\n\t\t\t} else if (pokemon.maxhp === 48) {\r\n\t\t\t\texacthp = ' <small>(' + pokemon.hp + '/' + pokemon.maxhp + ' pixels)</small>';\r\n\t\t\t}\r\n\t\t\ttext += '<p><small>HP:</small> ' + Pokemon.getHPText(pokemon) + exacthp + (pokemon.status ? ' <span class=\"status ' + pokemon.status + '\">' + pokemon.status.toUpperCase() + '</span>' : '');\r\n\t\t\tif (clientPokemon) {\r\n\t\t\t\tif (pokemon.status === 'tox') {\r\n\t\t\t\t\tif (pokemon.ability === 'Poison Heal' || pokemon.ability === 'Magic Guard') {\r\n\t\t\t\t\t\ttext += ' <small>Would take if ability removed: ' + Math.floor(100 / 16 * Math.min(clientPokemon.statusData.toxicTurns + 1, 15)) + '%</small>';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ttext += ' Next damage: ' + Math.floor(100 / (clientPokemon.volatiles['dynamax'] ? 32 : 16) * Math.min(clientPokemon.statusData.toxicTurns + 1, 15)) + '%';\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (pokemon.status === 'slp') {\r\n\t\t\t\t\ttext += ' Turns asleep: ' + clientPokemon.statusData.sleepTurns;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\ttext += '</p>';\r\n\t\t}\r\n\r\n\t\tconst supportsAbilities = this.battle.gen > 2 && !this.battle.tier.includes(\"Let's Go\");\r\n\r\n\t\tlet abilityText = '';\r\n\t\tif (supportsAbilities) {\r\n\t\t\tabilityText = this.getPokemonAbilityText(\r\n\t\t\t\tclientPokemon, serverPokemon, isActive, !!illusionIndex && illusionIndex > 1\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tlet itemText = '';\r\n\t\tif (serverPokemon) {\r\n\t\t\tlet item = '';\r\n\t\t\tlet itemEffect = '';\r\n\t\t\tif (clientPokemon?.prevItem) {\r\n\t\t\t\titem = 'None';\r\n\t\t\t\tlet prevItem = Dex.items.get(clientPokemon.prevItem).name;\r\n\t\t\t\titemEffect += clientPokemon.prevItemEffect ? prevItem + ' was ' + clientPokemon.prevItemEffect : 'was ' + prevItem;\r\n\t\t\t}\r\n\t\t\tif (serverPokemon.item) item = Dex.items.get(serverPokemon.item).name;\r\n\t\t\tif (itemEffect) itemEffect = ' (' + itemEffect + ')';\r\n\t\t\tif (item) itemText = '<small>Item:</small> ' + item + itemEffect;\r\n\t\t} else if (clientPokemon) {\r\n\t\t\tlet item = '';\r\n\t\t\tlet itemEffect = clientPokemon.itemEffect || '';\r\n\t\t\tif (clientPokemon.prevItem) {\r\n\t\t\t\titem = 'None';\r\n\t\t\t\tif (itemEffect) itemEffect += '; ';\r\n\t\t\t\tlet prevItem = Dex.items.get(clientPokemon.prevItem).name;\r\n\t\t\t\titemEffect += clientPokemon.prevItemEffect ? prevItem + ' was ' + clientPokemon.prevItemEffect : 'was ' + prevItem;\r\n\t\t\t}\r\n\t\t\tif (pokemon.item) item = Dex.items.get(pokemon.item).name;\r\n\t\t\tif (itemEffect) itemEffect = ' (' + itemEffect + ')';\r\n\t\t\tif (item) itemText = '<small>Item:</small> ' + item + itemEffect;\r\n\t\t}\r\n\r\n\t\tif (abilityText || itemText) {\r\n\t\t\ttext += '<p>';\r\n\t\t\ttext += abilityText;\r\n\t\t\tif (abilityText && itemText) {\r\n\t\t\t\t// ability/item on one line for your own switch tooltips, two lines everywhere else\r\n\t\t\t\ttext += (!isActive && serverPokemon ? ' / ' : '</p><p>');\r\n\t\t\t}\r\n\t\t\ttext += itemText;\r\n\t\t\ttext += '</p>';\r\n\t\t}\r\n\r\n\t\ttext += this.renderStats(clientPokemon, serverPokemon, !isActive);\r\n\r\n\t\tif (serverPokemon && !isActive) {\r\n\t\t\t// move list\r\n\t\t\ttext += `<p class=\"section\">`;\r\n\t\t\tconst battlePokemon = clientPokemon || this.battle.findCorrespondingPokemon(pokemon);\r\n\t\t\tfor (const moveid of serverPokemon.moves) {\r\n\t\t\t\tconst move = Dex.moves.get(moveid);\r\n\t\t\t\tlet moveName = `&#8226; ${move.name}`;\r\n\t\t\t\tif (battlePokemon?.moveTrack) {\r\n\t\t\t\t\tfor (const row of battlePokemon.moveTrack) {\r\n\t\t\t\t\t\tif (moveName === row[0]) {\r\n\t\t\t\t\t\t\tmoveName = this.getPPUseText(row, true);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\ttext += `${moveName}<br />`;\r\n\t\t\t}\r\n\t\t\ttext += '</p>';\r\n\t\t} else if (!this.battle.hardcoreMode && clientPokemon?.moveTrack.length) {\r\n\t\t\t// move list (guessed)\r\n\t\t\ttext += `<p class=\"section\">`;\r\n\t\t\tfor (const row of clientPokemon.moveTrack) {\r\n\t\t\t\ttext += `${this.getPPUseText(row)}<br />`;\r\n\t\t\t}\r\n\t\t\tif (clientPokemon.moveTrack.filter(([moveName]) => {\r\n\t\t\t\tif (moveName.charAt(0) === '*') return false;\r\n\t\t\t\tconst move = this.battle.dex.moves.get(moveName);\r\n\t\t\t\treturn !move.isZ && !move.isMax && move.name !== 'Mimic';\r\n\t\t\t}).length > 4) {\r\n\t\t\t\ttext += `(More than 4 moves is usually a sign of Illusion Zoroark/Zorua.) `;\r\n\t\t\t}\r\n\t\t\tif (this.battle.gen === 3) {\r\n\t\t\t\ttext += `(Pressure is not visible in Gen 3, so in certain situations, more PP may have been lost than shown here.) `;\r\n\t\t\t}\r\n\t\t\tif (this.pokemonHasClones(clientPokemon)) {\r\n\t\t\t\ttext += `(Your opponent has two indistinguishable Pokmon, making it impossible for you to tell which one has which moves/ability/item.) `;\r\n\t\t\t}\r\n\t\t\ttext += `</p>`;\r\n\t\t}\r\n\t\treturn text;\r\n\t}\r\n\r\n\tshowFieldTooltip() {\r\n\t\tconst scene = this.battle.scene as BattleScene;\r\n\t\tlet buf = `<table style=\"border: 0; border-collapse: collapse; vertical-align: top; padding: 0; width: 100%\"><tr>`;\r\n\r\n\t\tlet atLeastOne = false;\r\n\t\tfor (const side of this.battle.sides) {\r\n\t\t\tconst sideConditions = scene.sideConditionsLeft(side, true);\r\n\t\t\tif (sideConditions) atLeastOne = true;\r\n\t\t\tbuf += `<td><p class=\"section\"><strong>${BattleLog.escapeHTML(side.name)}</strong>${sideConditions || \"<br />(no conditions)\"}</p></td>`;\r\n\t\t}\r\n\t\tbuf += `</tr><table>`;\r\n\t\tif (!atLeastOne) buf = ``;\r\n\r\n\t\tlet weatherbuf = scene.weatherLeft() || `(no weather)`;\r\n\t\tif (weatherbuf.startsWith('<br />')) {\r\n\t\t\tweatherbuf = weatherbuf.slice(6);\r\n\t\t}\r\n\t\tbuf = `<p>${weatherbuf}</p>` + buf;\r\n\t\treturn `<p>${buf}</p>`;\r\n\t}\r\n\r\n\t/**\r\n\t * Does this Pokmon's trainer have two of these Pokmon that are\r\n\t * indistinguishable? (Same nickname, species, forme, level, gender,\r\n\t * and shininess.)\r\n\t */\r\n\tpokemonHasClones(pokemon: Pokemon) {\r\n\t\tconst side = pokemon.side;\r\n\t\tif (side.battle.speciesClause) return false;\r\n\t\tfor (const ally of side.pokemon) {\r\n\t\t\tif (pokemon !== ally && pokemon.searchid === ally.searchid) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tcalculateModifiedStats(clientPokemon: Pokemon | null, serverPokemon: ServerPokemon) {\r\n\t\tlet stats = {...serverPokemon.stats};\r\n\t\tlet pokemon = clientPokemon || serverPokemon;\r\n\t\tconst isPowerTrick = clientPokemon?.volatiles['powertrick'];\r\n\t\tfor (const statName of Dex.statNamesExceptHP) {\r\n\t\t\tlet sourceStatName = statName;\r\n\t\t\tif (isPowerTrick) {\r\n\t\t\t\tif (statName === 'atk') sourceStatName = 'def';\r\n\t\t\t\tif (statName === 'def') sourceStatName = 'atk';\r\n\t\t\t}\r\n\t\t\tstats[statName] = serverPokemon.stats[sourceStatName];\r\n\t\t\tif (!clientPokemon) continue;\r\n\r\n\t\t\tconst clientStatName = clientPokemon.boosts.spc && (statName === 'spa' || statName === 'spd') ? 'spc' : statName;\r\n\t\t\tconst boostLevel = clientPokemon.boosts[clientStatName];\r\n\t\t\tif (boostLevel) {\r\n\t\t\t\tlet boostTable = [1, 1.5, 2, 2.5, 3, 3.5, 4];\r\n\t\t\t\tif (boostLevel > 0) {\r\n\t\t\t\t\tstats[statName] *= boostTable[boostLevel];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (this.battle.gen <= 2) boostTable = [1, 100 / 66, 2, 2.5, 100 / 33, 100 / 28, 4];\r\n\t\t\t\t\tstats[statName] /= boostTable[-boostLevel];\r\n\t\t\t\t}\r\n\t\t\t\tstats[statName] = Math.floor(stats[statName]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst ability = toID(\r\n\t\t\tclientPokemon?.effectiveAbility(serverPokemon) ?? (serverPokemon.ability || serverPokemon.baseAbility)\r\n\t\t);\r\n\r\n\t\t// check for burn, paralysis, guts, quick feet\r\n\t\tif (pokemon.status) {\r\n\t\t\tif (this.battle.gen > 2 && ability === 'guts') {\r\n\t\t\t\tstats.atk = Math.floor(stats.atk * 1.5);\r\n\t\t\t} else if (this.battle.gen < 2 && pokemon.status === 'brn') {\r\n\t\t\t\tstats.atk = Math.floor(stats.atk * 0.5);\r\n\t\t\t}\r\n\r\n\t\t\tif (this.battle.gen > 2 && ability === 'quickfeet') {\r\n\t\t\t\tstats.spe = Math.floor(stats.spe * 1.5);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// gen 1 doesn't support items\r\n\t\tif (this.battle.gen <= 1) {\r\n\t\t\tfor (const statName of Dex.statNamesExceptHP) {\r\n\t\t\t\tif (stats[statName] > 999) stats[statName] = 999;\r\n\t\t\t}\r\n\t\t\treturn stats;\r\n\t\t}\r\n\r\n\t\tlet item = toID(serverPokemon.item);\r\n\t\tlet speedHalvingEVItems = ['machobrace', 'poweranklet', 'powerband', 'powerbelt', 'powerbracer', 'powerlens', 'powerweight'];\r\n\t\tif (\r\n\t\t\t(ability === 'klutz' && !speedHalvingEVItems.includes(item)) ||\r\n\t\t\tthis.battle.hasPseudoWeather('Magic Room') ||\r\n\t\t\tclientPokemon?.volatiles['embargo']\r\n\t\t) {\r\n\t\t\titem = '' as ID;\r\n\t\t}\r\n\r\n\t\tconst species = Dex.species.get(serverPokemon.speciesForme).baseSpecies;\r\n\t\tconst isTransform = clientPokemon?.volatiles.transform;\r\n\t\tconst speciesName = isTransform && clientPokemon?.volatiles.formechange?.[1] && this.battle.gen <= 4 ?\r\n\t\t\tthis.battle.dex.species.get(clientPokemon.volatiles.formechange[1]).baseSpecies : species;\r\n\r\n\t\tlet speedModifiers = [];\r\n\r\n\t\t// check for light ball, thick club, metal/quick powder\r\n\t\t// the only stat modifying items in gen 2 were light ball, thick club, metal powder\r\n\t\tif (item === 'lightball' && speciesName === 'Pikachu' && this.battle.gen !== 4) {\r\n\t\t\tif (this.battle.gen > 4) stats.atk *= 2;\r\n\t\t\tstats.spa *= 2;\r\n\t\t}\r\n\r\n\t\tif (item === 'thickclub') {\r\n\t\t\tif (speciesName === 'Marowak' || speciesName === 'Cubone') {\r\n\t\t\t\tstats.atk *= 2;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (speciesName === 'Ditto' && !(clientPokemon && 'transform' in clientPokemon.volatiles)) {\r\n\t\t\tif (item === 'quickpowder') {\r\n\t\t\t\tspeedModifiers.push(2);\r\n\t\t\t}\r\n\t\t\tif (item === 'metalpowder') {\r\n\t\t\t\tif (this.battle.gen === 2) {\r\n\t\t\t\t\tstats.def = Math.floor(stats.def * 1.5);\r\n\t\t\t\t\tstats.spd = Math.floor(stats.spd * 1.5);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tstats.def *= 2;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// check abilities other than Guts and Quick Feet\r\n\t\t// check items other than light ball, thick club, metal/quick powder\r\n\t\tif (this.battle.gen <= 2) {\r\n\t\t\treturn stats;\r\n\t\t}\r\n\r\n\t\tlet weather = this.battle.weather;\r\n\t\tif (this.battle.abilityActive(['Air Lock', 'Cloud Nine'])) {\r\n\t\t\tweather = '' as ID;\r\n\t\t}\r\n\r\n\t\tif (item === 'choiceband' && !clientPokemon?.volatiles['dynamax']) {\r\n\t\t\tstats.atk = Math.floor(stats.atk * 1.5);\r\n\t\t}\r\n\t\tif (ability === 'purepower' || ability === 'hugepower') {\r\n\t\t\tstats.atk *= 2;\r\n\t\t}\r\n\t\tif (ability === 'athenian') {\r\n\t\t\tstats.spa *= 2;\r\n\t\t}\r\n\t\tif (ability === 'hustle' || (ability === 'gorillatactics' && !clientPokemon?.volatiles['dynamax'])) {\r\n\t\t\tstats.atk = Math.floor(stats.atk * 1.5);\r\n\t\t}\r\n\t\tif (weather) {\r\n\t\t\tif (this.battle.gen >= 4 && this.pokemonHasType(pokemon, 'Rock') && weather === 'sandstorm') {\r\n\t\t\t\tstats.spd = Math.floor(stats.spd * 1.5);\r\n\t\t\t}\r\n\t\t\tif (this.pokemonHasType(pokemon, 'Ice') && weather === 'snow') {\r\n\t\t\t\tstats.def = Math.floor(stats.def * 1.5);\r\n\t\t\t}\r\n\t\t\tif (ability === 'sandrush' && weather === 'sandstorm') {\r\n\t\t\t\tspeedModifiers.push(2);\r\n\t\t\t}\r\n\t\t\tif ((ability === 'slushrush' || ability === 'icecleats') && (weather === 'hail' || weather === 'snow')) {\r\n\t\t\t\tspeedModifiers.push(2);\r\n\t\t\t}\r\n\t\t\tif (ability === 'shadowdance' && weather === 'newmoon') {\r\n\t\t\t\tspeedModifiers.push(2);\r\n\t\t\t}\r\n\t\t\tif (item !== 'utilityumbrella') {\r\n\t\t\t\tif (weather === 'sunnyday' || weather === 'desolateland') {\r\n\t\t\t\t\tif (ability === 'chlorophyll') {\r\n\t\t\t\t\t\tspeedModifiers.push(2);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (ability === 'solarpower') {\r\n\t\t\t\t\t\tstats.spa = Math.floor(stats.spa * 1.5);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (ability === 'orichalcumpulse') {\r\n\t\t\t\t\t\tstats.atk = Math.floor(stats.atk * 1.3);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet allyActive = clientPokemon?.side.active;\r\n\t\t\t\t\tif (allyActive) {\r\n\t\t\t\t\t\tfor (const ally of allyActive) {\r\n\t\t\t\t\t\t\tif (!ally || ally.fainted) continue;\r\n\t\t\t\t\t\t\tlet allyAbility = this.getAllyAbility(ally);\r\n\t\t\t\t\t\t\tif (allyAbility === 'Flower Gift' && (ally.getSpecies().baseSpecies === 'Cherrim' || this.battle.gen <= 4)) {\r\n\t\t\t\t\t\t\t\tstats.atk = Math.floor(stats.atk * 1.5);\r\n\t\t\t\t\t\t\t\tstats.spd = Math.floor(stats.spd * 1.5);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (weather === 'raindance' || weather === 'primordialsea') {\r\n\t\t\t\t\tif (ability === 'supercell') {\r\n\t\t\t\t\t\tstats.spa = Math.floor(stats.spa * 1.5);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (ability === 'swiftswim') {\r\n\t\t\t\t\t\tspeedModifiers.push(2);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (ability === 'supercell' && weather === 'newmoon') {\r\n\t\t\t\tstats.spa = Math.floor(stats.spa * 1.5);\r\n\t\t\t}\r\n\t\t\tif (ability === 'absolution' && weather === 'newmoon') {\r\n\t\t\t\tstats.spa = Math.floor(stats.spa * 1.5);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (ability === 'defeatist' && serverPokemon.hp <= serverPokemon.maxhp / 2) {\r\n\t\t\tstats.atk = Math.floor(stats.atk * 0.5);\r\n\t\t\tstats.spa = Math.floor(stats.spa * 0.5);\r\n\t\t}\r\n\t\tif (clientPokemon) {\r\n\t\t\tif (clientPokemon.volatiles['slowstart']) {\r\n\t\t\t\tstats.atk = Math.floor(stats.atk * 0.5);\r\n\t\t\t\tspeedModifiers.push(0.5);\r\n\t\t\t}\r\n\t\t\tif (ability === 'unburden' && clientPokemon.volatiles['itemremoved'] && !item) {\r\n\t\t\t\tspeedModifiers.push(2);\r\n\t\t\t}\r\n\t\t\tfor (const statName of Dex.statNamesExceptHP) {\r\n\t\t\t\tif (clientPokemon.volatiles['protosynthesis' + statName] || clientPokemon.volatiles['quarkdrive' + statName]) {\r\n\t\t\t\t\tif (statName === 'spe') {\r\n\t\t\t\t\t\tspeedModifiers.push(1.5);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tstats[statName] = Math.floor(stats[statName] * 1.3);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (ability === 'marvelscale' && pokemon.status) {\r\n\t\t\tstats.def = Math.floor(stats.def * 1.5);\r\n\t\t}\r\n\t\tconst isNFE = this.battle.dex.species.get(serverPokemon.speciesForme).evos?.some(evo => {\r\n\t\t\tconst evoSpecies = this.battle.dex.species.get(evo);\r\n\t\t\treturn !evoSpecies.isNonstandard ||\r\n\t\t\t\t\tevoSpecies.isNonstandard === this.battle.dex.species.get(serverPokemon.speciesForme)?.isNonstandard ||\r\n\t\t\t\t\t// Pokemon with Hisui evolutions\r\n\t\t\t\t\tevoSpecies.isNonstandard === \"Unobtainable\";\r\n\t\t});\r\n\t\tif (item === 'eviolite' && (isNFE || species === 'Eevee-Pre-Mega')) {\r\n\t\t\tstats.def = Math.floor(stats.def * 1.5);\r\n\t\t\tstats.spd = Math.floor(stats.spd * 1.5);\r\n\t\t}\r\n\t\tif (ability === 'grasspelt' && this.battle.hasPseudoWeather('Grassy Terrain')) {\r\n\t\t\tstats.def = Math.floor(stats.def * 1.5);\r\n\t\t}\r\n\t\tif (this.battle.hasPseudoWeather('Electric Terrain')) {\r\n\t\t\tif (ability === 'surgesurfer') {\r\n\t\t\t\tspeedModifiers.push(2);\r\n\t\t\t}\r\n\t\t\tif (ability === 'hadronengine') {\r\n\t\t\t\tstats.spa = Math.floor(stats.spa * 1.3);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (item === 'choicespecs' && !clientPokemon?.volatiles['dynamax']) {\r\n\t\t\tstats.spa = Math.floor(stats.spa * 1.5);\r\n\t\t}\r\n\t\tif (item === 'deepseatooth' && serverPokemon.speciesForme === 'Clamperl') {\r\n\t\t\tstats.spa *= 2;\r\n\t\t}\r\n\t\tif (item === 'dragonfang' && serverPokemon.speciesForme === 'Clamperl-Delta') {\r\n\t\t\tstats.atk *= 2;\r\n\t\t}\r\n\t\tif (item === 'souldew' && this.battle.gen <= 6 && (species === 'Latios' || species === 'Latias')) {\r\n\t\t\tstats.spa = Math.floor(stats.spa * 1.5);\r\n\t\t\tstats.spd = Math.floor(stats.spd * 1.5);\r\n\t\t}\r\n\t\tif (clientPokemon && (ability === 'plus' || ability === 'minus')) {\r\n\t\t\tlet allyActive = clientPokemon.side.active;\r\n\t\t\tif (allyActive.length > 1) {\r\n\t\t\t\tlet abilityName = (ability === 'plus' ? 'Plus' : 'Minus');\r\n\t\t\t\tfor (const ally of allyActive) {\r\n\t\t\t\t\tif (!ally || ally === clientPokemon || ally.fainted) continue;\r\n\t\t\t\t\tlet allyAbility = this.getAllyAbility(ally);\r\n\t\t\t\t\tif (allyAbility !== 'Plus' && allyAbility !== 'Minus') continue;\r\n\t\t\t\t\tif (this.battle.gen <= 4 && allyAbility === abilityName) continue;\r\n\t\t\t\t\tstats.spa = Math.floor(stats.spa * 1.5);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (item === 'assaultvest') {\r\n\t\t\tstats.spd = Math.floor(stats.spd * 1.5);\r\n\t\t}\r\n\t\tif (item === 'deepseascale' && serverPokemon.speciesForme === 'Clamperl') {\r\n\t\t\tstats.spd *= 2;\r\n\t\t}\r\n\t\tif (item === 'dragonscale' && serverPokemon.speciesForme === 'Clamperl-Delta') {\r\n\t\t\tstats.def *= 2;\r\n\t\t}\r\n\t\tif (item === 'choicescarf' && !clientPokemon?.volatiles['dynamax']) {\r\n\t\t\tspeedModifiers.push(1.5);\r\n\t\t}\r\n\t\tif (item === 'ironball' || speedHalvingEVItems.includes(item)) {\r\n\t\t\tspeedModifiers.push(0.5);\r\n\t\t}\r\n\t\tif (ability === 'furcoat') {\r\n\t\t\tstats.def *= 2;\r\n\t\t}\r\n\t\tif (this.battle.abilityActive('Vessel of Ruin')) {\r\n\t\t\tif (ability !== 'vesselofruin') {\r\n\t\t\t\tstats.spa = Math.floor(stats.spa * 0.75);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this.battle.abilityActive('Sword of Ruin')) {\r\n\t\t\tif (ability !== 'swordofruin') {\r\n\t\t\t\tstats.def = Math.floor(stats.def * 0.75);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this.battle.abilityActive('Tablets of Ruin')) {\r\n\t\t\tif (ability !== 'tabletsofruin') {\r\n\t\t\t\tstats.atk = Math.floor(stats.atk * 0.75);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this.battle.abilityActive('Beads of Ruin')) {\r\n\t\t\tif (ability !== 'beadsofruin') {\r\n\t\t\t\tstats.spd = Math.floor(stats.spd * 0.75);\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst sideConditions = this.battle.mySide.sideConditions;\r\n\t\tif (sideConditions['tailwind']) {\r\n\t\t\tspeedModifiers.push(2);\r\n\t\t}\r\n\t\tif (sideConditions['grasspledge']) {\r\n\t\t\tspeedModifiers.push(0.25);\r\n\t\t}\r\n\r\n\t\tlet chainedSpeedModifier = 1;\r\n\t\tfor (const modifier of speedModifiers) {\r\n\t\t\tchainedSpeedModifier *= modifier;\r\n\t\t}\r\n\t\t// Chained modifiers round down on 0.5\r\n\t\tstats.spe = stats.spe * chainedSpeedModifier;\r\n\t\tstats.spe = stats.spe % 1 > 0.5 ? Math.ceil(stats.spe) : Math.floor(stats.spe);\r\n\r\n\t\tif (pokemon.status === 'par' && ability !== 'quickfeet') {\r\n\t\t\tif (this.battle.gen > 6) {\r\n\t\t\t\tstats.spe = Math.floor(stats.spe * 0.5);\r\n\t\t\t} else {\r\n\t\t\t\tstats.spe = Math.floor(stats.spe * 0.25);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn stats;\r\n\t}\r\n\r\n\trenderStats(clientPokemon: Pokemon | null, serverPokemon?: ServerPokemon | null, short?: boolean) {\r\n\t\tconst isTransformed = clientPokemon?.volatiles.transform;\r\n\t\tif (!serverPokemon || isTransformed) {\r\n\t\t\tif (!clientPokemon) throw new Error('Must pass either clientPokemon or serverPokemon');\r\n\t\t\tlet [min, max] = this.getSpeedRange(clientPokemon);\r\n\t\t\treturn '<p><small>Spe</small> ' + min + ' to ' + max + ' <small>(before items/abilities/modifiers)</small></p>';\r\n\t\t}\r\n\t\tconst stats = serverPokemon.stats;\r\n\t\tconst modifiedStats = this.calculateModifiedStats(clientPokemon, serverPokemon);\r\n\r\n\t\tlet buf = '<p>';\r\n\r\n\t\tif (!short) {\r\n\t\t\tlet hasModifiedStat = false;\r\n\t\t\tfor (const statName of Dex.statNamesExceptHP) {\r\n\t\t\t\tif (this.battle.gen === 1 && statName === 'spd') continue;\r\n\t\t\t\tlet statLabel = this.battle.gen === 1 && statName === 'spa' ? 'spc' : statName;\r\n\t\t\t\tbuf += statName === 'atk' ? '<small>' : '<small> / ';\r\n\t\t\t\tbuf += '' + BattleText[statLabel].statShortName + '&nbsp;</small>';\r\n\t\t\t\tbuf += '' + stats[statName];\r\n\t\t\t\tif (modifiedStats[statName] !== stats[statName]) hasModifiedStat = true;\r\n\t\t\t}\r\n\t\t\tbuf += '</p>';\r\n\r\n\t\t\tif (!hasModifiedStat) return buf;\r\n\r\n\t\t\tbuf += '<p><small>(After stat modifiers:)</small></p>';\r\n\t\t\tbuf += '<p>';\r\n\t\t}\r\n\r\n\t\tfor (const statName of Dex.statNamesExceptHP) {\r\n\t\t\tif (this.battle.gen === 1 && statName === 'spd') continue;\r\n\t\t\tlet statLabel = this.battle.gen === 1 && statName === 'spa' ? 'spc' : statName;\r\n\t\t\tbuf += statName === 'atk' ? '<small>' : '<small> / ';\r\n\t\t\tbuf += '' + BattleText[statLabel].statShortName + '&nbsp;</small>';\r\n\t\t\tif (modifiedStats[statName] === stats[statName]) {\r\n\t\t\t\tbuf += '' + modifiedStats[statName];\r\n\t\t\t} else if (modifiedStats[statName] < stats[statName]) {\r\n\t\t\t\tbuf += '<strong class=\"stat-lowered\">' + modifiedStats[statName] + '</strong>';\r\n\t\t\t} else {\r\n\t\t\t\tbuf += '<strong class=\"stat-boosted\">' + modifiedStats[statName] + '</strong>';\r\n\t\t\t}\r\n\t\t}\r\n\t\tbuf += '</p>';\r\n\t\treturn buf;\r\n\t}\r\n\r\n\tgetPPUseText(moveTrackRow: [string, number], showKnown?: boolean) {\r\n\t\tlet [moveName, ppUsed] = moveTrackRow;\r\n\t\tlet move;\r\n\t\tlet maxpp;\r\n\t\tif (moveName.charAt(0) === '*') {\r\n\t\t\t// Transformed move\r\n\t\t\tmove = this.battle.dex.moves.get(moveName.substr(1));\r\n\t\t\tmaxpp = 5;\r\n\t\t} else {\r\n\t\t\tmove = this.battle.dex.moves.get(moveName);\r\n\t\t\tmaxpp = (move.pp === 1 || move.noPPBoosts ? move.pp : move.pp * 8 / 5);\r\n\t\t\tif (this.battle.gen < 3) maxpp = Math.min(61, maxpp);\r\n\t\t}\r\n\t\tconst bullet = moveName.charAt(0) === '*' || move.isZ ? '<span style=\"color:#888\">&#8226;</span>' : '&#8226;';\r\n\t\tif (ppUsed === Infinity) {\r\n\t\t\treturn `${bullet} ${move.name} <small>(0/${maxpp})</small>`;\r\n\t\t}\r\n\t\tif (ppUsed || moveName.charAt(0) === '*') {\r\n\t\t\treturn `${bullet} ${move.name} <small>(${maxpp - ppUsed}/${maxpp})</small>`;\r\n\t\t}\r\n\t\treturn `${bullet} ${move.name} ${showKnown ? ' <small>(revealed)</small>' : ''}`;\r\n\t}\r\n\r\n\tppUsed(move: Move, pokemon: Pokemon) {\r\n\t\tfor (let [moveName, ppUsed] of pokemon.moveTrack) {\r\n\t\t\tif (moveName.charAt(0) === '*') moveName = moveName.substr(1);\r\n\t\t\tif (move.name === moveName) return ppUsed;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t/**\r\n\t * Calculates possible Speed stat range of an opponent\r\n\t */\r\n\tgetSpeedRange(pokemon: Pokemon): [number, number] {\r\n\t\tconst tr = Math.trunc || Math.floor;\r\n\t\tconst species = pokemon.getSpecies();\r\n\t\tlet baseSpe = species.baseStats.spe;\r\n\t\tif (this.battle.rules['Scalemons Mod']) {\r\n\t\t\tconst bstWithoutHp = species.bst - species.baseStats.hp;\r\n\t\t\tconst scale = 600 - species.baseStats.hp;\r\n\t\t\tbaseSpe = tr(baseSpe * scale / bstWithoutHp);\r\n\t\t\tif (baseSpe < 1) baseSpe = 1;\r\n\t\t\tif (baseSpe > 255) baseSpe = 255;\r\n\t\t}\r\n\t\tlet level = pokemon.volatiles.transform?.[4] || pokemon.level;\r\n\t\tlet tier = this.battle.tier;\r\n\t\tlet gen = this.battle.gen;\r\n\t\tlet isCGT = tier.includes('Computer-Generated Teams');\r\n\t\tlet isRandomBattle = tier.includes('Random Battle') ||\r\n\t\t\t(tier.includes('Random') && tier.includes('Battle') && gen >= 6) || isCGT;\r\n\r\n\t\tlet minNature = (isRandomBattle || gen < 3) ? 1 : 0.9;\r\n\t\tlet maxNature = (isRandomBattle || gen < 3) ? 1 : 1.1;\r\n\t\tlet maxIv = (gen < 3) ? 30 : 31;\r\n\r\n\t\tlet min;\r\n\t\tlet max;\r\n\t\tif (tier.includes(\"Let's Go\")) {\r\n\t\t\tmin = tr(tr(tr(2 * baseSpe * level / 100 + 5) * minNature) * tr((70 / 255 / 10 + 1) * 100) / 100);\r\n\t\t\tmax = tr(tr(tr((2 * baseSpe + maxIv) * level / 100 + 5) * maxNature) * tr((70 / 255 / 10 + 1) * 100) / 100);\r\n\t\t\tif (tier.includes('No Restrictions')) max += 200;\r\n\t\t\telse if (tier.includes('Random')) max += 20;\r\n\t\t} else {\r\n\t\t\tlet maxIvEvOffset = maxIv + ((isRandomBattle && gen >= 3) ? 21 : 63);\r\n\t\t\tmax = tr(tr((2 * baseSpe + maxIvEvOffset) * level / 100 + 5) * maxNature);\r\n\t\t\tmin = isCGT ? max : tr(tr(2 * baseSpe * level / 100 + 5) * minNature);\r\n\t\t}\r\n\t\treturn [min, max];\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the proper current type for moves with a variable type.\r\n\t */\r\n\tgetMoveType(move: Move, value: ModifiableValue, forMaxMove?: boolean | Move): [TypeName, 'Physical' | 'Special' | 'Status'] {\r\n\t\tconst pokemon = value.pokemon;\r\n\t\tconst serverPokemon = value.serverPokemon;\r\n\r\n\t\tlet moveType = move.type;\r\n\t\tlet category = move.category;\r\n\t\tif (category === 'Status' && forMaxMove) return ['Normal', 'Status']; // Max Guard\r\n\t\t// can happen in obscure situations\r\n\t\tif (!pokemon) return [moveType, category];\r\n\r\n\t\tlet pokemonTypes = pokemon.getTypeList(serverPokemon);\r\n\t\tvalue.reset();\r\n\t\tif (move.id === 'revelationdance') {\r\n\t\t\tmoveType = pokemonTypes[0];\r\n\t\t}\r\n\t\t// Moves that require an item to change their type.\r\n\t\tlet item = Dex.items.get(value.itemName);\r\n\t\tif (move.id === 'multiattack' && item.onMemory) {\r\n\t\t\tif (value.itemModify(0)) moveType = item.onMemory;\r\n\t\t}\r\n\t\tif (move.id === 'judgment' && item.onPlate && !item.zMoveType) {\r\n\t\t\tif (value.itemModify(0)) moveType = item.onPlate;\r\n\t\t}\r\n\t\tif (move.id === 'technoblast' && item.onDrive) {\r\n\t\t\tif (value.itemModify(0)) moveType = item.onDrive;\r\n\t\t}\r\n\t\tif (move.id === 'naturalgift' && item.naturalGift) {\r\n\t\t\tif (value.itemModify(0)) moveType = item.naturalGift.type;\r\n\t\t}\r\n\t\t// Weather and pseudo-weather type changes.\r\n\t\tif (move.id === 'weatherball' && value.weatherModify(0)) {\r\n\t\t\tswitch (this.battle.weather) {\r\n\t\t\tcase 'sunnyday':\r\n\t\t\tcase 'desolateland':\r\n\t\t\t\tif (item.id === 'utilityumbrella') break;\r\n\t\t\t\tmoveType = 'Fire';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'raindance':\r\n\t\t\tcase 'primordialsea':\r\n\t\t\t\tif (item.id === 'utilityumbrella') break;\r\n\t\t\t\tmoveType = 'Water';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'sandstorm':\r\n\t\t\t\tmoveType = 'Rock';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'hail':\r\n\t\t\tcase 'snow':\r\n\t\t\t\tmoveType = 'Ice';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'newmoon':\r\n\t\t\t\tmoveType = 'Dark';\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (move.id === 'terrainpulse' && pokemon.isGrounded(serverPokemon)) {\r\n\t\t\tif (this.battle.hasPseudoWeather('Electric Terrain')) {\r\n\t\t\t\tmoveType = 'Electric';\r\n\t\t\t} else if (this.battle.hasPseudoWeather('Grassy Terrain')) {\r\n\t\t\t\tmoveType = 'Grass';\r\n\t\t\t} else if (this.battle.hasPseudoWeather('Misty Terrain')) {\r\n\t\t\t\tmoveType = 'Fairy';\r\n\t\t\t} else if (this.battle.hasPseudoWeather('Psychic Terrain')) {\r\n\t\t\t\tmoveType = 'Psychic';\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (move.id === 'terablast' && pokemon.terastallized) {\r\n\t\t\tmoveType = pokemon.terastallized as TypeName;\r\n\t\t}\r\n\r\n\t\t// Aura Wheel as Morpeko-Hangry changes the type to Dark\r\n\t\tif (move.id === 'aurawheel' && pokemon.getSpeciesForme() === 'Morpeko-Hangry') {\r\n\t\t\tmoveType = 'Dark';\r\n\t\t}\r\n\t\t// Raging Bull's type depends on the Tauros forme\r\n\t\tif (move.id === 'ragingbull') {\r\n\t\t\tswitch (pokemon.getSpeciesForme()) {\r\n\t\t\tcase 'Tauros-Paldea-Combat':\r\n\t\t\t\tmoveType = 'Fighting';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'Tauros-Paldea-Blaze':\r\n\t\t\t\tmoveType = 'Fire';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'Tauros-Paldea-Aqua':\r\n\t\t\t\tmoveType = 'Water';\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Other abilities that change the move type.\r\n\t\tconst noTypeOverride = [\r\n\t\t\t'judgment', 'multiattack', 'naturalgift', 'revelationdance', 'struggle', 'technoblast', 'terablast', 'terrainpulse', 'weatherball',\r\n\t\t];\r\n\t\tconst allowTypeOverride = !noTypeOverride.includes(move.id) && (move.id !== 'terablast' || !pokemon.terastallized);\r\n\t\tif (allowTypeOverride) {\r\n\t\t\tif (this.battle.rules['Revelationmons Mod']) {\r\n\t\t\t\tconst [types] = pokemon.getTypes(serverPokemon);\r\n\t\t\t\tfor (let i = 0; i < types.length; i++) {\r\n\t\t\t\t\tif (serverPokemon.moves[i] && move.id === toID(serverPokemon.moves[i])) {\r\n\t\t\t\t\t\tmoveType = types[i];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (category !== 'Status' && !move.isZ && !move.id.startsWith('hiddenpower')) {\r\n\t\t\t\tif (moveType === 'Normal') {\r\n\t\t\t\t\tif (value.abilityModify(0, 'Aerilate')) moveType = 'Flying';\r\n\t\t\t\t\tif (value.abilityModify(0, 'Galvanize')) moveType = 'Electric';\r\n\t\t\t\t\tif (value.abilityModify(0, 'Pixilate')) moveType = 'Fairy';\r\n\t\t\t\t\tif (value.abilityModify(0, 'Refrigerate')) moveType = 'Ice';\r\n\t\t\t\t\tif (value.abilityModify(0, 'Intoxicate')) moveType = 'Poison';\r\n\t\t\t\t}\r\n\t\t\t\tif (moveType === 'Rock') {\r\n\t\t\t\t  if (value.abilityModify(0, 'Foundry')) moveType = 'Fire';\r\n\t\t\t\t}\r\n\t\t\t\tif (value.abilityModify(0, 'Normalize')) moveType = 'Normal';\r\n\t\t\t}\r\n\r\n\t\t\t// There aren't any max moves with the sound flag, but if there were, Liquid Voice would make them water type\r\n\t\t\tconst isSound = !!(\r\n\t\t\t\tforMaxMove ?\r\n\t\t\t\tthis.getMaxMoveFromType(moveType, forMaxMove !== true && forMaxMove || undefined) : move\r\n\t\t\t).flags['sound'];\r\n\t\t\tif (isSound && value.abilityModify(0, 'Liquid Voice')) {\r\n\t\t\t\tmoveType = 'Water';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.battle.gen <= 3 && category !== 'Status') {\r\n\t\t\tcategory = Dex.getGen3Category(moveType);\r\n\t\t}\r\n    if (value.abilityModify(0, 'Spectral Jaws')) category = 'Special';\r\n\t\treturn [moveType, category];\r\n\t}\r\n\r\n\t// Gets the current accuracy for a move.\r\n\tgetMoveAccuracy(move: Move, value: ModifiableValue, target?: Pokemon) {\r\n\t\tvalue.reset(move.accuracy === true ? 0 : move.accuracy, true);\r\n\r\n\t\tlet pokemon = value.pokemon!;\r\n\t\t// Sure-hit accuracy\r\n\t\tif (move.id === 'toxic' && this.battle.gen >= 6 && this.pokemonHasType(pokemon, 'Poison')) {\r\n\t\t\tvalue.set(0, \"Poison type\");\r\n\t\t\treturn value;\r\n\t\t}\r\n\t\tif (move.id === 'blizzard' && this.battle.gen >= 4) {\r\n\t\t\tvalue.weatherModify(0, 'Hail');\r\n\t\t\tvalue.weatherModify(0, 'Snow');\r\n\t\t}\r\n\t\tif (move.id === 'hurricane' || move.id === 'thunder') {\r\n\t\t\tvalue.weatherModify(0, 'Rain Dance');\r\n\t\t\tvalue.weatherModify(0, 'Primordial Sea');\r\n\t\t}\r\n\t\tif (!move.ohko) {\r\n\t\t\tvalue.abilityModify(0, 'No Guard');\r\n\t\t}\r\n\t\tif (!value.value) return value;\r\n\r\n\t\t// OHKO moves don't use standard accuracy / evasion modifiers\r\n\t\tif (move.ohko) {\r\n\t\t\tif (this.battle.gen === 1) {\r\n\t\t\t\tvalue.set(value.value, `fails if target's Speed is higher`);\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\t\t\tif (move.id === 'sheercold' && this.battle.gen >= 7 && !this.pokemonHasType(pokemon, 'Ice')) {\r\n\t\t\t\tvalue.set(20, 'not Ice-type');\r\n\t\t\t}\r\n\t\t\tif (target) {\r\n\t\t\t\tif (pokemon.level < target.level) {\r\n\t\t\t\t\tvalue.reset(0);\r\n\t\t\t\t\tvalue.set(0, \"FAILS: target's level is higher\");\r\n\t\t\t\t} else if (pokemon.level > target.level) {\r\n\t\t\t\t\tvalue.set(value.value + pokemon.level - target.level, \"+1% per level above target\");\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (pokemon.level < 120) value.set(value.value, \"fails if target's level is higher\");\r\n\t\t\t\tif (pokemon.level > 1) value.set(value.value, \"+1% per level above target\");\r\n\t\t\t}\r\n\t\t\treturn value;\r\n\t\t}\r\n\r\n\t\t// Accuracy modifiers start\r\n\r\n\t\tlet accuracyModifiers = [];\r\n\t\tif (this.battle.hasPseudoWeather('Gravity')) {\r\n\t\t\taccuracyModifiers.push(6840);\r\n\t\t\tvalue.modify(5 / 3, \"Gravity\");\r\n\t\t}\r\n\r\n\t\tfor (const active of pokemon.side.active) {\r\n\t\t\tif (!active || active.fainted) continue;\r\n\t\t\tconst ability = this.getAllyAbility(active);\r\n\t\t\tif (ability === 'Victory Star') {\r\n\t\t\t\taccuracyModifiers.push(4506);\r\n\t\t\t\tvalue.modify(1.1, \"Victory Star\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (value.tryAbility('Hustle') && move.category === 'Physical') {\r\n\t\t\taccuracyModifiers.push(3277);\r\n\t\t\tvalue.abilityModify(0.8, \"Hustle\");\r\n\t\t} else if (value.tryAbility('Compound Eyes')) {\r\n\t\t\taccuracyModifiers.push(5325);\r\n\t\t\tvalue.abilityModify(1.3, \"Compound Eyes\");\r\n\t\t}\r\n\r\n\t\tif (value.tryItem('Wide Lens')) {\r\n\t\t\taccuracyModifiers.push(4505);\r\n\t\t\tvalue.itemModify(1.1, \"Wide Lens\");\r\n\t\t}\r\n\r\n\t\t// Chaining modifiers\r\n\t\tlet chain = 4096;\r\n\t\tfor (const mod of accuracyModifiers) {\r\n\t\t\tif (mod !== 4096) {\r\n\t\t\t\tchain = (chain * mod + 2048) >> 12;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Applying modifiers\r\n\t\tvalue.set(move.accuracy as number);\r\n\r\n\t\tif (move.id === 'hurricane' || move.id === 'thunder') {\r\n\t\t\tif (value.tryWeather('Sunny Day')) value.set(50, 'Sunny Day');\r\n\t\t\tif (value.tryWeather('Desolate Land')) value.set(50, 'Desolate Land');\r\n\t\t}\r\n\r\n\t\t// Chained modifiers round down on 0.5\r\n\t\tlet accuracyAfterChain = (value.value * chain) / 4096;\r\n\t\taccuracyAfterChain = accuracyAfterChain % 1 > 0.5 ? Math.ceil(accuracyAfterChain) : Math.floor(accuracyAfterChain);\r\n\t\tvalue.set(accuracyAfterChain);\r\n\r\n\t\t// Unlike for Atk, Def, etc. accuracy and evasion boosts are applied after modifiers\r\n\t\tif (pokemon?.boosts.accuracy) {\r\n\t\t\tif (pokemon.boosts.accuracy > 0) {\r\n\t\t\t\tvalue.set(Math.floor(value.value * (pokemon.boosts.accuracy + 3) / 3));\r\n\t\t\t} else {\r\n\t\t\t\tvalue.set(Math.floor(value.value * 3 / (3 - pokemon.boosts.accuracy)));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 1/256 glitch\r\n\t\tif (this.battle.gen === 1 && !toID(this.battle.tier).includes('stadium')) {\r\n\t\t\tvalue.set((Math.floor(value.value * 255 / 100) / 256) * 100);\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\r\n\t// Gets the proper current base power for moves which have a variable base power.\r\n\t// Takes into account the target for some moves.\r\n\t// If it is unsure of the actual base power, it gives an estimate.\r\n\tgetMoveBasePower(move: Move, moveType: TypeName, value: ModifiableValue, target: Pokemon | null = null) {\r\n\t\tconst pokemon = value.pokemon!;\r\n\t\tconst serverPokemon = value.serverPokemon;\r\n\r\n\t\t// apply modifiers for moves that depend on the actual stats\r\n\t\tconst modifiedStats = this.calculateModifiedStats(pokemon, serverPokemon);\r\n\r\n\t\tvalue.reset(move.basePower);\r\n\r\n\t\tif (move.id === 'acrobatics') {\r\n\t\t\tif (!serverPokemon.item) {\r\n\t\t\t\tvalue.modify(2, \"Acrobatics + no item\");\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (['crushgrip', 'wringout'].includes(move.id) && target) {\r\n\t\t\tvalue.set(\r\n\t\t\t\tMath.floor(Math.floor((120 * (100 * Math.floor(target.hp * 4096 / target.maxhp)) + 2048 - 1) / 4096) / 100) || 1,\r\n\t\t\t\t'approximate'\r\n\t\t\t);\r\n\t\t}\r\n\t\tif (move.id === 'brine' && target && target.hp * 2 <= target.maxhp) {\r\n\t\t\tvalue.modify(2, 'Brine + target below half HP');\r\n\t\t}\r\n\t\tif (move.id === 'eruption' || move.id === 'waterspout' || move.id === 'dragonenergy') {\r\n\t\t\tvalue.set(Math.floor(150 * pokemon.hp / pokemon.maxhp) || 1);\r\n\t\t}\r\n\t\tif (move.id === 'facade' && !['', 'slp', 'frz'].includes(pokemon.status)) {\r\n\t\t\tvalue.modify(2, 'Facade + status');\r\n\t\t}\r\n\t\tif (move.id === 'flail' || move.id === 'reversal') {\r\n\t\t\tlet multiplier;\r\n\t\t\tlet ratios;\r\n\t\t\tif (this.battle.gen > 4) {\r\n\t\t\t\tmultiplier = 48;\r\n\t\t\t\tratios = [2, 5, 10, 17, 33];\r\n\t\t\t} else {\r\n\t\t\t\tmultiplier = 64;\r\n\t\t\t\tratios = [2, 6, 13, 22, 43];\r\n\t\t\t}\r\n\t\t\tlet ratio = pokemon.hp * multiplier / pokemon.maxhp;\r\n\t\t\tlet basePower;\r\n\t\t\tif (ratio < ratios[0]) basePower = 200;\r\n\t\t\telse if (ratio < ratios[1]) basePower = 150;\r\n\t\t\telse if (ratio < ratios[2]) basePower = 100;\r\n\t\t\telse if (ratio < ratios[3]) basePower = 80;\r\n\t\t\telse if (ratio < ratios[4]) basePower = 40;\r\n\t\t\telse basePower = 20;\r\n\t\t\tvalue.set(basePower);\r\n\t\t}\r\n\t\tif (['hex', 'infernalparade'].includes(move.id) && target?.status) {\r\n\t\t\tvalue.modify(2, move.name + ' + status');\r\n\t\t}\r\n\t\tif (move.id === 'lastrespects') {\r\n\t\t\tvalue.set(Math.min(50 + 50 * pokemon.side.faintCounter));\r\n\t\t}\r\n\t\tif (move.id === 'punishment' && target) {\r\n\t\t\tlet boostCount = 0;\r\n\t\t\tfor (const boost of Object.values(target.boosts)) {\r\n\t\t\t\tif (boost > 0) boostCount += boost;\r\n\t\t\t}\r\n\t\t\tvalue.set(Math.min(60 + 20 * boostCount, 200));\r\n\t\t}\r\n\t\tif (move.id === 'smellingsalts' && target) {\r\n\t\t\tif (target.status === 'par') {\r\n\t\t\t\tvalue.modify(2, 'Smelling Salts + Paralysis');\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (['storedpower', 'powertrip'].includes(move.id) && target) {\r\n\t\t\tlet boostCount = 0;\r\n\t\t\tfor (const boost of Object.values(pokemon.boosts)) {\r\n\t\t\t\tif (boost > 0) boostCount += boost;\r\n\t\t\t}\r\n\t\t\tvalue.set(20 + 20 * boostCount);\r\n\t\t}\r\n\t\tif (move.id === 'trumpcard') {\r\n\t\t\tconst ppLeft = 5 - this.ppUsed(move, pokemon);\r\n\t\t\tlet basePower = 40;\r\n\t\t\tif (ppLeft === 1) basePower = 200;\r\n\t\t\telse if (ppLeft === 2) basePower = 80;\r\n\t\t\telse if (ppLeft === 3) basePower = 60;\r\n\t\t\telse if (ppLeft === 4) basePower = 50;\r\n\t\t\tvalue.set(basePower);\r\n\t\t}\r\n\t\tif (move.id === 'magnitude') {\r\n\t\t\tvalue.setRange(10, 150);\r\n\t\t}\r\n\t\tif (['venoshock', 'barbbarrage'].includes(move.id) && target) {\r\n\t\t\tif (['psn', 'tox'].includes(target.status)) {\r\n\t\t\t\tvalue.modify(2, move.name + ' + Poison');\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (move.id === 'wakeupslap' && target) {\r\n\t\t\tif (target.status === 'slp') {\r\n\t\t\t\tvalue.modify(2, 'Wake-Up Slap + Sleep');\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (move.id === 'weatherball') {\r\n\t\t\tif (this.battle.weather !== 'deltastream') {\r\n\t\t\t\tvalue.weatherModify(2);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (move.id === 'hydrosteam') {\r\n\t\t\tvalue.weatherModify(1.5, 'Sunny Day');\r\n\t\t}\r\n\t\tif (move.id === 'psyblade' && this.battle.hasPseudoWeather('Electric Terrain')) {\r\n\t\t\tvalue.modify(1.5, 'Electric Terrain');\r\n\t\t}\r\n\t\tif (move.id === 'terrainpulse' && pokemon.isGrounded(serverPokemon)) {\r\n\t\t\tif (\r\n\t\t\t\tthis.battle.hasPseudoWeather('Electric Terrain') ||\r\n\t\t\t\tthis.battle.hasPseudoWeather('Grassy Terrain') ||\r\n\t\t\t\tthis.battle.hasPseudoWeather('Misty Terrain') ||\r\n\t\t\t\tthis.battle.hasPseudoWeather('Psychic Terrain')\r\n\t\t\t) {\r\n\t\t\t\tvalue.modify(2, 'Terrain Pulse boost');\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (\r\n\t\t\tmove.id === 'watershuriken' && pokemon.getSpeciesForme() === 'Greninja-Ash' && pokemon.ability === 'Battle Bond'\r\n\t\t) {\r\n\t\t\tvalue.set(20, 'Battle Bond');\r\n\t\t}\r\n\t\t// Moves that check opponent speed\r\n\t\tif (move.id === 'electroball' && target) {\r\n\t\t\tlet [minSpe, maxSpe] = this.getSpeedRange(target);\r\n\t\t\tlet minRatio = (modifiedStats.spe / maxSpe);\r\n\t\t\tlet maxRatio = (modifiedStats.spe / minSpe);\r\n\t\t\tlet min;\r\n\t\t\tlet max;\r\n\r\n\t\t\tif (minRatio >= 4) min = 150;\r\n\t\t\telse if (minRatio >= 3) min = 120;\r\n\t\t\telse if (minRatio >= 2) min = 80;\r\n\t\t\telse if (minRatio >= 1) min = 60;\r\n\t\t\telse min = 40;\r\n\r\n\t\t\tif (maxRatio >= 4) max = 150;\r\n\t\t\telse if (maxRatio >= 3) max = 120;\r\n\t\t\telse if (maxRatio >= 2) max = 80;\r\n\t\t\telse if (maxRatio >= 1) max = 60;\r\n\t\t\telse max = 40;\r\n\r\n\t\t\tvalue.setRange(min, max);\r\n\t\t}\r\n\t\tif (move.id === 'gyroball' && target) {\r\n\t\t\tlet [minSpe, maxSpe] = this.getSpeedRange(target);\r\n\t\t\tlet min = (Math.floor(25 * minSpe / modifiedStats.spe) || 1);\r\n\t\t\tif (min > 150) min = 150;\r\n\t\t\tlet max = (Math.floor(25 * maxSpe / modifiedStats.spe) || 1);\r\n\t\t\tif (max > 150) max = 150;\r\n\t\t\tvalue.setRange(min, max);\r\n\t\t}\r\n\t\t// Moves which have base power changed due to items\r\n\t\tif (serverPokemon.item) {\r\n\t\t\tlet item = Dex.items.get(serverPokemon.item);\r\n\t\t\tif (move.id === 'fling' && item.fling) {\r\n\t\t\t\tvalue.itemModify(item.fling.basePower);\r\n\t\t\t}\r\n\t\t\tif (move.id === 'naturalgift') {\r\n\t\t\t\tvalue.itemModify(item.naturalGift.basePower);\r\n\t\t\t}\r\n\t\t}\r\n\t\t// Moves which have base power changed according to weight\r\n\t\tif (['lowkick', 'grassknot', 'heavyslam', 'heatcrash'].includes(move.id)) {\r\n\t\t\tlet isGKLK = ['lowkick', 'grassknot'].includes(move.id);\r\n\t\t\tif (target) {\r\n\t\t\t\tlet targetWeight = target.getWeightKg();\r\n\t\t\t\tlet pokemonWeight = pokemon.getWeightKg(serverPokemon);\r\n\t\t\t\tlet basePower;\r\n\t\t\t\tif (isGKLK) {\r\n\t\t\t\t\tbasePower = 20;\r\n\t\t\t\t\tif (targetWeight >= 200) basePower = 120;\r\n\t\t\t\t\telse if (targetWeight >= 100) basePower = 100;\r\n\t\t\t\t\telse if (targetWeight >= 50) basePower = 80;\r\n\t\t\t\t\telse if (targetWeight >= 25) basePower = 60;\r\n\t\t\t\t\telse if (targetWeight >= 10) basePower = 40;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbasePower = 40;\r\n\t\t\t\t\tif (pokemonWeight >= targetWeight * 5) basePower = 120;\r\n\t\t\t\t\telse if (pokemonWeight >= targetWeight * 4) basePower = 100;\r\n\t\t\t\t\telse if (pokemonWeight >= targetWeight * 3) basePower = 80;\r\n\t\t\t\t\telse if (pokemonWeight >= targetWeight * 2) basePower = 60;\r\n\t\t\t\t}\r\n\t\t\t\tif (target.volatiles['dynamax']) {\r\n\t\t\t\t\tvalue.set(0, 'blocked by target\\'s Dynamax');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalue.set(basePower);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvalue.setRange(isGKLK ? 20 : 40, 120);\r\n\t\t\t}\r\n\t\t}\r\n\t\t// Base power based on times hit\r\n\t\tif (move.id === 'ragefist') {\r\n\t\t\tvalue.set(Math.min(350, 50 + 50 * pokemon.timesAttacked),\r\n\t\t\t\tpokemon.timesAttacked > 0\r\n\t\t\t\t\t? `Hit ${pokemon.timesAttacked} time${pokemon.timesAttacked > 1 ? 's' : ''}`\r\n\t\t\t\t\t: undefined);\r\n\t\t}\r\n\t\tif (!value.value) return value;\r\n\r\n\t\t// Other ability boosts\r\n\t\tif (pokemon.status === 'brn' && move.category === 'Special') {\r\n\t\t\tvalue.abilityModify(1.5, \"Flare Boost\");\r\n\t\t}\r\n\t\tif (move.flags['punch']) {\r\n\t\t\tvalue.abilityModify(1.2, 'Iron Fist');\r\n\t\t}\r\n\t\tif (move.flags['pulse']) {\r\n\t\t\tvalue.abilityModify(1.5, \"Mega Launcher\");\r\n\t\t}\r\n\t\tif (move.flags['bite']) {\r\n\t\t\tvalue.abilityModify(1.5, \"Strong Jaw\");\r\n\t\t}\r\n\t\tif (value.value <= 60) {\r\n\t\t\tvalue.abilityModify(1.5, \"Technician\");\r\n\t\t}\r\n\t\tif (['psn', 'tox'].includes(pokemon.status) && move.category === 'Physical') {\r\n\t\t\tvalue.abilityModify(1.5, \"Toxic Boost\");\r\n\t\t}\r\n\t\tif (this.battle.gen > 2 && serverPokemon.status === 'brn' && move.id !== 'facade' && move.category === 'Physical') {\r\n\t\t\tif (!value.tryAbility(\"Guts\")) value.modify(0.5, 'Burn');\r\n\t\t}\r\n\t\tif (['Rock', 'Ground', 'Steel'].includes(moveType) && this.battle.weather === 'sandstorm') {\r\n\t\t\tif (value.tryAbility(\"Sand Force\")) value.weatherModify(1.3, \"Sandstorm\", \"Sand Force\");\r\n\t\t}\r\n\t\tif (move.secondaries) {\r\n\t\t\tvalue.abilityModify(1.3, \"Sheer Force\");\r\n\t\t}\r\n\t\tif (move.flags['contact']) {\r\n\t\t\tvalue.abilityModify(1.3, \"Tough Claws\");\r\n\t\t}\r\n\t\tif (move.flags['sound']) {\r\n\t\t\tvalue.abilityModify(1.3, \"Punk Rock\");\r\n\t\t}\r\n\t\tif (move.flags['slicing']) {\r\n\t\t\tvalue.abilityModify(1.5, \"Sharpness\");\r\n\t\t}\r\n\t\tfor (let i = 1; i <= 5 && i <= pokemon.side.faintCounter; i++) {\r\n\t\t\tif (pokemon.volatiles[`fallen${i}`]) {\r\n\t\t\t\tvalue.abilityModify(1 + 0.1 * i, \"Supreme Overlord\");\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (target) {\r\n\t\t\tif ([\"MF\", \"FM\"].includes(pokemon.gender + target.gender)) {\r\n\t\t\t\tvalue.abilityModify(0.75, \"Rivalry\");\r\n\t\t\t} else if ([\"MM\", \"FF\"].includes(pokemon.gender + target.gender)) {\r\n\t\t\t\tvalue.abilityModify(1.25, \"Rivalry\");\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst noTypeOverride = [\r\n\t\t\t'judgment', 'multiattack', 'naturalgift', 'revelationdance', 'struggle', 'technoblast', 'terrainpulse', 'weatherball',\r\n\t\t];\r\n\t\tconst allowTypeOverride = !noTypeOverride.includes(move.id) && (move.id !== 'terablast' || !pokemon.terastallized);\r\n\t\tif (\r\n\t\t\tmove.category !== 'Status' && allowTypeOverride && !move.isZ && !move.isMax &&\r\n\t\t\t!move.id.startsWith('hiddenpower')\r\n\t\t) {\r\n\t\t\tif (move.type === 'Normal') {\r\n\t\t\t\tvalue.abilityModify(this.battle.gen > 6 ? 1.2 : 1.3, \"Aerilate\");\r\n\t\t\t\tvalue.abilityModify(this.battle.gen > 6 ? 1.2 : 1.3, \"Galvanize\");\r\n\t\t\t\tvalue.abilityModify(this.battle.gen > 6 ? 1.2 : 1.3, \"Pixilate\");\r\n\t\t\t\tvalue.abilityModify(this.battle.gen > 6 ? 1.2 : 1.3, \"Refrigerate\");\r\n\t\t\t\tvalue.abilityModify(this.battle.gen > 6 ? 1.2 : 1.3, \"Intoxicate\");\r\n\t\t\t}\r\n      if (move.type === 'Rock') {\r\n        value.abilityModify(this.battle.gen > 6 ? 1.2 : 1.3, \"Foundry\");\r\n      }\r\n\t\t\tif (this.battle.gen > 6) {\r\n\t\t\t\tvalue.abilityModify(1.2, \"Normalize\");\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (move.recoil || move.hasCrashDamage) {\r\n\t\t\tvalue.abilityModify(1.2, 'Reckless');\r\n\t\t}\r\n\r\n\t\tif (move.category !== 'Status') {\r\n\t\t\tlet auraBoosted = '';\r\n\t\t\tlet auraBroken = false;\r\n\t\t\tfor (const ally of pokemon.side.active) {\r\n\t\t\t\tif (!ally || ally.fainted) continue;\r\n\t\t\t\tlet allyAbility = this.getAllyAbility(ally);\r\n\t\t\t\tif (moveType === 'Fairy' && allyAbility === 'Fairy Aura') {\r\n\t\t\t\t\tauraBoosted = 'Fairy Aura';\r\n\t\t\t\t} else if (moveType === 'Dark' && allyAbility === 'Dark Aura') {\r\n\t\t\t\t\tauraBoosted = 'Dark Aura';\r\n\t\t\t\t} else if (allyAbility === 'Aura Break') {\r\n\t\t\t\t\tauraBroken = true;\r\n\t\t\t\t} else if (allyAbility === 'Battery' && ally !== pokemon && move.category === 'Special') {\r\n\t\t\t\t\tvalue.modify(1.3, 'Battery');\r\n\t\t\t\t} else if (allyAbility === 'Power Spot' && ally !== pokemon) {\r\n\t\t\t\t\tvalue.modify(1.3, 'Power Spot');\r\n\t\t\t\t} else if (allyAbility === 'Steely Spirit' && moveType === 'Steel') {\r\n\t\t\t\t\tvalue.modify(1.5, 'Steely Spirit');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (const foe of pokemon.side.foe.active) {\r\n\t\t\t\tif (!foe || foe.fainted) continue;\r\n\t\t\t\tif (foe.ability === 'Fairy Aura' && moveType === 'Fairy') {\r\n\t\t\t\t\tauraBoosted = 'Fairy Aura';\r\n\t\t\t\t} else if (foe.ability === 'Dark Aura' && moveType === 'Dark') {\r\n\t\t\t\t\tauraBoosted = 'Dark Aura';\r\n\t\t\t\t} else if (foe.ability === 'Aura Break') {\r\n\t\t\t\t\tauraBroken = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (auraBoosted) {\r\n\t\t\t\tif (auraBroken) {\r\n\t\t\t\t\tvalue.modify(0.75, auraBoosted + ' + Aura Break');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalue.modify(1.33, auraBoosted);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Terrain\r\n\t\tif ((this.battle.hasPseudoWeather('Electric Terrain') && moveType === 'Electric') ||\r\n\t\t\t(this.battle.hasPseudoWeather('Grassy Terrain') && moveType === 'Grass') ||\r\n\t\t\t(this.battle.hasPseudoWeather('Psychic Terrain') && moveType === 'Psychic')) {\r\n\t\t\tif (pokemon.isGrounded(serverPokemon)) {\r\n\t\t\t\tvalue.modify(this.battle.gen > 7 ? 1.3 : 1.5, 'Terrain boost');\r\n\t\t\t}\r\n\t\t} else if (this.battle.hasPseudoWeather('Misty Terrain') && moveType === 'Dragon') {\r\n\t\t\tif (target ? target.isGrounded() : true) {\r\n\t\t\t\tvalue.modify(0.5, 'Misty Terrain + grounded target');\r\n\t\t\t}\r\n\t\t} else if (\r\n\t\t\tthis.battle.hasPseudoWeather('Grassy Terrain') && ['earthquake', 'bulldoze', 'magnitude'].includes(move.id)\r\n\t\t) {\r\n\t\t\tif (target ? target.isGrounded() : true) {\r\n\t\t\t\tvalue.modify(0.5, 'Grassy Terrain + grounded target');\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (\r\n\t\t\tmove.id === 'expandingforce' &&\r\n\t\t\tthis.battle.hasPseudoWeather('Psychic Terrain') &&\r\n\t\t\tpokemon.isGrounded(serverPokemon)\r\n\t\t) {\r\n\t\t\tvalue.modify(1.5, 'Expanding Force + Psychic Terrain boost');\r\n\t\t}\r\n\t\tif (move.id === 'mistyexplosion' && this.battle.hasPseudoWeather('Misty Terrain')) {\r\n\t\t\tvalue.modify(1.5, 'Misty Explosion + Misty Terrain boost');\r\n\t\t}\r\n\t\tif (move.id === 'risingvoltage' && this.battle.hasPseudoWeather('Electric Terrain') && target?.isGrounded()) {\r\n\t\t\tvalue.modify(2, 'Rising Voltage + Electric Terrain boost');\r\n\t\t}\r\n\t\tif (\r\n\t\t\tmove.id === 'steelroller' &&\r\n\t\t\t!this.battle.hasPseudoWeather('Electric Terrain') &&\r\n\t\t\t!this.battle.hasPseudoWeather('Grassy Terrain') &&\r\n\t\t\t!this.battle.hasPseudoWeather('Misty Terrain') &&\r\n\t\t\t!this.battle.hasPseudoWeather('Psychic Terrain')\r\n\t\t) {\r\n\t\t\tvalue.set(0, 'no Terrain');\r\n\t\t}\r\n\r\n\t\t// Item\r\n\t\tvalue = this.getItemBoost(move, value, moveType);\r\n\r\n\t\treturn value;\r\n\t}\r\n\r\n\tstatic incenseTypes: {[itemName: string]: TypeName} = {\r\n\t\t'Odd Incense': 'Psychic',\r\n\t\t'Rock Incense': 'Rock',\r\n\t\t'Rose Incense': 'Grass',\r\n\t\t'Sea Incense': 'Water',\r\n\t\t'Wave Incense': 'Water',\r\n\t};\r\n\tstatic itemTypes: {[itemName: string]: TypeName} = {\r\n\t\t'Black Belt': 'Fighting',\r\n\t\t'Black Glasses': 'Dark',\r\n\t\t'Charcoal': 'Fire',\r\n\t\t'Dragon Fang': 'Dragon',\r\n\t\t'Hard Stone': 'Rock',\r\n\t\t'Magnet': 'Electric',\r\n\t\t'Metal Coat': 'Steel',\r\n\t\t'Miracle Seed': 'Grass',\r\n\t\t'Mystic Water': 'Water',\r\n\t\t'Never-Melt Ice': 'Ice',\r\n\t\t'Poison Barb': 'Poison',\r\n\t\t'Sharp Beak': 'Flying',\r\n\t\t'Silk Scarf': 'Normal',\r\n\t\t'Silver Powder': 'Bug',\r\n\t\t'Soft Sand': 'Ground',\r\n\t\t'Spell Tag': 'Ghost',\r\n\t\t'Twisted Spoon': 'Psychic',\r\n\t};\r\n\tstatic orbUsers: {[speciesForme: string]: string[]} = {\r\n\t\t'Latias': ['Soul Dew'],\r\n\t\t'Latios': ['Soul Dew'],\r\n\t\t'Dialga': ['Adamant Crystal', 'Adamant Orb'],\r\n\t\t'Palkia': ['Lustrous Globe', 'Lustrous Orb'],\r\n\t\t'Giratina': ['Griseous Core', 'Griseous Orb'],\r\n\t\t'Venomicon': ['Vile Vial'],\r\n\t};\r\n\tstatic orbTypes: {[itemName: string]: TypeName[]} = {\r\n\t\t'Soul Dew': ['Psychic', 'Dragon'],\r\n\t\t'Adamant Crystal': ['Steel', 'Dragon'],\r\n\t\t'Adamant Orb': ['Steel', 'Dragon'],\r\n\t\t'Lustrous Globe': ['Water', 'Dragon'],\r\n\t\t'Lustrous Orb': ['Water', 'Dragon'],\r\n\t\t'Griseous Core': ['Ghost', 'Dragon'],\r\n\t\t'Griseous Orb': ['Ghost', 'Dragon'],\r\n\t\t'Vile Vial': ['Poison', 'Flying'],\r\n\t};\r\n\tstatic noGemMoves = [\r\n\t\t'Fire Pledge',\r\n\t\t'Fling',\r\n\t\t'Grass Pledge',\r\n\t\t'Struggle',\r\n\t\t'Water Pledge',\r\n\t];\r\n\tgetItemBoost(move: Move, value: ModifiableValue, moveType: TypeName) {\r\n\t\tlet item = this.battle.dex.items.get(value.serverPokemon.item);\r\n\t\tlet itemName = item.name;\r\n\t\tlet moveName = move.name;\r\n\t\tlet species = this.battle.dex.species.get(value.serverPokemon.speciesForme);\r\n\t\tlet isTransform = value.pokemon.volatiles.transform;\r\n\t\tlet speciesName = isTransform && value.pokemon.volatiles.formechange?.[1] && this.battle.gen <= 4 ?\r\n\t\t\tthis.battle.dex.species.get(value.pokemon.volatiles.formechange[1]).baseSpecies : species.baseSpecies;\r\n\r\n\t\t// Plates\r\n\t\tif (item.onPlate === moveType && !item.zMove) {\r\n\t\t\tvalue.itemModify(1.2);\r\n\t\t\treturn value;\r\n\t\t}\r\n\r\n\t\t// Incenses\r\n\t\tif (BattleTooltips.incenseTypes[item.name] === moveType) {\r\n\t\t\tvalue.itemModify(1.2);\r\n\t\t\treturn value;\r\n\t\t}\r\n\r\n\t\t// Type-enhancing items\r\n\t\tif (BattleTooltips.itemTypes[item.name] === moveType) {\r\n\t\t\tvalue.itemModify(this.battle.gen < 4 ? 1.1 : 1.2);\r\n\t\t\treturn value;\r\n\t\t}\r\n\r\n\t\t// Light ball is a base power modifier in gen 4 only\r\n\t\tif (item.name === 'Light Ball' && this.battle.gen === 4 && speciesName === 'Pikachu') {\r\n\t\t\tvalue.itemModify(2);\r\n\t\t\treturn value;\r\n\t\t}\r\n\r\n\t\t// Pokemon-specific items\r\n\t\tif (item.name === 'Soul Dew' && this.battle.gen < 7) return value;\r\n\t\tif (BattleTooltips.orbUsers[speciesName]?.includes(item.name) &&\r\n\t\t\tBattleTooltips.orbTypes[item.name]?.includes(moveType)) {\r\n\t\t\tvalue.itemModify(1.2);\r\n\t\t\treturn value;\r\n\t\t}\r\n\r\n\t\t// Gems\r\n\t\tif (BattleTooltips.noGemMoves.includes(moveName)) return value;\r\n\t\tif (itemName === moveType + ' Gem') {\r\n\t\t\tvalue.itemModify(this.battle.gen < 6 ? 1.5 : 1.3);\r\n\t\t\treturn value;\r\n\t\t}\r\n\r\n\t\tif (itemName === 'Punching Glove' && move.flags['punch']) {\r\n\t\t\tvalue.itemModify(1.1);\r\n\t\t}\r\n\r\n\t\treturn value;\r\n\t}\r\n\tgetPokemonTypes(pokemon: Pokemon | ServerPokemon, preterastallized = false): ReadonlyArray<TypeName> {\r\n\t\tif (!(pokemon as Pokemon).getTypes) {\r\n\t\t\treturn this.battle.dex.species.get(pokemon.speciesForme).types;\r\n\t\t}\r\n\r\n\t\treturn (pokemon as Pokemon).getTypeList(undefined, preterastallized);\r\n\t}\r\n\tpokemonHasType(pokemon: Pokemon | ServerPokemon, type: TypeName, types?: ReadonlyArray<TypeName>) {\r\n\t\tif (!types) types = this.getPokemonTypes(pokemon);\r\n\t\tfor (const curType of types) {\r\n\t\t\tif (curType === type) return true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\tgetAllyAbility(ally: Pokemon) {\r\n\t\t// this will only be available if the ability announced itself in some way\r\n\t\tlet allyAbility = Dex.abilities.get(ally.ability).name;\r\n\t\t// otherwise fall back on the original set data sent from the server\r\n\t\tif (!allyAbility) {\r\n\t\t\tif (this.battle.myAllyPokemon) { // multi battle ally\r\n\t\t\t\tallyAbility = Dex.abilities.get(this.battle.myAllyPokemon[ally.slot].ability).name;\r\n\t\t\t} else if (this.battle.myPokemon) {\r\n\t\t\t\tallyAbility = Dex.abilities.get(this.battle.myPokemon[ally.slot].ability).name;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn allyAbility;\r\n\t}\r\n\tgetPokemonAbilityData(clientPokemon: Pokemon | null, serverPokemon: ServerPokemon | null | undefined) {\r\n\t\tconst abilityData: {ability: string, baseAbility: string, possibilities: string[]} = {\r\n\t\t\tability: '', baseAbility: '', possibilities: [],\r\n\t\t};\r\n\t\tif (clientPokemon) {\r\n\t\t\tif (clientPokemon.ability) {\r\n\t\t\t\tabilityData.ability = clientPokemon.ability || clientPokemon.baseAbility;\r\n\t\t\t\tif (clientPokemon.baseAbility) {\r\n\t\t\t\t\tabilityData.baseAbility = clientPokemon.baseAbility;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst speciesForme = clientPokemon.getSpeciesForme() || serverPokemon?.speciesForme || '';\r\n\t\t\t\tconst species = this.battle.dex.species.get(speciesForme);\r\n\t\t\t\tif (species.exists && species.abilities) {\r\n\t\t\t\t\tabilityData.possibilities = [species.abilities['0']];\r\n\t\t\t\t\tif (species.abilities['1']) abilityData.possibilities.push(species.abilities['1']);\r\n\t\t\t\t\tif (species.abilities['H']) abilityData.possibilities.push(species.abilities['H']);\r\n\t\t\t\t\tif (species.abilities['S']) abilityData.possibilities.push(species.abilities['S']);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (serverPokemon) {\r\n\t\t\tif (!abilityData.ability) abilityData.ability = serverPokemon.ability || serverPokemon.baseAbility;\r\n\t\t\tif (!abilityData.baseAbility && serverPokemon.baseAbility) {\r\n\t\t\t\tabilityData.baseAbility = serverPokemon.baseAbility;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn abilityData;\r\n\t}\r\n\tgetPokemonAbilityText(\r\n\t\tclientPokemon: Pokemon | null,\r\n\t\tserverPokemon: ServerPokemon | null | undefined,\r\n\t\tisActive: boolean | undefined,\r\n\t\thidePossible?: boolean\r\n\t) {\r\n\t\tlet text = '';\r\n\t\tconst abilityData = this.getPokemonAbilityData(clientPokemon, serverPokemon);\r\n\t\tif (!isActive) {\r\n\t\t\t// for switch tooltips, only show the original ability\r\n\t\t\tconst ability = abilityData.baseAbility || abilityData.ability;\r\n\t\t\tif (ability) text = '<small>Ability:</small> ' + Dex.abilities.get(ability).name;\r\n\t\t} else {\r\n\t\t\tif (abilityData.ability) {\r\n\t\t\t\tconst abilityName = Dex.abilities.get(abilityData.ability).name;\r\n\t\t\t\ttext = '<small>Ability:</small> ' + abilityName;\r\n\t\t\t\tconst baseAbilityName = Dex.abilities.get(abilityData.baseAbility).name;\r\n\t\t\t\tif (baseAbilityName && baseAbilityName !== abilityName) text += ' (base: ' + baseAbilityName + ')';\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!text && abilityData.possibilities.length && !hidePossible) {\r\n\t\t\ttext = '<small>Possible abilities:</small> ' + abilityData.possibilities.join(', ');\r\n\t\t}\r\n\t\treturn text;\r\n\t}\r\n}\r\n\r\ntype StatsTable = {hp: number, atk: number, def: number, spa: number, spd: number, spe: number};\r\n\r\n/**\r\n * PokemonSet can be sparse, in which case that entry should be\r\n * inferred from the rest of the set, according to sensible\r\n * defaults.\r\n */\r\ninterface PokemonSet {\r\n\t/** Defaults to species name (not including forme), like in games */\r\n\tname?: string;\r\n\tspecies: string;\r\n\t/** Defaults to no item */\r\n\titem?: string;\r\n\t/** Defaults to no ability (error in Gen 3+) */\r\n\tability?: string;\r\n\tmoves: string[];\r\n\t/** Defaults to no nature (error in Gen 3+) */\r\n\tnature?: NatureName;\r\n\t/** Defaults to random legal gender, NOT subject to gender ratios */\r\n\tgender?: string;\r\n\t/** Defaults to flat 252's (200's/0's in Let's Go) (error in gen 3+) */\r\n\tevs?: StatsTable;\r\n\t/** Defaults to whatever makes sense - flat 31's unless you have Gyro Ball etc */\r\n\tivs?: StatsTable;\r\n\t/** Defaults as you'd expect (100 normally, 50 in VGC-likes, 5 in LC) */\r\n\tlevel?: number;\r\n\t/** Defaults to no (error if shiny event) */\r\n\tshiny?: boolean;\r\n\t/** Defaults to 255 unless you have Frustration, in which case 0 */\r\n\thappiness?: number;\r\n\t/** Defaults to event required ball, otherwise Pok Ball */\r\n\tpokeball?: string;\r\n\t/** Defaults to the type of your Hidden Power in Moves, otherwise Dark */\r\n\thpType?: string;\r\n\t/** Defaults to 10 */\r\n\tdynamaxLevel?: number;\r\n\t/** Defaults to no (can only be yes for certain Pokemon) */\r\n\tgigantamax?: boolean;\r\n\t/** Defaults to the primary type */\r\n\tteraType?: string;\r\n}\r\n\r\nclass BattleStatGuesser {\r\n\tformatid: ID;\r\n\tdex: ModdedDex;\r\n\tmoveCount: any = null;\r\n\thasMove: any = null;\r\n\r\n\tignoreEVLimits: boolean;\r\n\tsupportsEVs: boolean;\r\n\tsupportsAVs: boolean;\r\n\r\n\tconstructor(formatid: ID) {\r\n\t\tthis.formatid = formatid;\r\n\t\tthis.dex = formatid ? Dex.mod(formatid.slice(0, 4) as ID) : Dex;\r\n\t\tthis.ignoreEVLimits = (\r\n\t\t\tthis.dex.gen < 3 ||\r\n\t\t\t((this.formatid.endsWith('hackmons') || this.formatid.endsWith('bh')) && this.dex.gen !== 6) ||\r\n\t\t\tthis.formatid.includes('metronomebattle') ||\r\n\t\t\tthis.formatid.endsWith('norestrictions')\r\n\t\t);\r\n\t\tthis.supportsEVs = !this.formatid.includes('letsgo');\r\n\t\tthis.supportsAVs = !this.supportsEVs && this.formatid.endsWith('norestrictions');\r\n\t}\r\n\tguess(set: PokemonSet) {\r\n\t\tlet role = this.guessRole(set);\r\n\t\tlet comboEVs = this.guessEVs(set, role);\r\n\t\tlet evs = {hp: 0, atk: 0, def: 0, spa: 0, spd: 0, spe: 0};\r\n\t\tfor (let stat in evs) {\r\n\t\t\tevs[stat as StatName] = comboEVs[stat as StatName] || 0;\r\n\t\t}\r\n\t\tlet plusStat = comboEVs.plusStat || '';\r\n\t\tlet minusStat = comboEVs.minusStat || '';\r\n\t\treturn {role, evs, plusStat, minusStat, moveCount: this.moveCount, hasMove: this.hasMove};\r\n\t}\r\n\tguessRole(set: PokemonSet) {\r\n\t\tif (!set) return '?';\r\n\t\tif (!set.moves) return '?';\r\n\r\n\t\tlet moveCount = {\r\n\t\t\t'Physical': 0,\r\n\t\t\t'Special': 0,\r\n\t\t\t'PhysicalAttack': 0,\r\n\t\t\t'SpecialAttack': 0,\r\n\t\t\t'PhysicalSetup': 0,\r\n\t\t\t'SpecialSetup': 0,\r\n\t\t\t'Support': 0,\r\n\t\t\t'Setup': 0,\r\n\t\t\t'Restoration': 0,\r\n\t\t\t'Offense': 0,\r\n\t\t\t'Stall': 0,\r\n\t\t\t'SpecialStall': 0,\r\n\t\t\t'PhysicalStall': 0,\r\n\t\t\t'Fast': 0,\r\n\t\t\t'Ultrafast': 0,\r\n\t\t\t'bulk': 0,\r\n\t\t\t'specialBulk': 0,\r\n\t\t\t'physicalBulk': 0,\r\n\t\t};\r\n\t\tlet hasMove: {[moveid: string]: 1} = {};\r\n\t\tlet itemid = toID(set.item);\r\n\t\tlet item = this.dex.items.get(itemid);\r\n\t\tlet abilityid = toID(set.ability);\r\n\r\n\t\tlet species = this.dex.species.get(set.species || set.name!);\r\n\t\tif (item.megaEvolves === species.name) species = this.dex.species.get(item.megaStone);\r\n\t\tif (!species.exists) return '?';\r\n\t\tlet stats = species.baseStats;\r\n\r\n\t\tif (set.moves.length < 1) return '?';\r\n\t\tlet needsFourMoves = !['unown', 'ditto'].includes(species.id);\r\n\t\tlet moveids = set.moves.map(toID);\r\n\t\tif (moveids.includes('lastresort' as ID)) needsFourMoves = false;\r\n\t\tif (set.moves.length < 4 && needsFourMoves && !this.formatid.includes('metronomebattle')) {\r\n\t\t\treturn '?';\r\n\t\t}\r\n\r\n\t\tfor (let i = 0, len = set.moves.length; i < len; i++) {\r\n\t\t\tlet move = this.dex.moves.get(set.moves[i]);\r\n\t\t\thasMove[move.id] = 1;\r\n\t\t\tif (move.category === 'Status') {\r\n\t\t\t\tif (['batonpass', 'healingwish', 'lunardance'].includes(move.id)) {\r\n\t\t\t\t\tmoveCount['Support']++;\r\n\t\t\t\t} else if (['metronome', 'assist', 'copycat', 'mefirst', 'photongeyser', 'shellsidearm'].includes(move.id)) {\r\n\t\t\t\t\tmoveCount['Physical'] += 0.5;\r\n\t\t\t\t\tmoveCount['Special'] += 0.5;\r\n\t\t\t\t} else if (move.id === 'naturepower') {\r\n\t\t\t\t\tmoveCount['Special']++;\r\n\t\t\t\t} else if (['protect', 'detect', 'spikyshield', 'kingsshield'].includes(move.id)) {\r\n\t\t\t\t\tmoveCount['Stall']++;\r\n\t\t\t\t} else if (move.id === 'wish') {\r\n\t\t\t\t\tmoveCount['Restoration']++;\r\n\t\t\t\t\tmoveCount['Stall']++;\r\n\t\t\t\t\tmoveCount['Support']++;\r\n\t\t\t\t} else if (move.heal) {\r\n\t\t\t\t\tmoveCount['Restoration']++;\r\n\t\t\t\t\tmoveCount['Stall']++;\r\n\t\t\t\t} else if (move.target === 'self') {\r\n\t\t\t\t\tif (['agility', 'rockpolish', 'shellsmash', 'growth', 'workup'].includes(move.id)) {\r\n\t\t\t\t\t\tmoveCount['PhysicalSetup']++;\r\n\t\t\t\t\t\tmoveCount['SpecialSetup']++;\r\n\t\t\t\t\t} else if (['dragondance', 'swordsdance', 'coil', 'bulkup', 'curse', 'bellydrum'].includes(move.id)) {\r\n\t\t\t\t\t\tmoveCount['PhysicalSetup']++;\r\n\t\t\t\t\t} else if (['nastyplot', 'tailglow', 'quiverdance', 'calmmind', 'geomancy'].includes(move.id)) {\r\n\t\t\t\t\t\tmoveCount['SpecialSetup']++;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (move.id === 'substitute') moveCount['Stall']++;\r\n\t\t\t\t\tmoveCount['Setup']++;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (['toxic', 'leechseed', 'willowisp'].includes(move.id)) {\r\n\t\t\t\t\t\tmoveCount['Stall']++;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tmoveCount['Support']++;\r\n\t\t\t\t}\r\n\t\t\t} else if (['counter', 'endeavor', 'metalburst', 'mirrorcoat', 'rapidspin'].includes(move.id)) {\r\n\t\t\t\tmoveCount['Support']++;\r\n\t\t\t} else if ([\r\n\t\t\t\t'nightshade', 'seismictoss', 'psywave', 'superfang', 'naturesmadness', 'foulplay', 'endeavor', 'finalgambit', 'bodypress',\r\n\t\t\t].includes(move.id)) {\r\n\t\t\t\tmoveCount['Offense']++;\r\n\t\t\t} else if (move.id === 'fellstinger') {\r\n\t\t\t\tmoveCount['PhysicalSetup']++;\r\n\t\t\t\tmoveCount['Setup']++;\r\n\t\t\t} else {\r\n\t\t\t\tmoveCount[move.category]++;\r\n\t\t\t\tmoveCount['Offense']++;\r\n\t\t\t\tif (move.id === 'knockoff') {\r\n\t\t\t\t\tmoveCount['Support']++;\r\n\t\t\t\t}\r\n\t\t\t\tif (['scald', 'voltswitch', 'uturn', 'flipturn'].includes(move.id)) {\r\n\t\t\t\t\tmoveCount[move.category] -= 0.2;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (hasMove['batonpass']) moveCount['Support'] += moveCount['Setup'];\r\n\t\tmoveCount['PhysicalAttack'] = moveCount['Physical'];\r\n\t\tmoveCount['Physical'] += moveCount['PhysicalSetup'];\r\n\t\tmoveCount['SpecialAttack'] = moveCount['Special'];\r\n\t\tmoveCount['Special'] += moveCount['SpecialSetup'];\r\n\r\n\t\tif (hasMove['dragondance'] || hasMove['quiverdance']) moveCount['Ultrafast'] = 1;\r\n\r\n\t\tlet isFast = (stats.spe >= 80);\r\n\t\tlet physicalBulk = (stats.hp + 75) * (stats.def + 87);\r\n\t\tlet specialBulk = (stats.hp + 75) * (stats.spd + 87);\r\n\r\n\t\tif (hasMove['willowisp'] || hasMove['acidarmor'] || hasMove['irondefense'] || hasMove['cottonguard']) {\r\n\t\t\tphysicalBulk *= 1.6;\r\n\t\t\tmoveCount['PhysicalStall']++;\r\n\t\t} else if (hasMove['scald'] || hasMove['bulkup'] || hasMove['coil'] || hasMove['cosmicpower']) {\r\n\t\t\tphysicalBulk *= 1.3;\r\n\t\t\tif (hasMove['scald']) { // partial stall goes in reverse\r\n\t\t\t\tmoveCount['SpecialStall']++;\r\n\t\t\t} else {\r\n\t\t\t\tmoveCount['PhysicalStall']++;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (abilityid === 'flamebody') physicalBulk *= 1.1;\r\n\r\n\t\tif (hasMove['calmmind'] || hasMove['quiverdance'] || hasMove['geomancy']) {\r\n\t\t\tspecialBulk *= 1.3;\r\n\t\t\tmoveCount['SpecialStall']++;\r\n\t\t}\r\n\t\tif (abilityid === 'sandstream' && species.types.includes('Rock')) {\r\n\t\t\tspecialBulk *= 1.5;\r\n\t\t}\r\n\r\n\t\tif (hasMove['bellydrum']) {\r\n\t\t\tphysicalBulk *= 0.6;\r\n\t\t\tspecialBulk *= 0.6;\r\n\t\t}\r\n\t\tif (moveCount['Restoration']) {\r\n\t\t\tphysicalBulk *= 1.5;\r\n\t\t\tspecialBulk *= 1.5;\r\n\t\t} else if (hasMove['painsplit'] && hasMove['substitute']) {\r\n\t\t\t// SubSplit isn't generally a stall set\r\n\t\t\tmoveCount['Stall']--;\r\n\t\t} else if (hasMove['painsplit'] || hasMove['rest']) {\r\n\t\t\tphysicalBulk *= 1.4;\r\n\t\t\tspecialBulk *= 1.4;\r\n\t\t}\r\n\t\tif ((hasMove['bodyslam'] || hasMove['thunder']) && abilityid === 'serenegrace' || hasMove['thunderwave']) {\r\n\t\t\tphysicalBulk *= 1.1;\r\n\t\t\tspecialBulk *= 1.1;\r\n\t\t}\r\n\t\tif ((hasMove['ironhead'] || hasMove['airslash']) && abilityid === 'serenegrace') {\r\n\t\t\tphysicalBulk *= 1.1;\r\n\t\t\tspecialBulk *= 1.1;\r\n\t\t}\r\n\t\tif (hasMove['gigadrain'] || hasMove['drainpunch'] || hasMove['hornleech']) {\r\n\t\t\tphysicalBulk *= 1.15;\r\n\t\t\tspecialBulk *= 1.15;\r\n\t\t}\r\n\t\tif (itemid === 'leftovers' || itemid === 'blacksludge') {\r\n\t\t\tphysicalBulk *= 1 + 0.1 * (1 + moveCount['Stall'] / 1.5);\r\n\t\t\tspecialBulk *= 1 + 0.1 * (1 + moveCount['Stall'] / 1.5);\r\n\t\t}\r\n\t\tif (hasMove['leechseed']) {\r\n\t\t\tphysicalBulk *= 1 + 0.1 * (1 + moveCount['Stall'] / 1.5);\r\n\t\t\tspecialBulk *= 1 + 0.1 * (1 + moveCount['Stall'] / 1.5);\r\n\t\t}\r\n\t\tif ((itemid === 'flameorb' || itemid === 'toxicorb') && abilityid !== 'magicguard') {\r\n\t\t\tif (itemid === 'toxicorb' && abilityid === 'poisonheal') {\r\n\t\t\t\tphysicalBulk *= 1 + 0.1 * (2 + moveCount['Stall']);\r\n\t\t\t\tspecialBulk *= 1 + 0.1 * (2 + moveCount['Stall']);\r\n\t\t\t} else {\r\n\t\t\t\tphysicalBulk *= 0.8;\r\n\t\t\t\tspecialBulk *= 0.8;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (itemid === 'lifeorb') {\r\n\t\t\tphysicalBulk *= 0.7;\r\n\t\t\tspecialBulk *= 0.7;\r\n\t\t}\r\n\t\tif (abilityid === 'multiscale' || abilityid === 'magicguard' || abilityid === 'regenerator') {\r\n\t\t\tphysicalBulk *= 1.4;\r\n\t\t\tspecialBulk *= 1.4;\r\n\t\t}\r\n\t\tif (itemid === 'eviolite') {\r\n\t\t\tphysicalBulk *= 1.5;\r\n\t\t\tspecialBulk *= 1.5;\r\n\t\t}\r\n\t\tif (itemid === 'assaultvest') {\r\n\t\t\tspecialBulk *= 1.5;\r\n\t\t}\r\n\r\n\t\tlet bulk = physicalBulk + specialBulk;\r\n\t\tif (bulk < 46000 && stats.spe >= 70) isFast = true;\r\n\t\tif (hasMove['trickroom']) isFast = false;\r\n\t\tmoveCount['bulk'] = bulk;\r\n\t\tmoveCount['physicalBulk'] = physicalBulk;\r\n\t\tmoveCount['specialBulk'] = specialBulk;\r\n\r\n\t\tif (\r\n\t\t\thasMove['agility'] || hasMove['dragondance'] || hasMove['quiverdance'] ||\r\n\t\t\thasMove['rockpolish'] || hasMove['shellsmash'] || hasMove['flamecharge']\r\n\t\t) {\r\n\t\t\tisFast = true;\r\n\t\t} else if (abilityid === 'unburden' || abilityid === 'speedboost' || abilityid === 'motordrive') {\r\n\t\t\tisFast = true;\r\n\t\t\tmoveCount['Ultrafast'] = 1;\r\n\t\t} else if (abilityid === 'chlorophyll' || abilityid === 'swiftswim' || abilityid === 'sandrush') {\r\n\t\t\tisFast = true;\r\n\t\t\tmoveCount['Ultrafast'] = 2;\r\n\t\t} else if (itemid === 'salacberry') {\r\n\t\t\tisFast = true;\r\n\t\t}\r\n\t\tconst ultrafast = hasMove['agility'] || hasMove['shellsmash'] ||\r\n\t\t\thasMove['autotomize'] || hasMove['shiftgear'] || hasMove['rockpolish'];\r\n\t\tif (ultrafast) {\r\n\t\t\tmoveCount['Ultrafast'] = 2;\r\n\t\t}\r\n\t\tmoveCount['Fast'] = isFast ? 1 : 0;\r\n\r\n\t\tthis.moveCount = moveCount;\r\n\t\tthis.hasMove = hasMove;\r\n\r\n\t\tif (species.id === 'ditto') return abilityid === 'imposter' ? 'Physically Defensive' : 'Fast Bulky Support';\r\n\t\tif (species.id === 'shedinja') return 'Fast Physical Sweeper';\r\n\r\n\t\tif (itemid === 'choiceband' && moveCount['PhysicalAttack'] >= 2) {\r\n\t\t\tif (!isFast) return 'Bulky Band';\r\n\t\t\treturn 'Fast Band';\r\n\t\t} else if (itemid === 'choicespecs' && moveCount['SpecialAttack'] >= 2) {\r\n\t\t\tif (!isFast) return 'Bulky Specs';\r\n\t\t\treturn 'Fast Specs';\r\n\t\t} else if (itemid === 'choicescarf') {\r\n\t\t\tif (moveCount['PhysicalAttack'] === 0) return 'Special Scarf';\r\n\t\t\tif (moveCount['SpecialAttack'] === 0) return 'Physical Scarf';\r\n\t\t\tif (moveCount['PhysicalAttack'] > moveCount['SpecialAttack']) return 'Physical Biased Mixed Scarf';\r\n\t\t\tif (moveCount['PhysicalAttack'] < moveCount['SpecialAttack']) return 'Special Biased Mixed Scarf';\r\n\t\t\tif (stats.atk < stats.spa) return 'Special Biased Mixed Scarf';\r\n\t\t\treturn 'Physical Biased Mixed Scarf';\r\n\t\t}\r\n\r\n\t\tif (species.id === 'unown') return 'Fast Special Sweeper';\r\n\r\n\t\tif (moveCount['PhysicalStall'] && moveCount['Restoration']) {\r\n\t\t\tif (stats.spe > 110 && abilityid !== 'prankster') return 'Fast Bulky Support';\r\n\t\t\treturn 'Specially Defensive';\r\n\t\t}\r\n\t\tif (moveCount['SpecialStall'] && moveCount['Restoration'] && itemid !== 'lifeorb') {\r\n\t\t\tif (stats.spe > 110 && abilityid !== 'prankster') return 'Fast Bulky Support';\r\n\t\t\treturn 'Physically Defensive';\r\n\t\t}\r\n\r\n\t\tlet offenseBias: 'Physical' | 'Special' = 'Physical';\r\n\t\tif (stats.spa > stats.atk && moveCount['Special'] > 1) offenseBias = 'Special';\r\n\t\telse if (stats.atk > stats.spa && moveCount['Physical'] > 1) offenseBias = 'Physical';\r\n\t\telse if (moveCount['Special'] > moveCount['Physical']) offenseBias = 'Special';\r\n\r\n\t\tif (moveCount['Stall'] + moveCount['Support'] / 2 <= 2 && bulk < 135000 && moveCount[offenseBias] >= 1.5) {\r\n\t\t\tif (isFast) {\r\n\t\t\t\tif (bulk > 80000 && !moveCount['Ultrafast']) return 'Bulky ' + offenseBias + ' Sweeper';\r\n\t\t\t\treturn 'Fast ' + offenseBias + ' Sweeper';\r\n\t\t\t} else {\r\n\t\t\t\tif (moveCount[offenseBias] >= 3 || moveCount['Stall'] <= 0) {\r\n\t\t\t\t\treturn 'Bulky ' + offenseBias + ' Sweeper';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (isFast && abilityid !== 'prankster') {\r\n\t\t\tif (stats.spe > 100 || bulk < 55000 || moveCount['Ultrafast']) {\r\n\t\t\t\treturn 'Fast Bulky Support';\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (moveCount['SpecialStall']) return 'Physically Defensive';\r\n\t\tif (moveCount['PhysicalStall']) return 'Specially Defensive';\r\n\t\tif (species.id === 'blissey' || species.id === 'chansey') return 'Physically Defensive';\r\n\t\tif (specialBulk >= physicalBulk) return 'Specially Defensive';\r\n\t\treturn 'Physically Defensive';\r\n\t}\r\n\tensureMinEVs(evs: StatsTable, stat: StatName, min: number, evTotal: number) {\r\n\t\tif (!evs[stat]) evs[stat] = 0;\r\n\t\tlet diff = min - evs[stat];\r\n\t\tif (diff <= 0) return evTotal;\r\n\t\tif (evTotal <= 504) {\r\n\t\t\tlet change = Math.min(508 - evTotal, diff);\r\n\t\t\tevTotal += change;\r\n\t\t\tevs[stat] += change;\r\n\t\t\tdiff -= change;\r\n\t\t}\r\n\t\tif (diff <= 0) return evTotal;\r\n\t\tlet evPriority = {def: 1, spd: 1, hp: 1, atk: 1, spa: 1, spe: 1};\r\n\t\tlet prioStat: StatName;\r\n\t\tfor (prioStat in evPriority) {\r\n\t\t\tif (prioStat === stat) continue;\r\n\t\t\tif (evs[prioStat] && evs[prioStat] > 128) {\r\n\t\t\t\tevs[prioStat] -= diff;\r\n\t\t\t\tevs[stat] += diff;\r\n\t\t\t\treturn evTotal;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn evTotal; // can't do it :(\r\n\t}\r\n\tensureMaxEVs(evs: StatsTable, stat: StatName, min: number, evTotal: number) {\r\n\t\tif (!evs[stat]) evs[stat] = 0;\r\n\t\tlet diff = evs[stat] - min;\r\n\t\tif (diff <= 0) return evTotal;\r\n\t\tevs[stat] -= diff;\r\n\t\tevTotal -= diff;\r\n\t\treturn evTotal; // can't do it :(\r\n\t}\r\n\tguessEVs(set: PokemonSet, role: string): Partial<StatsTable> & {plusStat?: StatName | '', minusStat?: StatName | ''} {\r\n\t\tif (!set) return {};\r\n\t\tif (role === '?') return {};\r\n\t\tlet species = this.dex.species.get(set.species || set.name!);\r\n\t\tlet stats = species.baseStats;\r\n\r\n\t\tlet hasMove = this.hasMove;\r\n\t\tlet moveCount = this.moveCount;\r\n\r\n\t\tlet evs: StatsTable & {plusStat?: StatName | '', minusStat?: StatName | ''} = {\r\n\t\t\thp: 0, atk: 0, def: 0, spa: 0, spd: 0, spe: 0,\r\n\t\t};\r\n\t\tlet plusStat: StatName | '' = '';\r\n\t\tlet minusStat: StatName | '' = '';\r\n\r\n\t\tlet statChart: {[role: string]: [StatName, StatName]} = {\r\n\t\t\t'Bulky Band': ['atk', 'hp'],\r\n\t\t\t'Fast Band': ['spe', 'atk'],\r\n\t\t\t'Bulky Specs': ['spa', 'hp'],\r\n\t\t\t'Fast Specs': ['spe', 'spa'],\r\n\t\t\t'Physical Scarf': ['spe', 'atk'],\r\n\t\t\t'Special Scarf': ['spe', 'spa'],\r\n\t\t\t'Physical Biased Mixed Scarf': ['spe', 'atk'],\r\n\t\t\t'Special Biased Mixed Scarf': ['spe', 'spa'],\r\n\t\t\t'Fast Physical Sweeper': ['spe', 'atk'],\r\n\t\t\t'Fast Special Sweeper': ['spe', 'spa'],\r\n\t\t\t'Bulky Physical Sweeper': ['atk', 'hp'],\r\n\t\t\t'Bulky Special Sweeper': ['spa', 'hp'],\r\n\t\t\t'Fast Bulky Support': ['spe', 'hp'],\r\n\t\t\t'Physically Defensive': ['def', 'hp'],\r\n\t\t\t'Specially Defensive': ['spd', 'hp'],\r\n\t\t};\r\n\r\n\t\tplusStat = statChart[role][0];\r\n\t\tif (role === 'Fast Bulky Support') moveCount['Ultrafast'] = 0;\r\n\t\tif (plusStat === 'spe' && moveCount['Ultrafast']) {\r\n\t\t\tif (statChart[role][1] === 'atk' || statChart[role][1] === 'spa') {\r\n\t\t\t\tplusStat = statChart[role][1];\r\n\t\t\t} else if (moveCount['Physical'] >= 3) {\r\n\t\t\t\tplusStat = 'atk';\r\n\t\t\t} else if (stats.spd > stats.def) {\r\n\t\t\t\tplusStat = 'spd';\r\n\t\t\t} else {\r\n\t\t\t\tplusStat = 'def';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.supportsAVs) {\r\n\t\t\t// Let's Go, AVs enabled\r\n\t\t\tevs = {hp: 200, atk: 200, def: 200, spa: 200, spd: 200, spe: 200};\r\n\t\t\tif (!moveCount['PhysicalAttack']) evs.atk = 0;\r\n\t\t\tif (!moveCount['SpecialAttack']) evs.spa = 0;\r\n\t\t\tif (hasMove['gyroball'] || hasMove['trickroom']) evs.spe = 0;\r\n\t\t} else if (!this.supportsEVs) {\r\n\t\t\t// Let's Go, AVs disabled\r\n\t\t\t// no change\r\n\t\t} else if (this.ignoreEVLimits) {\r\n\t\t\t// Gen 1-2, hackable EVs (like Hackmons)\r\n\t\t\tevs = {hp: 252, atk: 252, def: 252, spa: 252, spd: 252, spe: 252};\r\n\t\t\tif (!moveCount['PhysicalAttack']) evs.atk = 0;\r\n\t\t\tif (!moveCount['SpecialAttack'] && this.dex.gen > 1) evs.spa = 0;\r\n\t\t\tif (hasMove['gyroball'] || hasMove['trickroom']) evs.spe = 0;\r\n\t\t\tif (this.dex.gen === 1) evs.spd = 0;\r\n\t\t\tif (this.dex.gen < 3) return evs;\r\n\t\t} else {\r\n\t\t\t// Normal Gen 3-7\r\n\t\t\tif (!statChart[role]) return {};\r\n\r\n\t\t\tlet evTotal = 0;\r\n\r\n\t\t\tlet primaryStat = statChart[role][0];\r\n\t\t\tlet stat = this.getStat(primaryStat, set, 252, plusStat === primaryStat ? 1.1 : 1.0);\r\n\t\t\tlet ev = 252;\r\n\t\t\twhile (ev > 0 && stat <= this.getStat(primaryStat, set, ev - 4, plusStat === primaryStat ? 1.1 : 1.0)) ev -= 4;\r\n\t\t\tevs[primaryStat] = ev;\r\n\t\t\tevTotal += ev;\r\n\r\n\t\t\tlet secondaryStat: StatName | null = statChart[role][1];\r\n\t\t\tif (secondaryStat === 'hp' && set.level && set.level < 20) secondaryStat = 'spd';\r\n\t\t\tstat = this.getStat(secondaryStat, set, 252, plusStat === secondaryStat ? 1.1 : 1.0);\r\n\t\t\tev = 252;\r\n\t\t\twhile (ev > 0 && stat <= this.getStat(secondaryStat, set, ev - 4, plusStat === secondaryStat ? 1.1 : 1.0)) ev -= 4;\r\n\t\t\tevs[secondaryStat] = ev;\r\n\t\t\tevTotal += ev;\r\n\r\n\t\t\tlet SRweaknesses = ['Fire', 'Flying', 'Bug', 'Ice'];\r\n\t\t\tlet SRresistances = ['Ground', 'Steel', 'Fighting'];\r\n\t\t\tlet SRweak = 0;\r\n\t\t\tif (set.ability !== 'Magic Guard' && set.ability !== 'Mountaineer') {\r\n\t\t\t\tif (SRweaknesses.indexOf(species.types[0]) >= 0) {\r\n\t\t\t\t\tSRweak++;\r\n\t\t\t\t} else if (SRresistances.indexOf(species.types[0]) >= 0) {\r\n\t\t\t\t\tSRweak--;\r\n\t\t\t\t}\r\n\t\t\t\tif (SRweaknesses.indexOf(species.types[1]) >= 0) {\r\n\t\t\t\t\tSRweak++;\r\n\t\t\t\t} else if (SRresistances.indexOf(species.types[1]) >= 0) {\r\n\t\t\t\t\tSRweak--;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlet hpDivisibility = 0;\r\n\t\t\tlet hpShouldBeDivisible = false;\r\n\t\t\tlet hp = evs['hp'] || 0;\r\n\t\t\tstat = this.getStat('hp', set, hp, 1);\r\n\t\t\tif ((set.item === 'Leftovers' || set.item === 'Black Sludge') && hasMove['substitute'] && stat !== 404) {\r\n\t\t\t\thpDivisibility = 4;\r\n\t\t\t} else if (set.item === 'Leftovers' || set.item === 'Black Sludge') {\r\n\t\t\t\thpDivisibility = 0;\r\n\t\t\t} else if (hasMove['bellydrum'] && (set.item || '').slice(-5) === 'Berry') {\r\n\t\t\t\thpDivisibility = 2;\r\n\t\t\t\thpShouldBeDivisible = true;\r\n\t\t\t} else if (hasMove['substitute'] && (set.item || '').slice(-5) === 'Berry') {\r\n\t\t\t\thpDivisibility = 4;\r\n\t\t\t\thpShouldBeDivisible = true;\r\n\t\t\t} else if (SRweak >= 2 || hasMove['bellydrum']) {\r\n\t\t\t\thpDivisibility = 2;\r\n\t\t\t} else if (SRweak >= 1 || hasMove['substitute'] || hasMove['transform']) {\r\n\t\t\t\thpDivisibility = 4;\r\n\t\t\t} else if (set.ability !== 'Magic Guard') {\r\n\t\t\t\thpDivisibility = 8;\r\n\t\t\t}\r\n\r\n\t\t\tif (hpDivisibility) {\r\n\t\t\t\twhile (hp < 252 && evTotal < 508 && !(stat % hpDivisibility) !== hpShouldBeDivisible) {\r\n\t\t\t\t\thp += 4;\r\n\t\t\t\t\tstat = this.getStat('hp', set, hp, 1);\r\n\t\t\t\t\tevTotal += 4;\r\n\t\t\t\t}\r\n\t\t\t\twhile (hp > 0 && !(stat % hpDivisibility) !== hpShouldBeDivisible) {\r\n\t\t\t\t\thp -= 4;\r\n\t\t\t\t\tstat = this.getStat('hp', set, hp, 1);\r\n\t\t\t\t\tevTotal -= 4;\r\n\t\t\t\t}\r\n\t\t\t\twhile (hp > 0 && stat === this.getStat('hp', set, hp - 4, 1)) {\r\n\t\t\t\t\thp -= 4;\r\n\t\t\t\t\tevTotal -= 4;\r\n\t\t\t\t}\r\n\t\t\t\tif (hp || evs['hp']) evs['hp'] = hp;\r\n\t\t\t}\r\n\r\n\t\t\tif (species.id === 'tentacruel') {\r\n\t\t\t\tevTotal = this.ensureMinEVs(evs, 'spe', 16, evTotal);\r\n\t\t\t} else if (species.id === 'skarmory') {\r\n\t\t\t\tevTotal = this.ensureMinEVs(evs, 'spe', 24, evTotal);\r\n\t\t\t} else if (species.id === 'jirachi') {\r\n\t\t\t\tevTotal = this.ensureMinEVs(evs, 'spe', 32, evTotal);\r\n\t\t\t} else if (species.id === 'celebi') {\r\n\t\t\t\tevTotal = this.ensureMinEVs(evs, 'spe', 36, evTotal);\r\n\t\t\t} else if (species.id === 'volcarona') {\r\n\t\t\t\tevTotal = this.ensureMinEVs(evs, 'spe', 52, evTotal);\r\n\t\t\t} else if (species.id === 'gliscor') {\r\n\t\t\t\tevTotal = this.ensureMinEVs(evs, 'spe', 72, evTotal);\r\n\t\t\t} else if (species.id === 'dragonite' && evs['hp']) {\r\n\t\t\t\tevTotal = this.ensureMaxEVs(evs, 'spe', 220, evTotal);\r\n\t\t\t}\r\n\r\n\t\t\tif (evTotal < 508) {\r\n\t\t\t\tlet remaining = 508 - evTotal;\r\n\t\t\t\tif (remaining > 252) remaining = 252;\r\n\t\t\t\tsecondaryStat = null;\r\n\t\t\t\tif (!evs['atk'] && moveCount['PhysicalAttack'] >= 1) {\r\n\t\t\t\t\tsecondaryStat = 'atk';\r\n\t\t\t\t} else if (!evs['spa'] && moveCount['SpecialAttack'] >= 1) {\r\n\t\t\t\t\tsecondaryStat = 'spa';\r\n\t\t\t\t} else if (stats.hp === 1 && !evs['def']) {\r\n\t\t\t\t\tsecondaryStat = 'def';\r\n\t\t\t\t} else if (stats.def === stats.spd && !evs['spd']) {\r\n\t\t\t\t\tsecondaryStat = 'spd';\r\n\t\t\t\t} else if (!evs['spd']) {\r\n\t\t\t\t\tsecondaryStat = 'spd';\r\n\t\t\t\t} else if (!evs['def']) {\r\n\t\t\t\t\tsecondaryStat = 'def';\r\n\t\t\t\t}\r\n\t\t\t\tif (secondaryStat) {\r\n\t\t\t\t\tev = remaining;\r\n\t\t\t\t\tstat = this.getStat(secondaryStat, set, ev);\r\n\t\t\t\t\twhile (ev > 0 && stat === this.getStat(secondaryStat, set, ev - 4)) ev -= 4;\r\n\t\t\t\t\tif (ev) evs[secondaryStat] = ev;\r\n\t\t\t\t\tremaining -= ev;\r\n\t\t\t\t}\r\n\t\t\t\tif (remaining && !evs['spe']) {\r\n\t\t\t\t\tev = remaining;\r\n\t\t\t\t\tstat = this.getStat('spe', set, ev);\r\n\t\t\t\t\twhile (ev > 0 && stat === this.getStat('spe', set, ev - 4)) ev -= 4;\r\n\t\t\t\t\tif (ev) evs['spe'] = ev;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif (hasMove['gyroball'] || hasMove['trickroom']) {\r\n\t\t\tminusStat = 'spe';\r\n\t\t} else if (!moveCount['PhysicalAttack']) {\r\n\t\t\tminusStat = 'atk';\r\n\t\t} else if (moveCount['SpecialAttack'] < 1 && !evs['spa']) {\r\n\t\t\tif (moveCount['SpecialAttack'] < moveCount['PhysicalAttack']) {\r\n\t\t\t\tminusStat = 'spa';\r\n\t\t\t} else if (!evs['atk']) {\r\n\t\t\t\tminusStat = 'atk';\r\n\t\t\t}\r\n\t\t} else if (moveCount['PhysicalAttack'] < 1 && !evs['atk']) {\r\n\t\t\tminusStat = 'atk';\r\n\t\t} else if (stats.def > stats.spe && stats.spd > stats.spe && !evs['spe']) {\r\n\t\t\tminusStat = 'spe';\r\n\t\t} else if (stats.def > stats.spd) {\r\n\t\t\tminusStat = 'spd';\r\n\t\t} else {\r\n\t\t\tminusStat = 'def';\r\n\t\t}\r\n\r\n\t\tif (plusStat === minusStat) {\r\n\t\t\tminusStat = (plusStat === 'spe' ? 'spd' : 'spe');\r\n\t\t}\r\n\r\n\t\tevs.plusStat = plusStat;\r\n\t\tevs.minusStat = minusStat;\r\n\r\n\t\treturn evs;\r\n\t}\r\n\r\n\tgetStat(stat: StatName, set: PokemonSet, evOverride?: number, natureOverride?: number) {\r\n\t\tlet species = this.dex.species.get(set.species);\r\n\t\tif (!species.exists) return 0;\r\n\r\n\t\tlet level = set.level || 120;\r\n\r\n\t\tlet baseStat = species.baseStats[stat];\r\n\r\n\t\tlet iv = (set.ivs && set.ivs[stat]);\r\n\t\tif (typeof iv !== 'number') iv = 31;\r\n\t\tif (this.dex.gen <= 2) iv &= 30;\r\n\r\n\t\tlet ev = (set.evs && set.evs[stat]);\r\n\t\tif (typeof ev !== 'number') ev = (this.dex.gen > 2 ? 0 : 252);\r\n\t\tif (evOverride !== undefined) ev = evOverride;\r\n\r\n\t\tif (stat === 'hp') {\r\n\t\t\tif (baseStat === 1) return 1;\r\n\t\t\tif (!this.supportsEVs) return ~~(~~(2 * baseStat + iv + 100) * level / 100 + 10) + (this.supportsAVs ? ev : 0);\r\n\t\t\treturn ~~(~~(2 * baseStat + iv + ~~(ev / 4) + 100) * level / 100 + 10);\r\n\t\t}\r\n\t\tlet val = ~~(~~(2 * baseStat + iv + ~~(ev / 4)) * level / 100 + 5);\r\n\t\tif (!this.supportsEVs) {\r\n\t\t\tval = ~~(~~(2 * baseStat + iv) * level / 100 + 5);\r\n\t\t}\r\n\t\tif (natureOverride) {\r\n\t\t\tval *= natureOverride;\r\n\t\t} else if (BattleNatures[set.nature!]?.plus === stat) {\r\n\t\t\tval *= 1.1;\r\n\t\t} else if (BattleNatures[set.nature!]?.minus === stat) {\r\n\t\t\tval *= 0.9;\r\n\t\t}\r\n\t\tif (!this.supportsEVs) {\r\n\t\t\tlet friendshipValue = ~~((70 / 255 / 10 + 1) * 100);\r\n\t\t\tval = ~~(val) * friendshipValue / 100 + (this.supportsAVs ? ev : 0);\r\n\t\t}\r\n\t\treturn ~~(val);\r\n\t}\r\n}\r\n\r\nif (typeof require === 'function') {\r\n\t// in Node\r\n\t(global as any).BattleStatGuesser = BattleStatGuesser;\r\n}\r\n"],"file":"battle-tooltips.js"}