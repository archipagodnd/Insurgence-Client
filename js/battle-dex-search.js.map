{"version":3,"sources":["../src/battle-dex-search.ts"],"names":["DexSearch","searchType","formatid","species","query","dex","Dex","typedSearch","results","exactMatch","firstPokemonColumn","sortCol","reverseSort","filters","setType","getTypedSearch","format","speciesOrSet","BattlePokemonSearch","BattleItemSearch","BattleMoveSearch","BattleAbilitySearch","BattleTypeSearch","BattleCategorySearch","find","toID","getResults","textSearch","addFilter","entry","type","includes","filter","push","removeFilter","filterid","join","deleted","i","length","splice","pop","toggleSort","filterLabel","filterType","illegalLabel","id","illegalReasons","getTier","searchTypeIndex","typeTable","qFilterType","slice","window","BattleTypeChart","getClosest","BattleSearchIndex","passType","searchPasses","queryAlias","BattleAliases","aliasPassType","unshift","substr","matchLength","matchQuery","bufs","topbufIndex","count","nearMatch","instafilter","instafilterSort","illegal","searchPass","shift","typeIndex","gen","startsWith","matchStart","matchEnd","originalIndex","BattleSearchIndexOffset","charCodeAt","typeName","curBufLength","topbuf","concat","Array","prototype","apply","fType","fId","buf","illegalBuf","charAt","toUpperCase","BattlePokedex","types","get","ability","abilities","name","hasAbility","BattleMovedex","category","left","right","mid","Math","floor","pokemon","tier","move","item","egggroup","article","BattleTypedSearch","set","formatType","baseResults","baseIllegalResults","sortRow","Number","forGen","mod","endsWith","getDefaultResults","call","getBaseResults","legalityFilter","resultType","value","getTable","illegalResults","result","rowType","sort","firstLearnsetid","speciesid","table","BattleTeambuilderTable","learnsets","exists","baseLearnsetid","baseSpecies","battleOnly","nextLearnsetid","learnsetid","lsetSpecies","next","changesFrom","prevo","canLearn","moveid","moves","isNonstandard","genChar","learnset","num","String","tableKey","overrideTier","isVGCOrBS","isDoublesOrBS","tierSet","tiers","map","r","slices","formatSlices","Uber","Regular","OU","UU","RU","NU","PU","ZU","LC","AG","DUber","DOU","DUU","DNU","zuBans","monotypeBans","test","row","eggGroups","sortOrder","rowType1","id1","rowType2","id2","stat1","baseStats","stat2","base1","base2","bst1","hp","atk","def","spa","spd","spe","bst2","name1","name2","Error","BattleAbilities","isHackmons","isAAA","abilitySet","isMega","goodAbilities","poorAbilities","badAbilities","abil","rating","BattleItems","itemSet","items","speciesName","speciesSpecific","itemUser","moveIsNotUseless","abilityid","itemid","weightkg","evos","GOOD_DOUBLES_MOVES","moveData","GOOD_STATUS_MOVES","basePower","GOOD_WEAK_MOVES","flags","charge","recharge","slicing","BAD_STRONG_MOVES","isSTABmons","isTradebacks","regionBornLegality","sketchMoves","sketch","lsetTable","learnsetEntry","minGenCode","nonstandardMoves","noSketch","isMax","isZ","speciesTypes","moveTypes","genDex","prevoSpecies","excludedForme","s","forme","otherFormes","formeName","valid","usableMoves","uselessMoves","isUsable","powerTable","frustration","spitup","trumpcard","naturalgift","grassknot","lowkick","gyroball","electroball","flail","reversal","present","wringout","crushgrip","heatcrash","heavyslam","fling","magnitude","beatup","punishment","psywave","nightshade","seismictoss","dragonrage","sonicboom","superfang","endeavor","sheercold","fissure","horndrill","guillotine","move1","move2","pow1","pow2","accuracy1","accuracy","accuracy2","pp1","pp","pp2","physical","special","status"],"mappings":"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CAC4P,iBAD5P,CAC+Q,YAD/Q,CAC6R,UAD7R,CACyS,OADzS,CACkT,MADlT,CAC0T,UAD1T,CACsU,aADtU,CACqV,WADrV,CACkW,WADlW,CAC+W,WAD/W,CAC4X,aAD5X,CAC2Y,WAD3Y,CACwZ,aADxZ,CACua,YADva,CACqb,YADrb,CACmc,WADnc,CACgd,UADhd,CAC4d,SAD5d,CACue,WADve,CACof,WADpf,CACigB,YADjgB,CAC+gB,WAD/gB,CAC4hB,gBAD5hB,CAC8iB,WAD9iB,CAC2jB,UAD3jB,CACukB,WADvkB,CAColB,aADplB,CACmmB,YADnmB,CACinB,SADjnB,CAC4nB,aAD5nB,CAC2oB,SAD3oB,CACspB,SADtpB,CACiqB,aADjqB,CACgrB,MADhrB,CACwrB,iBADxrB,CAC2sB,MAD3sB,CACmtB,YADntB,CACiuB,OADjuB,CAC0uB,UAD1uB,CACsvB,YADtvB,CACowB,WADpwB,CACixB,SADjxB,CAC4xB,UAD5xB,CACwyB,UADxyB,CACozB,aADpzB,CACm0B,WADn0B,CACg1B,YADh1B,CAC81B,QAD91B,CACw2B,aADx2B,CACu3B,OADv3B,CACg4B,aADh4B,CAC+4B,WAD/4B,CAC45B,aAD55B,CAC26B,YAD36B,CACy7B,YADz7B,CACu8B,aADv8B,CACs9B,WADt9B,CACm+B,UADn+B,CAC++B,UAD/+B,CAC2/B,OAD3/B,CACogC,aADpgC,CACmhC,QADnhC,CAC6hC,OAD7hC,CACsiC,WADtiC,CACmjC,OADnjC,CAC4jC,cAD5jC,CAC4kC,WAD5kC,CACylC,WADzlC,CACsmC,MADtmC,CAC8mC,MAD9mC,CAEnC,UAFmC,CAEvB,YAFuB,CAET,YAFS,CAEK,YAFL,C,CA5P/BrN,gB,CAgQWuN,e,CAAkB,CACjC,YADiC,CACnB,YADmB,CACL,YADK,CACS,WADT,CACsB,aADtB,CACqC,YADrC,CACmD,cADnD,CACmE,aADnE,CACkF,WADlF,CAC+F,eAD/F,CACgH,aADhH,CAC+H,WAD/H,CAC4I,gBAD5I,CAC8J,aAD9J,CAC6K,YAD7K,CAC2L,cAD3L,CAC2M,UAD3M,CACuN,QADvN,CACiO,UADjO,CAC6O,UAD7O,CACyP,aADzP,CACwQ,WADxQ,CACqR,aADrR,CACoS,WADpS,CACiT,WADjT,CAC8T,UAD9T,CAC0U,SAD1U,CACqV,UADrV,CACiW,aADjW,CACgX,gBADhX,CACkY,UADlY,CAC8Y,cAD9Y,CAC8Z,SAD9Z,CACya,WADza,CACsb,YADtb,CACoc,eADpc,CACqd,gBADrd,CACue,YADve,CACqf,QADrf,CAC+f,WAD/f,CAC4gB,gBAD5gB,CAC8hB,WAD9hB,CAC2iB,eAD3iB,CAC4jB,SAD5jB,CACukB,aADvkB,CACslB,UADtlB,CACkmB,WADlmB,CAC+mB,QAD/mB,CACynB,WADznB,CACsoB,WADtoB,CACmpB,UADnpB,CAC+pB,gBAD/pB,CACirB,aADjrB,CACgsB,YADhsB,CAC8sB,aAD9sB,CAC6tB,aAD7tB,CAC4uB,UAD5uB,CACwvB,aADxvB,CACuwB,YADvwB,CACqxB,aADrxB,CACoyB,WADpyB,CACizB,gBADjzB,CACm0B,UADn0B,CAC+0B,YAD/0B,CAC61B,YAD71B,CAC22B,YAD32B,CACy3B,UADz3B,CACq4B,OADr4B,CAC84B,cAD94B,CAC85B,YAD95B,CAC46B,eAD56B,CAC67B,aAD77B,CAEjC,cAFiC,CAEjB,SAFiB,CAEN,aAFM,CAES,UAFT,CAEqB,UAFrB,C,CAhQ7BvN,gB,CAoQW4N,gB,CAAmB,CAClC,OADkC,CACzB,QADyB,CACf,WADe,CACF,YADE,CACY,YADZ,CAC0B,SAD1B,CACqC,YADrC,CACmD,aADnD,CACkE,aADlE,CACiF,WADjF,CAC8F,WAD9F,CAC2G,gBAD3G,CAC6H,SAD7H,CACwI,YADxI,CACsJ,UADtJ,CACkK,WADlK,CAC+K,gBAD/K,CACiM,YADjM,CAC+M,WAD/M,CAC4N,YAD5N,CAC0O,WAD1O,CACuP,cADvP,CACuQ,WADvQ,CACoR,aADpR,CACmS,MADnS,CAC2S,UAD3S,CACuT,YADvT,CACqU,cADrU,CACqV,UADrV,CACiW,QADjW,CAC2W,QAD3W,CACqX,aADrX,CAElC,YAFkC,C,CApQ9B5N,gB,CAwQWmN,kB,CAAqB,CACpC,YADoC,CACtB,UADsB,CACV,UADU,CACE,YADF,CACgB,WADhB,CAC6B,OAD7B,CACsC,UADtC,CACkD,WADlD,CAC+D,aAD/D,CAC8E,eAD9E,CAC+F,SAD/F,CAC0G,eAD1G,CAC2H,YAD3H,CACyI,YADzI,CACuJ,SADvJ,CACkK,YADlK,CACgL,WADhL,CAC6L,WAD7L,CAC0M,WAD1M,CACuN,WADvN,CAEpC,UAFoC,C;;;AA+NhChN,oB;AACL6G,Q,CAAA,mBAAW;AACV,MAAO,CAAC+K,QAAQ,CAAE,CAAX,CAAcC,OAAO,CAAE,CAAvB,CAA0BC,MAAM,CAAE,CAAlC,CAAP;AACA,C;AACDvL,iB,CAAA,4BAAiC;AAChC,MAAO;AACN,CAAC,UAAD,CAAa,UAAb,CADM;AAEN,CAAC,UAAD,CAAa,SAAb,CAFM;AAGN,CAAC,UAAD,CAAa,QAAb,CAHM,CAAP;;AAKA,C;AACDE,c,CAAA,yBAAiB;AAChB,MAAO,MAAKF,iBAAL,EAAP;AACA,C;AACD9F,M,CAAA,gBAAO2J,GAAP,CAAuB9K,OAAvB,CAAqD;AACpD,KAAM,IAAIoM,CAAAA,KAAJ,CAAU,gBAAV,CAAN;AACA,C;AACDzE,I,CAAA,cAAKhI,OAAL,CAA2BG,OAA3B,CAAmDC,WAAnD,CAAuF;AACtF,KAAM,IAAIqM,CAAAA,KAAJ,CAAU,iBAAV,CAAN;AACA,C,+BAnBiC7F,iB;;;AAsB7B9F,gB;AACL8G,Q,CAAA,mBAAW;AACV,MAAO/E,CAAAA,MAAM,CAACC,eAAd;AACA,C;AACDwE,iB,CAAA,4BAAiC;AAChC,GAAMtH,CAAAA,OAAoB,CAAG,EAA7B;AACA,IAAK,GAAIsC,CAAAA,KAAT,GAAeO,CAAAA,MAAM,CAACC,eAAtB,CAAuC;AACtC9C,OAAO,CAACyB,IAAR,CAAa,CAAC,MAAD,CAASa,KAAT,CAAb;AACA;AACD,MAAOtC,CAAAA,OAAP;AACA,C;AACDwH,c,CAAA,yBAAiB;AAChB,MAAO,MAAKF,iBAAL,EAAP;AACA,C;AACD9F,M,CAAA,gBAAO2J,GAAP,CAAuB9K,OAAvB,CAAqD;AACpD,KAAM,IAAIoM,CAAAA,KAAJ,CAAU,gBAAV,CAAN;AACA,C;AACDzE,I,CAAA,cAAKhI,OAAL,CAA2BG,OAA3B,CAAmDC,WAAnD,CAAuF;AACtF,KAAM,IAAIqM,CAAAA,KAAJ,CAAU,iBAAV,CAAN;AACA,C,2BAnB6B7F,iB","sourcesContent":["/**\r\n * Search\r\n *\r\n * Code for searching for dex information, used by the Dex and\r\n * Teambuilder.\r\n *\r\n * Dependencies: battledata, search-index\r\n * Optional dependencies: pokedex, moves, items, abilities\r\n *\r\n * @author Guangcong Luo <guangcongluo@gmail.com>\r\n * @license MIT\r\n */\r\n\r\ntype SearchType = (\r\n\t'pokemon' | 'type' | 'tier' | 'move' | 'item' | 'ability' | 'egggroup' | 'category' | 'article'\r\n);\r\n\r\ntype SearchRow = (\r\n\t[SearchType, ID, number?, number?] | ['sortpokemon' | 'sortmove', ''] | ['header' | 'html', string]\r\n);\r\n\r\ntype SearchFilter = [string, string];\r\n\r\n/** ID, SearchType, index (if alias), offset (if offset alias) */\r\ndeclare const BattleSearchIndex: [ID, SearchType, number?, number?][];\r\ndeclare const BattleSearchIndexOffset: any;\r\ndeclare const BattleTeambuilderTable: any;\r\n\r\n/**\r\n * Backend for search UIs.\r\n */\r\nclass DexSearch {\r\n\tquery = '';\r\n\r\n\t/**\r\n\t * Dex for the mod/generation to search.\r\n\t */\r\n\tdex: ModdedDex = Dex;\r\n\r\n\ttypedSearch: BattleTypedSearch<SearchType> | null = null;\r\n\r\n\tresults: SearchRow[] | null = null;\r\n\texactMatch = false;\r\n\r\n\tstatic typeTable = {\r\n\t\tpokemon: 1,\r\n\t\ttype: 2,\r\n\t\ttier: 3,\r\n\t\tmove: 4,\r\n\t\titem: 5,\r\n\t\tability: 6,\r\n\t\tegggroup: 7,\r\n\t\tcategory: 8,\r\n\t\tarticle: 9,\r\n\t};\r\n\tstatic typeName = {\r\n\t\tpokemon: 'Pok&eacute;mon',\r\n\t\ttype: 'Type',\r\n\t\ttier: 'Tiers',\r\n\t\tmove: 'Moves',\r\n\t\titem: 'Items',\r\n\t\tability: 'Abilities',\r\n\t\tegggroup: 'Egg group',\r\n\t\tcategory: 'Category',\r\n\t\tarticle: 'Article',\r\n\t};\r\n\tfirstPokemonColumn: 'Tier' | 'Number' = 'Number';\r\n\r\n\t/**\r\n\t * Column to sort by. Default is `null`, a smart sort determined by how good\r\n\t * things are according to the base filters, falling back to dex number (for\r\n\t * Pokemon) and name (for everything else).\r\n\t */\r\n\tsortCol: string | null = null;\r\n\treverseSort = false;\r\n\r\n\t/**\r\n\t * Filters for the search result. Does not include the two base filters\r\n\t * (format and species).\r\n\t */\r\n\tfilters: SearchFilter[] | null = null;\r\n\r\n\tconstructor(searchType: SearchType | '' = '', formatid = '' as ID, species = '' as ID) {\r\n\t\tthis.setType(searchType, formatid, species);\r\n\t}\r\n\r\n\tgetTypedSearch(searchType: SearchType | '', format = '' as ID, speciesOrSet: ID | PokemonSet = '' as ID) {\r\n\t\tif (!searchType) return null;\r\n\t\tswitch (searchType) {\r\n\t\tcase 'pokemon': return new BattlePokemonSearch('pokemon', format, speciesOrSet);\r\n\t\tcase 'item': return new BattleItemSearch('item', format, speciesOrSet);\r\n\t\tcase 'move': return new BattleMoveSearch('move', format, speciesOrSet);\r\n\t\tcase 'ability': return new BattleAbilitySearch('ability', format, speciesOrSet);\r\n\t\tcase 'type': return new BattleTypeSearch('type', format, speciesOrSet);\r\n\t\tcase 'category': return new BattleCategorySearch('category', format, speciesOrSet);\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tfind(query: string) {\r\n\t\tquery = toID(query);\r\n\t\tif (this.query === query && this.results) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tthis.query = query;\r\n\t\tif (!query) {\r\n\t\t\tthis.results = this.typedSearch?.getResults(this.filters, this.sortCol, this.reverseSort) || [];\r\n\t\t} else {\r\n\t\t\tthis.results = this.textSearch(query);\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\tsetType(searchType: SearchType | '', format = '' as ID, speciesOrSet: ID | PokemonSet = '' as ID) {\r\n\t\t// invalidate caches\r\n\t\tthis.results = null;\r\n\r\n\t\tif (searchType !== this.typedSearch?.searchType) {\r\n\t\t\tthis.filters = null;\r\n\t\t\tthis.sortCol = null;\r\n\t\t}\r\n\t\tthis.typedSearch = this.getTypedSearch(searchType, format, speciesOrSet);\r\n\t\tif (this.typedSearch) this.dex = this.typedSearch.dex;\r\n\t}\r\n\r\n\taddFilter(entry: SearchFilter): boolean {\r\n\t\tif (!this.typedSearch) return false;\r\n\t\tlet [type] = entry;\r\n\t\tif (this.typedSearch.searchType === 'pokemon') {\r\n\t\t\tif (type === this.sortCol) this.sortCol = null;\r\n\t\t\tif (!['type', 'move', 'ability', 'egggroup', 'tier'].includes(type)) return false;\r\n\t\t\tif (type === 'move') entry[1] = toID(entry[1]);\r\n\t\t\tif (!this.filters) this.filters = [];\r\n\t\t\tthis.results = null;\r\n\t\t\tfor (const filter of this.filters) {\r\n\t\t\t\tif (filter[0] === type && filter[1] === entry[1]) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.filters.push(entry);\r\n\t\t\treturn true;\r\n\t\t} else if (this.typedSearch.searchType === 'move') {\r\n\t\t\tif (type === this.sortCol) this.sortCol = null;\r\n\t\t\tif (!['type', 'category', 'pokemon'].includes(type)) return false;\r\n\t\t\tif (type === 'pokemon') entry[1] = toID(entry[1]);\r\n\t\t\tif (!this.filters) this.filters = [];\r\n\t\t\tthis.filters.push(entry);\r\n\t\t\tthis.results = null;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tremoveFilter(entry?: SearchFilter): boolean {\r\n\t\tif (!this.filters) return false;\r\n\t\tif (entry) {\r\n\t\t\tconst filterid = entry.join(':');\r\n\t\t\tlet deleted: string[] | null = null;\r\n\t\t\t// delete specific filter\r\n\t\t\tfor (let i = 0; i < this.filters.length; i++) {\r\n\t\t\t\tif (filterid === this.filters[i].join(':')) {\r\n\t\t\t\t\tdeleted = this.filters[i];\r\n\t\t\t\t\tthis.filters.splice(i, 1);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!deleted) return false;\r\n\t\t} else {\r\n\t\t\tthis.filters.pop();\r\n\t\t}\r\n\t\tif (!this.filters.length) this.filters = null;\r\n\t\tthis.results = null;\r\n\t\treturn true;\r\n\t}\r\n\r\n\ttoggleSort(sortCol: string) {\r\n\t\tif (this.sortCol === sortCol) {\r\n\t\t\tif (!this.reverseSort) {\r\n\t\t\t\tthis.reverseSort = true;\r\n\t\t\t} else {\r\n\t\t\t\tthis.sortCol = null;\r\n\t\t\t\tthis.reverseSort = false;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis.sortCol = sortCol;\r\n\t\t\tthis.reverseSort = false;\r\n\t\t}\r\n\t\tthis.results = null;\r\n\t}\r\n\r\n\tfilterLabel(filterType: string) {\r\n\t\tif (this.typedSearch && this.typedSearch.searchType !== filterType) {\r\n\t\t\treturn 'Filter';\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\tillegalLabel(id: ID) {\r\n\t\treturn this.typedSearch?.illegalReasons?.[id] || null;\r\n\t}\r\n\r\n\tgetTier(species: Species) {\r\n\t\treturn this.typedSearch?.getTier(species) || '';\r\n\t}\r\n\r\n\ttextSearch(query: string): SearchRow[] {\r\n\t\tquery = toID(query);\r\n\r\n\t\tthis.exactMatch = false;\r\n\t\tlet searchType: SearchType | '' = this.typedSearch?.searchType || '';\r\n\r\n\t\t// If searchType exists, we're searching mainly for results of that type.\r\n\t\t// We'll still search for results of other types, but those results\r\n\t\t// will only be used to filter results for that type.\r\n\t\tlet searchTypeIndex = (searchType ? DexSearch.typeTable[searchType] : -1);\r\n\r\n\t\t/** searching for \"Psychic type\" will make the type come up over the move */\r\n\t\tlet qFilterType: 'type' | '' = '';\r\n\t\tif (query.slice(-4) === 'type') {\r\n\t\t\tif (query.slice(0, -4) in window.BattleTypeChart) {\r\n\t\t\t\tquery = query.slice(0, -4);\r\n\t\t\t\tqFilterType = 'type';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// i represents the location of the search index we're looking at\r\n\t\tlet i = DexSearch.getClosest(query);\r\n\t\tthis.exactMatch = (BattleSearchIndex[i][0] === query);\r\n\r\n\t\t// Even with output buffer buckets, we make multiple passes through\r\n\t\t// the search index. searchPasses is a queue of which pass we're on:\r\n\t\t// [passType, i, query]\r\n\r\n\t\t// By doing an alias pass after the normal pass, we ensure that\r\n\t\t// mid-word matches only display after start matches.\r\n\t\tlet passType: SearchPassType | '' = '';\r\n\t\t/**\r\n\t\t * pass types:\r\n\t\t * * '': time to pop the next pass off the searchPasses queue\r\n\t\t * * 'normal': start at i and stop when results no longer start with query\r\n\t\t * * 'alias': like normal, but output aliases instead of non-alias results\r\n\t\t * * 'fuzzy': start at i and stop when you have two results\r\n\t\t * * 'exact': like normal, but stop at i\r\n\t\t */\r\n\t\ttype SearchPassType = 'normal' | 'alias' | 'fuzzy' | 'exact';\r\n\t\t/**\r\n\t\t * [passType, i, query]\r\n\t\t *\r\n\t\t * i = index of BattleSearchIndex to start from\r\n\t\t *\r\n\t\t * By doing an alias pass after the normal pass, we ensure that\r\n\t\t * mid-word matches only display after start matches.\r\n\t\t */\r\n\t\ttype SearchPass = [SearchPassType, number, string];\r\n\t\tlet searchPasses: SearchPass[] = [['normal', i, query]];\r\n\r\n\t\t// For performance reasons, only do an alias pass if query is at\r\n\t\t// least 2 chars long\r\n\t\tif (query.length > 1) searchPasses.push(['alias', i, query]);\r\n\r\n\t\t// If the query matches an official alias in BattleAliases: These are\r\n\t\t// different from the aliases in the search index and are given\r\n\t\t// higher priority. We'll do a normal pass through the index with\r\n\t\t// the alias text before any other passes.\r\n\t\tlet queryAlias;\r\n\t\tif (query in BattleAliases) {\r\n\t\t\tif (['sub', 'tr'].includes(query) || toID(BattleAliases[query]).slice(0, query.length) !== query) {\r\n\t\t\t\tqueryAlias = toID(BattleAliases[query]);\r\n\t\t\t\tlet aliasPassType: SearchPassType = (queryAlias === 'hiddenpower' ? 'exact' : 'normal');\r\n\t\t\t\tsearchPasses.unshift([aliasPassType, DexSearch.getClosest(queryAlias), queryAlias]);\r\n\t\t\t}\r\n\t\t\tthis.exactMatch = true;\r\n\t\t}\r\n\r\n\t\t// If there are no matches starting with query: Do a fuzzy match pass\r\n\t\t// Fuzzy matches will still be shown after alias matches\r\n\t\tif (!this.exactMatch && BattleSearchIndex[i][0].substr(0, query.length) !== query) {\r\n\t\t\t// No results start with this. Do a fuzzy match pass.\r\n\t\t\tlet matchLength = query.length - 1;\r\n\t\t\tif (!i) i++;\r\n\t\t\twhile (matchLength &&\r\n\t\t\t\tBattleSearchIndex[i][0].substr(0, matchLength) !== query.substr(0, matchLength) &&\r\n\t\t\t\tBattleSearchIndex[i - 1][0].substr(0, matchLength) !== query.substr(0, matchLength)) {\r\n\t\t\t\tmatchLength--;\r\n\t\t\t}\r\n\t\t\tlet matchQuery = query.substr(0, matchLength);\r\n\t\t\twhile (i >= 1 && BattleSearchIndex[i - 1][0].substr(0, matchLength) === matchQuery) i--;\r\n\t\t\tsearchPasses.push(['fuzzy', i, '']);\r\n\t\t}\r\n\r\n\t\t// We split the output buffers into 8 buckets.\r\n\t\t// Bucket 0 is usually unused, and buckets 1-7 represent\r\n\t\t// pokemon, types, moves, etc (see typeTable).\r\n\r\n\t\t// When we're done, the buffers are concatenated together to form\r\n\t\t// our results, with each buffer getting its own header, unlike\r\n\t\t// multiple-pass results, which have no header.\r\n\r\n\t\t// Notes:\r\n\t\t// - if we have a searchType, that searchType's buffer will be on top\r\n\t\tlet bufs: SearchRow[][] = [[], [], [], [], [], [], [], [], [], []];\r\n\t\tlet topbufIndex = -1;\r\n\r\n\t\tlet count = 0;\r\n\t\tlet nearMatch = false;\r\n\r\n\t\t/** [type, id, typeIndex] */\r\n\t\tlet instafilter: [SearchType, ID, number] | null = null;\r\n\t\tlet instafilterSort = [0, 1, 2, 5, 4, 3, 6, 7, 8];\r\n\t\tlet illegal = this.typedSearch?.illegalReasons;\r\n\r\n\t\t// We aren't actually looping through the entirety of the searchIndex\r\n\t\tfor (i = 0; i < BattleSearchIndex.length; i++) {\r\n\t\t\tif (!passType) {\r\n\t\t\t\tlet searchPass = searchPasses.shift();\r\n\t\t\t\tif (!searchPass) break;\r\n\t\t\t\tpassType = searchPass[0];\r\n\t\t\t\ti = searchPass[1];\r\n\t\t\t\tquery = searchPass[2];\r\n\t\t\t}\r\n\r\n\t\t\tlet entry = BattleSearchIndex[i];\r\n\t\t\tlet id = entry[0];\r\n\t\t\tlet type = entry[1];\r\n\r\n\t\t\tif (!id) break;\r\n\r\n\t\t\tif (passType === 'fuzzy') {\r\n\t\t\t\t// fuzzy match pass; stop after 2 results\r\n\t\t\t\tif (count >= 2) {\r\n\t\t\t\t\tpassType = '';\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tnearMatch = true;\r\n\t\t\t} else if (passType === 'exact') {\r\n\t\t\t\t// exact pass; stop after 1 result\r\n\t\t\t\tif (count >= 1) {\r\n\t\t\t\t\tpassType = '';\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t} else if (id.substr(0, query.length) !== query) {\r\n\t\t\t\t// regular pass, time to move onto our next match\r\n\t\t\t\tpassType = '';\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif (entry.length > 2) {\r\n\t\t\t\t// alias entry\r\n\t\t\t\tif (passType !== 'alias') continue;\r\n\t\t\t} else {\r\n\t\t\t\t// normal entry\r\n\t\t\t\tif (passType === 'alias') continue;\r\n\t\t\t}\r\n\r\n\t\t\tlet typeIndex = DexSearch.typeTable[type];\r\n\r\n\t\t\t// For performance, with a query length of 1, we only fill the first bucket\r\n\t\t\tif (query.length === 1 && typeIndex !== (searchType ? searchTypeIndex : 1)) continue;\r\n\r\n\t\t\t// For pokemon queries, accept types/tier/abilities/moves/eggroups as filters\r\n\t\t\tif (searchType === 'pokemon' && (typeIndex === 5 || typeIndex > 7)) continue;\r\n\t\t\tif (searchType === 'pokemon' && typeIndex === 3 && this.dex.gen < 9) continue;\r\n\t\t\t// For move queries, accept types/categories as filters\r\n\t\t\tif (searchType === 'move' && ((typeIndex !== 8 && typeIndex > 4) || typeIndex === 3)) continue;\r\n\t\t\t// For move queries in the teambuilder, don't accept pokemon as filters\r\n\t\t\tif (searchType === 'move' && illegal && typeIndex === 1) continue;\r\n\t\t\t// For ability/item queries, don't accept anything else as a filter\r\n\t\t\tif ((searchType === 'ability' || searchType === 'item') && typeIndex !== searchTypeIndex) continue;\r\n\t\t\t// Query was a type name followed 'type'; only show types\r\n\t\t\tif (qFilterType === 'type' && typeIndex !== 2) continue;\r\n\t\t\t// hardcode cases of duplicate non-consecutive aliases\r\n\t\t\tif ((id === 'megax' || id === 'megay') && 'mega'.startsWith(query)) continue;\r\n\r\n\t\t\tlet matchStart = 0;\r\n\t\t\tlet matchEnd = 0;\r\n\t\t\tif (passType === 'alias') {\r\n\t\t\t\t// alias entry\r\n\t\t\t\t// [aliasid, type, originalid, matchStart, originalindex]\r\n\t\t\t\tmatchStart = entry[3]!;\r\n\t\t\t\tlet originalIndex = entry[2]!;\r\n\t\t\t\tif (matchStart) {\r\n\t\t\t\t\tmatchEnd = matchStart + query.length;\r\n\t\t\t\t\tmatchStart += (BattleSearchIndexOffset[originalIndex][matchStart] || '0').charCodeAt(0) - 48;\r\n\t\t\t\t\tmatchEnd += (BattleSearchIndexOffset[originalIndex][matchEnd - 1] || '0').charCodeAt(0) - 48;\r\n\t\t\t\t}\r\n\t\t\t\tid = BattleSearchIndex[originalIndex][0];\r\n\t\t\t} else {\r\n\t\t\t\tmatchEnd = query.length;\r\n\t\t\t\tif (matchEnd) matchEnd += (BattleSearchIndexOffset[i][matchEnd - 1] || '0').charCodeAt(0) - 48;\r\n\t\t\t}\r\n\r\n\t\t\t// some aliases are substrings\r\n\t\t\tif (queryAlias === id && query !== id) continue;\r\n\r\n\t\t\tif (searchType && searchTypeIndex !== typeIndex) {\r\n\t\t\t\t// This is a filter, set it as an instafilter candidate\r\n\t\t\t\tif (!instafilter || instafilterSort[typeIndex] < instafilterSort[instafilter[2]]) {\r\n\t\t\t\t\tinstafilter = [type, id, typeIndex];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// show types above Arceus formes\r\n\t\t\tif (topbufIndex < 0 && searchTypeIndex < 2 && passType === 'alias' && !bufs[1].length && bufs[2].length) {\r\n\t\t\t\ttopbufIndex = 2;\r\n\t\t\t}\r\n\r\n\t\t\tif (illegal && typeIndex === searchTypeIndex) {\r\n\t\t\t\t// Always show illegal results under legal results.\r\n\t\t\t\t// This is done by putting legal results (and the type header)\r\n\t\t\t\t// in bucket 0, and illegal results in the searchType's bucket.\r\n\t\t\t\t// searchType buckets are always on top (but under bucket 0), so\r\n\t\t\t\t// illegal results will be seamlessly right under legal results.\r\n\t\t\t\tif (!bufs[typeIndex].length && !bufs[0].length) {\r\n\t\t\t\t\tbufs[0] = [['header', DexSearch.typeName[type]]];\r\n\t\t\t\t}\r\n\t\t\t\tif (!(id in illegal)) typeIndex = 0;\r\n\t\t\t} else {\r\n\t\t\t\tif (!bufs[typeIndex].length) {\r\n\t\t\t\t\tbufs[typeIndex] = [['header', DexSearch.typeName[type]]];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// don't match duplicate aliases\r\n\t\t\tlet curBufLength = (passType === 'alias' && bufs[typeIndex].length);\r\n\t\t\tif (curBufLength && bufs[typeIndex][curBufLength - 1][1] === id) continue;\r\n\r\n\t\t\tbufs[typeIndex].push([type, id, matchStart, matchEnd]);\r\n\r\n\t\t\tcount++;\r\n\t\t}\r\n\r\n\t\tlet topbuf: SearchRow[] = [];\r\n\t\tif (nearMatch) {\r\n\t\t\ttopbuf = [['html', `<em>No exact match found. The closest matches alphabetically are:</em>`]];\r\n\t\t}\r\n\t\tif (topbufIndex >= 0) {\r\n\t\t\ttopbuf = topbuf.concat(bufs[topbufIndex]);\r\n\t\t\tbufs[topbufIndex] = [];\r\n\t\t}\r\n\t\tif (searchTypeIndex >= 0) {\r\n\t\t\ttopbuf = topbuf.concat(bufs[0]);\r\n\t\t\ttopbuf = topbuf.concat(bufs[searchTypeIndex]);\r\n\t\t\tbufs[searchTypeIndex] = [];\r\n\t\t\tbufs[0] = [];\r\n\t\t}\r\n\r\n\t\tif (instafilter && count < 20) {\r\n\t\t\t// Result count is less than 20, so we can instafilter\r\n\t\t\tbufs.push(this.instafilter(searchType, instafilter[0], instafilter[1]));\r\n\t\t}\r\n\r\n\t\tthis.results = Array.prototype.concat.apply(topbuf, bufs);\r\n\t\treturn this.results;\r\n\t}\r\n\tprivate instafilter(searchType: SearchType | '', fType: SearchType, fId: ID): SearchRow[] {\r\n\t\tlet buf: SearchRow[] = [];\r\n\t\tlet illegalBuf: SearchRow[] = [];\r\n\t\tlet illegal = this.typedSearch?.illegalReasons;\r\n\t\tif (searchType === 'pokemon') {\r\n\t\t\tswitch (fType) {\r\n\t\t\tcase 'type':\r\n\t\t\t\tlet type = fId.charAt(0).toUpperCase() + fId.slice(1) as TypeName;\r\n\t\t\t\tbuf.push(['header', `${type}-type Pok&eacute;mon`]);\r\n\t\t\t\tfor (let id in BattlePokedex) {\r\n\t\t\t\t\tif (!BattlePokedex[id].types) continue;\r\n\t\t\t\t\tif (this.dex.species.get(id).types.includes(type)) {\r\n\t\t\t\t\t\t(illegal && id in illegal ? illegalBuf : buf).push(['pokemon', id as ID]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'ability':\r\n\t\t\t\tlet ability = Dex.abilities.get(fId).name;\r\n\t\t\t\tbuf.push(['header', `${ability} Pok&eacute;mon`]);\r\n\t\t\t\tfor (let id in BattlePokedex) {\r\n\t\t\t\t\tif (!BattlePokedex[id].abilities) continue;\r\n\t\t\t\t\tif (Dex.hasAbility(this.dex.species.get(id), ability)) {\r\n\t\t\t\t\t\t(illegal && id in illegal ? illegalBuf : buf).push(['pokemon', id as ID]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t} else if (searchType === 'move') {\r\n\t\t\tswitch (fType) {\r\n\t\t\tcase 'type':\r\n\t\t\t\tlet type = fId.charAt(0).toUpperCase() + fId.slice(1);\r\n\t\t\t\tbuf.push(['header', `${type}-type moves`]);\r\n\t\t\t\tfor (let id in BattleMovedex) {\r\n\t\t\t\t\tif (BattleMovedex[id].type === type) {\r\n\t\t\t\t\t\t(illegal && id in illegal ? illegalBuf : buf).push(['move', id as ID]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'category':\r\n\t\t\t\tlet category = fId.charAt(0).toUpperCase() + fId.slice(1);\r\n\t\t\t\tbuf.push(['header', `${category} moves`]);\r\n\t\t\t\tfor (let id in BattleMovedex) {\r\n\t\t\t\t\tif (BattleMovedex[id].category === category) {\r\n\t\t\t\t\t\t(illegal && id in illegal ? illegalBuf : buf).push(['move', id as ID]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn [...buf, ...illegalBuf];\r\n\t}\r\n\r\n\tstatic getClosest(query: string) {\r\n\t\t// binary search through the index!\r\n\t\tlet left = 0;\r\n\t\tlet right = BattleSearchIndex.length - 1;\r\n\t\twhile (right > left) {\r\n\t\t\tlet mid = Math.floor((right - left) / 2 + left);\r\n\t\t\tif (BattleSearchIndex[mid][0] === query && (mid === 0 || BattleSearchIndex[mid - 1][0] !== query)) {\r\n\t\t\t\t// that's us\r\n\t\t\t\treturn mid;\r\n\t\t\t} else if (BattleSearchIndex[mid][0] < query) {\r\n\t\t\t\tleft = mid + 1;\r\n\t\t\t} else {\r\n\t\t\t\tright = mid - 1;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (left >= BattleSearchIndex.length - 1) left = BattleSearchIndex.length - 1;\r\n\t\telse if (BattleSearchIndex[left + 1][0] && BattleSearchIndex[left][0] < query) left++;\r\n\t\tif (left && BattleSearchIndex[left - 1][0] === query) left--;\r\n\t\treturn left;\r\n\t}\r\n}\r\n\r\nabstract class BattleTypedSearch<T extends SearchType> {\r\n\tsearchType: T;\r\n\t/**\r\n\t * Dex for the mod/generation to search.\r\n\t */\r\n\tdex: ModdedDex = Dex;\r\n\t/**\r\n\t * Format is the first of two base filters. It constrains results to things\r\n\t * legal in the format, and affects the default sort.\r\n\t *\r\n\t * This string specifically normalizes out generation number and the words\r\n\t * \"Doubles\" and \"Let's Go\" from the name.\r\n\t */\r\n\tformat = '' as ID;\r\n\t/**\r\n\t * `species` is the second of two base filters. It constrains results to\r\n\t * things that species can use, and affects the default sort.\r\n\t */\r\n\tspecies = '' as ID;\r\n\t/**\r\n\t * `set` is a pseudo-base filter; it has minor effects on move sorting.\r\n\t * (Abilities/items can affect what moves are sorted as usable.)\r\n\t */\r\n\tset: PokemonSet | null = null;\r\n\r\n\tprotected formatType: 'doubles' | 'bdsp' | 'bdspdoubles' | 'letsgo' | 'metronome' | 'natdex' | 'nfe' |\r\n\t'dlc1' | 'dlc1doubles' | 'stadium' | null = null;\r\n\r\n\t/**\r\n\t * Cached copy of what the results list would be with only base filters\r\n\t * (i.e. with an empty `query` and `filters`)\r\n\t */\r\n\tbaseResults: SearchRow[] | null = null;\r\n\t/**\r\n\t * Cached copy of all results not in `baseResults` - mostly in case a user\r\n\t * is wondering why a specific result isn't showing up.\r\n\t */\r\n\tbaseIllegalResults: SearchRow[] | null = null;\r\n\tillegalReasons: {[id: string]: string} | null = null;\r\n\tresults: SearchRow[] | null = null;\r\n\r\n\tprotected readonly sortRow: SearchRow | null = null;\r\n\r\n\tconstructor(searchType: T, format = '' as ID, speciesOrSet: ID | PokemonSet = '' as ID) {\r\n\t\tthis.searchType = searchType;\r\n\r\n\t\tthis.baseResults = null;\r\n\t\tthis.baseIllegalResults = null;\r\n\r\n\t\tif (format.slice(0, 3) === 'gen') {\r\n\t\t\tconst gen = (Number(format.charAt(3)) || 6);\r\n\t\t\tformat = (format.slice(4) || 'customgame') as ID;\r\n\t\t\tthis.dex = Dex.forGen(gen);\r\n\t\t} else if (!format) {\r\n\t\t\tthis.dex = Dex;\r\n\t\t}\r\n\r\n\t\tif (format.startsWith('dlc1')) {\r\n\t\t\tif (format.includes('doubles')) {\r\n\t\t\t\tthis.formatType = 'dlc1doubles';\r\n\t\t\t} else {\r\n\t\t\t\tthis.formatType = 'dlc1';\r\n\t\t\t}\r\n\t\t\tformat = format.slice(4) as ID;\r\n\t\t}\r\n\t\tif (format.startsWith('stadium')) {\r\n\t\t\tthis.formatType = 'stadium';\r\n\t\t\tformat = format.slice(7) as ID;\r\n\t\t\tif (!format) format = 'ou' as ID;\r\n\t\t}\r\n\t\tif (format.startsWith('vgc')) this.formatType = 'doubles';\r\n\t\tif (format === 'vgc2020') this.formatType = 'dlc1doubles';\r\n\t\tif (format.includes('bdsp')) {\r\n\t\t\tif (format.includes('doubles')) {\r\n\t\t\t\tthis.formatType = 'bdspdoubles';\r\n\t\t\t} else {\r\n\t\t\t\tthis.formatType = 'bdsp';\r\n\t\t\t}\r\n\t\t\tformat = format.slice(4) as ID;\r\n\t\t\tthis.dex = Dex.mod('gen8bdsp' as ID);\r\n\t\t}\r\n\t\tif (format.includes('doubles') && this.dex.gen > 4 && !this.formatType) this.formatType = 'doubles';\r\n\t\tif (format === 'partnersincrime') this.formatType = 'doubles';\r\n\t\tif (format.startsWith('ffa') || format === 'freeforall') this.formatType = 'doubles';\r\n\t\tif (format.includes('letsgo')) {\r\n\t\t\tthis.formatType = 'letsgo';\r\n\t\t\tthis.dex = Dex.mod('gen7letsgo' as ID);\r\n\t\t}\r\n\t\tif (format.includes('nationaldex') || format.startsWith('nd') || format.includes('natdex')) {\r\n\t\t\tformat = (format.startsWith('nd') ? format.slice(2) :\r\n\t\t\t\tformat.includes('natdex') ? format.slice(6) : format.slice(11)) as ID;\r\n\t\t\tthis.formatType = 'natdex';\r\n\t\t\tif (!format) format = 'ou' as ID;\r\n\t\t}\r\n\t\tif (this.formatType === 'letsgo') format = format.slice(6) as ID;\r\n\t\tif (format.includes('metronome')) {\r\n\t\t\tthis.formatType = 'metronome';\r\n\t\t}\r\n\t\tif (format.endsWith('nfe')) {\r\n\t\t\tformat = format.slice(3) as ID;\r\n\t\t\tthis.formatType = 'nfe';\r\n\t\t\tif (!format) format = 'ou' as ID;\r\n\t\t}\r\n\t\tthis.format = format;\r\n\r\n\t\tthis.species = '' as ID;\r\n\t\tthis.set = null;\r\n\t\tif (typeof speciesOrSet === 'string') {\r\n\t\t\tif (speciesOrSet) this.species = speciesOrSet;\r\n\t\t} else {\r\n\t\t\tthis.set = speciesOrSet as PokemonSet;\r\n\t\t\tthis.species = toID(this.set.species);\r\n\t\t}\r\n\t\tif (!searchType || !this.set) return;\r\n\t}\r\n\tgetResults(filters?: SearchFilter[] | null, sortCol?: string | null, reverseSort?: boolean): SearchRow[] {\r\n\t\tif (sortCol === 'type') {\r\n\t\t\treturn [this.sortRow!, ...BattleTypeSearch.prototype.getDefaultResults.call(this)];\r\n\t\t} else if (sortCol === 'category') {\r\n\t\t\treturn [this.sortRow!, ...BattleCategorySearch.prototype.getDefaultResults.call(this)];\r\n\t\t} else if (sortCol === 'ability') {\r\n\t\t\treturn [this.sortRow!, ...BattleAbilitySearch.prototype.getDefaultResults.call(this)];\r\n\t\t}\r\n\r\n\t\tif (!this.baseResults) {\r\n\t\t\tthis.baseResults = this.getBaseResults();\r\n\t\t}\r\n\r\n\t\tif (!this.baseIllegalResults) {\r\n\t\t\tconst legalityFilter: {[id: string]: 1} = {};\r\n\t\t\tfor (const [resultType, value] of this.baseResults) {\r\n\t\t\t\tif (resultType === this.searchType) legalityFilter[value] = 1;\r\n\t\t\t}\r\n\t\t\tthis.baseIllegalResults = [];\r\n\t\t\tthis.illegalReasons = {};\r\n\r\n\t\t\tfor (const id in this.getTable()) {\r\n\t\t\t\tif (!(id in legalityFilter)) {\r\n\t\t\t\t\tthis.baseIllegalResults.push([this.searchType, id as ID]);\r\n\t\t\t\t\tthis.illegalReasons[id] = 'Illegal';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet results: SearchRow[];\r\n\t\tlet illegalResults: SearchRow[] | null;\r\n\r\n\t\tif (filters) {\r\n\t\t\tresults = [];\r\n\t\t\tillegalResults = [];\r\n\t\t\tfor (const result of this.baseResults) {\r\n\t\t\t\tif (this.filter(result, filters)) {\r\n\t\t\t\t\tif (results.length && result[0] === 'header' && results[results.length - 1][0] === 'header') {\r\n\t\t\t\t\t\tresults[results.length - 1] = result;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tresults.push(result);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (results.length && results[results.length - 1][0] === 'header') {\r\n\t\t\t\tresults.pop();\r\n\t\t\t}\r\n\t\t\tfor (const result of this.baseIllegalResults) {\r\n\t\t\t\tif (this.filter(result, filters)) {\r\n\t\t\t\t\tillegalResults.push(result);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tresults = [...this.baseResults];\r\n\t\t\tillegalResults = null;\r\n\t\t}\r\n\r\n\t\tif (sortCol) {\r\n\t\t\tresults = results.filter(([rowType]) => rowType === this.searchType);\r\n\t\t\tresults = this.sort(results, sortCol, reverseSort);\r\n\t\t\tif (illegalResults) {\r\n\t\t\t\tillegalResults = illegalResults.filter(([rowType]) => rowType === this.searchType);\r\n\t\t\t\tillegalResults = this.sort(illegalResults, sortCol, reverseSort);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.sortRow) {\r\n\t\t\tresults = [this.sortRow, ...results];\r\n\t\t}\r\n\t\tif (illegalResults && illegalResults.length) {\r\n\t\t\tresults = [...results, ['header', \"Illegal results\"], ...illegalResults];\r\n\t\t}\r\n\t\treturn results;\r\n\t}\r\n\tprotected firstLearnsetid(speciesid: ID) {\r\n\t\tlet table = BattleTeambuilderTable;\r\n\t\tif (this.formatType?.startsWith('bdsp')) table = table['gen8bdsp'];\r\n\t\tif (this.formatType === 'letsgo') table = table['gen7letsgo'];\r\n\t\tif (speciesid in table.learnsets) return speciesid;\r\n\t\tconst species = this.dex.species.get(speciesid);\r\n\t\tif (!species.exists) return '' as ID;\r\n\r\n\t\tlet baseLearnsetid = toID(species.baseSpecies);\r\n\t\tif (typeof species.battleOnly === 'string' && species.battleOnly !== species.baseSpecies) {\r\n\t\t\tbaseLearnsetid = toID(species.battleOnly);\r\n\t\t}\r\n\t\tif (baseLearnsetid in table.learnsets) return baseLearnsetid;\r\n\t\treturn '' as ID;\r\n\t}\r\n\tprotected nextLearnsetid(learnsetid: ID, speciesid: ID) {\r\n\t\tif (learnsetid === 'lycanrocdusk' || (speciesid === 'rockruff' && learnsetid === 'rockruff')) {\r\n\t\t\treturn 'rockruffdusk' as ID;\r\n\t\t}\r\n\t\tconst lsetSpecies = this.dex.species.get(learnsetid);\r\n\t\tif (!lsetSpecies.exists) return '' as ID;\r\n\r\n\t\tif (lsetSpecies.id === 'gastrodoneast') return 'gastrodon' as ID;\r\n\t\tif (lsetSpecies.id === 'pumpkaboosuper') return 'pumpkaboo' as ID;\r\n\r\n\t\tconst next = lsetSpecies.battleOnly || lsetSpecies.changesFrom || lsetSpecies.prevo;\r\n\t\tif (next) return toID(next);\r\n\r\n\t\treturn '' as ID;\r\n\t}\r\n\tprotected canLearn(speciesid: ID, moveid: ID) {\r\n\t\tconst move = this.dex.moves.get(moveid);\r\n\t\tif (this.formatType === 'natdex' && move.isNonstandard && move.isNonstandard !== 'Past') {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tconst gen = this.dex.gen;\r\n\t\tlet genChar = `${gen}`;\r\n\t\tif (\r\n\t\t\tthis.format.startsWith('vgc') ||\r\n\t\t\tthis.format.startsWith('battlespot') ||\r\n\t\t\tthis.format.startsWith('battlestadium') ||\r\n\t\t\tthis.format.startsWith('battlefestival') ||\r\n\t\t\t(this.dex.gen === 9 && this.formatType !== 'natdex')\r\n\t\t) {\r\n\t\t\tif (gen === 9) {\r\n\t\t\t\tgenChar = 'a';\r\n\t\t\t} else if (gen === 8) {\r\n\t\t\t\tgenChar = 'g';\r\n\t\t\t} else if (gen === 7) {\r\n\t\t\t\tgenChar = 'q';\r\n\t\t\t} else if (gen === 6) {\r\n\t\t\t\tgenChar = 'p';\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet learnsetid = this.firstLearnsetid(speciesid);\r\n\t\twhile (learnsetid) {\r\n\t\t\tlet table = BattleTeambuilderTable;\r\n\t\t\tif (this.formatType?.startsWith('bdsp')) table = table['gen8bdsp'];\r\n\t\t\tif (this.formatType === 'letsgo') table = table['gen7letsgo'];\r\n\t\t\tlet learnset = table.learnsets[learnsetid];\r\n\t\t\tif (learnset && (moveid in learnset) && (!this.format.startsWith('tradebacks') ? learnset[moveid].includes(genChar) :\r\n\t\t\t\tlearnset[moveid].includes(genChar) ||\r\n\t\t\t\t\t(learnset[moveid].includes(`${gen + 1}`) && move.gen === gen))) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tlearnsetid = this.nextLearnsetid(learnsetid, speciesid);\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\tgetTier(pokemon: Species) {\r\n\t\tif (this.formatType === 'metronome' || this.formatType === 'natdex') {\r\n\t\t\treturn pokemon.num >= 0 ? String(pokemon.num) : pokemon.tier;\r\n\t\t}\r\n\t\tlet table = window.BattleTeambuilderTable;\r\n\t\tconst gen = this.dex.gen;\r\n\t\tconst tableKey = this.formatType === 'doubles' ? `gen${gen}doubles` :\r\n\t\t\tthis.formatType === 'letsgo' ? 'gen7letsgo' :\r\n\t\t\tthis.formatType === 'bdsp' ? 'gen8bdsp' :\r\n\t\t\tthis.formatType === 'bdspdoubles' ? 'gen8bdspdoubles' :\r\n\t\t\tthis.formatType === 'nfe' ? `gen${gen}nfe` :\r\n\t\t\tthis.formatType === 'dlc1' ? 'gen8dlc1' :\r\n\t\t\tthis.formatType === 'dlc1doubles' ? 'gen8dlc1doubles' :\r\n\t\t\tthis.formatType === 'natdex' ? `gen${gen}natdex` :\r\n\t\t\tthis.formatType === 'stadium' ? `gen${gen}stadium${gen > 1 ? gen : ''}` :\r\n\t\t\t`gen${gen}`;\r\n\t\tif (table && table[tableKey]) {\r\n\t\t\ttable = table[tableKey];\r\n\t\t}\r\n\t\tif (!table) return pokemon.tier;\r\n\r\n\t\tlet id = pokemon.id;\r\n\t\tif (id in table.overrideTier) {\r\n\t\t\treturn table.overrideTier[id];\r\n\t\t}\r\n\t\tif (id.slice(-5) === 'totem' && id.slice(0, -5) in table.overrideTier) {\r\n\t\t\treturn table.overrideTier[id.slice(0, -5)];\r\n\t\t}\r\n\t\tid = toID(pokemon.baseSpecies);\r\n\t\tif (id in table.overrideTier) {\r\n\t\t\treturn table.overrideTier[id];\r\n\t\t}\r\n\r\n\t\treturn pokemon.tier;\r\n\t}\r\n\tabstract getTable(): {[id: string]: any};\r\n\tabstract getDefaultResults(): SearchRow[];\r\n\tabstract getBaseResults(): SearchRow[];\r\n\tabstract filter(input: SearchRow, filters: string[][]): boolean;\r\n\tabstract sort(input: SearchRow[], sortCol: string, reverseSort?: boolean): SearchRow[];\r\n}\r\n\r\nclass BattlePokemonSearch extends BattleTypedSearch<'pokemon'> {\r\n\tsortRow: SearchRow = ['sortpokemon', ''];\r\n\tgetTable() {\r\n\t\treturn BattlePokedex;\r\n\t}\r\n\tgetDefaultResults(): SearchRow[] {\r\n\t\tlet results: SearchRow[] = [];\r\n\t\tfor (let id in BattlePokedex) {\r\n\t\t\tswitch (id) {\r\n\t\t\tcase 'bulbasaur':\r\n\t\t\t\tresults.push(['header', \"Generation 1\"]);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'chikorita':\r\n\t\t\t\tresults.push(['header', \"Generation 2\"]);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'treecko':\r\n\t\t\t\tresults.push(['header', \"Generation 3\"]);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'turtwig':\r\n\t\t\t\tresults.push(['header', \"Generation 4\"]);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'victini':\r\n\t\t\t\tresults.push(['header', \"Generation 5\"]);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'chespin':\r\n\t\t\t\tresults.push(['header', \"Generation 6\"]);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'rowlet':\r\n\t\t\t\tresults.push(['header', \"Generation 7\"]);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'grookey':\r\n\t\t\t\tresults.push(['header', \"Generation 8\"]);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'sprigatito':\r\n\t\t\t\tresults.push(['header', \"Generation 9\"]);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'missingno':\r\n\t\t\t\tresults.push(['header', \"Glitch\"]);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'syclar':\r\n\t\t\t\tresults.push(['header', \"CAP\"]);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'pikachucosplay':\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tresults.push(['pokemon', id as ID]);\r\n\t\t}\r\n\t\treturn results;\r\n\t}\r\n\tgetBaseResults(): SearchRow[] {\r\n\t\tconst format = this.format;\r\n\t\tif (!format) return this.getDefaultResults();\r\n\t\tconst isVGCOrBS = format.startsWith('battlespot') || format.startsWith('battlestadium') || format.startsWith('vgc');\r\n\t\tlet isDoublesOrBS = isVGCOrBS || this.formatType?.includes('doubles');\r\n\t\tconst dex = this.dex;\r\n\r\n\t\tlet table = BattleTeambuilderTable;\r\n\t\tif ((format.endsWith('cap') || format.endsWith('caplc')) && dex.gen < 9) {\r\n\t\t\ttable = table['gen' + dex.gen];\r\n\t\t} else if (isVGCOrBS) {\r\n\t\t\ttable = table['gen' + dex.gen + 'vgc'];\r\n\t\t} else if (\r\n\t\t\ttable['gen' + dex.gen + 'doubles'] && dex.gen > 4 &&\r\n\t\t\tthis.formatType !== 'letsgo' && this.formatType !== 'bdspdoubles' && this.formatType !== 'dlc1doubles' &&\r\n\t\t\t(\r\n\t\t\t\tformat.includes('doubles') || format.includes('triples') ||\r\n\t\t\t\tformat === 'freeforall' || format.startsWith('ffa') ||\r\n\t\t\t\tformat === 'partnersincrime'\r\n\t\t\t)\r\n\t\t) {\r\n\t\t\ttable = table['gen' + dex.gen + 'doubles'];\r\n\t\t\tisDoublesOrBS = true;\r\n\t\t} else if (dex.gen < 9 && !this.formatType) {\r\n\t\t\ttable = table['gen' + dex.gen];\r\n\t\t} else if (this.formatType?.startsWith('bdsp')) {\r\n\t\t\ttable = table['gen8' + this.formatType];\r\n\t\t} else if (this.formatType === 'letsgo') {\r\n\t\t\ttable = table['gen7letsgo'];\r\n\t\t} else if (this.formatType === 'natdex') {\r\n\t\t\ttable = table['gen' + this.dex.gen + 'natdex'];\r\n\t\t} else if (this.formatType === 'metronome') {\r\n\t\t\ttable = table['gen' + dex.gen + 'metronome'];\r\n\t\t} else if (this.formatType === 'nfe') {\r\n\t\t\ttable = table['gen' + dex.gen + 'nfe'];\r\n\t\t} else if (this.formatType?.startsWith('dlc1')) {\r\n\t\t\tif (this.formatType.includes('doubles')) {\r\n\t\t\t\ttable = table['gen8dlc1doubles'];\r\n\t\t\t} else {\r\n\t\t\t\ttable = table['gen8dlc1'];\r\n\t\t\t}\r\n\t\t} else if (this.formatType === 'stadium') {\r\n\t\t\ttable = table['gen' + dex.gen + 'stadium' + (dex.gen > 1 ? dex.gen : '')];\r\n\t\t}\r\n\r\n\t\tif (!table.tierSet) {\r\n\t\t\ttable.tierSet = table.tiers.map((r: any) => {\r\n\t\t\t\tif (typeof r === 'string') return ['pokemon', r];\r\n\t\t\t\treturn [r[0], r[1]];\r\n\t\t\t});\r\n\t\t\ttable.tiers = null;\r\n\t\t}\r\n\t\tlet tierSet: SearchRow[] = table.tierSet;\r\n\t\tlet slices: {[k: string]: number} = table.formatSlices;\r\n\t\tif (format === 'ubers' || format === 'uber') tierSet = tierSet.slice(slices.Uber);\r\n\t\telse if (isVGCOrBS) {\r\n\t\t\tif (\r\n\t\t\t\tformat === 'vgc2010' || format === 'vgc2016' || format.startsWith('vgc2019') ||\r\n\t\t\t\tformat === 'vgc2022' || format.endsWith('series10') || format.endsWith('series11')\r\n\t\t\t) {\r\n\t\t\t\ttierSet = tierSet.slice(slices[\"Restricted Legendary\"]);\r\n\t\t\t} else {\r\n\t\t\t\ttierSet = tierSet.slice(slices.Regular);\r\n\t\t\t}\r\n\t\t} else if (format === 'ou') tierSet = tierSet.slice(slices.OU);\r\n\t\telse if (format === 'uu') tierSet = tierSet.slice(slices.UU);\r\n\t\telse if (format === 'ru') tierSet = tierSet.slice(slices.RU || slices.UU);\r\n\t\telse if (format === 'nu') tierSet = tierSet.slice(slices.NU || slices.RU || slices.UU);\r\n\t\telse if (format === 'pu') tierSet = tierSet.slice(slices.PU || slices.NU);\r\n\t\telse if (format === 'zu') tierSet = tierSet.slice(slices.ZU || slices.PU || slices.NU);\r\n\t\telse if (format === 'lc' || format === 'lcuu' || format.startsWith('lc') || (format !== 'caplc' && format.endsWith('lc'))) tierSet = tierSet.slice(slices.LC);\r\n\t\telse if (format === 'cap') tierSet = tierSet.slice(0, slices.AG || slices.Uber).concat(tierSet.slice(slices.OU));\r\n\t\telse if (format === 'caplc') {\r\n\t\t\ttierSet = tierSet.slice(slices['CAP LC'], slices.AG || slices.Uber).concat(tierSet.slice(slices.LC));\r\n\t\t} else if (format === 'anythinggoes' || format.endsWith('ag') || format.startsWith('ag')) {\r\n\t\t\ttierSet = tierSet.slice(slices.AG);\r\n\t\t} else if (format.includes('hackmons') || format.endsWith('bh')) tierSet = tierSet.slice(slices.AG || slices.Uber);\r\n\t\telse if (format === 'monotype') tierSet = tierSet.slice(slices.Uber);\r\n\t\telse if (format === 'doublesubers') tierSet = tierSet.slice(slices.DUber);\r\n\t\telse if (format === 'doublesou' && dex.gen > 4) tierSet = tierSet.slice(slices.DOU);\r\n\t\telse if (format === 'doublesuu') tierSet = tierSet.slice(slices.DUU);\r\n\t\telse if (format === 'doublesnu') tierSet = tierSet.slice(slices.DNU || slices.DUU);\r\n\t\telse if (this.formatType?.startsWith('bdsp') || this.formatType === 'letsgo' || this.formatType === 'stadium') {\r\n\t\t\ttierSet = tierSet.slice(slices.Uber);\r\n\t\t} else if (!isDoublesOrBS) {\r\n\t\t\ttierSet = [\r\n\t\t\t\t...tierSet.slice(slices.OU, slices.UU),\r\n\t\t\t\t...tierSet.slice(slices.AG, slices.Uber),\r\n\t\t\t\t...tierSet.slice(slices.Uber, slices.OU),\r\n\t\t\t\t...tierSet.slice(slices.UU),\r\n\t\t\t];\r\n\t\t} else {\r\n\t\t\ttierSet = [\r\n\t\t\t\t...tierSet.slice(slices.DOU, slices.DUU),\r\n\t\t\t\t...tierSet.slice(slices.DUber, slices.DOU),\r\n\t\t\t\t...tierSet.slice(slices.DUU),\r\n\t\t\t];\r\n\t\t}\r\n\r\n\t\tif (dex.gen >= 5) {\r\n\t\t\tif (format === 'zu' && table.zuBans) {\r\n\t\t\t\ttierSet = tierSet.filter(([type, id]) => {\r\n\t\t\t\t\tif (id in table.zuBans) return false;\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tif (format === 'monotype' && table.monotypeBans) {\r\n\t\t\t\ttierSet = tierSet.filter(([type, id]) => {\r\n\t\t\t\t\tif (id in table.monotypeBans) return false;\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Filter out Gmax Pokemon from standard tier selection\r\n\t\tif (!/^(battlestadium|vgc|doublesubers)/g.test(format)) {\r\n\t\t\ttierSet = tierSet.filter(([type, id]) => {\r\n\t\t\t\tif (type === 'header' && id === 'DUber by technicality') return false;\r\n\t\t\t\tif (type === 'pokemon') return !id.endsWith('gmax');\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn tierSet;\r\n\t}\r\n\tfilter(row: SearchRow, filters: string[][]) {\r\n\t\tif (!filters) return true;\r\n\t\tif (row[0] !== 'pokemon') return true;\r\n\t\tconst species = this.dex.species.get(row[1]);\r\n\t\tfor (const [filterType, value] of filters) {\r\n\t\t\tswitch (filterType) {\r\n\t\t\tcase 'type':\r\n\t\t\t\tif (species.types[0] !== value && species.types[1] !== value) return false;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'egggroup':\r\n\t\t\t\tif (species.eggGroups[0] !== value && species.eggGroups[1] !== value) return false;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'tier':\r\n\t\t\t\tif (this.getTier(species) !== value) return false;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'ability':\r\n\t\t\t\tif (!Dex.hasAbility(species, value)) return false;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'move':\r\n\t\t\t\tif (!this.canLearn(species.id, value as ID)) return false;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\tsort(results: SearchRow[], sortCol: string, reverseSort?: boolean) {\r\n\t\tconst sortOrder = reverseSort ? -1 : 1;\r\n\t\tif (['hp', 'atk', 'def', 'spa', 'spd', 'spe'].includes(sortCol)) {\r\n\t\t\treturn results.sort(([rowType1, id1], [rowType2, id2]) => {\r\n\t\t\t\tconst stat1 = this.dex.species.get(id1).baseStats[sortCol as StatName];\r\n\t\t\t\tconst stat2 = this.dex.species.get(id2).baseStats[sortCol as StatName];\r\n\t\t\t\treturn (stat2 - stat1) * sortOrder;\r\n\t\t\t});\r\n\t\t} else if (sortCol === 'bst') {\r\n\t\t\treturn results.sort(([rowType1, id1], [rowType2, id2]) => {\r\n\t\t\t\tconst base1 = this.dex.species.get(id1).baseStats;\r\n\t\t\t\tconst base2 = this.dex.species.get(id2).baseStats;\r\n\t\t\t\tconst bst1 = base1.hp + base1.atk + base1.def + base1.spa + base1.spd + base1.spe;\r\n\t\t\t\tconst bst2 = base2.hp + base2.atk + base2.def + base2.spa + base2.spd + base2.spe;\r\n\t\t\t\treturn (bst2 - bst1) * sortOrder;\r\n\t\t\t});\r\n\t\t} else if (sortCol === 'name') {\r\n\t\t\treturn results.sort(([rowType1, id1], [rowType2, id2]) => {\r\n\t\t\t\tconst name1 = id1;\r\n\t\t\t\tconst name2 = id2;\r\n\t\t\t\treturn (name1 < name2 ? -1 : name1 > name2 ? 1 : 0) * sortOrder;\r\n\t\t\t});\r\n\t\t}\r\n\t\tthrow new Error(\"invalid sortcol\");\r\n\t}\r\n}\r\n\r\nclass BattleAbilitySearch extends BattleTypedSearch<'ability'> {\r\n\tgetTable() {\r\n\t\treturn BattleAbilities;\r\n\t}\r\n\tgetDefaultResults(): SearchRow[] {\r\n\t\tconst results: SearchRow[] = [];\r\n\t\tfor (let id in BattleAbilities) {\r\n\t\t\tresults.push(['ability', id as ID]);\r\n\t\t}\r\n\t\treturn results;\r\n\t}\r\n\tgetBaseResults() {\r\n\t\tif (!this.species) return this.getDefaultResults();\r\n\t\tconst format = this.format;\r\n\t\tconst isHackmons = (format.includes('hackmons') || format.endsWith('bh'));\r\n\t\tconst isAAA = (format === 'almostanyability' || format.includes('aaa'));\r\n\t\tconst dex = this.dex;\r\n\t\tlet species = dex.species.get(this.species);\r\n\t\tlet abilitySet: SearchRow[] = [['header', \"Abilities\"]];\r\n\r\n\t\tif (species.isMega) {\r\n\t\t\tabilitySet.unshift(['html', `Will be <strong>${species.abilities['0']}</strong> after Mega Evolving.`]);\r\n\t\t\tspecies = dex.species.get(species.baseSpecies);\r\n\t\t}\r\n\t\tabilitySet.push(['ability', toID(species.abilities['0'])]);\r\n\t\tif (species.abilities['1']) {\r\n\t\t\tabilitySet.push(['ability', toID(species.abilities['1'])]);\r\n\t\t}\r\n\t\tif (species.abilities['H']) {\r\n\t\t\tabilitySet.push(['header', \"Hidden Ability\"]);\r\n\t\t\tabilitySet.push(['ability', toID(species.abilities['H'])]);\r\n\t\t}\r\n\t\tif (species.abilities['S']) {\r\n\t\t\tabilitySet.push(['header', \"Special Event Ability\"]);\r\n\t\t\tabilitySet.push(['ability', toID(species.abilities['S'])]);\r\n\t\t}\r\n\t\tif (isAAA || format.includes('metronomebattle') || isHackmons) {\r\n\t\t\tlet abilities: ID[] = [];\r\n\t\t\tfor (let i in this.getTable()) {\r\n\t\t\t\tconst ability = dex.abilities.get(i);\r\n\t\t\t\tif (ability.isNonstandard) continue;\r\n\t\t\t\tif (ability.gen > dex.gen) continue;\r\n\t\t\t\tabilities.push(ability.id);\r\n\t\t\t}\r\n\r\n\t\t\tlet goodAbilities: SearchRow[] = [['header', \"Abilities\"]];\r\n\t\t\tlet poorAbilities: SearchRow[] = [['header', \"Situational Abilities\"]];\r\n\t\t\tlet badAbilities: SearchRow[] = [['header', \"Unviable Abilities\"]];\r\n\t\t\tfor (const ability of abilities.sort().map(abil => dex.abilities.get(abil))) {\r\n\t\t\t\tlet rating = ability.rating;\r\n\t\t\t\tif (ability.id === 'normalize') rating = 3;\r\n\t\t\t\tif (rating >= 3) {\r\n\t\t\t\t\tgoodAbilities.push(['ability', ability.id]);\r\n\t\t\t\t} else if (rating >= 2) {\r\n\t\t\t\t\tpoorAbilities.push(['ability', ability.id]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbadAbilities.push(['ability', ability.id]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tabilitySet = [...goodAbilities, ...poorAbilities, ...badAbilities];\r\n\t\t\tif (species.isMega) {\r\n\t\t\t\tif (isAAA) {\r\n\t\t\t\t\tabilitySet.unshift(['html', `Will be <strong>${species.abilities['0']}</strong> after Mega Evolving.`]);\r\n\t\t\t\t}\r\n\t\t\t\t// species is unused after this, so no need to replace\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn abilitySet;\r\n\t}\r\n\tfilter(row: SearchRow, filters: string[][]) {\r\n\t\tif (!filters) return true;\r\n\t\tif (row[0] !== 'ability') return true;\r\n\t\tconst ability = this.dex.abilities.get(row[1]);\r\n\t\tfor (const [filterType, value] of filters) {\r\n\t\t\tswitch (filterType) {\r\n\t\t\tcase 'pokemon':\r\n\t\t\t\tif (!Dex.hasAbility(this.dex.species.get(value), ability.name)) return false;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\tsort(results: SearchRow[], sortCol: string | null, reverseSort?: boolean): SearchRow[] {\r\n\t\tthrow new Error(\"invalid sortcol\");\r\n\t}\r\n}\r\n\r\nclass BattleItemSearch extends BattleTypedSearch<'item'> {\r\n\tgetTable() {\r\n\t\treturn BattleItems;\r\n\t}\r\n\tgetDefaultResults(): SearchRow[] {\r\n\t\tlet table = BattleTeambuilderTable;\r\n\t\tif (this.formatType?.startsWith('bdsp')) {\r\n\t\t\ttable = table['gen8bdsp'];\r\n\t\t} else if (this.formatType === 'natdex') {\r\n\t\t\ttable = table['gen' + this.dex.gen + 'natdex'];\r\n\t\t} else if (this.formatType === 'metronome') {\r\n\t\t\ttable = table['gen' + this.dex.gen + 'metronome'];\r\n\t\t} else if (this.dex.gen < 9) {\r\n\t\t\ttable = table['gen' + this.dex.gen];\r\n\t\t}\r\n\t\tif (!table.itemSet) {\r\n\t\t\ttable.itemSet = table.items.map((r: any) => {\r\n\t\t\t\tif (typeof r === 'string') {\r\n\t\t\t\t\treturn ['item', r];\r\n\t\t\t\t}\r\n\t\t\t\treturn [r[0], r[1]];\r\n\t\t\t});\r\n\t\t\ttable.items = null;\r\n\t\t}\r\n\t\treturn table.itemSet;\r\n\t}\r\n\tgetBaseResults(): SearchRow[] {\r\n\t\tif (!this.species) return this.getDefaultResults();\r\n\t\tconst speciesName = this.dex.species.get(this.species).name;\r\n\t\tconst results = this.getDefaultResults();\r\n\t\tconst speciesSpecific: SearchRow[] = [];\r\n\t\tfor (const row of results) {\r\n\t\t\tif (row[0] !== 'item') continue;\r\n\t\t\tif (this.dex.items.get(row[1]).itemUser?.includes(speciesName)) {\r\n\t\t\t\tspeciesSpecific.push(row);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (speciesSpecific.length) {\r\n\t\t\treturn [\r\n\t\t\t\t['header', \"Specific to \" + speciesName],\r\n\t\t\t\t...speciesSpecific,\r\n\t\t\t\t...results,\r\n\t\t\t];\r\n\t\t}\r\n\t\treturn results;\r\n\t}\r\n\tfilter(row: SearchRow, filters: string[][]) {\r\n\t\tif (!filters) return true;\r\n\t\tif (row[0] !== 'ability') return true;\r\n\t\tconst ability = this.dex.abilities.get(row[1]);\r\n\t\tfor (const [filterType, value] of filters) {\r\n\t\t\tswitch (filterType) {\r\n\t\t\tcase 'pokemon':\r\n\t\t\t\tif (!Dex.hasAbility(this.dex.species.get(value), ability.name)) return false;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\tsort(results: SearchRow[], sortCol: string | null, reverseSort?: boolean): SearchRow[] {\r\n\t\tthrow new Error(\"invalid sortcol\");\r\n\t}\r\n}\r\n\r\nclass BattleMoveSearch extends BattleTypedSearch<'move'> {\r\n\tsortRow: SearchRow = ['sortmove', ''];\r\n\tgetTable() {\r\n\t\treturn BattleMovedex;\r\n\t}\r\n\tgetDefaultResults(): SearchRow[] {\r\n\t\tlet results: SearchRow[] = [];\r\n\t\tresults.push(['header', \"Moves\"]);\r\n\t\tfor (let id in BattleMovedex) {\r\n\t\t\tswitch (id) {\r\n\t\t\tcase 'paleowave':\r\n\t\t\t\tresults.push(['header', \"CAP moves\"]);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'magikarpsrevenge':\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tresults.push(['move', id as ID]);\r\n\t\t}\r\n\t\treturn results;\r\n\t}\r\n\tprivate moveIsNotUseless(id: ID, species: Species, moves: string[], set: PokemonSet | null) {\r\n\t\tconst dex = this.dex;\r\n\r\n\t\tlet abilityid: ID = set ? toID(set.ability) : '' as ID;\r\n\t\tconst itemid: ID = set ? toID(set.item) : '' as ID;\r\n\r\n\t\tif (dex.gen === 1) {\r\n\t\t\t// Usually not useless for Gen 1\r\n\t\t\tif ([\r\n\t\t\t\t'acidarmor', 'amnesia', 'barrier', 'bind', 'blizzard', 'clamp', 'confuseray', 'counter', 'firespin', 'growth', 'headbutt', 'hyperbeam', 'mirrormove', 'pinmissile', 'razorleaf', 'sing', 'slash', 'sludge', 'twineedle', 'wrap',\r\n\t\t\t].includes(id)) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\t// Usually useless for Gen 1\r\n\t\t\tif ([\r\n\t\t\t\t'disable', 'haze', 'leechseed', 'quickattack', 'roar', 'thunder', 'toxic', 'triattack', 'waterfall', 'whirlwind',\r\n\t\t\t].includes(id)) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\t// Not useless only when certain moves aren't present\r\n\t\t\tswitch (id) {\r\n\t\t\tcase 'bubblebeam': return (!moves.includes('surf') && !moves.includes('blizzard'));\r\n\t\t\tcase 'doubleedge': return !moves.includes('bodyslam');\r\n\t\t\tcase 'doublekick': return !moves.includes('submission');\r\n\t\t\tcase 'firepunch': return !moves.includes('fireblast');\r\n\t\t\tcase 'megadrain': return !moves.includes('razorleaf') && !moves.includes('surf');\r\n\t\t\tcase 'megakick': return !moves.includes('hyperbeam');\r\n\t\t\tcase 'reflect': return !moves.includes('barrier') && !moves.includes('acidarmor');\r\n\t\t\tcase 'stomp': return !moves.includes('headbutt');\r\n\t\t\tcase 'submission': return !moves.includes('highjumpkick');\r\n\t\t\tcase 'thunderpunch': return !moves.includes('thunderbolt');\r\n\t\t\tcase 'triattack': return !moves.includes('bodyslam');\r\n\t\t\t}\r\n\t\t\t// Useful and Useless moves for Stadium OU, which changes many game mechanics.\r\n\t\t\tif (this.formatType === 'stadium') {\r\n\t\t\t\tif (['doubleedge', 'focusenergy', 'haze'].includes(id)) return true;\r\n\t\t\t\tif (['hyperbeam', 'sing', 'hypnosis'].includes(id)) return false;\r\n\t\t\t\tswitch (id) {\r\n\t\t\t\tcase 'fly': return !moves.includes('drillpeck');\r\n\t\t\t\tcase 'dig': return !moves.includes('earthquake');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.formatType === 'letsgo') {\r\n\t\t\tif (['megadrain', 'teleport'].includes(id)) return true;\r\n\t\t}\r\n\r\n\t\tif (this.formatType === 'metronome') {\r\n\t\t\tif (id === 'metronome') return true;\r\n\t\t}\r\n\r\n\t\tif (itemid === 'pidgeotite' || itemid === 'poliwrathite') abilityid = 'noguard' as ID;\r\n\t\tif (itemid === 'blastoisinite' || itemid === 'deltablastoisinite') abilityid = 'megalauncher' as ID;\r\n\t\tif (itemid === 'aerodactylite' || itemid === 'feraligatite' || itemid === 'spiritombite') abilityid = 'toughclaws' as ID;\r\n\t\tif (itemid === 'glalitite') abilityid = 'refrigerate' as ID;\r\n\t\tif (itemid === 'shiftrite') abilityid = 'shadowdance' as ID;\r\n\t\tif (itemid === 'deltacharizardite') abilityid = 'noctem' as ID;\r\n\t\tif (itemid === 'deltabisharpite') abilityid = 'technician' as ID;\r\n\t\tif (itemid === 'golurkite') abilityid = 'sheerforce' as ID;\r\n\r\n\t\tswitch (id) {\r\n\t\tcase 'fakeout': case 'flamecharge': case 'nuzzle': case 'poweruppunch':\r\n\t\t\treturn abilityid !== 'sheerforce';\r\n\t\tcase 'solarbeam': case 'solarblade':\r\n\t\t\treturn ['desolateland', 'drought', 'chlorophyll', 'orichalcumpulse'].includes(abilityid) || itemid === 'powerherb';\r\n\t\tcase 'lunarcannon':\r\n\t\t\treturn ['noctem', 'shadowdance'].includes(abilityid) || itemid === 'powerherb';\r\n\t\tcase 'dynamicpunch': case 'grasswhistle': case 'inferno': case 'sing': case 'zapcannon':\r\n\t\t\treturn abilityid === 'noguard';\r\n\t\tcase 'heatcrash': case 'heavyslam':\r\n\t\t\treturn species.weightkg >= (species.evos ? 75 : 130);\r\n\r\n\t\tcase 'aerialace':\r\n\t\t\treturn ['technician', 'toughclaws'].includes(abilityid) && !moves.includes('bravebird');\r\n\t\tcase 'ancientpower':\r\n\t\t\treturn ['serenegrace', 'technician'].includes(abilityid) || !moves.includes('powergem');\r\n\t\tcase 'aquajet':\r\n\t\t\treturn !moves.includes('jetpunch');\r\n\t\tcase 'aurawheel':\r\n\t\t\treturn species.baseSpecies === 'Morpeko';\r\n\t\tcase 'axekick':\r\n\t\t\treturn !moves.includes('highjumpkick');\r\n\t\tcase 'bellydrum':\r\n\t\t\treturn moves.includes('aquajet') || moves.includes('jetpunch') || moves.includes('extremespeed') ||\r\n\t\t\t\t['iceface', 'unburden'].includes(abilityid);\r\n\t\tcase 'bulletseed':\r\n\t\t\treturn ['skilllink', 'technician'].includes(abilityid);\r\n\t\tcase 'chillingwater':\r\n\t\t\treturn !moves.includes('scald');\r\n\t\tcase 'counter':\r\n\t\t\treturn species.baseStats.hp >= 65;\r\n\t\tcase 'darkvoid':\r\n\t\t\treturn dex.gen < 7;\r\n\t\tcase 'dualwingbeat':\r\n\t\t\treturn abilityid === 'technician' || !moves.includes('drillpeck');\r\n\t\tcase 'feint':\r\n\t\t\treturn abilityid === 'refrigerate';\r\n\t\tcase 'grassyglide':\r\n\t\t\treturn abilityid === 'grassysurge';\r\n\t\tcase 'gyroball':\r\n\t\t\treturn species.baseStats.spe <= 60;\r\n\t\tcase 'headbutt':\r\n\t\t\treturn abilityid === 'serenegrace';\r\n\t\tcase 'hex':\r\n\t\t\treturn !moves.includes('infernalparade');\r\n\t\tcase 'hiddenpowerelectric':\r\n\t\t\treturn (dex.gen < 4 && !moves.includes('thunderpunch')) && !moves.includes('thunderbolt');\r\n\t\tcase 'hiddenpowerfighting':\r\n\t\t\treturn (dex.gen < 4 && !moves.includes('brickbreak')) && !moves.includes('aurasphere') && !moves.includes('focusblast');\r\n\t\tcase 'hiddenpowerfire':\r\n\t\t\treturn (dex.gen < 4 && !moves.includes('firepunch')) && !moves.includes('flamethrower') &&\r\n\t\t\t\t!moves.includes('mysticalfire') && !moves.includes('burningjealousy');\r\n\t\tcase 'hiddenpowergrass':\r\n\t\t\treturn !moves.includes('energyball') && !moves.includes('grassknot') && !moves.includes('gigadrain');\r\n\t\tcase 'hiddenpowerice':\r\n\t\t\treturn !moves.includes('icebeam') && (dex.gen < 4 && !moves.includes('icepunch')) ||\r\n\t\t\t\t(dex.gen > 5 && !moves.includes('aurorabeam') && !moves.includes('glaciate'));\r\n\t\tcase 'hiddenpowerflying':\r\n\t\t\treturn dex.gen < 4 && !moves.includes('drillpeck');\r\n\t\tcase 'hiddenpowerbug':\r\n\t\t\treturn dex.gen < 4 && !moves.includes('megahorn');\r\n\t\tcase 'hiddenpowerpsychic':\r\n\t\t\treturn species.baseSpecies === 'Unown';\r\n\t\tcase 'hyperspacefury':\r\n\t\t\treturn species.id === 'hoopaunbound';\r\n\t\tcase 'spiritaway':\r\n\t\t\treturn species.id === 'hoopadeltaunleashed';\r\n\t\tcase 'hypnosis':\r\n\t\t\treturn (dex.gen < 4 && !moves.includes('sleeppowder')) || (dex.gen > 6 && abilityid === 'baddreams');\r\n\t\tcase 'icepunch':\r\n\t\t\treturn !moves.includes('icespinner') || ['sheerforce', 'ironfist'].includes(abilityid) || itemid === 'punchingglove';\r\n\t\tcase 'iciclecrash':\r\n\t\t\treturn !moves.includes('mountaingale');\r\n\t\tcase 'icywind':\r\n\t\t\t// Keldeo needs Hidden Power for Electric/Ghost\r\n\t\t\treturn species.baseSpecies === 'Keldeo' || this.formatType === 'doubles';\r\n\t\tcase 'infestation':\r\n\t\t\treturn moves.includes('stickyweb');\r\n\t\tcase 'irondefense':\r\n\t\t\treturn !moves.includes('acidarmor');\r\n\t\tcase 'irontail':\r\n\t\t\treturn dex.gen > 5 && !moves.includes('ironhead') && !moves.includes('gunkshot') && !moves.includes('poisonjab');\r\n\t\tcase 'jumpkick':\r\n\t\t\treturn !moves.includes('highjumpkick') && !moves.includes('axekick');\r\n\t\tcase 'lastresort':\r\n\t\t\treturn set && set.moves.length < 3;\r\n\t\tcase 'leechlife':\r\n\t\t\treturn dex.gen > 6;\r\n\t\tcase 'mysticalfire':\r\n\t\t\treturn dex.gen > 6 && !moves.includes('flamethrower');\r\n\t\tcase 'naturepower':\r\n\t\t\treturn dex.gen === 5;\r\n\t\tcase 'nightslash':\r\n\t\t\treturn !moves.includes('crunch') && !(moves.includes('knockoff') && dex.gen >= 6);\r\n\t\tcase 'outrage':\r\n\t\t\treturn !moves.includes('glaiverush');\r\n\t\tcase 'petaldance':\r\n\t\t\treturn abilityid === 'owntempo';\r\n\t\tcase 'shadowforce':\r\n\t\t\treturn (!moves.includes('poltergeist') && !moves.includes('shadowclaw') && !moves.includes('zombiestrike')) || this.formatType === 'doubles'\r\n\t\t\t|| ['noctem', 'shadowdance'].includes(abilityid) || itemid === 'powerherb';\r\n\t\tcase 'phantomforce':\r\n\t\t\treturn !moves.includes('shadowforce') && ((!moves.includes('poltergeist') && !moves.includes('shadowclaw') && !moves.includes('zombiestrike'))\r\n\t\t\t|| this.formatType === 'doubles' || ['noctem', 'shadowdance'].includes(abilityid) || itemid === 'powerherb');\r\n\t\tcase 'poisonfang':\r\n\t\t\treturn species.types.includes('Poison') && !moves.includes('gunkshot') && !moves.includes('poisonjab');\r\n\t\tcase 'relicsong':\r\n\t\t\treturn species.num === 648;\r\n\t\tcase 'refresh':\r\n\t\t\treturn !moves.includes('aromatherapy') && !moves.includes('healbell');\r\n\t\tcase 'risingvoltage':\r\n\t\t\treturn abilityid === 'electricsurge' || abilityid === 'hadronengine';\r\n\t\tcase 'rocktomb':\r\n\t\t\treturn abilityid === 'technician';\r\n\t\tcase 'selfdestruct':\r\n\t\t\treturn dex.gen < 5 && !moves.includes('explosion');\r\n\t\tcase 'shadowpunch':\r\n\t\t\treturn abilityid === 'ironfist' && !moves.includes('ragefist');\r\n\t\tcase 'shelter':\r\n\t\t\treturn !moves.includes('acidarmor') && !moves.includes('irondefense');\r\n\t\tcase 'smackdown':\r\n\t\t\treturn species.types.includes('Ground');\r\n\t\tcase 'smartstrike':\r\n\t\t\treturn species.types.includes('Steel') && !moves.includes('ironhead');\r\n\t\tcase 'soak':\r\n\t\t\treturn abilityid === 'unaware';\r\n\t\tcase 'steelwing':\r\n\t\t\treturn !moves.includes('ironhead');\r\n\t\tcase 'stompingtantrum':\r\n\t\t\treturn (!moves.includes('earthquake') && !moves.includes('drillrun')) || this.formatType === 'doubles';\r\n\t\tcase 'stunspore':\r\n\t\t\treturn !moves.includes('thunderwave');\r\n\t\tcase 'technoblast':\r\n\t\t\treturn dex.gen > 5 && itemid.endsWith('drive') || itemid === 'dousedrive';\r\n\t\tcase 'teleport':\r\n\t\t\treturn dex.gen > 7;\r\n\t\tcase 'terrainpulse': case 'waterpulse':\r\n\t\t\treturn ['megalauncher', 'technician'].includes(abilityid) && !moves.includes('originpulse');\r\n\t\tcase 'toxicspikes':\r\n\t\t\treturn abilityid !== 'toxicdebris';\r\n\t\tcase 'trickroom':\r\n\t\t\treturn species.baseStats.spe <= 100;\r\n\t\t}\r\n\r\n\t\tif (this.formatType === 'doubles' && BattleMoveSearch.GOOD_DOUBLES_MOVES.includes(id)) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tconst moveData = BattleMovedex[id];\r\n\t\tif (!moveData) return true;\r\n\t\tif (moveData.category === 'Status') {\r\n\t\t\treturn BattleMoveSearch.GOOD_STATUS_MOVES.includes(id);\r\n\t\t}\r\n\t\tif (moveData.basePower < 75) {\r\n\t\t\treturn BattleMoveSearch.GOOD_WEAK_MOVES.includes(id);\r\n\t\t}\r\n\t\tif (id === 'skydrop') return true;\r\n\t\t// strong moves\r\n\t\tif (moveData.flags?.charge) {\r\n\t\t\treturn itemid === 'powerherb';\r\n\t\t}\r\n\t\tif (moveData.flags?.recharge) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif (moveData.flags?.slicing && abilityid === 'sharpness') {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn !BattleMoveSearch.BAD_STRONG_MOVES.includes(id);\r\n\t}\r\n\tstatic readonly GOOD_STATUS_MOVES = [\r\n\t\t'acidarmor', 'agility', 'aromatherapy', 'auroraveil', 'autotomize', 'banefulbunker', 'batonpass', 'bellydrum', 'bulkup', 'calmmind', 'chillyreception', 'clangoroussoul', 'coil', 'cottonguard', 'courtchange', 'curse', 'defog', 'destinybond', 'detect', 'disable', 'dragondance', 'encore', 'extremeevoboost', 'filletaway', 'geomancy', 'glare', 'haze', 'healbell', 'healingwish', 'healorder', 'heartswap', 'honeclaws', 'kingsshield', 'leechseed', 'lightscreen', 'lovelykiss', 'lunardance', 'magiccoat', 'maxguard', 'memento', 'milkdrink', 'moonlight', 'morningsun', 'nastyplot', 'naturesmadness', 'noretreat', 'obstruct', 'painsplit', 'partingshot', 'perishsong', 'protect', 'quiverdance', 'recover', 'reflect', 'reflecttype', 'rest', 'revivalblessing', 'roar', 'rockpolish', 'roost', 'shedtail', 'shellsmash', 'shiftgear', 'shoreup', 'silktrap', 'slackoff', 'sleeppowder', 'sleeptalk', 'softboiled', 'spikes', 'spikyshield', 'spore', 'stealthrock', 'stickyweb', 'strengthsap', 'substitute', 'switcheroo', 'swordsdance', 'synthesis', 'tailglow', 'tailwind', 'taunt', 'thunderwave', 'tidyup', 'toxic', 'transform', 'trick', 'victorydance', 'whirlwind', 'willowisp', 'wish', 'yawn',\r\n\t\t'livewire', 'nanorepair', 'permafrost', 'retrograde',\r\n\t] as ID[] as readonly ID[];\r\n\tstatic readonly GOOD_WEAK_MOVES = [\r\n\t\t'accelerock', 'acrobatics', 'aquacutter', 'avalanche', 'barbbarrage', 'bonemerang', 'bouncybubble', 'bulletpunch', 'buzzybuzz', 'ceaselessedge', 'circlethrow', 'clearsmog', 'doubleironbash', 'dragondarts', 'dragontail', 'drainingkiss', 'endeavor', 'facade', 'firefang', 'flipturn', 'flowertrick', 'freezedry', 'frustration', 'geargrind', 'grassknot', 'gyroball', 'icefang', 'iceshard', 'iciclespear', 'infernalparade', 'knockoff', 'lastrespects', 'lowkick', 'machpunch', 'mortalspin', 'mysticalpower', 'naturesmadness', 'nightshade', 'nuzzle', 'pikapapow', 'populationbomb', 'psychocut', 'psyshieldbash', 'pursuit', 'quickattack', 'ragefist', 'rapidspin', 'return', 'rockblast', 'ruination', 'saltcure', 'scorchingsands', 'seismictoss', 'shadowclaw', 'shadowsneak', 'sizzlyslide', 'stoneaxe', 'storedpower', 'stormthrow', 'suckerpunch', 'superfang', 'surgingstrikes', 'tailslap', 'trailblaze', 'tripleaxel', 'tripledive', 'twinbeam', 'uturn', 'veeveevolley', 'voltswitch', 'watershuriken', 'weatherball',\r\n\t\t'achillesheel', 'corrode', 'crystalrush', 'dracojet', 'wormhole',\r\n\t] as ID[] as readonly ID[];\r\n\tstatic readonly BAD_STRONG_MOVES = [\r\n\t\t'belch', 'burnup', 'crushclaw', 'dragonrush', 'dreameater', 'eggbomb', 'firepledge', 'flyingpress', 'grasspledge', 'hyperbeam', 'hyperfang', 'hyperspacehole', 'jawlock', 'landswrath', 'megakick', 'megapunch', 'mistyexplosion', 'muddywater', 'nightdaze', 'pollenpuff', 'rockclimb', 'selfdestruct', 'shelltrap', 'skyuppercut', 'slam', 'strength', 'submission', 'synchronoise', 'takedown', 'thrash', 'uproar', 'waterpledge',\r\n\t\t'darkmatter',\r\n\t] as ID[] as readonly ID[];\r\n\tstatic readonly GOOD_DOUBLES_MOVES = [\r\n\t\t'allyswitch', 'bulldoze', 'coaching', 'electroweb', 'faketears', 'fling', 'followme', 'healpulse', 'helpinghand', 'junglehealing', 'lifedew', 'lunarblessing', 'muddywater', 'pollenpuff', 'psychup', 'ragepowder', 'safeguard', 'skillswap', 'snipeshot', 'wideguard',\r\n\t\t'wildfire',\r\n\t] as ID[] as readonly ID[];\r\n\tgetBaseResults() {\r\n\t\tif (!this.species) return this.getDefaultResults();\r\n\t\tconst dex = this.dex;\r\n\t\tlet species = dex.species.get(this.species);\r\n\t\tconst format = this.format;\r\n\t\tconst isHackmons = (format.includes('hackmons') || format.endsWith('bh'));\r\n\t\tconst isSTABmons = (format.includes('stabmons') || format === 'staaabmons');\r\n\t\tconst isTradebacks = format.includes('tradebacks');\r\n\t\tconst regionBornLegality = dex.gen >= 6 &&\r\n\t\t\t/^battle(spot|stadium|festival)/.test(format) || format.startsWith('vgc') ||\r\n\t\t\t(dex.gen === 9 && this.formatType !== 'natdex');\r\n\r\n\t\tlet learnsetid = this.firstLearnsetid(species.id);\r\n\t\tlet moves: string[] = [];\r\n\t\tlet sketchMoves: string[] = [];\r\n\t\tlet sketch = false;\r\n\t\tlet gen = '' + dex.gen;\r\n\t\tlet lsetTable = BattleTeambuilderTable;\r\n\t\tif (this.formatType?.startsWith('bdsp')) lsetTable = lsetTable['gen8bdsp'];\r\n\t\tif (this.formatType === 'letsgo') lsetTable = lsetTable['gen7letsgo'];\r\n\t\tif (this.formatType?.startsWith('dlc1')) lsetTable = lsetTable['gen8dlc1'];\r\n\t\twhile (learnsetid) {\r\n\t\t\tlet learnset = lsetTable.learnsets[learnsetid];\r\n\t\t\tif (learnset) {\r\n\t\t\t\tfor (let moveid in learnset) {\r\n\t\t\t\t\tlet learnsetEntry = learnset[moveid];\r\n\t\t\t\t\tconst move = dex.moves.get(moveid);\r\n\t\t\t\t\tconst minGenCode: {[gen: number]: string} = {6: 'p', 7: 'q', 8: 'g', 9: 'a'};\r\n\t\t\t\t\tif (regionBornLegality && !learnsetEntry.includes(minGenCode[dex.gen])) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (\r\n\t\t\t\t\t\t!learnsetEntry.includes(gen) &&\r\n\t\t\t\t\t\t(!isTradebacks ? true : !(move.gen <= dex.gen && learnsetEntry.includes('' + (dex.gen + 1))))\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (this.formatType !== 'natdex' && move.isNonstandard === \"Past\") {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (\r\n\t\t\t\t\t\tthis.formatType?.startsWith('dlc1') &&\r\n\t\t\t\t\t\tBattleTeambuilderTable['gen8dlc1']?.nonstandardMoves.includes(moveid)\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (moves.includes(moveid)) continue;\r\n\t\t\t\t\tmoves.push(moveid);\r\n\t\t\t\t\tif (moveid === 'sketch') sketch = true;\r\n\t\t\t\t\tif (moveid === 'hiddenpower') {\r\n\t\t\t\t\t\tmoves.push(\r\n\t\t\t\t\t\t\t'hiddenpowerbug', 'hiddenpowerdark', 'hiddenpowerdragon', 'hiddenpowerelectric', 'hiddenpowerfighting', 'hiddenpowerfire', 'hiddenpowerflying', 'hiddenpowerghost', 'hiddenpowergrass', 'hiddenpowerground', 'hiddenpowerice', 'hiddenpowerpoison', 'hiddenpowerpsychic', 'hiddenpowerrock', 'hiddenpowersteel', 'hiddenpowerwater'\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlearnsetid = this.nextLearnsetid(learnsetid, species.id);\r\n\t\t}\r\n\t\tif (sketch || isHackmons) {\r\n\t\t\tif (isHackmons) moves = [];\r\n\t\t\tfor (let id in BattleMovedex) {\r\n\t\t\t\tif (!format.startsWith('cap') && (id === 'paleowave' || id === 'shadowstrike')) continue;\r\n\t\t\t\tconst move = dex.moves.get(id);\r\n\t\t\t\tif (move.gen > dex.gen) continue;\r\n\t\t\t\tif (sketch) {\r\n\t\t\t\t\tif (move.noSketch || move.isMax || move.isZ) continue;\r\n\t\t\t\t\tif (move.isNonstandard && move.isNonstandard !== 'Past') continue;\r\n\t\t\t\t\tif (move.isNonstandard === 'Past' && this.formatType !== 'natdex') continue;\r\n\t\t\t\t\tsketchMoves.push(move.id);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (!(dex.gen < 8 || this.formatType === 'natdex') && move.isZ) continue;\r\n\t\t\t\t\tif (typeof move.isMax === 'string') continue;\r\n\t\t\t\t\tif (move.isMax && dex.gen > 8) continue;\r\n\t\t\t\t\tif (move.isNonstandard === 'Past' && this.formatType !== 'natdex') continue;\r\n\t\t\t\t\tif (move.isNonstandard === 'LGPE' && this.formatType !== 'letsgo') continue;\r\n\t\t\t\t\tmoves.push(move.id);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this.formatType === 'metronome') moves = ['metronome'];\r\n\t\tif (isSTABmons) {\r\n\t\t\tfor (let id in this.getTable()) {\r\n\t\t\t\tconst move = dex.moves.get(id);\r\n\t\t\t\tif (moves.includes(move.id)) continue;\r\n\t\t\t\tif (move.gen > dex.gen) continue;\r\n\t\t\t\tif (move.isZ || move.isMax || (move.isNonstandard && move.isNonstandard !== 'Unobtainable')) continue;\r\n\r\n\t\t\t\tconst speciesTypes: string[] = [];\r\n\t\t\t\tconst moveTypes: string[] = [];\r\n\t\t\t\tfor (let i = dex.gen; i >= species.gen && i >= move.gen; i--) {\r\n\t\t\t\t\tconst genDex = Dex.forGen(i);\r\n\t\t\t\t\tmoveTypes.push(genDex.moves.get(move.name).type);\r\n\r\n\t\t\t\t\tconst pokemon = genDex.species.get(species.name);\r\n\t\t\t\t\tlet baseSpecies = genDex.species.get(pokemon.changesFrom || pokemon.name);\r\n\t\t\t\t\tif (!pokemon.battleOnly) speciesTypes.push(...pokemon.types);\r\n\t\t\t\t\tlet prevo = pokemon.prevo;\r\n\t\t\t\t\twhile (prevo) {\r\n\t\t\t\t\t\tconst prevoSpecies = genDex.species.get(prevo);\r\n\t\t\t\t\t\tspeciesTypes.push(...prevoSpecies.types);\r\n\t\t\t\t\t\tprevo = prevoSpecies.prevo;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (pokemon.battleOnly && typeof pokemon.battleOnly === 'string') {\r\n\t\t\t\t\t\tspecies = dex.species.get(pokemon.battleOnly);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst excludedForme = (s: Species) => [\r\n\t\t\t\t\t\t'Alola', 'Alola-Totem', 'Galar', 'Galar-Zen', 'Hisui', 'Paldea', 'Paldea-Combat', 'Paldea-Blaze', 'Paldea-Aqua',\r\n\t\t\t\t\t].includes(s.forme);\r\n\t\t\t\t\tif (baseSpecies.otherFormes && !['Wormadam', 'Urshifu'].includes(baseSpecies.baseSpecies)) {\r\n\t\t\t\t\t\tif (!excludedForme(species)) speciesTypes.push(...baseSpecies.types);\r\n\t\t\t\t\t\tfor (const formeName of baseSpecies.otherFormes) {\r\n\t\t\t\t\t\t\tconst forme = dex.species.get(formeName);\r\n\t\t\t\t\t\t\tif (!forme.battleOnly && !excludedForme(forme)) speciesTypes.push(...forme.types);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tlet valid = false;\r\n\t\t\t\tfor (let type of moveTypes) {\r\n\t\t\t\t\tif (speciesTypes.includes(type)) {\r\n\t\t\t\t\t\tvalid = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (valid) moves.push(id);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tmoves.sort();\r\n\t\tsketchMoves.sort();\r\n\r\n\t\tlet usableMoves: SearchRow[] = [];\r\n\t\tlet uselessMoves: SearchRow[] = [];\r\n\t\tfor (const id of moves) {\r\n\t\t\tconst isUsable = this.moveIsNotUseless(id as ID, species, moves, this.set);\r\n\t\t\tif (isUsable) {\r\n\t\t\t\tif (!usableMoves.length) usableMoves.push(['header', \"Moves\"]);\r\n\t\t\t\tusableMoves.push(['move', id as ID]);\r\n\t\t\t} else {\r\n\t\t\t\tif (!uselessMoves.length) uselessMoves.push(['header', \"Usually useless moves\"]);\r\n\t\t\t\tuselessMoves.push(['move', id as ID]);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (sketchMoves.length) {\r\n\t\t\tusableMoves.push(['header', \"Sketched moves\"]);\r\n\t\t\tuselessMoves.push(['header', \"Useless sketched moves\"]);\r\n\t\t}\r\n\t\tfor (const id of sketchMoves) {\r\n\t\t\tconst isUsable = this.moveIsNotUseless(id as ID, species, sketchMoves, this.set);\r\n\t\t\tif (isUsable) {\r\n\t\t\t\tusableMoves.push(['move', id as ID]);\r\n\t\t\t} else {\r\n\t\t\t\tuselessMoves.push(['move', id as ID]);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn [...usableMoves, ...uselessMoves];\r\n\t}\r\n\tfilter(row: SearchRow, filters: string[][]) {\r\n\t\tif (!filters) return true;\r\n\t\tif (row[0] !== 'move') return true;\r\n\t\tconst move = this.dex.moves.get(row[1]);\r\n\t\tfor (const [filterType, value] of filters) {\r\n\t\t\tswitch (filterType) {\r\n\t\t\tcase 'type':\r\n\t\t\t\tif (move.type !== value) return false;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'category':\r\n\t\t\t\tif (move.category !== value) return false;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'pokemon':\r\n\t\t\t\tif (!this.canLearn(value as ID, move.id)) return false;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\tsort(results: SearchRow[], sortCol: string, reverseSort?: boolean): SearchRow[] {\r\n\t\tconst sortOrder = reverseSort ? -1 : 1;\r\n\t\tswitch (sortCol) {\r\n\t\tcase 'power':\r\n\t\t\tlet powerTable: {[id: string]: number | undefined} = {\r\n\t\t\t\treturn: 102, frustration: 102, spitup: 300, trumpcard: 200, naturalgift: 80, grassknot: 120,\r\n\t\t\t\tlowkick: 120, gyroball: 150, electroball: 150, flail: 200, reversal: 200, present: 120,\r\n\t\t\t\twringout: 120, crushgrip: 120, heatcrash: 120, heavyslam: 120, fling: 130, magnitude: 150,\r\n\t\t\t\tbeatup: 24, punishment: 1020, psywave: 1250, nightshade: 1200, seismictoss: 1200,\r\n\t\t\t\tdragonrage: 1140, sonicboom: 1120, superfang: 1350, endeavor: 1399, sheercold: 1501,\r\n\t\t\t\tfissure: 1500, horndrill: 1500, guillotine: 1500,\r\n\t\t\t};\r\n\t\t\treturn results.sort(([rowType1, id1], [rowType2, id2]) => {\r\n\t\t\t\tlet move1 = this.dex.moves.get(id1);\r\n\t\t\t\tlet move2 = this.dex.moves.get(id2);\r\n\t\t\t\tlet pow1 = move1.basePower || powerTable[id1] || (move1.category === 'Status' ? -1 : 1400);\r\n\t\t\t\tlet pow2 = move2.basePower || powerTable[id2] || (move2.category === 'Status' ? -1 : 1400);\r\n\t\t\t\treturn (pow2 - pow1) * sortOrder;\r\n\t\t\t});\r\n\t\tcase 'accuracy':\r\n\t\t\treturn results.sort(([rowType1, id1], [rowType2, id2]) => {\r\n\t\t\t\tlet accuracy1 = this.dex.moves.get(id1).accuracy || 0;\r\n\t\t\t\tlet accuracy2 = this.dex.moves.get(id2).accuracy || 0;\r\n\t\t\t\tif (accuracy1 === true) accuracy1 = 101;\r\n\t\t\t\tif (accuracy2 === true) accuracy2 = 101;\r\n\t\t\t\treturn (accuracy2 - accuracy1) * sortOrder;\r\n\t\t\t});\r\n\t\tcase 'pp':\r\n\t\t\treturn results.sort(([rowType1, id1], [rowType2, id2]) => {\r\n\t\t\t\tlet pp1 = this.dex.moves.get(id1).pp || 0;\r\n\t\t\t\tlet pp2 = this.dex.moves.get(id2).pp || 0;\r\n\t\t\t\treturn (pp2 - pp1) * sortOrder;\r\n\t\t\t});\r\n\t\tcase 'name':\r\n\t\t\treturn results.sort(([rowType1, id1], [rowType2, id2]) => {\r\n\t\t\t\tconst name1 = id1;\r\n\t\t\t\tconst name2 = id2;\r\n\t\t\t\treturn (name1 < name2 ? -1 : name1 > name2 ? 1 : 0) * sortOrder;\r\n\t\t\t});\r\n\t\t}\r\n\t\tthrow new Error(\"invalid sortcol\");\r\n\t}\r\n}\r\n\r\nclass BattleCategorySearch extends BattleTypedSearch<'category'> {\r\n\tgetTable() {\r\n\t\treturn {physical: 1, special: 1, status: 1};\r\n\t}\r\n\tgetDefaultResults(): SearchRow[] {\r\n\t\treturn [\r\n\t\t\t['category', 'physical' as ID],\r\n\t\t\t['category', 'special' as ID],\r\n\t\t\t['category', 'status' as ID],\r\n\t\t];\r\n\t}\r\n\tgetBaseResults() {\r\n\t\treturn this.getDefaultResults();\r\n\t}\r\n\tfilter(row: SearchRow, filters: string[][]): boolean {\r\n\t\tthrow new Error(\"invalid filter\");\r\n\t}\r\n\tsort(results: SearchRow[], sortCol: string | null, reverseSort?: boolean): SearchRow[] {\r\n\t\tthrow new Error(\"invalid sortcol\");\r\n\t}\r\n}\r\n\r\nclass BattleTypeSearch extends BattleTypedSearch<'type'> {\r\n\tgetTable() {\r\n\t\treturn window.BattleTypeChart;\r\n\t}\r\n\tgetDefaultResults(): SearchRow[] {\r\n\t\tconst results: SearchRow[] = [];\r\n\t\tfor (let id in window.BattleTypeChart) {\r\n\t\t\tresults.push(['type', id as ID]);\r\n\t\t}\r\n\t\treturn results;\r\n\t}\r\n\tgetBaseResults() {\r\n\t\treturn this.getDefaultResults();\r\n\t}\r\n\tfilter(row: SearchRow, filters: string[][]): boolean {\r\n\t\tthrow new Error(\"invalid filter\");\r\n\t}\r\n\tsort(results: SearchRow[], sortCol: string | null, reverseSort?: boolean): SearchRow[] {\r\n\t\tthrow new Error(\"invalid sortcol\");\r\n\t}\r\n}\r\n"],"file":"battle-dex-search.js"}